<meta charset="utf-8"/>

{# Title / Description #}
<title>
    {% if title %}
        {{ title | annihilateTags(['sup', 'sub']) | striptags }}
            -
            {{ site.title }}
    {% else %}
        {{ site.title }}
            -
            {{ site.description }}
    {% endif %}
</title>

{% if excerpt %}
    <meta name="description" content="{{ excerpt | mdInline | safe | striptags }}">
{% else %}
    <meta name="description" content="{{ site.description }}">
{% endif %}

{# Compatibility #}
<meta content="IE=edge" http-equip="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>

{# Meta: Keywords #}
{# List a bunch of keywords which make sense for this page. #}
{% set page_keywords = [] %}
{% set page_keywords = page_keywords | push(site.author.alias | lower) %}
{% if title %}
    {% set page_keywords = page_keywords | push(title | annihilateTags(['sup', 'sub']) | striptags | lower | e) %}
{% endif %}
{% if excerpt %}
    {% set page_keywords = page_keywords | push(excerpt | lower | e) %}
{% endif %}
{% if tags %}
    {% set page_keywords = page_keywords | extend(tags | exclude('posts')) %}
{% endif %}
{% if keywords %}
    {% set page_keywords = page_keywords | extend(keywords) %}
{% endif %}
<meta name="keywords" content="{{page_keywords | join(',') | safe}}"/>

{# Meta: Robots #}
{# Configure how the page is indexed and crawled. #}
{% if noindex %}
    {% set index = "noindex" %}
{% else %}
    {% set index = "index" %}
{% endif %}
<meta name="robots" content="{{index}},follow"/>

{# Meta: CSP #}
<meta http-equiv='Content-Security-Policy' content="{{site.content_security_policy | safe}}"/>

{# Meta: RSS Auto-Discovery #}
<link href="/feeds/posts.xml" rel="alternate" title="RSS Feed for {{site.title}}" type="application/rss+xml"/>
{% if feedtags | contains(page.fileSlug) %}
    {# Additional tag for tag pages. #}
    <link href="/feeds/{{page.fileSlug}}.xml" rel="alternate" title="RSS Feed for {{site.title}} ({{page.fileSlug}})" type="application/rss+xml"/>
{% endif %}

{# OpenGraph Metadata #}
{# See https://ogp.me/. #}
<meta content="{{ site.title }}" property="og:site_name"/>
{% if title %}
    {% set meta_title = title | annihilateTags(['sup', 'sub']) | striptags %}
    <meta content="article" property="og:type"/>
{% else %}
    {% set meta_title = site.title %}
    <meta content="website" property="og:type"/>
{% endif %}
<meta content="{{ meta_title }}" property="og:title"/>
<meta content="{{ meta_title }}" property="twitter:title"/>

{% if excerpt %}
    {% set meta_desc = (excerpt | mdInline | striptags) + "<br/>" + (content | annihilate('.article-header, .metadata-container, .metadata-tag-container, #toc-sidebar') | striptags | truncateWords(30)) %}
{% else %}
    {% set meta_desc = site.description %}
{% endif %}
<meta content="{{meta_desc}}" property="og:description"/>
<meta content="{{meta_desc}}" property="twitter:description"/>

{% if page.url %}
    <meta content="{{ site.url }}{{ page.url }}" property="og:url"/>
{% endif %}
{% if thumbnail_src %}
    <meta name="twitter:card" content="summary_large_image">
    <meta content="{{ site.url }}{{ thumbnail_src | resolveImageOutputPath(page) }}" property="og:image"/>
    <meta content="{{ site.url }}{{ thumbnail_src | resolveImageOutputPath(page) }}" property="twitter:image"/>
{% endif %}
{% if page.date %}
    <meta content="{{ page.date | dateISO }}" property="article:published_time"/>
{% endif %}
{% if updated %}
    <meta content="{{ updated | dateISO }}" property="article:modified_time"/>
{% endif %}
<meta content="{{ site.author.alias }}" property="article:author"/>
{% if ogsection %}
    <meta content="{{ ogsection }}" property="article:section"/>
{% endif %}
{% if tags %}
    {% for t in tags | exclude('posts') %}
        <meta content="{{t}}" property="article:tag"/>
    {% endfor %}
{% endif %}