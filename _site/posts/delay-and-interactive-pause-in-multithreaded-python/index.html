<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Delay and Interactive Pause in Multi-Threaded Python - TrebledJ's Pages</title><meta name="description" content="It's like musical chairs for threads (except no one gets left behind)!"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="trebledj,delay and interactive pause in multi-threaded python,it's like musical chairs for threads (except no one gets left behind)!,programming,python,tutorial,infosec,pentesting,threading,Event,threading.Event,signal,asyncio,multiprocessing,multithreading,concurrent.futures,ThreadPoolExecutor,ProcessPoolExecutor,pause,pausing,sleep,delay"><meta name="robots" content="index,follow"><meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'sha256-Wv9Tjjg7Y7X5sBbP5AXqAQJA6+eewSRUjoPhNczfpnM=' 'sha256-FBtdNYnNdsvTKcrNIznI+jwGwhW3pNA5x/yQUw8jOPA=' 'sha256-puGfk8by7YflxyCkfgS+RgzE70yM3jYq5c5IrWTe0hM=' 'sha256-qlkNkQyGC5u9Brt4wwVi0MsPO/hVdrz3rzXuWYIkAbM=' 'sha256-fpqHX3vj/TpB8DyMxAUbt+Rpk0g/8oR6BkJd6JriNoo=' 'sha256-J+ryCgKrW+QOH4xdCyPd6R5W3u9wJkXayR7KvtlnCnQ=' 'sha256-Deekn20h+++EarpL0nFQLX7JSJv7s/2W9f988ZFAh14=' 'unsafe-hashes' comments.trebledj.me code.jquery.com cdn.jsdelivr.net gist.github.com static.cloudflareinsights.com; style-src 'self' 'unsafe-inline' comments.trebledj.me cdn.jsdelivr.net cdnjs.cloudflare.com github.githubassets.com; font-src 'self' data: comments.trebledj.me cdn.jsdelivr.net cdnjs.cloudflare.com; img-src 'self' data: comments.trebledj.me; frame-src 'self' *.soundcloud.com; connect-src 'self' comments.trebledj.me wss://comments.trebledj.me cloudflareinsights.com formcarry.com;"><link href="/feeds/posts.xml" rel="alternate" title="RSS Feed for TrebledJ's Pages" type="application/rss+xml"><meta property="og:site_name" content="TrebledJ's Pages"><meta property="og:type" content="article"><meta property="og:title" content="Delay and Interactive Pause in Multi-Threaded Python - TrebledJ's Pages"><meta property="twitter:title" content="Delay and Interactive Pause in Multi-Threaded Python - TrebledJ's Pages"><meta property="og:description" content="It's like musical chairs for threads (except no one gets left behind)!

Scanning the internet is not trivial, but Python excels at such network I/O tasks thanks to its simplicity and its vast ecosystem of libraries. Still, when dealing with the internet..."><meta property="twitter:description" content="It's like musical chairs for threads (except no one gets left behind)!

Scanning the internet is not trivial, but Python excels at such network I/O tasks thanks to its simplicity and its vast ecosystem of libraries. Still, when dealing with the internet..."><meta property="og:url" content="https://trebledj.me/posts/delay-and-interactive-pause-in-multithreaded-python/"><meta name="twitter:card" content="summary_large_image"><meta property="og:image" content="https://trebledj.me/img/posts/programming/mini-projects/interactive-pause-python/assets/thumbnail-1024w.webp"><meta property="twitter:image" content="https://trebledj.me/img/posts/programming/mini-projects/interactive-pause-python/assets/thumbnail-1024w.webp"><meta property="article:published_time" content="2025-03-10T00:00:00.000Z"><meta property="article:author" content="TrebledJ"><meta property="article:section" content="programming"><meta property="article:tag" content="programming"><meta property="article:tag" content="python"><meta property="article:tag" content="tutorial"><meta property="article:tag" content="infosec"><meta property="article:tag" content="pentesting"><script type="application/ld+json">{"@context": "https://schema.org","@type": "WebSite","name": "TrebledJ's Pages","url": "https://trebledj.me"}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/cb/css/icons-3b2a868570ec062c.css"><link rel="stylesheet" href="/cb/x2ljFSZBUH.css" media="print"><script>document.querySelectorAll('link[media|="print"]').forEach(e=>{e.addEventListener("load",()=>e.media="all"),e.sheet&&(e.media="all")})</script><script>const defaultTheme="dark";let icon=void 0;function modeInit(){var e=localStorage.getItem("theme");setMode("dark"===e?"dark":"light"===e?"light":defaultTheme)}function modeInitIcon(){icon=document.getElementById("mode-switch-icon"),isLightTheme()&&(icon.classList.remove("fa-moon"),icon.classList.add("fa-sun"),icon.classList.add("mode-switch-transform"))}function isLightTheme(){return"light"===localStorage.getItem("theme")}function modeSwitcher(){var e=localStorage.getItem("theme");setMode("dark"===e?"light":"light"===e?"dark":defaultTheme)}function setMode(e){"dark"===e?(document.documentElement.setAttribute("data-theme","dark"),localStorage.setItem("theme","dark")):"light"===e&&(document.documentElement.setAttribute("data-theme","light"),localStorage.setItem("theme","light")),icon&&(icon.classList.toggle("fa-moon"),icon.classList.toggle("fa-sun"),icon.classList.toggle("mode-switch-transform"))}modeInit(),document.addEventListener("DOMContentLoaded",()=>{document.getElementById("mode-switch").addEventListener("click",()=>{modeSwitcher()})})</script><script defer src="https://cdn.jsdelivr.net/npm/jquery@3.7.0/dist/jquery.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"><link rel="stylesheet" href="/css/comments.css"><link rel="icon" href="/favicon.ico" type="image/x-icon"></head><body><header><nav class="navbar navbar-expand-md py-2"><div class="container-fluid justify-content-between align-items-center"><button aria-controls="navbar-container" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler shadow-none" data-bs-target="#navbar-container" data-bs-toggle="collapse" type="button"><span id="navbar-toggler-icon"><i class="fas fa-bars"></i></span></button> <a class="navbar-brand no-decoration" href="/">TrebledJ's Pages</a><div class="navbar-collapse collapse" id="navbar-container"><ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="/">Home</a></li><li class="nav-item"><a class="nav-link" href="/about">About</a></li><li class="nav-item"><a class="nav-link" href="/posts">Posts</a></li><li class="nav-item"><a class="nav-link" href="/vulnerability-research">CVEs</a></li><li class="nav-item"><a class="nav-link" href="/music">Music</a></li><li class="nav-item"><a class="nav-link" href="/webroll">Webroll</a></li></ul><ul class="navbar-nav"><li><a class="nav-link me-2" data-bs-toggle="modal" data-bs-target="#search-modal" aria-label="Search..." role="button"><i class="fas fa-search nav-icon"></i></a></li><li><a class="nav-link" id="mode-switch" aria-label="Theme Switch" role="button"><i id="mode-switch-icon" class="fas fa-moon nav-icon"></i></a><script>modeInitIcon()</script></li></ul></div></div></nav><div id="scroll-progress-bar"></div></header><div id="top-of-the-morning-to-you"></div><div id="search-modal" class="modal fade wide-modal" aria-hidden="true" aria-label="Search" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header pb-2 d-flex flex-row justify-content-between"><div class="container-fluid ps-0" id="search-box-container"><input type="text" autofocus class="container-fluid" id="search-box" placeholder="Search"> <i class="fas fa-search"></i></div><button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button></div><div class="modal-body" id="search-results-list"></div></div></div></div><button id="btn-back-to-top" class="btn btn-lg" type="button" aria-label="Back to Top"><i class="fas fa-arrow-up"></i></button><div id="btn-mobile-toc" class="dropup"><button type="button" class="btn btn-lg" data-bs-toggle="dropdown" aria-label="Content"><i class="fas fa-list-ul"></i></button><ul class="dropdown-menu toc-container"><li><nav class="toc"><ol><li><a href="#a-tale-of-two-scripts">A Tale of Two Scripts</a><ol><li><a href="#basic-script">Basic Script</a></li><li><a href="#fancy-script">Fancy Script</a></li></ol></li><li><a href="#the-magic">The Magic</a><ol><li><a href="#threading-event">threading.Event</a></li><li><a href="#handling-ctrl-c-with-signal">Handling Ctrl+C with signal</a></li><li><a href="#write-a-pause-menu">Write a Pause Menu</a></li></ol></li><li><a href="#conclusion">Conclusion</a><ol><li><a href="#tl-dr">tl;dr</a></li><li><a href="#references">References</a></li></ol></li><li><a href="#appendix">Appendix</a><ol><li><a href="#appendix-a-bonus-rich-progress">Appendix A: Bonus - rich.progress</a></li><li><a href="#appendix-b-handling-future-results">Appendix B: Handling Future Results</a></li></ol></li></ol></nav></li></ul></div><div class="main-container"><div class="page-container col-lg-12"><div class="container-lg px-0"><article class="jw-100 post-article" itemscope itemtype="http://schema.org/BlogPosting"><div class="row flex-row-reverse gx-lg-5"><div class="col-lg-4 d-none d-lg-block"><div class="dim-deep"><div class="metadata-container d-flex"><div class="d-flex flex-row align-items-center"><span><i class="fas fa-calendar post-meta-icon me-1"></i> </span><span class="fs-7 post-posted-date">Posted on <span itemprop="datePublished" content="2025-03-10T08:00:00.000+08:00">2025‑03‑10</span></span></div><div class="d-flex flex-row align-items-center"></div><div class="d-flex flex-row align-items-center"><span><i class="far fa-clock post-meta-icon me-1"></i> </span><span class="fs-7">5 minute read</span></div></div><div class="metadata-tag-container"><span><i class="fas fa-tag post-meta-icon me-1 mt-2"></i></span><div class="tag-list d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a> </span><span><a class="jtag" href="/tags/python/" itemprop="keywords">python</a> </span><span><a class="jtag" href="/tags/tutorial/" itemprop="keywords">tutorial</a> </span><span><a class="jtag" href="/tags/infosec/" itemprop="keywords">infosec</a> </span><span><a class="jtag" href="/tags/pentesting/" itemprop="keywords">pentesting</a></span></div></div></div><br><div id="toc-sidebar" class="sticky-right dim-deep dim-if-dark"><div class="toc-container"><span><a id="toc-content" href="javascript:void(0);">Content</a></span><nav class="toc"><ol><li><a href="#a-tale-of-two-scripts">A Tale of Two Scripts</a><ol><li><a href="#basic-script">Basic Script</a></li><li><a href="#fancy-script">Fancy Script</a></li></ol></li><li><a href="#the-magic">The Magic</a><ol><li><a href="#threading-event">threading.Event</a></li><li><a href="#handling-ctrl-c-with-signal">Handling Ctrl+C with signal</a></li><li><a href="#write-a-pause-menu">Write a Pause Menu</a></li></ol></li><li><a href="#conclusion">Conclusion</a><ol><li><a href="#tl-dr">tl;dr</a></li><li><a href="#references">References</a></li></ol></li><li><a href="#appendix">Appendix</a><ol><li><a href="#appendix-a-bonus-rich-progress">Appendix A: Bonus - rich.progress</a></li><li><a href="#appendix-b-handling-future-results">Appendix B: Handling Future Results</a></li></ol></li></ol></nav><hr></div><div class="toc-link-container"><span><a href="#related">Related Posts</a></span></div><div class="toc-link-container"><span><a href="#comments">Comments</a></span></div></div></div><div class="col-lg-8 post-body-container"><div class="article-header"><h1 class="post-title" itemprop="name headline">Delay and Interactive Pause in Multi-Threaded Python</h1><p class="post-desc" itemprop="alternativeHeadline">It's like musical chairs for threads (except no one gets left behind)!</p><div class="d-lg-none dim-deep"><div class="metadata-container d-flex"><div class="d-flex flex-row align-items-center"><span><i class="fas fa-calendar post-meta-icon me-1"></i> </span><span class="fs-7 post-posted-date">Posted on <span itemprop="datePublished" content="2025-03-10T08:00:00.000+08:00">2025‑03‑10</span></span></div><div class="d-flex flex-row align-items-center"></div><div class="d-flex flex-row align-items-center"><span><i class="far fa-clock post-meta-icon me-1"></i> </span><span class="fs-7">5 minute read</span></div></div><div class="metadata-tag-container"><span><i class="fas fa-tag post-meta-icon me-1 mt-2"></i></span><div class="tag-list d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a> </span><span><a class="jtag" href="/tags/python/" itemprop="keywords">python</a> </span><span><a class="jtag" href="/tags/tutorial/" itemprop="keywords">tutorial</a> </span><span><a class="jtag" href="/tags/infosec/" itemprop="keywords">infosec</a> </span><span><a class="jtag" href="/tags/pentesting/" itemprop="keywords">pentesting</a></span></div></div></div></div><hr><div class="post-body text-content" itemprop="articleBody text"><img class="mb-2 rw center jw-100" src="/img/posts/programming/mini-projects/interactive-pause-python/assets/thumbnail-1024w.webp" loading="eager" decoding="async" style="aspect-ratio: auto 1024 / 768" alt="Delay and Interactive Pause in Multi-Threaded Python" title="Delay and Interactive Pause in Multi-Threaded Python" srcset="/img/posts/programming/mini-projects/interactive-pause-python/assets/thumbnail-256w.webp 256w, /img/posts/programming/mini-projects/interactive-pause-python/assets/thumbnail-512w.webp 512w, /img/posts/programming/mini-projects/interactive-pause-python/assets/thumbnail-1024w.webp 1024w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, (max-width: 1024px) 1024px, 1024px"><p>Scanning the internet is not trivial, but Python excels at such network I/O tasks thanks to its simplicity and its vast ecosystem of libraries. Still, when dealing with the internet, it’s not uncommon to encounter rate-limited endpoints and strongly firewalled sites. For penetration testing and red-teaming, opsec is also an important consideration. This means features such as delay and interactive pause are crucial — I'd even say desirable — to ensuring success and low false positives.</p><ul><li><strong>Delay</strong> (or throttling) allows us to rate-limit requests fired below the 1-thread threshold.</li><li><strong>Interactive Pause</strong> allows the user to adapt to changing circumstances. These include situations such as sudden network congestion leading to increased response time, <abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Web Application Firewalls">WAFs</abbr> kicking in due to excessive requests, local network failures, and sudden drops in bandwidth.<sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup></li></ul><p>In this post, I’ll be sharing how delay and interactive pause can be added to multithreaded Python scripts to enhance flexibility without compromising functionality.</p><p>Our objective is to pause the script when the user hits Ctrl+C, enter an interactive menu, then resume when “c” or “continue” is entered. We'll accomplish this with Python's pre-packaged <code>threading.Event</code> and <code>signal</code> libraries. (No additional dependencies!)</p><p><a class="lightbox-single" title="Diagram of UI flow when pausing and resuming." href="/img/posts/programming/mini-projects/interactive-pause-python/assets/interactive-pause-plan-562w.webp"><img class="mb-2 rw center jw-80 alpha-imgv" src="/img/posts/programming/mini-projects/interactive-pause-python/assets/interactive-pause-plan-562w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 562 / 209" alt="Diagram of UI flow when pausing and resuming." title="Diagram of UI flow when pausing and resuming." srcset="/img/posts/programming/mini-projects/interactive-pause-python/assets/interactive-pause-plan-256w.webp 256w, /img/posts/programming/mini-projects/interactive-pause-python/assets/interactive-pause-plan-512w.webp 512w, /img/posts/programming/mini-projects/interactive-pause-python/assets/interactive-pause-plan-562w.webp 562w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 562px"></a></p><p class="caption"><sup>Note: the first <em><strong>"Running"</strong></em> box extends slightly to the right, because threads may still be working even after Ctrl+C is hit. For instance, waiting for a response from an HTTP server.</sup></p><h2 id="a-tale-of-two-scripts" tabindex="-1"><a class="md-anchor" href="#a-tale-of-two-scripts" aria-hidden="true"></a> A Tale of Two Scripts</h2><p>To best demonstrate the addition of our desired features, I'll be presenting two scripts, a "before" and "after". I'll then highlight and explain the changes.</p><ol><li>The "before" is a very basic multithreading script. No delay and pause.</li><li>The "after" is a robust working example of multithreading with delay and pause.</li></ol><p>I’ll be demonstrating with Python threads via <code>concurrent.futures.ThreadPoolExecutor</code>. Python offers two other concurrency primitives: processes (<code>multiprocessing</code> / <code>ProcessPoolExecutor</code>) and green threads (<code>asyncio</code>). We won't discuss those today, but the gist is similar!</p><h3 id="basic-script" tabindex="-1"><a class="md-anchor" href="#basic-script" aria-hidden="true"></a> Basic Script</h3><div class="mb-2 rw center jw-80 video"><video autoplay loop muted class="jw-100"><source src="/img/demo1.mp4" type="video/mp4"></video></div><p class="caption"><sup>A simple script. The user has barely any control over the execution flow aside from parameters. Sufficient for straightforward scripts though.</sup></p><div class="code-toolbar"><pre data-label="mt_basic.py" class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> concurrent<span class="token punctuation">.</span>futures
<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep


<span class="token keyword">def</span> <span class="token function">thread_do_stuff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">thread_function</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[thread] task started </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    thread_do_stuff<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Simulate an IO task, e.g. requests.get().</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Start an executor with 2 threads and 10 tasks.</span>
    <span class="token keyword">with</span> concurrent<span class="token punctuation">.</span>futures<span class="token punctuation">.</span>ThreadPoolExecutor<span class="token punctuation">(</span>max_workers<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">as</span> executor<span class="token punctuation">:</span>
        not_done <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            f <span class="token operator">=</span> executor<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>thread_function<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
            not_done<span class="token punctuation">.</span>append<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
        
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token comment"># Process results while waiting.</span>
            done<span class="token punctuation">,</span> not_done <span class="token operator">=</span> concurrent<span class="token punctuation">.</span>futures<span class="token punctuation">.</span>wait<span class="token punctuation">(</span>not_done<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> future <span class="token keyword">in</span> done<span class="token punctuation">:</span>
                <span class="token comment"># Handle thread result.</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    future<span class="token punctuation">.</span>result<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
                
            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>not_done<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[main] Finished all tasks!'</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>mt_basic.py</span></div><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><h3 id="fancy-script" tabindex="-1"><a class="md-anchor" href="#fancy-script" aria-hidden="true"></a> Fancy Script</h3><div class="mb-2 rw center jw-80 video"><video autoplay loop muted class="jw-100"><source src="/img/demo2.mp4" type="video/mp4"></video></div><p class="caption"><sup>Similar to the previous script, but includes a small delay between tasks and two interactive pauses. The first pause occurs while the worker threads are <em>running <code>event.wait()</code></em>, instantly responding with "Interrupt detected". The second pause occurs while they are <em>working</em> (which we assume is some blocking operation, like <code>requests.get()</code>), and the interrupt won't be detected until the next task.</sup></p><div class="code-toolbar"><pre data-label="mt_with_delay_and_pause.py" data-diff="" class="language-diff-python language-python" tabindex="0"><code class="language-diff-python language-python"><span class="token unchanged language-python"><span class="token prefix unchanged"> </span><span class="token keyword">import</span> concurrent<span class="token punctuation">.</span>futures
</span><span class="token inserted-sign inserted language-python"><span class="token prefix inserted">+</span><span class="token keyword">import</span> signal
<span class="token prefix inserted">+</span><span class="token keyword">from</span> threading <span class="token keyword">import</span> Event
</span><span class="token unchanged language-python"><span class="token prefix unchanged"> </span><span class="token keyword">from</span> time <span class="token keyword">import</span> sleep
<span class="token prefix unchanged"> </span>
</span><span class="token inserted-sign inserted language-python"><span class="token prefix inserted">+</span><span class="token comment"># Create global events which will be used across main and worker threads.</span>
<span class="token prefix inserted">+</span>pause_evt <span class="token operator">=</span> Event<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>resume_evt <span class="token operator">=</span> Event<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>quit_evt <span class="token operator">=</span> Event<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token prefix inserted">+</span><span class="token comment"># quit_evt can be a global bool variable too, since single write, multiple read</span>
<span class="token prefix inserted">+</span><span class="token comment"># is thread-safe.</span>
<span class="token prefix inserted">+</span>
<span class="token prefix inserted">+</span><span class="token comment"># Handle incoming Ctrl+C with `signal`.</span>
<span class="token prefix inserted">+</span><span class="token keyword">def</span> <span class="token function">handle_int_signal</span><span class="token punctuation">(</span>signo<span class="token punctuation">,</span> _frame<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token prefix inserted">+</span>    resume_evt<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>    pause_evt<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>
<span class="token prefix inserted">+</span><span class="token comment"># Save the original signal so that we can restore it later.</span>
<span class="token prefix inserted">+</span>py_int_signal <span class="token operator">=</span> signal<span class="token punctuation">.</span>getsignal<span class="token punctuation">(</span>signal<span class="token punctuation">.</span>SIGINT<span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>signal<span class="token punctuation">.</span>signal<span class="token punctuation">(</span>signal<span class="token punctuation">.</span>SIGINT<span class="token punctuation">,</span> handle_int_signal<span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>
<span class="token prefix inserted">+</span><span class="token keyword">def</span> <span class="token function">enable_py_signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token prefix inserted">+</span>    signal<span class="token punctuation">.</span>signal<span class="token punctuation">(</span>signal<span class="token punctuation">.</span>SIGINT<span class="token punctuation">,</span> py_int_signal<span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>
<span class="token prefix inserted">+</span><span class="token keyword">def</span> <span class="token function">enable_custom_signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token prefix inserted">+</span>    signal<span class="token punctuation">.</span>signal<span class="token punctuation">(</span>signal<span class="token punctuation">.</span>SIGINT<span class="token punctuation">,</span> handle_int_signal<span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>
<span class="token prefix inserted">+</span><span class="token comment"># Create a custom "sleep" function which uses events under the hood.</span>
<span class="token prefix inserted">+</span><span class="token keyword">def</span> <span class="token function">thread_delay</span><span class="token punctuation">(</span>sec<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token prefix inserted">+</span>    <span class="token keyword">if</span> pause_evt<span class="token punctuation">.</span>wait<span class="token punctuation">(</span>sec<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token prefix inserted">+</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[thread] Interrupt detected, waiting for resume.'</span><span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>        resume_evt<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Block until resume is triggered.</span>
<span class="token prefix inserted">+</span>        <span class="token keyword">if</span> quit_evt<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># Indicate quit preference with a flag.</span>
<span class="token prefix inserted">+</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[thread] Resumed, but still interrupted. Exiting thread.'</span><span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>            <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">'interrupt'</span><span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>
<span class="token prefix inserted">+</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[thread] Resuming...'</span><span class="token punctuation">)</span>
</span><span class="token unchanged language-python"><span class="token prefix unchanged"> </span>
<span class="token prefix unchanged"> </span><span class="token keyword">def</span> <span class="token function">thread_do_stuff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token prefix unchanged"> </span>    sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token prefix unchanged"> </span>
<span class="token prefix unchanged"> </span><span class="token keyword">def</span> <span class="token function">thread_function</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="token inserted-sign inserted language-python"><span class="token prefix inserted">+</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[thread] task waiting </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>    thread_delay<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># Delay between tasks using threading.Event.</span>
</span><span class="token unchanged language-python"><span class="token prefix unchanged"> </span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[thread] task started </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token prefix unchanged"> </span>    thread_do_stuff<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Simulate an IO task, e.g. requests.get().</span>
<span class="token prefix unchanged"> </span>
</span><span class="token inserted-sign inserted language-python"><span class="token prefix inserted">+</span><span class="token comment"># A simple interactive menu to display during the paused state!</span>
<span class="token prefix inserted">+</span><span class="token comment"># Return True -&gt; continue program. Return False -&gt; quit.</span>
<span class="token prefix inserted">+</span><span class="token keyword">def</span> <span class="token function">main_pause_menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token prefix inserted">+</span>    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
<span class="token prefix inserted">+</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>
<span class="token prefix inserted">+</span>            x <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Do you want to continue? [y/n] '</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>        <span class="token keyword">except</span> <span class="token punctuation">(</span>KeyboardInterrupt<span class="token punctuation">,</span> EOFError<span class="token punctuation">)</span> <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token prefix inserted">+</span>            <span class="token comment"># Treat Ctrl+C and Ctrl+D as "no".</span>
<span class="token prefix inserted">+</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Got </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__name__<span class="token punctuation">}</span></span><span class="token string">. Quitting...'</span></span><span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>
<span class="token prefix inserted">+</span>        
<span class="token prefix inserted">+</span>        <span class="token keyword">if</span> x <span class="token operator">==</span> <span class="token string">'y'</span><span class="token punctuation">:</span>
<span class="token prefix inserted">+</span>            <span class="token keyword">return</span> <span class="token boolean">True</span>
<span class="token prefix inserted">+</span>        <span class="token keyword">elif</span> x <span class="token operator">==</span> <span class="token string">'n'</span><span class="token punctuation">:</span>
<span class="token prefix inserted">+</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>
</span><span class="token unchanged language-python"><span class="token prefix unchanged"> </span>
<span class="token prefix unchanged"> </span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token prefix unchanged"> </span>    <span class="token comment"># Start an executor with 2 threads and 8 tasks.</span>
<span class="token prefix unchanged"> </span>    <span class="token keyword">with</span> concurrent<span class="token punctuation">.</span>futures<span class="token punctuation">.</span>ThreadPoolExecutor<span class="token punctuation">(</span>max_workers<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">as</span> executor<span class="token punctuation">:</span>
<span class="token prefix unchanged"> </span>        not_done <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token prefix unchanged"> </span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token prefix unchanged"> </span>            f <span class="token operator">=</span> executor<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>thread_function<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
<span class="token prefix unchanged"> </span>            not_done<span class="token punctuation">.</span>append<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
<span class="token prefix unchanged"> </span>        
<span class="token prefix unchanged"> </span>        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
</span><span class="token inserted-sign inserted language-python"><span class="token prefix inserted">+</span>            enable_custom_signal<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>            <span class="token keyword">while</span> <span class="token keyword">not</span> pause_evt<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token prefix inserted">+</span>                <span class="token comment"># Process results while waiting. The processing shouldn't take</span>
<span class="token prefix inserted">+</span>                <span class="token comment"># too long in order for the pause menu to show responsively</span>
<span class="token prefix inserted">+</span>                <span class="token comment"># after Ctrl+C is hit.</span>
</span><span class="token unchanged language-python"><span class="token prefix unchanged"> </span>                done<span class="token punctuation">,</span> not_done <span class="token operator">=</span> concurrent<span class="token punctuation">.</span>futures<span class="token punctuation">.</span>wait<span class="token punctuation">(</span>not_done<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span>
<span class="token prefix unchanged"> </span>                <span class="token keyword">for</span> future <span class="token keyword">in</span> done<span class="token punctuation">:</span>
<span class="token prefix unchanged"> </span>                    <span class="token comment"># Handle thread result.</span>
<span class="token prefix unchanged"> </span>                    <span class="token keyword">try</span><span class="token punctuation">:</span>
<span class="token prefix unchanged"> </span>                        future<span class="token punctuation">.</span>result<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token prefix unchanged"> </span>                    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token prefix unchanged"> </span>                        <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token prefix unchanged"> </span>                    
<span class="token prefix unchanged"> </span>                <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>not_done<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
<span class="token prefix unchanged"> </span>                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[main] Finished all tasks!'</span><span class="token punctuation">)</span>
<span class="token prefix unchanged"> </span>                    <span class="token keyword">return</span>
<span class="token prefix unchanged"> </span>
</span><span class="token inserted-sign inserted language-python"><span class="token prefix inserted">+</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[main] Triggered interrupt.'</span><span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>            enable_py_signal<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>            
<span class="token prefix inserted">+</span>            <span class="token comment"># Handle pause menu/input.</span>
<span class="token prefix inserted">+</span>            cont <span class="token operator">=</span> main_pause_menu<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>                
<span class="token prefix inserted">+</span>            <span class="token keyword">if</span> cont<span class="token punctuation">:</span>
<span class="token prefix inserted">+</span>                <span class="token comment"># Continue jobs.</span>
<span class="token prefix inserted">+</span>                quit_evt<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>
<span class="token prefix inserted">+</span>                <span class="token comment"># Cancel pending jobs.</span>
<span class="token prefix inserted">+</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[main] Shutting down...'</span><span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>                executor<span class="token punctuation">.</span>shutdown<span class="token punctuation">(</span>wait<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> cancel_futures<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>                quit_evt<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[main] Finished shutdown.'</span><span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>            
<span class="token prefix inserted">+</span>            pause_evt<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>            resume_evt<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Signal remaining threads to resume (and possibly quit).</span>
<span class="token prefix inserted">+</span>            <span class="token keyword">if</span> <span class="token keyword">not</span> cont<span class="token punctuation">:</span>
<span class="token prefix inserted">+</span>                <span class="token keyword">break</span>
</span><span class="token unchanged language-python"><span class="token prefix unchanged"> </span>
<span class="token prefix unchanged"> </span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
<span class="token prefix unchanged"> </span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span></span></code></pre><div class="toolbar"><div class="toolbar-item"><span>mt_with_delay_and_pause.py</span></div><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><h2 id="the-magic" tabindex="-1"><a class="md-anchor" href="#the-magic" aria-hidden="true"></a> The Magic</h2><p>So what voodoo did we add into the second script? It all comes down to <code>threading.Event</code>, signals, and some extra flair.</p><h3 id="threading-event" tabindex="-1"><a class="md-anchor" href="#threading-event" aria-hidden="true"></a> threading.Event</h3><p><code>Event</code> is a Python class from the <code>threading</code> library. As the <a href="https://docs.python.org/3/library/threading.html#event-objects" rel="noreferrer" target="_blank">Python documentation</a> puts it:</p><blockquote><p>This is one of the simplest mechanisms for communication between threads: <strong>one thread signals</strong> an event and <strong>other threads wait</strong> for it. An event object manages an internal flag that can be set to true with the&nbsp;<a href="https://docs.python.org/3/library/threading.html#threading.Event.set" rel="noreferrer" target="_blank"><code>set()</code></a>&nbsp;method and reset to false with the&nbsp;<a href="https://docs.python.org/3/library/threading.html#threading.Event.clear" rel="noreferrer" target="_blank"><code>clear()</code></a>&nbsp;method. The&nbsp;<a href="https://docs.python.org/3/library/threading.html#threading.Event.wait" rel="noreferrer" target="_blank"><code>wait()</code></a>&nbsp;method blocks until the flag is true.</p></blockquote><p>This is what we call a <strong>binary semaphore</strong>. It’s binary because it represents two states (set or not set). It’s a semaphore because it’s a thread-safe signalling mechanism. (In the past, semaphores were visual cues used to communicate over a distance.)</p><p>To demonstrate why they're so useful consider the following toy functions:</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> time<span class="token punctuation">,</span> threading

<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'done: foo'</span><span class="token punctuation">)</span>

event <span class="token operator">=</span> threading<span class="token punctuation">.</span>Event<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    event<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'done: bar'</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>What's the difference?</p><table><thead><tr><th><code>time.sleep()</code></th><th><code>event.wait()</code></th></tr></thead><tbody><tr><td>Blocks for a duration.</td><td>Blocks for a duration, but returns instantly when signalled with <code>event.set()</code>. If no parameter is passed, waits indefinitely.</td></tr></tbody></table><p>For simple delays, <code>time.sleep</code> is good enough. But when responsiveness and multithreaded synchronisation are needed, <code>Event</code> becomes much more appealing. If we add some code to the second example, it's clear that <code>event.wait</code> is a superior sleep-like function, simply because we can control <em><strong>when</strong></em> that <code>sleep</code> finishes, across multiple threads.<sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup></p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python">threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>bar<span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># do something...</span>
event<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment"># 'done: bar' printed instantly after</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><hr><p>Back to our "after" script. You'll notice we used not one, not two, but <em>three</em> events. In the thread, we introduce a new kind of sleep function: <code>thread_delay</code>.</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python">pause_evt <span class="token operator">=</span> Event<span class="token punctuation">(</span><span class="token punctuation">)</span>
resume_evt <span class="token operator">=</span> Event<span class="token punctuation">(</span><span class="token punctuation">)</span>
quit_evt <span class="token operator">=</span> Event<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># -- snip -- </span>

<span class="token keyword">def</span> <span class="token function">thread_delay</span><span class="token punctuation">(</span>sec<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> pause_evt<span class="token punctuation">.</span>wait<span class="token punctuation">(</span>sec<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[thread] Interrupt detected, waiting for resume.'</span><span class="token punctuation">)</span>
        resume_evt<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> quit_evt<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[thread] Resumed, but still interrupted. Exiting thread.'</span><span class="token punctuation">)</span>
            <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">'interrupt'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[thread] Resuming...'</span><span class="token punctuation">)</span>
            <span class="token keyword">pass</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><ul><li><code>pause_evt</code> - This is the event responsible for sleeping. If <code>pause_evt</code> is set when <code>pause_evt.wait(sec)</code> is running, it will return <code>True</code> and enter the "paused state". Otherwise, <code>.wait(sec)</code> eventually times out and returns <code>False</code>.</li><li><code>resume_evt</code> - Since we want our threads to stop running completely during interactive pause, we need to block and wait for another signal. Thus, a second event. Notice <code>resume_evt.wait()</code> doesn't take a parameter, so it waits indefinitely.</li><li><code>quit_evt</code> - This is an additional feature I added to allow gracefully exiting the thread. The "protocol" I came up with is:<ul><li>If <code>resume_evt</code> is set and <code>quit_evt</code> is set → quit the program by throwing an error to exit the thread.</li><li>If <code>resume_evt</code> is set and <code>quit_evt</code> is cleared → continue running.</li><li>This doesn't need to be an event. It could just as well be a variable, since single writes and multiple reads are thread-safe.</li></ul></li></ul><p>Let's now take a look at the modified code in <code>main()</code>.</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token comment"># ...</span>
    <span class="token keyword">while</span> <span class="token keyword">not</span> pause_evt<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment"># handle results...</span>
        
    <span class="token comment"># -- snip --</span>
    
    <span class="token comment"># Handle pause menu/input.</span>
    cont <span class="token operator">=</span> main_pause_menu<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
    <span class="token keyword">if</span> cont<span class="token punctuation">:</span> <span class="token comment"># Continue</span>
        quit_evt<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token comment"># Quit</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[main] Shutting down...'</span><span class="token punctuation">)</span>
        executor<span class="token punctuation">.</span>shutdown<span class="token punctuation">(</span>wait<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> cancel_futures<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        quit_evt<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[main] Finished shutdown.'</span><span class="token punctuation">)</span>
    
    pause_evt<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
    resume_evt<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Signal remaining threads to resume (and possibly quit).</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> cont<span class="token punctuation">:</span>
        <span class="token keyword">break</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>The logic here is somewhat simple:</p><ul><li>If <code>pause_evt</code> <em>is not</em> set, handle finished results.</li><li>If <code>pause_evt</code> <em>is</em> set, enter the pause menu.</li><li><em>User inputs whether to continue or quit.</em></li><li>The rest of the code fulfils the "protocol" outlined earlier.<ul><li>To continue: clear <code>quit_evt</code>.</li><li>To quit: set <code>quit_evt</code>. (Plus cancel pending jobs.)</li><li>Then set <code>resume_evt</code> to signal worker threads to venture forth!</li></ul></li></ul><h3 id="handling-ctrl-c-with-signal" tabindex="-1"><a class="md-anchor" href="#handling-ctrl-c-with-signal" aria-hidden="true"></a> Handling Ctrl+C with signal</h3><p>By default, when Python receives Ctrl+C, a callback runs which raises <code>KeyboardInterrupt</code>. In major operating systems, Ctrl+C sends a SIGINT (i.e. signal interrupt) to programs.</p><p>To customise Ctrl+C behaviour, we can set a callback with <code>signal.signal</code>. In our case, our customisation will pause threads by calling <code>pause_evt.set()</code>. We'll save the original signal so that we can restore normal Ctrl+C behaviour when threads are paused or finished.</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Set custom handler...</span>
<span class="token keyword">def</span> <span class="token function">handle_int_signal</span><span class="token punctuation">(</span>signo<span class="token punctuation">,</span> _frame<span class="token punctuation">)</span><span class="token punctuation">:</span>
    resume_evt<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
    pause_evt<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

py_int_signal <span class="token operator">=</span> signal<span class="token punctuation">.</span>getsignal<span class="token punctuation">(</span>signal<span class="token punctuation">.</span>SIGINT<span class="token punctuation">)</span>
signal<span class="token punctuation">.</span>signal<span class="token punctuation">(</span>signal<span class="token punctuation">.</span>SIGINT<span class="token punctuation">,</span> handle_int_signal<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">enable_py_signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    signal<span class="token punctuation">.</span>signal<span class="token punctuation">(</span>signal<span class="token punctuation">.</span>SIGINT<span class="token punctuation">,</span> py_int_signal<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">enable_custom_signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    signal<span class="token punctuation">.</span>signal<span class="token punctuation">(</span>signal<span class="token punctuation">.</span>SIGINT<span class="token punctuation">,</span> handle_int_signal<span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>In <code>main()</code>, we wrap our result-handling code with <code>enable_custom_signal()</code> and <code>enable_py_signal()</code>:</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># When running threads...</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    enable_custom_signal<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># -- snip -- Wait for Ctrl+C signal to pause threads...</span>
    enable_py_signal<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># -- snip -- Show pause menu + handle events...</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>Truth be told, I couldn't figure out how to get arbitrary keystrokes in an <code>event.wait</code>-esque manner (i.e. with a timeout). The easiest solution was to just use Ctrl+C. A bit limited, but I'm happy with it.</p><h3 id="write-a-pause-menu" tabindex="-1"><a class="md-anchor" href="#write-a-pause-menu" aria-hidden="true"></a> Write a Pause Menu</h3><p>If you learned programming before generative AI replaced tutorials, diligence, and self-worth, chances are your first program was a simple interactive I/O. Read input; spit it back out. Our simple menu will go back to those nostalgic first days of programming.</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># A simple interactive menu to display during the paused state!</span>
<span class="token comment"># Return True -&gt; continue program. Return False -&gt; quit.</span>
<span class="token keyword">def</span> <span class="token function">main_pause_menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Elsa?'</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            x <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Do you want to build a snowman? [y/n] '</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> <span class="token punctuation">(</span>KeyboardInterrupt<span class="token punctuation">,</span> EOFError<span class="token punctuation">)</span> <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token comment"># Treat Ctrl+C and Ctrl+D as "no".</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Got </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__name__<span class="token punctuation">}</span></span><span class="token string">. You don\'t have to be thaat rude. :('</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        
        <span class="token keyword">if</span> x <span class="token operator">==</span> <span class="token string">'y'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">elif</span> x <span class="token operator">==</span> <span class="token string">'n'</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Okay, byeeeee.'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><h2 id="conclusion" tabindex="-1"><a class="md-anchor" href="#conclusion" aria-hidden="true"></a> Conclusion</h2><p>To show <s>off</s> this potential in an interactive tool, here's a short clip where I integrated the techniques here into my <a href="https://github.com/TrebledJ/bsqli.py" rel="noreferrer" target="_blank">nifty little SQL injection automation</a> (for ethical hacking purposes).</p><div class="mb-2 rw center jw-100 video"><video autoplay loop muted class="jw-100"><source src="/img/demo3.mp4" type="video/mp4"></video></div><p class="caption"><sup>On the left panel, we seamlessly execute various commands, pausing twice with Ctrl+C, with the option of configuring the delay, timeout, and log level. An updated version allows toggling the proxy!</sup></p><p>This post demonstrated how to add interactive pausing to your multithreaded Python script with zero additional dependencies. Despite the simplicity, there are a few other things to explore that we haven't discussed:</p><ul><li><strong>Pausing with processes or asyncio.</strong> Each of these has their own Event objects. Processes have <a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Event" rel="noreferrer" target="_blank"><code>multiprocessing.Event</code></a>. asyncio has <a href="https://docs.python.org/3/library/asyncio-sync.html#event" rel="noreferrer" target="_blank">asyncio.Event</a>. These are also worth exploring.</li><li><strong>Trigger pause with an arbitrary key.</strong> Instead of relying on Ctrl+C and SIGINT, is it possible to listen for arbitrary keys and pause with them? This seems difficult to implement without additional dependencies and may require native API wrangling (see the <code>keyboard</code> package).<ul><li>It is possible to capture input on a separate thread with <code>getch</code> implementations (<a href="https://stackoverflow.com/q/510357/10239789" rel="noreferrer" target="_blank">see here</a>). This blocks while waiting for input. However, issues arise when considering other UX aspects.</li><li>What if the user presses Ctrl+C? SIGINT (and signals, in general) are <a href="https://docs.python.org/3/library/signal.html" rel="noreferrer" target="_blank">always executed in the main thread</a>.</li><li>What if the processing finishes without the user entering input? The thread receiving input would need to be killed.</li></ul></li><li><strong>Off-by-One Delay.</strong> Currently, our execution is <strong>delay</strong> → <strong>work</strong> → <strong>delay</strong> → <strong>work</strong>, but the first delay isn't actually needed. This should be fairly trivial to fix, but I decided to leave it out from the example to avoid overcomplication. Exercise for the reader and all that.</li></ul><p><a id="logical-end-of-article"></a></p><h3 id="tl-dr" tabindex="-1"><a class="md-anchor" href="#tl-dr" aria-hidden="true"></a> tl;dr</h3><ul><li>Use <code>threading.Event</code> to synchronise events (e.g. pause) and sleep.<ul><li>Use three events: one to signal pause, one to signal resume, and one to indicate resume or quit.</li><li>Write a <code>delay()</code> function which calls <code>pause_event.wait(SLEEP_SEC)</code>.</li></ul></li><li>Use <code>signal.signal</code> to customise Ctrl+C (which triggers SIGINT). The handler should call <code>pause_event.set()</code>.</li><li>Adjust the environment before and after the pause menu, such as temporarily restoring Python's SIGINT handler.</li></ul><h3 id="references" tabindex="-1"><a class="md-anchor" href="#references" aria-hidden="true"></a> References</h3><ul><li><a href="https://stackoverflow.com/a/29082411" rel="noreferrer" target="_blank">SO: Python time.sleep() vs event.wait()</a> (goes into low level implementation deets)</li><li><a href="https://docs.python.org/3/library/threading.html#event-objects" rel="noreferrer" target="_blank">Python 3 Docs: threading.Event</a> (very simple and clear docs)</li><li><a href="https://docs.python.org/3/library/signal.html" rel="noreferrer" target="_blank">Python 3 Docs: signal</a></li><li><a href="https://docs.python.org/3/library/concurrent.futures.html" rel="noreferrer" target="_blank">Python 3 Docs: concurrent.futures</a></li></ul><h2 id="appendix" tabindex="-1"><a class="md-anchor" href="#appendix" aria-hidden="true"></a> Appendix</h2><h3 id="appendix-a-bonus-rich-progress" tabindex="-1"><a class="md-anchor" href="#appendix-a-bonus-rich-progress" aria-hidden="true"></a> Appendix A: Bonus - rich.progress</h3><p>If you're using <code>rich.progress</code> to liven up your UI, you may find the live progress bar conflicts with our custom pause menu. To disable the live progress, you can manually adjust the class members before entering the pause menu in <code>main()</code>:</p><div class="code-toolbar"><pre data-diff="" class="language-diff-python language-python" tabindex="0"><code class="language-diff-python language-python"><span class="token inserted-sign inserted language-python"><span class="token prefix inserted">+</span><span class="token comment"># Disable live progress.</span>
<span class="token prefix inserted">+</span><span class="token comment"># prog is an instance of rich.progress.Progress.</span>
<span class="token prefix inserted">+</span>prog<span class="token punctuation">.</span>update<span class="token punctuation">(</span>prog<span class="token punctuation">.</span>task_ids<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> visible<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> refresh<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token prefix inserted">+</span>prog<span class="token punctuation">.</span>disable <span class="token operator">=</span> <span class="token boolean">True</span>
<span class="token prefix inserted">+</span>prog<span class="token punctuation">.</span>live<span class="token punctuation">.</span>auto_refresh <span class="token operator">=</span> <span class="token boolean">False</span>
<span class="token prefix inserted">+</span>is_interactive <span class="token operator">=</span> prog<span class="token punctuation">.</span>live<span class="token punctuation">.</span>console<span class="token punctuation">.</span>is_interactive
<span class="token prefix inserted">+</span>prog<span class="token punctuation">.</span>live<span class="token punctuation">.</span>console<span class="token punctuation">.</span>is_interactive <span class="token operator">=</span> <span class="token boolean">False</span>
</span><span class="token unchanged language-python"><span class="token prefix unchanged"> </span>
<span class="token prefix unchanged"> </span>cont <span class="token operator">=</span> main_pause_menu<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token prefix unchanged"> </span><span class="token comment"># -- snip --</span>
<span class="token prefix unchanged"> </span>resume_evt<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token prefix unchanged"> </span>
</span><span class="token inserted-sign inserted language-python"><span class="token prefix inserted">+</span><span class="token comment"># Re-enable live progress...</span>
<span class="token prefix inserted">+</span>prog<span class="token punctuation">.</span>live<span class="token punctuation">.</span>console<span class="token punctuation">.</span>is_interactive <span class="token operator">=</span> is_interactive
<span class="token prefix inserted">+</span>prog<span class="token punctuation">.</span>live<span class="token punctuation">.</span>auto_refresh <span class="token operator">=</span> <span class="token boolean">True</span>
<span class="token prefix inserted">+</span>prog<span class="token punctuation">.</span>disable <span class="token operator">=</span> <span class="token boolean">False</span>
<span class="token prefix inserted">+</span>prog<span class="token punctuation">.</span>update<span class="token punctuation">(</span>prog<span class="token punctuation">.</span>task_ids<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> visible<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> refresh<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</span><span class="token unchanged language-python"><span class="token prefix unchanged"> </span>
<span class="token prefix unchanged"> </span><span class="token keyword">if</span> cont<span class="token punctuation">:</span>
<span class="token prefix unchanged"> </span>    <span class="token keyword">break</span></span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>This is very hacky, because the properties aren't documented and could potentially change, but it works pretty well.</p><h3 id="appendix-b-handling-future-results" tabindex="-1"><a class="md-anchor" href="#appendix-b-handling-future-results" aria-hidden="true"></a> Appendix B: Handling Future Results</h3><p>AFAIK, there are three main ways of handling future results from <code>concurrent.futures</code>. Keep in mind some approaches may be better for your script.</p><ol><li><p><code>concurrent.futures.wait</code>. Polls and partitions an iterable of futures into <code>done</code> and <code>not_done</code> sets. Does not block main thread when <code>timeout</code> is specified. Result handling runs in main thread.</p><p>For the "other stuff" to run responsively, the <code>timeout</code> parameter in <code>concurrent.futures.wait()</code> should be relatively small, and the result handling shouldn't take too long.</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">with</span> concurrent<span class="token punctuation">.</span>futures<span class="token punctuation">.</span>ThreadPoolExecutor<span class="token punctuation">(</span>max_workers<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">as</span> executor<span class="token punctuation">:</span>
    not_done <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        f <span class="token operator">=</span> executor<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>thread_function<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
        not_done<span class="token punctuation">.</span>append<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token comment"># Process results while waiting.</span>
        done<span class="token punctuation">,</span> not_done <span class="token operator">=</span> concurrent<span class="token punctuation">.</span>futures<span class="token punctuation">.</span>wait<span class="token punctuation">(</span>not_done<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> future <span class="token keyword">in</span> done<span class="token punctuation">:</span>
            <span class="token comment"># Handle thread result.</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                future<span class="token punctuation">.</span>result<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
            
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>not_done<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[main] Finished all tasks!'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        
        <span class="token comment"># Do other stuff...</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div></li><li><p><code>concurrent.futures.as_completed</code>. This returns an iterable of completed futures. Blocks main thread. Result handling runs in main thread.</p><p>This is <strong>not</strong> a reliable way to integrate with the flow demonstrated in this post.</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">with</span> concurrent<span class="token punctuation">.</span>futures<span class="token punctuation">.</span>ThreadPoolExecutor<span class="token punctuation">(</span>max_workers<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">as</span> executor<span class="token punctuation">:</span>
    futures <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        f <span class="token operator">=</span> executor<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>thread_function<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
        futures<span class="token punctuation">.</span>append<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    
    <span class="token keyword">for</span> f <span class="token keyword">in</span> concurrent<span class="token punctuation">.</span>futures<span class="token punctuation">.</span>as_completed<span class="token punctuation">(</span>futures<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            f<span class="token punctuation">.</span>result<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>

        <span class="token comment"># Do other stuff? Not necessarily consistent or responsive though.</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div></li><li><p><code>future.add_done_callback()</code>. This fires a callback upon completion of each future. Does not block main thread. Result handling may not run in main thread.</p><p>Probably the "cleanest" way to integrate with the flow demonstrated in this post, unless you handle <code>future.result()</code> in a non-thread-safe manner, in which case... beware race conditions.</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">def</span> <span class="token function">callback</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>result<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>

<span class="token keyword">with</span> concurrent<span class="token punctuation">.</span>futures<span class="token punctuation">.</span>ThreadPoolExecutor<span class="token punctuation">(</span>max_workers<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">as</span> executor<span class="token punctuation">:</span>
    futures <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        f <span class="token operator">=</span> executor<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>thread_function<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
        f<span class="token punctuation">.</span>add_done_callback<span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
        futures<span class="token punctuation">.</span>append<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    
    <span class="token comment"># Results get handled in the background!</span>
    <span class="token comment"># Do other stuff...</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div></li></ol><hr class="footnotes-sep"><b>Footnotes</b><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a href="https://github.com/epi052/feroxbuster" rel="noreferrer" target="_blank">feroxbuster</a>, a popular pentesting tool, has interactive pause for runtime addition of filters and pruning of exploration paths. Quite useful for reducing false positives and saving time! <a href="#fnref1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p>Of course, it's possible to do the same with <code>time.sleep</code> by breaking the sleep into smaller pieces and looping. In fact, Python 2's implementation of <code>event.wait()</code> was exactly like that&nbsp;— a while loop calling <code>time.sleep</code> with tiny intervals. This turned out to be inefficient (by acquiring the GIL repeatedly) and caused a few bugs. In Python 3, <code>event.wait()</code> is properly implemented in C with interrupts! Check out this <a href="https://stackoverflow.com/a/29082411" rel="noreferrer" target="_blank">SO answer</a> for more gory details. <a href="#fnref2" class="footnote-backref">↩︎</a></p></li></ol></section></div><a id="end-of-article"></a><br><script defer src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><div class="post-share dim-gentle mb-3 d-flex flex-row align-items-center"><div class="d-flex flex-row flex-wrap align-items-center gap-3"><span>Share&nbsp;on</span> <a class="no-decoration" data-sharer="reddit" data-title="Delay and Interactive Pause in Multi-Threaded Python" data-url="https://trebledj.me/posts/delay-and-interactive-pause-in-multithreaded-python/"><span class="fs-4"><i class="fab fa-reddit"></i> </span></a><a class="no-decoration" data-sharer="telegram" data-title="Delay and Interactive Pause in Multi-Threaded Python" data-url="https://trebledj.me/posts/delay-and-interactive-pause-in-multithreaded-python/"><span class="fs-4"><i class="fab fa-telegram"></i> </span></a><a class="no-decoration" data-sharer="whatsapp" data-title="Delay and Interactive Pause in Multi-Threaded Python" data-url="https://trebledj.me/posts/delay-and-interactive-pause-in-multithreaded-python/"><span class="fs-4"><i class="fab fa-whatsapp"></i> </span></a><a class="no-decoration" data-sharer="linkedin" data-title="Delay and Interactive Pause in Multi-Threaded Python" data-url="https://trebledj.me/posts/delay-and-interactive-pause-in-multithreaded-python/"><span class="fs-4"><i class="fab fa-linkedin"></i> </span></a><a class="no-decoration" data-sharer="vk" data-title="Delay and Interactive Pause in Multi-Threaded Python" data-url="https://trebledj.me/posts/delay-and-interactive-pause-in-multithreaded-python/"><span class="fs-4"><i class="fab fa-vk"></i> </span></a><a class="no-decoration" data-sharer="twitter" data-title="Delay and Interactive Pause in Multi-Threaded Python" data-url="https://trebledj.me/posts/delay-and-interactive-pause-in-multithreaded-python/"><span class="fs-4"><i class="fab fa-twitter"></i> </span></a><a id="copy-link-button" class="no-decoration" data-bs-toggle="tooltip" data-bs-trigger="click" title="Link copied!"><span class="fs-4"><i class="fas fa-link"></i></span></a></div></div><hr><div id="post-author-container" class="d-flex justify-content-between align-items-center gap-3" itemprop="author" itemscope itemtype="https://schema.org/Person"><img src="/img/profile-icon.jpg" class="profile-img" alt="" loading="lazy" decoding="async" itemprop="image"><div class="author-info d-flex flex-column gap-1"><p class="profile-name" itemprop="name">TrebledJ</p><p class="profile-bio" itemprop="description">Passionate problem-solver, pentester, and autodidact. I thrive on learning new things and enjoy passing it on. When not immersed in bughunting or programming, I can be found taking walks, composing a short tune, and occasionally indulging in CTF challenges.</p></div></div><hr class="section-sep"><div id="related" class="jw-100"><h3><i class="fas fa-circle-nodes me-2"></i>Related Posts</h3><div class="row gx-3 mt-4"><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/automating-boolean-sql-injection-with-python/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/automating-boolean-sql-injection-with-python/"><img class="post-img-blurred-bg" src="/img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 273" alt="Thumbnail for Automating Boolean-Based SQL Injection with Python" srcset="/img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-256w.webp 256w, /img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-512w.webp 512w, /img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-1024w.webp 1024w, /img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-1800w.webp 1800w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 273" alt="Thumbnail for Automating Boolean-Based SQL Injection with Python" srcset="/img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-256w.webp 256w, /img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-512w.webp 512w, /img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-1024w.webp 1024w, /img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-1800w.webp 1800w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">Automating Boolean-Based SQL Injection with Python</h2><div class="post-summary"><p>How to be efficiently lazy at finding hidden gems in predictable places –&nbsp;Database Edition</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/infosec/" itemprop="keywords">infosec</a> </span><span><a class="jtag" href="/tags/sql/" itemprop="keywords">sql</a> </span><span><a class="jtag" href="/tags/python/" itemprop="keywords">python</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/attack-of-the-zip/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/attack-of-the-zip/"><img class="post-img-blurred-bg" src="/img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-500w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 500 / 337" alt="Thumbnail for From Compression to Compromise: Unmasking Zip File Threats" srcset="/img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-256w.webp 256w, /img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-500w.webp 500w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 500px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-500w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 500 / 337" alt="Thumbnail for From Compression to Compromise: Unmasking Zip File Threats" srcset="/img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-256w.webp 256w, /img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-500w.webp 500w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 500px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">From Compression to Compromise: Unmasking Zip File Threats</h2><div class="post-summary"><p>Deep dive into zip file attacks and mitigations (with examples!).</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/infosec/" itemprop="keywords">infosec</a> </span><span><a class="jtag" href="/tags/notes/" itemprop="keywords">notes</a> </span><span><a class="jtag" href="/tags/web/" itemprop="keywords">web</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/boomlang-blue-team-strikes-back-et-cvss-and-dllmodules/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/boomlang-blue-team-strikes-back-et-cvss-and-dllmodules/"><img class="post-img-blurred-bg" src="/img/posts/misc/satire/2025/assets/weekend-tech-reads-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 404" alt="Thumbnail for 5 Weekend Reads You Missed: BOOMlang v2, Blue Team Strikes Back, ET, CVSS 4.1, and DLLModules" srcset="/img/posts/misc/satire/2025/assets/weekend-tech-reads-thumbnail-256w.webp 256w, /img/posts/misc/satire/2025/assets/weekend-tech-reads-thumbnail-512w.webp 512w, /img/posts/misc/satire/2025/assets/weekend-tech-reads-thumbnail-1024w.webp 1024w, /img/posts/misc/satire/2025/assets/weekend-tech-reads-thumbnail-1536w.webp 1536w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/misc/satire/2025/assets/weekend-tech-reads-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 404" alt="Thumbnail for 5 Weekend Reads You Missed: BOOMlang v2, Blue Team Strikes Back, ET, CVSS 4.1, and DLLModules" srcset="/img/posts/misc/satire/2025/assets/weekend-tech-reads-thumbnail-256w.webp 256w, /img/posts/misc/satire/2025/assets/weekend-tech-reads-thumbnail-512w.webp 512w, /img/posts/misc/satire/2025/assets/weekend-tech-reads-thumbnail-1024w.webp 1024w, /img/posts/misc/satire/2025/assets/weekend-tech-reads-thumbnail-1536w.webp 1536w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">5 Weekend Reads You Missed: BOOMlang v2, Blue Team Strikes Back, ET, CVSS 4.1, and DLLModules</h2><div class="post-summary"><p>Breaking news, awesome stuff happened!</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/satire/" itemprop="keywords">satire</a> </span><span><a class="jtag" href="/tags/infosec/" itemprop="keywords">infosec</a> </span><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/im-a-certified-offensive-waterblower/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/im-a-certified-offensive-waterblower/"><img class="post-img-blurred-bg" src="/img/posts/misc/satire/2024/assets/cow-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 512" alt="Thumbnail for I'm now a Certified Offensive Waterblower!" srcset="/img/posts/misc/satire/2024/assets/cow-thumbnail-256w.webp 256w, /img/posts/misc/satire/2024/assets/cow-thumbnail-512w.webp 512w, /img/posts/misc/satire/2024/assets/cow-thumbnail-1024w.webp 1024w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/misc/satire/2024/assets/cow-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 512" alt="Thumbnail for I'm now a Certified Offensive Waterblower!" srcset="/img/posts/misc/satire/2024/assets/cow-thumbnail-256w.webp 256w, /img/posts/misc/satire/2024/assets/cow-thumbnail-512w.webp 512w, /img/posts/misc/satire/2024/assets/cow-thumbnail-1024w.webp 1024w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">I'm now a Certified Offensive Waterblower!</h2><div class="post-summary"><p>Emotional penetration testing is no joke. Millions suffer each year.</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/satire/" itemprop="keywords">satire</a> </span><span><a class="jtag" href="/tags/infosec/" itemprop="keywords">infosec</a> </span><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a></span></div></div></div></div></article></div></div><hr><h3><i class="fas fa-tags me-2"></i>Related Tags</h3><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to infosec, pentesting">software.security</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/ctf/">ctf</a> <a class="jtag" href="/tags/infosec/">infosec</a> <a class="jtag" href="/tags/reverse/">reverse</a> <a class="jtag" href="/tags/pentesting/">pentesting</a> <a class="jtag" href="/tags/pwn/">pwn</a> <a class="jtag" href="/tags/cryptography/">cryptography</a> <a class="jtag" href="/tags/cve/">cve</a> <a class="jtag" href="/tags/redteam/">redteam</a> <a class="jtag" href="/tags/stego/">stego</a></span></div><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to programming">software.general</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/programming/">programming</a> <a class="jtag" href="/tags/software-engineering/">software-engineering</a> <a class="jtag" href="/tags/web/">web</a> <a class="jtag" href="/tags/aoc/">aoc</a> <a class="jtag" href="/tags/apps/">apps</a> <a class="jtag" href="/tags/dsp/">dsp</a> <a class="jtag" href="/tags/programming-languages/">programming-languages</a> <a class="jtag" href="/tags/linux/">linux</a> <a class="jtag" href="/tags/performance/">performance</a> <a class="jtag" href="/tags/functional/">functional</a> <a class="jtag" href="/tags/types/">types</a> <a class="jtag" href="/tags/windows/">windows</a> <a class="jtag" href="/tags/ai/">ai</a> <a class="jtag" href="/tags/metaprogramming/">metaprogramming</a> <a class="jtag" href="/tags/oop/">oop</a></span></div><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to python">software.programming-language</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/cpp/">cpp</a> <a class="jtag" href="/tags/python/">python</a> <a class="jtag" href="/tags/c/">c</a> <a class="jtag" href="/tags/haskell/">haskell</a> <a class="jtag" href="/tags/js/">js</a> <a class="jtag" href="/tags/qt/">qt</a> <a class="jtag" href="/tags/rust/">rust</a> <a class="jtag" href="/tags/qml/">qml</a> <a class="jtag" href="/tags/sql/">sql</a> <a class="jtag" href="/tags/java/">java</a> <a class="jtag" href="/tags/scala/">scala</a></span></div><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to tutorial">misc</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/writeup/">writeup</a> <a class="jtag" href="/tags/notes/">notes</a> <a class="jtag" href="/tags/tutorial/">tutorial</a> <a class="jtag" href="/tags/project/">project</a> <a class="jtag" href="/tags/reflection/">reflection</a> <a class="jtag" href="/tags/hkust/">hkust</a> <a class="jtag" href="/tags/experience/">experience</a> <a class="jtag" href="/tags/research/">research</a> <a class="jtag" href="/tags/faith/">faith</a> <a class="jtag" href="/tags/learning/">learning</a> <a class="jtag" href="/tags/meta/">meta</a> <a class="jtag" href="/tags/mathematics/">mathematics</a> <a class="jtag" href="/tags/cheatsheet/">cheatsheet</a> <a class="jtag" href="/tags/satire/">satire</a> <a class="jtag" href="/tags/essay/">essay</a> <a class="jtag" href="/tags/reading/">reading</a></span></div></div><hr class="section-sep"><div class="container-md mt-4 p-4"><a id="comments"></a><p>Comments are back! Privacy-focused; without ads, bloatware 🤮, and trackers. Be one of the first to contribute to the discussion— before AI invades social media, world leaders declare war on guppies, and what little humanity left is lost to time.</p><script defer src="/js/comentario.min.js"></script><script>if(window.location.hash.startsWith("#comentario")){const a=document.getElementById("comments");a&&a.scrollIntoView({behavior:"smooth"})}</script><comentario-comments id="comentario" auto-init="false" no-fonts="true" css-override="false" theme="dark"></comentario-comments></div><br></div></div></article></div></div></div><footer class="d-flex flex-column gap-2"><div class="d-flex flex-row gap-3 mx-auto" style="width:fit-content;"><a rel="me noreferrer" href="https://github.com/TrebledJ" target="_blank"><i class="social-icon fab fa-github" style="color:rgb(150, 60, 180) !important;"></i> </a><a rel="me noreferrer" href="https://infosec.exchange/@trebledj" target="_blank"><i class="social-icon fab fa-mastodon" style="color:rgb(99, 101, 255) !important;"></i> </a><a rel="me noreferrer" href="https://x.com/trebledjjj" target="_blank"><i class="social-icon fab fa-twitter" style="color:rgb(99, 101, 255) !important;"></i> </a><a rel="me noreferrer" href="https://stackoverflow.com/users/10239789/trebledj" target="_blank"><i class="social-icon fab fa-stack-overflow" style="color:rgb(236, 124, 34) !important;"></i> </a><a rel="me noreferrer" href="https://soundcloud.com/trebledj" target="_blank"><i class="social-icon fab fa-soundcloud" style="color:rgb(237, 110, 30) !important;"></i> </a><a rel="me noreferrer" href="https://discordapp.com/users/220427982798454794" target="_blank"><i class="social-icon fab fa-discord" style="color:rgb(84, 100, 235) !important;"></i> </a><a rel="me" href="mailto:trebledjjj@gmail.com"><i class="social-icon fas fa-envelope"></i> </a><a rel="me" href="/feeds"><i class="social-icon fas fa-square-rss"></i></a></div><p>Copyright&nbsp;©&nbsp;2026&nbsp;TrebledJ • <a href="/privacy-policy">Privacy&nbsp;Policy</a> • <a href="https://github.com/TrebledJ/trebledj.github.io?tab=readme-ov-file#credits--appreciation" rel="noreferrer" target="_blank">Credits</a></p></footer><script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js"></script><script>var tocOptions={}</script><script defer src="/cb/YmP0cUsv-I.js"></script><script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;52d99b3d385b4c9a98ac8ad109a95a2a&quot;}"></script></body></html>