<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>TAMUctf 2022 – Labyrinth - TrebledJ's Pages</title><meta name="description" content="Using CFGs to solve a control-flow maze."><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="trebledj,tamuctf 2022 – labyrinth,using cfgs to solve a control-flow maze.,ctf,writeup,reverse,python,programming"><meta name="robots" content="index,follow"><meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'sha256-Wv9Tjjg7Y7X5sBbP5AXqAQJA6+eewSRUjoPhNczfpnM=' 'sha256-FBtdNYnNdsvTKcrNIznI+jwGwhW3pNA5x/yQUw8jOPA=' 'sha256-5e8R4YC3Atf/5McNMkFk4TZYUtMEItdy9ikt1KUoPSc=' 'sha256-qlkNkQyGC5u9Brt4wwVi0MsPO/hVdrz3rzXuWYIkAbM=' 'sha256-J+ryCgKrW+QOH4xdCyPd6R5W3u9wJkXayR7KvtlnCnQ=' 'sha256-Deekn20h+++EarpL0nFQLX7JSJv7s/2W9f988ZFAh14=' comments.trebledj.me code.jquery.com cdn.jsdelivr.net gist.github.com static.cloudflareinsights.com; style-src 'self' 'unsafe-inline' comments.trebledj.me cdn.jsdelivr.net cdnjs.cloudflare.com github.githubassets.com; font-src 'self' data: comments.trebledj.me cdn.jsdelivr.net cdnjs.cloudflare.com; img-src 'self' data: comments.trebledj.me; frame-src 'self' *.soundcloud.com; connect-src 'self' comments.trebledj.me wss://comments.trebledj.me cloudflareinsights.com formcarry.com;"><link href="/feeds/posts.xml" rel="alternate" title="RSS Feed for TrebledJ's Pages" type="application/rss+xml"><meta property="og:site_name" content="TrebledJ's Pages"><meta property="og:type" content="article"><meta property="og:title" content="TAMUctf 2022 – Labyrinth - TrebledJ's Pages"><meta property="twitter:title" content="TAMUctf 2022 – Labyrinth - TrebledJ's Pages"><meta property="og:description" content="Using CFGs to solve a control-flow maze.

Challenge Description To get the flag you'll need to get to the end of a maz- five randomly generated mazes within five minutes. This is an automatic reversing challenge. You..."><meta property="twitter:description" content="Using CFGs to solve a control-flow maze.

Challenge Description To get the flag you'll need to get to the end of a maz- five randomly generated mazes within five minutes. This is an automatic reversing challenge. You..."><meta property="og:url" content="https://trebledj.me/posts/tamuctf-2022-labyrinth/"><meta name="twitter:card" content="summary_large_image"><meta property="og:image" content="https://trebledj.me/img/posts/ctf/tamuctf22/assets/labyrinth-thumbnail-1800w.webp"><meta property="twitter:image" content="https://trebledj.me/img/posts/ctf/tamuctf22/assets/labyrinth-thumbnail-1800w.webp"><meta property="article:published_time" content="2022-04-22T00:00:00.000Z"><meta property="article:author" content="TrebledJ"><meta property="article:section" content="ctfs"><meta property="article:tag" content="ctf"><meta property="article:tag" content="writeup"><meta property="article:tag" content="reverse"><meta property="article:tag" content="python"><meta property="article:tag" content="programming"><script type="application/ld+json">{"@context": "https://schema.org","@type": "WebSite","name": "TrebledJ's Pages","url": "https://trebledj.me"}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/cb/css/icons-6e60ae6c5e022aba.css"><link rel="stylesheet" href="/cb/x2ljFSZBUH.css" media="print"><style></style><script>document.querySelectorAll('link[media|="print"]').forEach(e=>{e.addEventListener("load",()=>e.media="all"),e.sheet&&(e.media="all")})</script><script>const defaultTheme="dark";let icon=void 0;var reloadDisqus=void 0;function modeInit(){var e=localStorage.getItem("theme");setMode("dark"===e?"dark":"light"===e?"light":defaultTheme)}function modeInitIcon(){icon=document.getElementById("mode-switch-icon"),isLightTheme()&&(icon.classList.remove("fa-moon"),icon.classList.add("fa-sun"),icon.classList.add("mode-switch-transform"))}function isLightTheme(){return"light"===localStorage.getItem("theme")}function modeSwitcher(){var e=localStorage.getItem("theme");"dark"===e?(setMode("light"),reloadDisqus&&reloadDisqus()):"light"===e?(setMode("dark"),reloadDisqus&&reloadDisqus()):setMode(defaultTheme)}function setMode(e){"dark"===e?(document.documentElement.setAttribute("data-theme","dark"),localStorage.setItem("theme","dark")):"light"===e&&(document.documentElement.setAttribute("data-theme","light"),localStorage.setItem("theme","light")),icon&&(icon.classList.toggle("fa-moon"),icon.classList.toggle("fa-sun"),icon.classList.toggle("mode-switch-transform"))}modeInit(),document.addEventListener("DOMContentLoaded",()=>{document.getElementById("mode-switch").addEventListener("click",()=>{modeSwitcher()})})</script><script defer src="https://cdn.jsdelivr.net/npm/jquery@3.7.0/dist/jquery.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"><link rel="stylesheet" href="/css/comments.css"><link rel="icon" href="/favicon.ico" type="image/x-icon"></head><body><header><nav class="navbar navbar-expand-md py-2"><div class="container-fluid justify-content-between align-items-center"><button aria-controls="navbar-container" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler shadow-none" data-bs-target="#navbar-container" data-bs-toggle="collapse" type="button"><span id="navbar-toggler-icon"><i class="fas fa-bars"></i></span></button> <a class="navbar-brand no-decoration" href="/">TrebledJ's Pages</a><div class="navbar-collapse collapse" id="navbar-container"><ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="/">Home</a></li><li class="nav-item"><a class="nav-link" href="/about">About</a></li><li class="nav-item"><a class="nav-link" href="/posts">Posts</a></li><li class="nav-item"><a class="nav-link" href="/music">Music</a></li></ul><ul class="navbar-nav"><li><a class="nav-link me-2" data-bs-toggle="modal" data-bs-target="#search-modal" aria-label="Search..." role="button"><i class="fas fa-search nav-icon"></i></a></li><li><a class="nav-link" id="mode-switch" aria-label="Theme Switch" role="button"><i id="mode-switch-icon" class="fas fa-moon nav-icon"></i></a><script>modeInitIcon()</script></li></ul></div></div></nav><div id="scroll-progress-bar"></div></header><div id="top-of-the-morning-to-you"></div><div id="search-modal" class="modal fade wide-modal" aria-hidden="true" aria-label="Search" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header pb-2 d-flex flex-row justify-content-between"><div class="container-fluid ps-0" id="search-box-container"><input type="text" autofocus class="container-fluid" id="search-box" placeholder="Search"> <i class="fas fa-search"></i></div><button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button></div><div class="modal-body" id="search-results-list"></div></div></div></div><button id="btn-back-to-top" class="btn btn-lg" type="button" aria-label="Back to Top"><i class="fas fa-arrow-up"></i></button><div id="btn-mobile-toc" class="dropup"><button type="button" class="btn btn-lg" data-bs-toggle="dropdown" aria-label="Content"><i class="fas fa-list-ul"></i></button><ul class="dropdown-menu toc-container"><li><nav class="toc"><ol><li><a href="#challenge-description">Challenge Description</a></li><li><a href="#write-up">Write-Up</a></li><li><a href="#solve-script">Solve Script</a></li><li><a href="#flag">Flag</a></li></ol></nav></li></ul></div><div class="main-container"><div class="page-container col-lg-12"><div class="container-lg px-0"><article class="jw-100 post-article" itemscope itemtype="http://schema.org/BlogPosting"><div class="row flex-row-reverse gx-lg-5"><div class="col-lg-4 d-none d-lg-block"><div class="dim-deep"><div class="metadata-container d-flex"><div class="d-flex flex-row align-items-center"><span><i class="fas fa-calendar post-meta-icon me-1"></i> </span><span class="fs-7 post-posted-date">Posted on <span itemprop="datePublished" content="2022-04-22T08:00:00.000+08:00">2022‑04‑22</span></span></div><div class="d-flex flex-row align-items-center"><span class="post-updated-date-icon"><i class="fas fa-calendar post-meta-icon me-1"></i> </span><span class="fs-7 post-updated-date">Updated on <span itemprop="dateModified" content="2023-09-12T01:44:11.000+08:00">2023‑09‑11</span></span></div><div class="d-flex flex-row align-items-center"><span><i class="far fa-clock post-meta-icon me-1"></i> </span><span class="fs-7">6 minute read</span></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><span><i class="fas fa-tag post-meta-icon me-1 mt-2"></i></span><div class="tag-list d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/writeup/" itemprop="keywords">writeup</a> </span><span><a class="jtag" href="/tags/reverse/" itemprop="keywords">reverse</a> </span><span><a class="jtag" href="/tags/python/" itemprop="keywords">python</a> </span><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a></span></div></div></div><br><div id="toc-sidebar" class="sticky-right dim-deep dim-if-dark"><div class="toc-container"><span><a id="toc-content" href="javascript:void(0);">Content</a></span><nav class="toc"><ol><li><a href="#challenge-description">Challenge Description</a></li><li><a href="#write-up">Write-Up</a></li><li><a href="#solve-script">Solve Script</a></li><li><a href="#flag">Flag</a></li></ol></nav><hr></div><div class="toc-link-container"><span><a href="#related">Related Posts</a></span></div><div class="toc-link-container"><span><a href="#comments">Comments</a></span></div></div></div><div class="col-lg-8 post-body-container"><div class="article-header"><h1 class="post-title" itemprop="name headline">TAMUctf 2022 – Labyrinth</h1><p class="post-desc" itemprop="alternativeHeadline">Using CFGs to solve a control-flow maze.</p><div class="d-lg-none dim-deep"><div class="metadata-container d-flex"><div class="d-flex flex-row align-items-center"><span><i class="fas fa-calendar post-meta-icon me-1"></i> </span><span class="fs-7 post-posted-date">Posted on <span itemprop="datePublished" content="2022-04-22T08:00:00.000+08:00">2022‑04‑22</span></span></div><div class="d-flex flex-row align-items-center"><span class="post-updated-date-icon"><i class="fas fa-calendar post-meta-icon me-1"></i> </span><span class="fs-7 post-updated-date">Updated on <span itemprop="dateModified" content="2023-09-12T01:44:11.000+08:00">2023‑09‑11</span></span></div><div class="d-flex flex-row align-items-center"><span><i class="far fa-clock post-meta-icon me-1"></i> </span><span class="fs-7">6 minute read</span></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><span><i class="fas fa-tag post-meta-icon me-1 mt-2"></i></span><div class="tag-list d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/writeup/" itemprop="keywords">writeup</a> </span><span><a class="jtag" href="/tags/reverse/" itemprop="keywords">reverse</a> </span><span><a class="jtag" href="/tags/python/" itemprop="keywords">python</a> </span><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a></span></div></div></div></div><hr><div class="post-body text-content" itemprop="articleBody text"><h3 id="challenge-description" tabindex="-1"><a class="md-anchor" href="#challenge-description" aria-hidden="true"></a> Challenge Description</h3><blockquote><p>To get the flag you'll need to get to the end of a maz- five randomly generated mazes within five minutes.</p><p>This is an automatic reversing challenge. You will be provided an ELF as a hex string. You should analyze it, construct an input to make it terminate with <code>exit(0)</code>, and then respond with your input in the same format. You will need to solve five binaries within a five minute timeout.</p></blockquote><h3 id="write-up" tabindex="-1"><a class="md-anchor" href="#write-up" aria-hidden="true"></a> Write-Up</h3><h4 id="preliminary-observations-and-analysis" tabindex="-1"><a class="md-anchor" href="#preliminary-observations-and-analysis" aria-hidden="true"></a> Preliminary Observations and Analysis</h4><p>Unlike other reverse challenges, this one requires us to connect to a server and auto-hack not one, but <em>five</em> binaries. We're provided with this template:</p><div class="code-toolbar"><pre data-label="solver-template.py" class="language-py" tabindex="0"><code class="language-py"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">"tamuctf.com"</span><span class="token punctuation">,</span> <span class="token number">443</span><span class="token punctuation">,</span> ssl<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> sni<span class="token operator">=</span><span class="token string">"labyrinth"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> binary <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"elf"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token comment"># send whatever data you want</span>
  p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">b"howdy"</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>solver-template.py</span></div><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>Modifying the template slightly, we run and download a couple binaries for analysis.</p><p>As a first step, we'll run <code>checksec</code> to see what securities are in place.</p><div class="code-toolbar"><pre class="command-line language-sh" data-prompt="$" data-output="2-7" tabindex="0"><code class="language-sh"><span class="command-line-prompt"><span data-prompt="$"></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span class="token command">checksec elf</span>
<span class="token output">[*] '/Users/&lt;redacted&gt;/labyrinth/elf'</span>
<span class="token output">    Arch:     amd64-64-little</span>
<span class="token output">    RELRO:    Partial RELRO</span>
<span class="token output">    Stack:    No canary found</span>
<span class="token output">    NX:       NX enabled</span>
<span class="token output">    PIE:      PIE enabled</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Shell</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>It appears that PIE is enabled. We'll make a mental note of this, since this may mess with function addresses.</p><div class="alert alert-info d-flex align-items-start"><i class="fas fa-bolt ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><p><strong>What is PIE?</strong> Sadly, not the scrumptious dessert. Position-independent executable is a security mechanism whereby on starting an application, the OS will offset the assembly sections (<code>.data</code>, <code>.text</code>, etc.).</p></div></div><p>Next, we decompile our elves using Ghidra and make some observations.</p><p><a class="lightbox-single" title="Labyrinth decompiled 1." href="/img/posts/ctf/tamuctf22/assets/labyrinth-1-2460w.webp"><img class="mb-2 rw center jw-100" src="/img/posts/ctf/tamuctf22/assets/labyrinth-1-2460w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 2460 / 1146" alt="Labyrinth decompiled 1." title="Labyrinth decompiled 1." srcset="/img/posts/ctf/tamuctf22/assets/labyrinth-1-256w.webp 256w, /img/posts/ctf/tamuctf22/assets/labyrinth-1-512w.webp 512w, /img/posts/ctf/tamuctf22/assets/labyrinth-1-1024w.webp 1024w, /img/posts/ctf/tamuctf22/assets/labyrinth-1-2460w.webp 2460w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, (max-width: 1024px) 1024px, 2460px"></a></p><p class="caption"><sup>Only one function contains <code>exit(0)</code>.</sup></p><p><a class="lightbox-single" title="Labyrinth decompiled 2." href="/img/posts/ctf/tamuctf22/assets/labyrinth-2-2452w.webp"><img class="mb-2 rw center jw-100" src="/img/posts/ctf/tamuctf22/assets/labyrinth-2-2452w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 2452 / 1152" alt="Labyrinth decompiled 2." title="Labyrinth decompiled 2." srcset="/img/posts/ctf/tamuctf22/assets/labyrinth-2-256w.webp 256w, /img/posts/ctf/tamuctf22/assets/labyrinth-2-512w.webp 512w, /img/posts/ctf/tamuctf22/assets/labyrinth-2-1024w.webp 1024w, /img/posts/ctf/tamuctf22/assets/labyrinth-2-2452w.webp 2452w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, (max-width: 1024px) 1024px, 2452px"></a></p><p class="caption"><sup>Other functions seem to perform some sort of check and lead to more functions.</sup></p><ul><li>Each binary contains a thousand (1000) functions (excluding <code>main</code>). The symbols are <code>function_0</code>, <code>function_1</code>, <code>function_2</code>, and so on.</li><li>Each of these functions will:<ul><li>Call <code>scanf("%u\n", ...)</code> (read 4 bytes into a stack variable), and</li><li>Branch (if, else-if, else) into two or more paths.</li><li>The branch conditions come in some form of arithmetic check. For example, <code>input == 0x1c1</code>, <code>input ^ 0xc213504e == 0x142</code>, <code>input &lt; 0x143</code>, <code>input - 0x5173cdc3 == 0x28b</code>.</li><li>Each branch will either<ul><li><code>exit(1)</code></li><li>or call another function from the 1000 functions.</li></ul></li><li>The number of branches, numbers used in the conditions, and order of conditions are random.</li></ul></li><li>All 1000 functions are laid next to each other in memory.</li><li><code>main</code> is always at <code>0x101155</code> and starts by calling one of the 1000 functions. The function call is not fixed (i.e. we can't be certain about the address).</li><li>Only one function calls <code>exit(0)</code> and this function is always at address <code>0x1011c4</code>.</li></ul><p>To "solve" an elf, we need to give an appropriate input at each step of the function such that the correct branch and path are taken. In other words, we need to trace the right path out of the maze. We need to solve 5 elves to get the flag. We only have five minutes for five elves. Solving this without any automation seems next to impossible. Thankfully, we have angr.</p><div class="alert alert-info d-flex align-items-start"><i class="fas fa-bolt ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><p><strong>What is angr?</strong><br>angr is a python library which simulates machine code while keeping track of program state. Its exploration features are useful to find the input corresponding to a given output.</p></div></div><h4 id="coding" tabindex="-1"><a class="md-anchor" href="#coding" aria-hidden="true"></a> Coding</h4><p>As a preliminary step, we'll import angr, load the project, and set some constants.</p><div class="code-toolbar"><pre class="language-py" tabindex="0"><code class="language-py"><span class="token keyword">from</span> angr <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">def</span> <span class="token function">solve</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token operator">=</span><span class="token string">'elf'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> Project<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>
    elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>

    <span class="token comment"># Find target address.</span>
    start_addr <span class="token operator">=</span> <span class="token number">0x4011b3</span>
    tar_addr <span class="token operator">=</span> <span class="token number">0x4011c8</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><div class="alert alert-info d-flex align-items-start"><i class="fas fa-bolt ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><p>Ghidra will load PIE assembly at offset <code>0x100000</code>, but angr loads it at <code>0x400000</code> by default. So all addresses in the previous section were offset by an additional <code>0x300000</code> to account for this difference. There's a way to make angr load at a custom offset, but I forgot what the option was called. (But the option exists!)</p></div></div><p>Now we'll try some good ol' angr <code>explore()</code> and see what turns up.</p><div class="code-toolbar"><pre class="language-py" tabindex="0"><code class="language-py">state <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>entry_state<span class="token punctuation">(</span>addr<span class="token operator">=</span>start_addr<span class="token punctuation">)</span> <span class="token comment"># Construct the state when we "start" the executable at `start_addr`.</span>
simgr <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simgr<span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token comment"># Get a simulation manager. This will... manage our simulations.</span>
simgr<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find<span class="token operator">=</span>tar_addr<span class="token punctuation">)</span>  <span class="token comment"># GOGOGO!!!</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p><code>explore()</code> is the most straightforward command in angr. With the <code>find=tar_addr</code> parameter, we tell <code>explore()</code> to <em>simulate</em> and <em>look for</em> states which will execute the instruction at <code>tar_addr</code>.</p><h4 id="path-explosion" tabindex="-1"><a class="md-anchor" href="#path-explosion" aria-hidden="true"></a> Path Explosion</h4><p>Unfortunately, this takes forever to run due to <em>path explosion</em>. Notice how the control flow makes the paths diverge in one of the binaries:</p><p><a class="lightbox-single" title="Paths go boom." href="/img/posts/ctf/tamuctf22/assets/labyrinth-path-explosion-graph-1196w.webp"><img class="mb-2 rw center jw-80" src="/img/posts/ctf/tamuctf22/assets/labyrinth-path-explosion-graph-1196w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 1196 / 626" alt="Example diagram of path explosion." title="Paths go boom." srcset="/img/posts/ctf/tamuctf22/assets/labyrinth-path-explosion-graph-256w.webp 256w, /img/posts/ctf/tamuctf22/assets/labyrinth-path-explosion-graph-512w.webp 512w, /img/posts/ctf/tamuctf22/assets/labyrinth-path-explosion-graph-1024w.webp 1024w, /img/posts/ctf/tamuctf22/assets/labyrinth-path-explosion-graph-1196w.webp 1196w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, (max-width: 1024px) 1024px, 1196px"></a></p><p>Now angr is pretty smart, but not too smart. angr will simulate all paths and if it encounters a branch, it will simulate both branches together. However, it will treat the <code>function_133</code> branches as separate states...</p><p>To get a more concrete view of paths exploding, Gru tried calling <code>simgr.run(n=50)</code>—which simulates 50 steps...</p><p><a class="lightbox-single" title="Good going, Gru!" href="/img/posts/ctf/tamuctf22/assets/labyrinth-path-explosion-gru-700w.webp"><img class="mb-2 rw center jw-80" src="/img/posts/ctf/tamuctf22/assets/labyrinth-path-explosion-gru-700w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 700 / 449" alt="Gru explains his plan to avoid path explosion. (not)" title="Good going, Gru!" srcset="/img/posts/ctf/tamuctf22/assets/labyrinth-path-explosion-gru-256w.webp 256w, /img/posts/ctf/tamuctf22/assets/labyrinth-path-explosion-gru-512w.webp 512w, /img/posts/ctf/tamuctf22/assets/labyrinth-path-explosion-gru-700w.webp 700w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 700px"></a></p><p>90 active states is quite a lot! Usually we'd want to limit ourselves to around 10 active states to ensure good simulation speed.</p><p>With 50 steps and already 90 active states, the situation is pretty dismal. We'll need to find a better way of getting to the target address.</p><h4 id="cfgs-to-the-rescue" tabindex="-1"><a class="md-anchor" href="#cfgs-to-the-rescue" aria-hidden="true"></a> CFGs to the Rescue</h4><p><strong>Control flow graphs</strong> (CFGs) are directed graphs where nodes are blocks of code and edges indicate the direction the code can take. By translating the program into a graph, we can utilise the many graph algorithms at our disposal. In particular, we're interested in the <em>shortest path between a start node and target node</em>.</p><div class="center rw mb-2 lightbox-gallery"><a class="" title="Path explosion 1." href="/img/posts/ctf/tamuctf22/assets/labyrinth-path-explosion-1-577w.webp"><img class="jw-30 multi" src="/img/posts/ctf/tamuctf22/assets/labyrinth-path-explosion-1-577w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 577 / 433" alt="Path explosion 1." title="Path explosion 1." srcset="/img/posts/ctf/tamuctf22/assets/labyrinth-path-explosion-1-256w.webp 256w, /img/posts/ctf/tamuctf22/assets/labyrinth-path-explosion-1-512w.webp 512w, /img/posts/ctf/tamuctf22/assets/labyrinth-path-explosion-1-577w.webp 577w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 577px"></a><a class="" title="Path explosion 2." href="/img/posts/ctf/tamuctf22/assets/labyrinth-path-explosion-2-577w.webp"><img class="jw-30 multi" src="/img/posts/ctf/tamuctf22/assets/labyrinth-path-explosion-2-577w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 577 / 433" alt="Path explosion 2." title="Path explosion 2." srcset="/img/posts/ctf/tamuctf22/assets/labyrinth-path-explosion-2-256w.webp 256w, /img/posts/ctf/tamuctf22/assets/labyrinth-path-explosion-2-512w.webp 512w, /img/posts/ctf/tamuctf22/assets/labyrinth-path-explosion-2-577w.webp 577w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 577px"></a><a class="" title="Path explosion 3." href="/img/posts/ctf/tamuctf22/assets/labyrinth-path-explosion-3-577w.webp"><img class="jw-30 multi" src="/img/posts/ctf/tamuctf22/assets/labyrinth-path-explosion-3-577w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 577 / 433" alt="Path explosion 3." title="Path explosion 3." srcset="/img/posts/ctf/tamuctf22/assets/labyrinth-path-explosion-3-256w.webp 256w, /img/posts/ctf/tamuctf22/assets/labyrinth-path-explosion-3-512w.webp 512w, /img/posts/ctf/tamuctf22/assets/labyrinth-path-explosion-3-577w.webp 577w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 577px"></a></div><p>angr comes with a bundle of analysis modules; these include two CFG analysis strategies: <code>CFGFast</code> and <code>CFGEmulated</code>. The former analyses the program statically (without actually simulating the code!), whereas the latter analyses the program dynamically (i.e. by simulating the code).</p><p>Since the labyrinth elf only contains simple if-statements and function calls, and no obfuscation or complicated redirection whatsoever, we can construct a CFG statically!</p><p>Working with graphs and nodes in angr is fairly straightforward. angr CFGs are just instances of <code>networkx</code> graphs (a python graph library), so we'll need to import it to use its handy <code>shortest_path</code> function.</p><div class="code-toolbar"><pre class="language-py" tabindex="0"><code class="language-py"><span class="token comment"># Construct a CFG from the 1000 functions. </span>
<span class="token comment"># Restrict analysis to the relevant region to save time.</span>
region <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0x401155</span><span class="token punctuation">,</span> <span class="token number">0x400000</span> <span class="token operator">+</span> elf<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__libc_csu_init'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
cfg <span class="token operator">=</span> p<span class="token punctuation">.</span>analyses<span class="token punctuation">.</span>CFGFast<span class="token punctuation">(</span>regions<span class="token operator">=</span>region<span class="token punctuation">)</span>

<span class="token comment"># Get networkx nodes for start and target addresses in CFG.</span>
src_node <span class="token operator">=</span> cfg<span class="token punctuation">.</span>model<span class="token punctuation">.</span>get_any_node<span class="token punctuation">(</span>start_addr<span class="token punctuation">,</span> anyaddr<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
tar_node <span class="token operator">=</span> cfg<span class="token punctuation">.</span>model<span class="token punctuation">.</span>get_any_node<span class="token punctuation">(</span>tar_addr<span class="token punctuation">,</span> anyaddr<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># Ensure nodes exist. shortest_path works differently if a node is None.</span>
<span class="token keyword">assert</span> src_node <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> tar_node <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span>

<span class="token comment"># Construct the shortest path from src to tar. This will be a list of CFGNodes.</span>
<span class="token keyword">from</span> networkx <span class="token keyword">import</span> shortest_path
path <span class="token operator">=</span> shortest_path<span class="token punctuation">(</span>cfg<span class="token punctuation">.</span>graph<span class="token punctuation">,</span> src_node<span class="token punctuation">,</span> tar_node<span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>Now that we have a direct sequence of nodes from <code>main</code> to our <code>exit(0)</code> function, we just need to guide angr's simulation manager along the path, function-by-function.</p><div class="code-toolbar"><pre class="language-py" tabindex="0"><code class="language-py"><span class="token comment"># Walk through the rest of the path.</span>
state <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>blank_state<span class="token punctuation">(</span>addr<span class="token operator">=</span>start_addr<span class="token punctuation">)</span>
<span class="token keyword">for</span> node <span class="token keyword">in</span> path<span class="token punctuation">:</span>
    <span class="token comment"># Let the simulator engine works its magic.</span>
    simgr <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simgr<span class="token punctuation">(</span>state<span class="token punctuation">)</span>
    simgr<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find<span class="token operator">=</span>node<span class="token punctuation">.</span>addr<span class="token punctuation">)</span>
    <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>simgr<span class="token punctuation">.</span>found<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span>
    
    <span class="token comment"># Keep the found state for next iteration.</span>
    state <span class="token operator">=</span> simgr<span class="token punctuation">.</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>Our last step is to get the input used. angr's constraint solver should have it figured out.</p><div class="code-toolbar"><pre class="language-py" tabindex="0"><code class="language-py"><span class="token comment"># Get input which will get us from main to exit(0).</span>
chain <span class="token operator">=</span> state<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">return</span> chain</code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>On my computer, this solve process takes roughly 30-40 seconds... which is good enough, since it falls within the allotted time of one minute per solve. Putting it together with the solver template and running it, the server kindly hands us the flag!</p><h3 id="solve-script" tabindex="-1"><a class="md-anchor" href="#solve-script" aria-hidden="true"></a> Solve Script</h3><div class="code-toolbar"><pre class="language-py" tabindex="0"><code class="language-py"><span class="token keyword">from</span> angr <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> networkx <span class="token keyword">import</span> shortest_path
<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>


<span class="token keyword">def</span> <span class="token function">solve</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token operator">=</span><span class="token string">'elf'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> Project<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>
    elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>

    <span class="token comment"># Find target address.</span>
    start_addr <span class="token operator">=</span> <span class="token number">0x4011b3</span>
    tar_addr <span class="token operator">=</span> <span class="token number">0x4011c8</span>

    <span class="token comment"># Construct a CFG from the 1000 functions.</span>
    <span class="token comment"># Restrict analysis to the relevant region to reduce time.</span>
    region <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0x401155</span><span class="token punctuation">,</span> <span class="token number">0x400000</span> <span class="token operator">+</span> elf<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__libc_csu_init'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    cfg <span class="token operator">=</span> p<span class="token punctuation">.</span>analyses<span class="token punctuation">.</span>CFGFast<span class="token punctuation">(</span>regions<span class="token operator">=</span>region<span class="token punctuation">)</span>

    <span class="token comment"># Get networkx nodes for start and target addresses in CFG.</span>
    src_node <span class="token operator">=</span> cfg<span class="token punctuation">.</span>model<span class="token punctuation">.</span>get_any_node<span class="token punctuation">(</span>start_addr<span class="token punctuation">,</span> anyaddr<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    tar_node <span class="token operator">=</span> cfg<span class="token punctuation">.</span>model<span class="token punctuation">.</span>get_any_node<span class="token punctuation">(</span>tar_addr<span class="token punctuation">,</span> anyaddr<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token comment"># Ensure nodes exist. shortest_path works differently if a node is None.</span>
    <span class="token keyword">assert</span> src_node <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> tar_node <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span>

    <span class="token comment"># Construct the shortest path from src to tar. This will be a list of CFGNodes.</span>
    path <span class="token operator">=</span> shortest_path<span class="token punctuation">(</span>cfg<span class="token punctuation">.</span>graph<span class="token punctuation">,</span> src_node<span class="token punctuation">,</span> tar_node<span class="token punctuation">)</span>

    <span class="token comment"># Walk through the rest of the path.</span>
    state <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>blank_state<span class="token punctuation">(</span>addr<span class="token operator">=</span>start_addr<span class="token punctuation">)</span>
    <span class="token keyword">for</span> node <span class="token keyword">in</span> path<span class="token punctuation">:</span>
        <span class="token comment"># Let the simulator engine works its magic.</span>
        simgr <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simgr<span class="token punctuation">(</span>state<span class="token punctuation">)</span>
        simgr<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find<span class="token operator">=</span>node<span class="token punctuation">.</span>addr<span class="token punctuation">)</span>
        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>simgr<span class="token punctuation">.</span>found<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span>
        
        <span class="token comment"># Keep the found state for next iteration.</span>
        state <span class="token operator">=</span> simgr<span class="token punctuation">.</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token comment"># Get input which will get us from main to exit(0).</span>
    chain <span class="token operator">=</span> state<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>chain<span class="token punctuation">)</span>

    <span class="token keyword">return</span> chain


p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">"tamuctf.com"</span><span class="token punctuation">,</span> <span class="token number">443</span><span class="token punctuation">,</span> ssl<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> sni<span class="token operator">=</span><span class="token string">"labyrinth"</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> binary <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Read input and save as binary.</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"elf"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Solve and print.</span>
    out <span class="token operator">=</span> solve<span class="token punctuation">(</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>out<span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><h3 id="flag" tabindex="-1"><a class="md-anchor" href="#flag" aria-hidden="true"></a> Flag</h3><div class="code-toolbar"><pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">gigem{w0w_y0ur3_r34lly_600d_w17h_m4z35}</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div></div><a id="end-of-article"></a><br><script defer src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><div class="post-share dim-gentle mb-3 d-flex flex-row align-items-center"><div class="d-flex flex-row flex-wrap align-items-center gap-3"><span>Share&nbsp;on</span> <a class="no-decoration" data-sharer="reddit" data-title="TAMUctf 2022 – Labyrinth" data-url="/posts/tamuctf-2022-labyrinth/"><span class="fs-4"><i class="fab fa-reddit"></i> </span></a><a class="no-decoration" data-sharer="telegram" data-title="TAMUctf 2022 – Labyrinth" data-url="/posts/tamuctf-2022-labyrinth/"><span class="fs-4"><i class="fab fa-telegram"></i> </span></a><a class="no-decoration" data-sharer="whatsapp" data-title="TAMUctf 2022 – Labyrinth" data-url="/posts/tamuctf-2022-labyrinth/"><span class="fs-4"><i class="fab fa-whatsapp"></i> </span></a><a class="no-decoration" data-sharer="linkedin" data-title="TAMUctf 2022 – Labyrinth" data-url="/posts/tamuctf-2022-labyrinth/"><span class="fs-4"><i class="fab fa-linkedin"></i> </span></a><a class="no-decoration" data-sharer="vk" data-title="TAMUctf 2022 – Labyrinth" data-url="/posts/tamuctf-2022-labyrinth/"><span class="fs-4"><i class="fab fa-vk"></i> </span></a><a class="no-decoration" data-sharer="twitter" data-title="TAMUctf 2022 – Labyrinth" data-url="/posts/tamuctf-2022-labyrinth/"><span class="fs-4"><i class="fab fa-twitter"></i> </span></a><a id="copy-link-button" class="no-decoration" data-bs-toggle="tooltip" data-bs-trigger="click" title="Link copied!"><span class="fs-4"><i class="fas fa-link"></i></span></a></div></div><hr><div id="post-author-container" class="d-flex justify-content-between align-items-center gap-3" itemprop="author" itemscope itemtype="https://schema.org/Person"><img src="/img/profile-icon.jpg" class="profile-img" alt="" loading="lazy" decoding="async" itemprop="image"><div class="author-info d-flex flex-column gap-1"><p class="profile-name" itemprop="name">TrebledJ</p><p class="profile-bio" itemprop="description">Passionate problem-solver, pentester, and autodidact. I thrive on learning new things and enjoy passing it on. When not immersed in bughunting or programming, I can be found taking walks, composing a short tune, and occasionally indulging in CTF challenges.</p></div></div><hr class="section-sep"><div id="related" class="jw-100"><h3><i class="fas fa-circle-nodes me-2"></i>Related Posts</h3><div class="row gx-3 mt-4"><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/abusing-server-side-rendering-in-drogon/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/abusing-server-side-rendering-in-drogon/"><img class="post-img-blurred-bg" src="/img/posts/infosec/drogon-csp/assets/drogon-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 288" alt="Thumbnail for Dynamic Views Loading – Abusing Server Side Rendering in Drogon" srcset="/img/posts/infosec/drogon-csp/assets/drogon-thumbnail-256w.webp 256w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-512w.webp 512w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-1024w.webp 1024w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-1600w.webp 1600w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/infosec/drogon-csp/assets/drogon-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 288" alt="Thumbnail for Dynamic Views Loading – Abusing Server Side Rendering in Drogon" srcset="/img/posts/infosec/drogon-csp/assets/drogon-thumbnail-256w.webp 256w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-512w.webp 512w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-1024w.webp 1024w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-1600w.webp 1600w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">Dynamic Views Loading – Abusing Server Side Rendering in Drogon</h2><div class="post-summary"><p>What could go wrong releasing a C++ web server with "live reload" into the wild?</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/infosec/" itemprop="keywords">infosec</a> </span><span><a class="jtag" href="/tags/cpp/" itemprop="keywords">cpp</a> </span><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/attack-of-the-zip/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/attack-of-the-zip/"><img class="post-img-blurred-bg" src="/img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-500w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 500 / 337" alt="Thumbnail for From Compression to Compromise: Unmasking Zip File Threats" srcset="/img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-256w.webp 256w, /img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-500w.webp 500w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 500px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-500w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 500 / 337" alt="Thumbnail for From Compression to Compromise: Unmasking Zip File Threats" srcset="/img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-256w.webp 256w, /img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-500w.webp 500w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 500px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">From Compression to Compromise: Unmasking Zip File Threats</h2><div class="post-summary"><p>Deep dive into zip file attacks and mitigations (with examples!).</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/infosec/" itemprop="keywords">infosec</a> </span><span><a class="jtag" href="/tags/notes/" itemprop="keywords">notes</a> </span><span><a class="jtag" href="/tags/web/" itemprop="keywords">web</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/hkcert-2023-decompetition-vitamin-cpp/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/hkcert-2023-decompetition-vitamin-cpp/"><img class="post-img-blurred-bg" src="/img/posts/ctf/hkcert23/assets/vitamin-cpp-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 288" alt="Thumbnail for HKCERT CTF 2023 – Decompetition: Vitamin&nbsp;C++" srcset="/img/posts/ctf/hkcert23/assets/vitamin-cpp-256w.webp 256w, /img/posts/ctf/hkcert23/assets/vitamin-cpp-512w.webp 512w, /img/posts/ctf/hkcert23/assets/vitamin-cpp-640w.webp 640w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/ctf/hkcert23/assets/vitamin-cpp-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 288" alt="Thumbnail for HKCERT CTF 2023 – Decompetition: Vitamin&nbsp;C++" srcset="/img/posts/ctf/hkcert23/assets/vitamin-cpp-256w.webp 256w, /img/posts/ctf/hkcert23/assets/vitamin-cpp-512w.webp 512w, /img/posts/ctf/hkcert23/assets/vitamin-cpp-640w.webp 640w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">HKCERT CTF 2023 – Decompetition: Vitamin&nbsp;C++</h2><div class="post-summary"><p>A beginner-friendly writeup to reverse-engineering C++ a lá decompetition. Years of complex shenanigans condensed!</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/writeup/" itemprop="keywords">writeup</a> </span><span><a class="jtag" href="/tags/reverse/" itemprop="keywords">reverse</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/subtype-metaprogramming-is-mostly-harmless/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/subtype-metaprogramming-is-mostly-harmless/"><img class="post-img-blurred-bg" src="/img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 249" alt="Thumbnail for N[Subtype Metaprogramming] is N[Mostly Harmless]" srcset="/img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-256w.webp 256w, /img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-512w.webp 512w, /img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-804w.webp 804w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 249" alt="Thumbnail for N[Subtype Metaprogramming] is N[Mostly Harmless]" srcset="/img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-256w.webp 256w, /img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-512w.webp 512w, /img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-804w.webp 804w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title"><sub><sup>N[</sup></sub>Subtype Metaprogramming<sub><sup>]</sup></sub> is <sub><sup>N[</sup></sub>Mostly Harmless<sub><sup>]</sup></sub></h2><div class="post-summary"><p>Inheritance go brrrrrrrr... abusing turing-complete typesystems to write fun programs in Python.</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a> </span><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/types/" itemprop="keywords">types</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/hitcon-2023-the-blade/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/hitcon-2023-the-blade/"><img class="post-img-blurred-bg" src="/img/posts/ctf/hitcon23/assets/hitcon-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 206" alt="Thumbnail for HITCON 2023 – The Blade" srcset="/img/posts/ctf/hitcon23/assets/hitcon-thumbnail-256w.webp 256w, /img/posts/ctf/hitcon23/assets/hitcon-thumbnail-512w.webp 512w, /img/posts/ctf/hitcon23/assets/hitcon-thumbnail-1024w.webp 1024w, /img/posts/ctf/hitcon23/assets/hitcon-thumbnail-1570w.webp 1570w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/ctf/hitcon23/assets/hitcon-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 206" alt="Thumbnail for HITCON 2023 – The Blade" srcset="/img/posts/ctf/hitcon23/assets/hitcon-thumbnail-256w.webp 256w, /img/posts/ctf/hitcon23/assets/hitcon-thumbnail-512w.webp 512w, /img/posts/ctf/hitcon23/assets/hitcon-thumbnail-1024w.webp 1024w, /img/posts/ctf/hitcon23/assets/hitcon-thumbnail-1570w.webp 1570w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">HITCON 2023 – The Blade</h2><div class="post-summary"><p>Beginner-friendly writeup for a nifty Rust reversing challenge.</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/writeup/" itemprop="keywords">writeup</a> </span><span><a class="jtag" href="/tags/reverse/" itemprop="keywords">reverse</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/gdb-cheatsheet/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/gdb-cheatsheet/"><img class="post-img-blurred-bg" src="/img/posts/programming/cheatsheets/assets/gef-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 250" alt="Thumbnail for GDB/GEF Cheatsheet" srcset="/img/posts/programming/cheatsheets/assets/gef-256w.webp 256w, /img/posts/programming/cheatsheets/assets/gef-512w.webp 512w, /img/posts/programming/cheatsheets/assets/gef-906w.webp 906w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/programming/cheatsheets/assets/gef-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 250" alt="Thumbnail for GDB/GEF Cheatsheet" srcset="/img/posts/programming/cheatsheets/assets/gef-256w.webp 256w, /img/posts/programming/cheatsheets/assets/gef-512w.webp 512w, /img/posts/programming/cheatsheets/assets/gef-906w.webp 906w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">GDB/GEF Cheatsheet</h2><div class="post-summary"><p>Quick command reference on one of the most powerful tools for dynamic analysis.</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a> </span><span><a class="jtag" href="/tags/cheatsheet/" itemprop="keywords">cheatsheet</a> </span><span><a class="jtag" href="/tags/infosec/" itemprop="keywords">infosec</a></span></div></div></div></div></article></div></div><hr><h3><i class="fas fa-tags me-2"></i>Related Tags</h3><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to ctf, reverse">software.security</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/ctf/">ctf</a> <a class="jtag" href="/tags/infosec/">infosec</a> <a class="jtag" href="/tags/reverse/">reverse</a> <a class="jtag" href="/tags/pentesting/">pentesting</a> <a class="jtag" href="/tags/pwn/">pwn</a> <a class="jtag" href="/tags/cryptography/">cryptography</a> <a class="jtag" href="/tags/redteam/">redteam</a> <a class="jtag" href="/tags/stego/">stego</a></span></div><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to programming">software.general</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/programming/">programming</a> <a class="jtag" href="/tags/software-engineering/">software-engineering</a> <a class="jtag" href="/tags/web/">web</a> <a class="jtag" href="/tags/aoc/">aoc</a> <a class="jtag" href="/tags/apps/">apps</a> <a class="jtag" href="/tags/dsp/">dsp</a> <a class="jtag" href="/tags/programming-languages/">programming-languages</a> <a class="jtag" href="/tags/linux/">linux</a> <a class="jtag" href="/tags/performance/">performance</a> <a class="jtag" href="/tags/functional/">functional</a> <a class="jtag" href="/tags/types/">types</a> <a class="jtag" href="/tags/windows/">windows</a> <a class="jtag" href="/tags/ai/">ai</a> <a class="jtag" href="/tags/metaprogramming/">metaprogramming</a> <a class="jtag" href="/tags/oop/">oop</a></span></div><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to python">software.programming-language</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/cpp/">cpp</a> <a class="jtag" href="/tags/python/">python</a> <a class="jtag" href="/tags/c/">c</a> <a class="jtag" href="/tags/haskell/">haskell</a> <a class="jtag" href="/tags/js/">js</a> <a class="jtag" href="/tags/qt/">qt</a> <a class="jtag" href="/tags/rust/">rust</a> <a class="jtag" href="/tags/qml/">qml</a> <a class="jtag" href="/tags/sql/">sql</a> <a class="jtag" href="/tags/scala/">scala</a></span></div><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to writeup">misc</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/writeup/">writeup</a> <a class="jtag" href="/tags/notes/">notes</a> <a class="jtag" href="/tags/tutorial/">tutorial</a> <a class="jtag" href="/tags/reflection/">reflection</a> <a class="jtag" href="/tags/hkust/">hkust</a> <a class="jtag" href="/tags/project/">project</a> <a class="jtag" href="/tags/experience/">experience</a> <a class="jtag" href="/tags/faith/">faith</a> <a class="jtag" href="/tags/meta/">meta</a> <a class="jtag" href="/tags/learning/">learning</a> <a class="jtag" href="/tags/mathematics/">mathematics</a> <a class="jtag" href="/tags/cheatsheet/">cheatsheet</a> <a class="jtag" href="/tags/research/">research</a> <a class="jtag" href="/tags/satire/">satire</a> <a class="jtag" href="/tags/essay/">essay</a> <a class="jtag" href="/tags/reading/">reading</a></span></div></div><hr class="section-sep"><div class="container-md mt-4 p-4"><a id="comments"></a><p><em>Comments are back! Privacy-focused, without ads, bloatware 🤮, and trackers. Be one of the first to contribute to the discussion — I'd love to hear your thoughts.</em></p><script defer src="https://trebledj.me/js/comentario.min.js"></script><comentario-comments id="comentario" auto-init="false" no-fonts="true" css-override="false" theme="dark"></comentario-comments></div><br></div></div></article></div></div></div><footer class="d-flex flex-column gap-2"><div class="d-flex flex-row gap-3 mx-auto" style="width:fit-content;"><a rel="me noreferrer" href="https://github.com/TrebledJ" target="_blank"><i class="social-icon fab fa-github" style="color:rgb(150, 60, 180) !important;"></i> </a><a rel="me noreferrer" href="https://stackoverflow.com/users/10239789/trebledj" target="_blank"><i class="social-icon fab fa-stack-overflow" style="color:rgb(236, 124, 34) !important;"></i> </a><a rel="me noreferrer" href="https://www.codingame.com/profile/8444100ecb9723c1ec542346b0630aaa2821532" target="_blank"><i class="social-icon d-flex flex-column"><img src="/img/logos/codingame.webp" alt="" loading="lazy" decoding="async"></i></a><a rel="me noreferrer" href="https://soundcloud.com/trebledj" target="_blank"><i class="social-icon fab fa-soundcloud" style="color:rgb(237, 110, 30) !important;"></i> </a><a rel="me noreferrer" href="https://musescore.com/user/20636901" target="_blank"><i class="social-icon d-flex flex-column"><img src="/img/logos/musescore.webp" alt="" loading="lazy" decoding="async"></i></a><a rel="me noreferrer" href="https://discordapp.com/users/220427982798454794" target="_blank"><i class="social-icon fab fa-discord" style="color:rgb(84, 100, 235) !important;"></i> </a><a rel="me" href="mailto:trebledjjj@gmail.com"><i class="social-icon fas fa-envelope"></i> </a><a rel="me" href="/feeds"><i class="social-icon fas fa-square-rss"></i></a></div><p>Copyright&nbsp;©&nbsp;2025&nbsp;TrebledJ • <a href="/privacy-policy">Privacy&nbsp;Policy</a> • <a href="https://github.com/TrebledJ/trebledj.github.io?tab=readme-ov-file#credits--appreciation" rel="noreferrer" target="_blank">Credits</a></p></footer><script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js"></script><script>var tocOptions={}</script><script defer src="/cb/MPnrKnjI5w.js"></script><script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;52d99b3d385b4c9a98ac8ad109a95a2a&quot;}"></script></body></html>