<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>HITCON 2023 ‚Äì The Blade - TrebledJ's Pages</title><meta name="description" content="Beginner-friendly writeup for a nifty Rust reversing challenge."><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="trebledj,hitcon 2023 ‚Äì the blade,beginner-friendly writeup for a nifty rust reversing challenge.,ctf,reverse,rust,python,programming,writeup"><meta name="robots" content="index,follow"><meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'sha256-Wv9Tjjg7Y7X5sBbP5AXqAQJA6+eewSRUjoPhNczfpnM=' 'sha256-FBtdNYnNdsvTKcrNIznI+jwGwhW3pNA5x/yQUw8jOPA=' 'sha256-puGfk8by7YflxyCkfgS+RgzE70yM3jYq5c5IrWTe0hM=' 'sha256-qlkNkQyGC5u9Brt4wwVi0MsPO/hVdrz3rzXuWYIkAbM=' 'sha256-fpqHX3vj/TpB8DyMxAUbt+Rpk0g/8oR6BkJd6JriNoo=' 'sha256-J+ryCgKrW+QOH4xdCyPd6R5W3u9wJkXayR7KvtlnCnQ=' 'sha256-Deekn20h+++EarpL0nFQLX7JSJv7s/2W9f988ZFAh14=' 'unsafe-hashes' comments.trebledj.me code.jquery.com cdn.jsdelivr.net gist.github.com static.cloudflareinsights.com; style-src 'self' 'unsafe-inline' comments.trebledj.me cdn.jsdelivr.net cdnjs.cloudflare.com github.githubassets.com; font-src 'self' data: comments.trebledj.me cdn.jsdelivr.net cdnjs.cloudflare.com; img-src 'self' data: comments.trebledj.me; frame-src 'self' *.soundcloud.com; connect-src 'self' comments.trebledj.me wss://comments.trebledj.me cloudflareinsights.com formcarry.com;"><link href="/feeds/posts.xml" rel="alternate" title="RSS Feed for TrebledJ's Pages" type="application/rss+xml"><meta property="og:site_name" content="TrebledJ's Pages"><meta property="og:type" content="article"><meta property="og:title" content="HITCON 2023 ‚Äì The Blade - TrebledJ's Pages"><meta property="twitter:title" content="HITCON 2023 ‚Äì The Blade - TrebledJ's Pages"><meta property="og:description" content="Beginner-friendly writeup for a nifty Rust reversing challenge.

My first Rust rev solve! Though in hindsight, not much Rust knowledge was needed. Description A Rust tool for executing shellcode in a seccomp environment. Your goal is to pass..."><meta property="twitter:description" content="Beginner-friendly writeup for a nifty Rust reversing challenge.

My first Rust rev solve! Though in hindsight, not much Rust knowledge was needed. Description A Rust tool for executing shellcode in a seccomp environment. Your goal is to pass..."><meta property="og:url" content="https://trebledj.me/posts/hitcon-2023-the-blade/"><meta name="twitter:card" content="summary_large_image"><meta property="og:image" content="https://trebledj.me/img/posts/ctf/hitcon23/assets/hitcon-thumbnail-1570w.webp"><meta property="twitter:image" content="https://trebledj.me/img/posts/ctf/hitcon23/assets/hitcon-thumbnail-1570w.webp"><meta property="article:published_time" content="2023-09-20T00:00:00.000Z"><meta property="article:author" content="TrebledJ"><meta property="article:section" content="ctfs"><meta property="article:tag" content="ctf"><meta property="article:tag" content="reverse"><meta property="article:tag" content="rust"><meta property="article:tag" content="python"><meta property="article:tag" content="programming"><meta property="article:tag" content="writeup"><script type="application/ld+json">{"@context": "https://schema.org","@type": "WebSite","name": "TrebledJ's Pages","url": "https://trebledj.me"}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/cb/css/icons-3b2a868570ec062c.css"><link rel="stylesheet" href="/cb/x2ljFSZBUH.css" media="print"><script>document.querySelectorAll('link[media|="print"]').forEach(e=>{e.addEventListener("load",()=>e.media="all"),e.sheet&&(e.media="all")})</script><script>const defaultTheme="dark";let icon=void 0;function modeInit(){var e=localStorage.getItem("theme");setMode("dark"===e?"dark":"light"===e?"light":defaultTheme)}function modeInitIcon(){icon=document.getElementById("mode-switch-icon"),isLightTheme()&&(icon.classList.remove("fa-moon"),icon.classList.add("fa-sun"),icon.classList.add("mode-switch-transform"))}function isLightTheme(){return"light"===localStorage.getItem("theme")}function modeSwitcher(){var e=localStorage.getItem("theme");setMode("dark"===e?"light":"light"===e?"dark":defaultTheme)}function setMode(e){"dark"===e?(document.documentElement.setAttribute("data-theme","dark"),localStorage.setItem("theme","dark")):"light"===e&&(document.documentElement.setAttribute("data-theme","light"),localStorage.setItem("theme","light")),icon&&(icon.classList.toggle("fa-moon"),icon.classList.toggle("fa-sun"),icon.classList.toggle("mode-switch-transform"))}modeInit(),document.addEventListener("DOMContentLoaded",()=>{document.getElementById("mode-switch").addEventListener("click",()=>{modeSwitcher()})})</script><script defer src="https://cdn.jsdelivr.net/npm/jquery@3.7.0/dist/jquery.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"><link rel="stylesheet" href="/css/comments.css"><link rel="icon" href="/favicon.ico" type="image/x-icon"></head><body><header><nav class="navbar navbar-expand-md py-2"><div class="container-fluid justify-content-between align-items-center"><button aria-controls="navbar-container" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler shadow-none" data-bs-target="#navbar-container" data-bs-toggle="collapse" type="button"><span id="navbar-toggler-icon"><i class="fas fa-bars"></i></span></button> <a class="navbar-brand no-decoration" href="/">TrebledJ's Pages</a><div class="navbar-collapse collapse" id="navbar-container"><ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="/">Home</a></li><li class="nav-item"><a class="nav-link" href="/about">About</a></li><li class="nav-item"><a class="nav-link" href="/posts">Posts</a></li><li class="nav-item"><a class="nav-link" href="/vulnerability-research">CVEs</a></li><li class="nav-item"><a class="nav-link" href="/music">Music</a></li><li class="nav-item"><a class="nav-link" href="/webroll">Webroll</a></li></ul><ul class="navbar-nav"><li><a class="nav-link me-2" data-bs-toggle="modal" data-bs-target="#search-modal" aria-label="Search..." role="button"><i class="fas fa-search nav-icon"></i></a></li><li><a class="nav-link" id="mode-switch" aria-label="Theme Switch" role="button"><i id="mode-switch-icon" class="fas fa-moon nav-icon"></i></a><script>modeInitIcon()</script></li></ul></div></div></nav><div id="scroll-progress-bar"></div></header><div id="top-of-the-morning-to-you"></div><div id="search-modal" class="modal fade wide-modal" aria-hidden="true" aria-label="Search" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header pb-2 d-flex flex-row justify-content-between"><div class="container-fluid ps-0" id="search-box-container"><input type="text" autofocus class="container-fluid" id="search-box" placeholder="Search"> <i class="fas fa-search"></i></div><button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button></div><div class="modal-body" id="search-results-list"></div></div></div></div><button id="btn-back-to-top" class="btn btn-lg" type="button" aria-label="Back to Top"><i class="fas fa-arrow-up"></i></button><div id="btn-mobile-toc" class="dropup"><button type="button" class="btn btn-lg" data-bs-toggle="dropdown" aria-label="Content"><i class="fas fa-list-ul"></i></button><ul class="dropdown-menu toc-container"><li><nav class="toc"><ol><li><a href="#description">Description</a></li><li><a href="#writeup">Writeup</a><ol><li><a href="#running-the-server">Running the Server</a></li><li><a href="#identifying-interest-points">Identifying Interest Points</a></li><li><a href="#reversing-the-encryption">Reversing the Encryption</a></li><li><a href="#1-reversing-the-permutation">1. Reversing the Permutation</a></li><li><a href="#2-constructing-an-inverse-map">2. Constructing An Inverse Map</a></li><li><a href="#3-cracking-the-shellcode">3. Cracking the Shellcode</a></li><li><a href="#tying-it-all-together">Tying it All Together</a></li></ol></li><li><a href="#debugging-our-mess">Debugging Our Mess</a></li><li><a href="#final-remarks">Final Remarks</a></li><li><a href="#solve-script">Solve Script</a></li><li><a href="#flag">Flag</a></li></ol></nav></li></ul></div><div class="main-container"><div class="page-container col-lg-12"><div class="container-lg px-0"><article class="jw-100 post-article" itemscope itemtype="http://schema.org/BlogPosting"><div class="row flex-row-reverse gx-lg-5"><div class="col-lg-4 d-none d-lg-block"><div class="dim-deep"><div class="metadata-container d-flex"><div class="d-flex flex-row align-items-center"><span><i class="fas fa-calendar post-meta-icon me-1"></i> </span><span class="fs-7 post-posted-date">Posted on <span itemprop="datePublished" content="2023-09-20T08:00:00.000+08:00">2023‚Äë09‚Äë20</span></span></div><div class="d-flex flex-row align-items-center"><span class="post-updated-date-icon"><i class="fas fa-calendar post-meta-icon me-1"></i> </span><span class="fs-7 post-updated-date">Updated on <span itemprop="dateModified" content="2024-09-08T01:57:01.000+08:00">2024‚Äë09‚Äë07</span></span></div><div class="d-flex flex-row align-items-center"><span><i class="far fa-clock post-meta-icon me-1"></i> </span><span class="fs-7">6 minute read</span></div></div><div class="metadata-tag-container"><span><i class="fas fa-tag post-meta-icon me-1 mt-2"></i></span><div class="tag-list d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/reverse/" itemprop="keywords">reverse</a> </span><span><a class="jtag" href="/tags/rust/" itemprop="keywords">rust</a> </span><span><a class="jtag" href="/tags/python/" itemprop="keywords">python</a> </span><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a> </span><span><a class="jtag" href="/tags/writeup/" itemprop="keywords">writeup</a></span></div></div></div><br><div id="toc-sidebar" class="sticky-right dim-deep dim-if-dark"><div class="toc-container"><span><a id="toc-content" href="javascript:void(0);">Content</a></span><nav class="toc"><ol><li><a href="#description">Description</a></li><li><a href="#writeup">Writeup</a><ol><li><a href="#running-the-server">Running the Server</a></li><li><a href="#identifying-interest-points">Identifying Interest Points</a></li><li><a href="#reversing-the-encryption">Reversing the Encryption</a></li><li><a href="#1-reversing-the-permutation">1. Reversing the Permutation</a></li><li><a href="#2-constructing-an-inverse-map">2. Constructing An Inverse Map</a></li><li><a href="#3-cracking-the-shellcode">3. Cracking the Shellcode</a></li><li><a href="#tying-it-all-together">Tying it All Together</a></li></ol></li><li><a href="#debugging-our-mess">Debugging Our Mess</a></li><li><a href="#final-remarks">Final Remarks</a></li><li><a href="#solve-script">Solve Script</a></li><li><a href="#flag">Flag</a></li></ol></nav><hr></div><div class="toc-link-container"><span><a href="#related">Related Posts</a></span></div><div class="toc-link-container"><span><a href="#comments">Comments</a></span></div></div></div><div class="col-lg-8 post-body-container"><div class="article-header"><h1 class="post-title" itemprop="name headline">HITCON 2023 ‚Äì The Blade</h1><p class="post-desc" itemprop="alternativeHeadline">Beginner-friendly writeup for a nifty Rust reversing challenge.</p><div class="d-lg-none dim-deep"><div class="metadata-container d-flex"><div class="d-flex flex-row align-items-center"><span><i class="fas fa-calendar post-meta-icon me-1"></i> </span><span class="fs-7 post-posted-date">Posted on <span itemprop="datePublished" content="2023-09-20T08:00:00.000+08:00">2023‚Äë09‚Äë20</span></span></div><div class="d-flex flex-row align-items-center"><span class="post-updated-date-icon"><i class="fas fa-calendar post-meta-icon me-1"></i> </span><span class="fs-7 post-updated-date">Updated on <span itemprop="dateModified" content="2024-09-08T01:57:01.000+08:00">2024‚Äë09‚Äë07</span></span></div><div class="d-flex flex-row align-items-center"><span><i class="far fa-clock post-meta-icon me-1"></i> </span><span class="fs-7">6 minute read</span></div></div><div class="metadata-tag-container"><span><i class="fas fa-tag post-meta-icon me-1 mt-2"></i></span><div class="tag-list d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/reverse/" itemprop="keywords">reverse</a> </span><span><a class="jtag" href="/tags/rust/" itemprop="keywords">rust</a> </span><span><a class="jtag" href="/tags/python/" itemprop="keywords">python</a> </span><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a> </span><span><a class="jtag" href="/tags/writeup/" itemprop="keywords">writeup</a></span></div></div></div></div><hr><div class="post-body text-content" itemprop="articleBody text"><div class="post-preamble" data-nosnippet=""><p><em>This writeup is also intended for beginners. Anytime there's a set of questions, feel free to pause, challenge yourself, and think through them. :) If you want to follow along, you can grab the challenge binary <a href="https://github.com/TrebledJ/ctf-binaries/tree/c8e9259c8f7d9cee149d99269d9b691cf54e53b9/hitcon-2023/the-blade" rel="noreferrer" target="_blank">here</a>.</em></p><p><em>I'll be mainly using <a href="https://ghidra-sre.org/" rel="noreferrer" target="_blank">ghidra</a> as my decompiler, along with GDB + GEF. For those unfamiliar with GDB, you may find my <a href="/posts/gdb-cheatsheet">recently posted cheatsheet</a> helpful.</em></p><hr></div><p>My first Rust <a class="jtag" href="/tags/reverse/">rev</a> solve! Though in hindsight, not much Rust knowledge was needed.</p><h2 id="description" tabindex="-1"><a class="md-anchor" href="#description" aria-hidden="true"></a> Description</h2><blockquote><p><em>A Rust tool for executing shellcode in a seccomp environment. Your goal is to pass the hidden flag checker concealed in the binary.</em></p></blockquote><p>Author: <a href="https://github.com/wxrdnx" rel="noreferrer" target="_blank">wxrdnx</a><br>40/683 solves.</p><h2 id="writeup" tabindex="-1"><a class="md-anchor" href="#writeup" aria-hidden="true"></a> Writeup</h2><h3 id="running-the-server" tabindex="-1"><a class="md-anchor" href="#running-the-server" aria-hidden="true"></a> Running the Server</h3><p>Let‚Äôs start by running the binary. We can get a feel by navigating the program with <code>help</code> and other commands.</p><p>Turns out we‚Äôre given a C2 (Command and Control) interface which sends shellcode. Imagine we control a compromised machine. By running a malicious shellcode, we can trigger a reverse shell to our server, so that we can easily send more commands from the server.</p><p>Anyhow, we can start the server with:</p><div class="code-toolbar"><pre data-lang-off="" class="language-txt" tabindex="0"><code class="language-txt">server
run</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>We‚Äôre told to run some shellcode on the ‚Äúclient‚Äù. By default, this starts a connection to <code>localhost:4444</code>.</p><ul><li>A simple alternative is to run <code>nc localhost 4444</code> (on a separate shell). This will initiate a connection to the server, but it won‚Äôt have the same effect as the shellcode.</li><li>To run the shellcode, we can compile a simple C program containing the shellcode and execute it.</li></ul><div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> shellcode<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"\xeb\x10\x31\xc0\x53\x5f\x49\x8d\x77\x10\x48\x31\xd2\x80\xc2\xff\x0f\x05\x6a\x29\x58\x99\x6a\x02\x5f\x6a\x01\x5e\x0f\x05\x50\x5b\x48\x97\x68\x7f\x00\x00\x01\x66\x68\x11\x5c\x66\x6a\x02\x54\x5e\xb2\x10\xb0\x2a\x0f\x05\x4c\x8d\x3d\xc5\xff\xff\xff\x41\xff\xe7"</span><span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Compile with:</span>
<span class="token comment">// gcc main.c  -fno-stack-protector -z execstack &amp;&amp; gdb ./a.out</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>After running, then what? The commands don‚Äôt seem to reveal much, and at this point it‚Äôs a bit guessy. Time to turn to a decompiler.</p><h3 id="identifying-interest-points" tabindex="-1"><a class="md-anchor" href="#identifying-interest-points" aria-hidden="true"></a> Identifying Interest Points</h3><ul><li>What command triggers the flag checker?</li><li>Where is the flag processed?</li><li>How is the flag processed?</li></ul><p>According to the description, the program contains a flag checker. So presumably we pass the flag as input at some point. But <em>where</em> and <em>how</em>?</p><p>By running <code>strings</code>, we find an interesting set of strings: <span class="spoiler" tabindex="0"><code>?flag</code></span>, <code>?help</code>, <code>?exit</code>, <code>?quit</code>. This pattern can‚Äôt be a coincidence.</p><p>In your favourite decompiler, do a search for the bytes <span class="spoiler" tabindex="0"><code>?flag</code></span>. If you can‚Äôt find it, try playing with endian settings. This should lead you to <span class="spoiler" tabindex="0"><code>seccomp_shell::shell::prompt()</code></span>.</p><p>Under a condition checking for flag, we‚Äôre led to <span class="spoiler" tabindex="0"><code>seccomp_shell::shell::verify()</code></span>.</p><div class="alert alert-info d-flex align-items-start"><i class="fas fa-circle-info ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><p>Although strings shows <span class="spoiler" tabindex="0"><code>?flag</code></span> as the full string, the actual string is just <code>flag</code>. Questionable, no? This is because the byte before <code>flag</code> happens to be <code>\x22</code> (i.e. <code>?</code>). <code>strings</code> doesn‚Äôt know better, because it doesn‚Äôt actually disassemble the program.</p></div></div><p>So how is the flag actually processed? This requires a careful study of <span class="spoiler" tabindex="0"><code>verify()</code></span>, with a touch of dynamic analysis and experimentation.</p><p>Like most flag checkers, it turns out we just pass the flag as input (alongside the <code>flag</code> command).</p><div class="code-toolbar"><pre data-lang-off="" class="language-txt" tabindex="0"><code class="language-txt">flag hitcon{test_flag}</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>And like most flag checkers, we‚Äôre immediately hit with ‚Äú<em>Incorrect</em>‚Äù.</p><details><summary>We also get some hints about the flag's length...</summary><div class="details-content"><p>...by glancing at the start of <code>verify()</code>...</p><p>...<span class="spoiler" tabindex="0">64</span>.</p><div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span>param_3 <span class="token operator">!=</span> <span class="token number">0x40</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	auVar27 <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token operator">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"incorrect/"</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> auVar27<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>When we try sending a flag 64-bytes long, we get something on our other shell. We're not immediately hit with an "<em>Incorrect</em>".</p><div class="code-toolbar"><pre data-lang-off="" class="language-txt" tabindex="0"><code class="language-txt">flag hitcon{AAAABBBBCCCCDDDDEEEEFFFFGGGGHHHHIIIIJJJJKKKKLLLLMMMMNNNN}</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><div class="details-collapse-bottom"><sub><a class="details-collapse-button">(collapse)</a></sub></div></div></details><h3 id="reversing-the-encryption" tabindex="-1"><a class="md-anchor" href="#reversing-the-encryption" aria-hidden="true"></a> Reversing the Encryption</h3><p>Time to play the UNO reverse card on this binary!</p><ul><li>There are 3 parts to the encryption. What addresses do they begin and end?</li><li>What is each part doing?</li></ul><p>Let‚Äôs recognise some high level patterns.</p><p>It‚Äôs easy to be intimidated by the multitude of loops; but really, half the loops are the same, just wearing different clothes.</p><p>There are the 3 parts to the encryption:</p><ul><li>Part 1 <span class="spoiler" tabindex="0">(<code>112d10</code> ‚Äì <code>113017</code>)</span>.</li><li>Part 2 <span class="spoiler" tabindex="0">(<code>113020</code> ‚Äì <code>11309c</code>)</span>.</li><li>Part 3 <span class="spoiler" tabindex="0">(<code>11310e</code> ‚Äì <code>1133a5</code>)</span>.</li></ul><p>The procedure is roughly:</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	part1<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
	part2<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>

part3<span class="token punctuation">(</span>flag<span class="token punctuation">,</span> interesting_data_a7516852<span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><h3 id="1-reversing-the-permutation" tabindex="-1"><a class="md-anchor" href="#1-reversing-the-permutation" aria-hidden="true"></a> 1. Reversing the Permutation</h3><p><a class="lightbox-single" title="Even cats can catch sneaky permutations!" href="/img/giphy-500w.webp"><img class="mb-2 rw center jw-80" src="/img/giphy-500w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 500 / 281" alt="Even cats can catch sneaky permutations!" title="Even cats can catch sneaky permutations!" srcset="/img/giphy-256w.webp 256w, /img/giphy-500w.webp 500w" sizes="(max-width: 256px) 256px, 500px"></a></p><p>Address: <code>112d10</code> ‚Äì <code>113017</code>.</p><p>Eight loops, doing pretty much the same thing. Let‚Äôs focus on the first one.</p><div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token function">memcpy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>some_buffer<span class="token punctuation">,</span><span class="token operator">&amp;</span>SOME_ADDRESS<span class="token punctuation">,</span><span class="token number">0x200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
n <span class="token operator">=</span> <span class="token number">0x40</span><span class="token punctuation">;</span>
puVar21 <span class="token operator">=</span> <span class="token punctuation">(</span>ulong <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>some_buffer_offset_by_4<span class="token punctuation">;</span>
<span class="token keyword">do</span> <span class="token punctuation">{</span>
	uVar23 <span class="token operator">=</span> puVar21<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0x3f</span> <span class="token operator">&lt;</span> uVar23<span class="token punctuation">)</span>
		<span class="token keyword">goto</span> panic<span class="token punctuation">;</span>
	uVar1 <span class="token operator">=</span> __ptr<span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// __ptr :: char[]</span>
	__ptr<span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> __ptr<span class="token punctuation">[</span>uVar23<span class="token punctuation">]</span><span class="token punctuation">;</span>
	__ptr<span class="token punctuation">[</span>uVar23<span class="token punctuation">]</span> <span class="token operator">=</span> uVar1<span class="token punctuation">;</span>
	
	uVar23 <span class="token operator">=</span> puVar21<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0x3f</span> <span class="token operator">&lt;</span> uVar23<span class="token punctuation">)</span>
		<span class="token keyword">goto</span> panic<span class="token punctuation">;</span>
	uVar1 <span class="token operator">=</span> __ptr<span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	__ptr<span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> __ptr<span class="token punctuation">[</span>uVar23<span class="token punctuation">]</span><span class="token punctuation">;</span>
	__ptr<span class="token punctuation">[</span>uVar23<span class="token punctuation">]</span> <span class="token operator">=</span> uVar1<span class="token punctuation">;</span>
	
	puVar21 <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	n <span class="token operator">-=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>n <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p><sup>(Some variables are renamed for clarity.)</sup></p><p>Does this look familiar?</p><p>It‚Äôs good ol‚Äô swap! (Though slightly <a href="https://en.wikipedia.org/wiki/Loop_unrolling" rel="noreferrer" target="_blank"><em>unrolled</em></a>.) There are eight of these loops, the only difference being the <code>memcpy</code> source.</p><p>So how do we reverse this? Generally, there are two approaches to take:</p><ul><li>Static analysis. This means we reverse the binary by looking at the bytecode, assembly, decompiler, etc. We don't run or emulate anything.</li><li>Dynamic analysis. In this approach, we observe the program's behaviour by running it. Common tools are <code>gdb</code>, <code>strace</code>, and <code>ltrace</code>.</li></ul><p>Approaching this statically seems faster, but integer semantics may get lost in translation. Our conclusion may be unstable.</p><p>Thus, for fun (and practice), we'll go the dynamic route. Let's insert some breakpoints, input our flag of <span class="spoiler" tabindex="0">64 unique characters (e.g. Base64 alphabet)</span>, grab the permuted string, and construct a mapping.</p><p>In GDB:</p><div class="code-toolbar"><pre data-language="GDB" class="command-line language-sh" data-prompt="gdb>" data-continuation-prompt=">" data-continuation-str="  " data-filter-output="out>" tabindex="0"><code class="language-sh"><span class="command-line-prompt"><span data-prompt="gdb>"></span><span></span><span></span><span data-prompt="gdb>"></span><span></span><span data-prompt="gdb>"></span><span></span><span data-prompt="gdb>"></span><span data-continuation-prompt=">"></span><span data-continuation-prompt=">"></span><span data-continuation-prompt=">"></span><span></span><span></span><span></span><span data-prompt="gdb>"></span><span></span><span data-prompt="gdb>"></span><span></span><span></span><span></span><span data-prompt="gdb>"></span><span></span></span><span class="token command">start</span>
<span class="token output"></span>
<span class="token output">Break to determine __ptr location.</span>
<span class="token command"><span class="token builtin class-name">break</span> *_ZN13seccomp_shell5shell6verify17h898bf5fa26dafbabE + <span class="token number">61</span></span>
<span class="token output">Break to grab permuted string.</span>
<span class="token command"><span class="token builtin class-name">break</span> *_ZN13seccomp_shell5shell6verify17h898bf5fa26dafbabE + <span class="token number">935</span></span>
<span class="token output"></span>
<span class="token command"><span class="token builtin class-name">continue</span>  </span>
<span class="token command">server  </span>
<span class="token command">run  </span>
<span class="token command">flag abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/</span>
<span class="token output">(breakpoint triggered)</span>
<span class="token output"></span>
<span class="token output">Get location of __ptr.</span>
<span class="token command">p <span class="token variable">$rax</span></span>
<span class="token output">$1 = 0x5555555d63e0</span>
<span class="token command"><span class="token builtin class-name">continue</span></span>
<span class="token output">(breakpoint triggered)</span>
<span class="token output"></span>
<span class="token output">Get permuted string.</span>
<span class="token command">x/s 0x5555555d63e0</span>
<span class="token output">Rp5v+AZmM8XWy1sgNhTB/oCzYVdPrGn6KD3Q9lke4qtFxHb0uUOcS2jIEJfL7aiw</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">GDB</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>All that's left is to match the characters.</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> string

p <span class="token operator">=</span> string<span class="token punctuation">.</span>ascii_letters <span class="token operator">+</span> string<span class="token punctuation">.</span>digits <span class="token operator">+</span> <span class="token string">'+/'</span>
<span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">64</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>

<span class="token comment"># Permuted string obtained from GDB.</span>
permuted <span class="token operator">=</span> <span class="token string">'Rp5v+AZmM8XWy1sgNhTB/oCzYVdPrGn6KD3Q9lke4qtFxHb0uUOcS2jIEJfL7aiw'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">64</span><span class="token punctuation">]</span>

perm <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">64</span>  <span class="token comment"># Permutation </span>
rperm <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">64</span> <span class="token comment"># Reverse permutation</span>

<span class="token keyword">for</span> i<span class="token punctuation">,</span> c <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">:</span>
	j <span class="token operator">=</span> permuted<span class="token punctuation">.</span>index<span class="token punctuation">(</span>c<span class="token punctuation">)</span>
	perm<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> j
	rperm<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> i</code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>First part done!</p><h3 id="2-constructing-an-inverse-map" tabindex="-1"><a class="md-anchor" href="#2-constructing-an-inverse-map" aria-hidden="true"></a> 2. Constructing An Inverse Map</h3><p>Address: <code>113020</code> ‚Äì <code>11309c</code>.</p><details open><summary>Part 2 Decompile</summary><div class="details-content"><p>Looks like a bunch of arithmetic.</p><div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token keyword">do</span> <span class="token punctuation">{</span>
    uVar23 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    uVar18 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    uVar3 <span class="token operator">=</span> __ptr<span class="token punctuation">[</span>lVar20<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    uVar19 <span class="token operator">=</span> <span class="token number">0x101</span><span class="token punctuation">;</span>
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
        uVar25 <span class="token operator">=</span> uVar3<span class="token punctuation">;</span>
        uVar27 <span class="token operator">=</span> uVar18<span class="token punctuation">;</span>
        uVar3 <span class="token operator">=</span> uVar19 <span class="token operator">%</span> uVar25<span class="token punctuation">;</span>
        iVar24 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>uVar27<span class="token punctuation">;</span>
        iVar26 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>uVar23<span class="token punctuation">;</span>
        uVar23 <span class="token operator">=</span> uVar27<span class="token punctuation">;</span>
        uVar18 <span class="token operator">=</span> <span class="token punctuation">(</span>ulong<span class="token punctuation">)</span><span class="token punctuation">(</span>iVar26 <span class="token operator">-</span> <span class="token punctuation">(</span>uVar19 <span class="token operator">/</span> uVar25<span class="token punctuation">)</span> <span class="token operator">*</span> iVar24<span class="token punctuation">)</span><span class="token punctuation">;</span>
        uVar19 <span class="token operator">=</span> uVar25<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span>uVar3 <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    __ptr<span class="token punctuation">[</span>lVar20<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>uVar27 <span class="token operator">&amp;</span> <span class="token number">0xffff</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">0xf</span><span class="token punctuation">)</span> <span class="token operator">+</span> uVar27 <span class="token operator">+</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>uVar27 <span class="token operator">&gt;&gt;</span> <span class="token number">0xf</span><span class="token punctuation">)</span> <span class="token operator">-</span> iVar24<span class="token punctuation">)</span> <span class="token operator">+</span> iVar26 <span class="token operator">&amp;</span> <span class="token number">0xffffU</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">0x101</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0x71U</span> <span class="token operator">^</span> <span class="token number">0x89</span><span class="token punctuation">;</span>
    lVar20 <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>lVar20 <span class="token operator">!=</span> <span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p><sup>Some type-casts were removed to simplify the code.</sup></p><div class="details-collapse-bottom"><sub><a class="details-collapse-button">(collapse)</a></sub></div></div></details><p>If we reverse this statically, it <em>seems</em> like we get a one-to-one mapping of sorts... almost a bijection... but perhaps our implementation is wrong? Better check it with dynamic analysis. ü´†</p><p>By "<em>mapping</em>", I mean values are <em>transformed</em> and mapped from one value to another. For example, <code>a</code> (0x61) is mapped to <code>u</code> (0x75), while <code>b</code> (0x62) is mapped to <code>q</code> (0x71).</p><p>Like before, we <em>could</em> reverse this part statically... but overflow and types are tricky to get right. So we'll go dynamic again!</p><p>Let's start with some basic GDB analysis:</p><ul><li>What breakpoints should we add to check the result of one map iteration?</li><li>What memory location should we examine?</li><li>(And after all that, can you derive the mapping function?)</li></ul><details><summary>Oh where to go?</summary><div class="details-content"><p>We'll break after <span class="spoiler" tabindex="0">the loop, at <code>11309e</code></span>.</p><div class="code-toolbar"><pre data-language="GDB" class="command-line language-sh" data-prompt="gdb>" data-filter-output="out>" tabindex="0"><code class="language-sh"><span class="command-line-prompt"><span data-prompt="gdb>"></span></span><span class="token command"><span class="token builtin class-name">break</span> *_ZN13seccomp_shell5shell6verify17h898bf5fa26dafbabE + <span class="token number">1070</span></span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">GDB</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>As for memory location, the code still modifies <code>__ptr</code>, so we'll read from the same location.</p><div class="code-toolbar"><pre data-language="GDB" class="command-line language-sh" data-prompt="gdb>" data-filter-output="out>" tabindex="0"><code class="language-sh"><span class="command-line-prompt"><span data-prompt="gdb>"></span></span><span class="token command">x/16wx 0x5555555d63e0</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">GDB</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><div class="details-collapse-bottom"><sub><a class="details-collapse-button">(collapse)</a></sub></div></div></details><p>Two things I'd like to point out:</p><ol><li><p>Previously, we used <code>x/s</code> to print a string from memory. This time, I used <code>x/16wx</code> to print bytes, since some mapped bytes aren't printable.<sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup></p></li><li><p>There's another problem... previously, we input the bytes through <code>flag &lt;bytes&gt;</code>, and this is great if we're using printable chars. But what about <em>non-printable</em> chars? There are different solutions around this:</p><ul><li>Employ <a href="/posts/gdb-cheatsheet/#input-non-printable-characters">GDB input tricks</a>.</li><li>Track cycles of characters.</li><li>Break before mapping, and hard-code <code>__ptr</code> by <a href="/posts/gdb-cheatsheet/#modify-memory">modifying its memory</a>. Since the goal is to discover the remaining mappings, we'll hard-code <code>__ptr</code> with the rest of the bytes outside our Base64 alphabet.</li></ul><p>Y'know what? Let's go with the last option!</p></li></ol><div class="code-toolbar"><pre data-language="GDB" class="command-line language-sh" data-prompt="gdb>" data-filter-output="out>" tabindex="0"><code class="language-sh"><span class="command-line-prompt"><span data-prompt="gdb>"></span><span></span><span></span><span data-prompt="gdb>"></span><span></span><span data-prompt="gdb>"></span><span></span><span data-prompt="gdb>"></span><span></span><span></span><span></span><span data-prompt="gdb>"></span><span data-prompt="gdb>"></span><span></span><span data-prompt="gdb>"></span><span data-prompt="gdb>"></span><span></span><span data-prompt="gdb>"></span><span></span><span></span><span></span><span data-prompt="gdb>"></span><span></span><span></span></span><span class="token command">start</span>
<span class="token output"></span>
<span class="token output">Break before the loop.</span>
<span class="token command"><span class="token builtin class-name">break</span> *_ZN13seccomp_shell5shell6verify17h898bf5fa26dafbabE + <span class="token number">937</span></span>
<span class="token output">Break after the loop.</span>
<span class="token command"><span class="token builtin class-name">break</span> *_ZN13seccomp_shell5shell6verify17h898bf5fa26dafbabE + <span class="token number">1070</span></span>
<span class="token output"></span>
<span class="token command"><span class="token builtin class-name">continue</span></span>
<span class="token output">(breakpoint-before-loop triggered)</span>
<span class="token output"></span>
<span class="token output">Set 8x8 = 64 bytes. (I used a Python script to generate these `set` cmds from the missing input bytes.)</span>
<span class="token command"><span class="token builtin class-name">set</span> *<span class="token punctuation">(</span>0x5555555d63e0 as *mut u64<span class="token punctuation">)</span> <span class="token operator">=</span> 0x0001020304050607</span>
<span class="token command"><span class="token builtin class-name">set</span> *<span class="token punctuation">(</span>0x5555555d63e8 as *mut u64<span class="token punctuation">)</span> <span class="token operator">=</span> 0x08090a0b0c0d0e0f</span>
<span class="token output">and so on...</span>
<span class="token command"><span class="token builtin class-name">set</span> *<span class="token punctuation">(</span>0x5555555d6410 as *mut u64<span class="token punctuation">)</span> <span class="token operator">=</span> 0x3c3d3e3f405b5c5d</span>
<span class="token command"><span class="token builtin class-name">set</span> *<span class="token punctuation">(</span>0x5555555d6418 as *mut u64<span class="token punctuation">)</span> <span class="token operator">=</span> 0x5e5f607b7c7d7e7f</span>
<span class="token output"></span>
<span class="token command"><span class="token builtin class-name">continue</span></span>
<span class="token output">(breakpoint-after-loop triggered)</span>
<span class="token output"></span>
<span class="token output">Get mapped bytes.</span>
<span class="token command">x/16wx 0x5555555d63e0</span>
<span class="token output">...</span>
<span class="token output">Repeat until all mappings are deduced...</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">GDB</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>Finished gathering data? Let's analyse it!</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Values obtained with `x/16wx 0x5555555d63e0`.</span>

<span class="token comment"># Values before mapping.</span>
dst <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
0x5555555d63e0: 0x76357052      0x6d5a412b      0x5758384d      0x67733179
0x5555555d63f0: 0x4254684e      0x7a436f2f      0x50645659      0x366e4772
0x5555555d6400: 0x5133444b      0x656b6c39      0x46747134      0x30624878
0x5555555d6410: 0x634f5575      0x496a3253      0x4c664a45      0x77696137

0x5555555d63e0: 0x04050607      0x00010203      0x0c0d0e0f      0x08090a0b
0x5555555d63f0: 0x14151617      0x10111213      0x1c1d1e1f      0x18191a1b
0x5555555d6400: 0x24252627      0x20212223      0x2d2e3a3b      0x28292a2c
0x5555555d6410: 0x405b5c5d      0x3c3d3e3f      0x7c7d7e7f      0x5e5f607b

-- snip -- to save space --
"""</span>

<span class="token comment"># Values after mapping.</span>
mpd <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
0x5555555d63e0: 0x2e616c58      0xe2cb3269      0xa002e0b3      0xc16b1c86
0x5555555d63f0: 0xd2799cec      0x74d9c29e      0x9f043b0c      0xed14031e
0x5555555d6400: 0xca978fa2      0x39a4d8da      0xaf7e645b      0x0f71930b
0x5555555d6410: 0x0a81fd99      0x3aef66b7      0xe1ff00ee      0x09ab75ad

0x5555555d63e0: 0x51158ddb      0xfb7b4ebb      0xaab260eb      0xb0aca58e
0x5555555d63f0: 0x2bc6a635      0x635cde42      0xbd24b1e3      0x3043d65f
0x5555555d6400: 0x7c6d8b17      0x8ca7d52a      0x59a92706      0x9d83fe10
0x5555555d6410: 0x41a880c0      0x25dc5ee7      0xc42d4ff9      0x164d2f6a

-- snip --
"""</span>

<span class="token keyword">def</span> <span class="token function">mkbytes</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>bs<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token operator">*</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">for</span> l <span class="token keyword">in</span> s<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span> <span class="token keyword">if</span> l<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> bs <span class="token keyword">in</span> l<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">': '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

dbytes <span class="token operator">=</span> mkbytes<span class="token punctuation">(</span>dst<span class="token punctuation">)</span>
mbytes <span class="token operator">=</span> mkbytes<span class="token punctuation">(</span>mpd<span class="token punctuation">)</span>

mp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">256</span>  <span class="token comment"># Value map.</span>
rmp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">256</span> <span class="token comment"># Reverse value map.</span>
<span class="token keyword">for</span> a<span class="token punctuation">,</span> b <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>dbytes<span class="token punctuation">,</span> mbytes<span class="token punctuation">)</span><span class="token punctuation">:</span>
    mp<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> b
    rmp<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> a

<span class="token comment"># Assert bijection.</span>
<span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">len</span><span class="token punctuation">(</span>rmp<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">256</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>And just like that, we obtained a reverse mapping, thanks to it being a bijection!</p><div class="alert alert-success d-flex align-items-start"><i class="fas fa-lightbulb ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><p><strong>What is a bijection?</strong></p><p>A <strong>bijection</strong> is a function where...</p><ul><li>each input maps to a <em>unique</em> output. (injective)</li><li>each possible output is mapped from a corresponding input. Specifically, every value in the function's range has a mapping. (surjective)</li></ul><p>This characteristic is crucial as it <em>guarantees</em> an <strong>invertible operation</strong>.</p><p><a class="lightbox-single" title="Bijection example." href="/img/bijective-function-1629606712-625w.webp"><img class="mb-2 rw center jw-60 alpha-img" src="/img/bijective-function-1629606712-625w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 625 / 514" alt="Mathematical mapping explanation of bijection." title="Bijection example." srcset="/img/bijective-function-1629606712-256w.webp 256w, /img/bijective-function-1629606712-512w.webp 512w, /img/bijective-function-1629606712-625w.webp 625w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 625px"></a></p><p class="caption"><sup>(<a href="https://www.cuemath.com/algebra/bijective-function/" rel="noreferrer" target="_blank">Image Source</a>)</sup></p></div></div><h3 id="3-cracking-the-shellcode" tabindex="-1"><a class="md-anchor" href="#3-cracking-the-shellcode" aria-hidden="true"></a> 3. Cracking the Shellcode</h3><p>Address: <code>11310e</code> ‚Äì <code>1133a5</code>.</p><p>The final part. Subtle, but delectable.</p><ul><li><p>What are the 255 bytes copied into the Rust <code>vec</code>?</p><div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c">local_278 <span class="token operator">=</span> alloc<span class="token operator">::</span>raw_vec<span class="token operator">::</span>RawVec<span class="token operator">&lt;</span>T<span class="token punctuation">,</span>A<span class="token operator">&gt;</span><span class="token operator">::</span><span class="token function">allocate_in</span><span class="token punctuation">(</span><span class="token number">0xff</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">memcpy</span><span class="token punctuation">(</span>local_278<span class="token punctuation">.</span>_0_8_<span class="token punctuation">,</span><span class="token operator">&amp;</span>DAT_00162b2b<span class="token punctuation">,</span><span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div></li><li><p>What is the purpose of the data loaded at <code>11310e</code>?</p><div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c">local_238 <span class="token operator">=</span> <span class="token number">0x526851a7</span><span class="token punctuation">;</span>
local_234 <span class="token operator">=</span> <span class="token number">0x31ff2785</span><span class="token punctuation">;</span>
local_230 <span class="token operator">=</span> <span class="token number">0xc7d28788</span><span class="token punctuation">;</span>
local_22c <span class="token operator">=</span> <span class="token number">0x523f23d3</span><span class="token punctuation">;</span>
local_228 <span class="token operator">=</span> <span class="token number">0xaf1f1055</span><span class="token punctuation">;</span>
local_224 <span class="token operator">=</span> <span class="token number">0x5c94f027</span><span class="token punctuation">;</span>
<span class="token comment">// -- snip --</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div></li></ul><p>The 255 bytes loaded into a <code>vec</code>? Guess what? That also happens to be a <span class="spoiler" tabindex="0">shellcode</span>!</p><ul><li>Follow-up question: if this is <span class="spoiler" tabindex="0">shellcode</span>, what does it do? how is it run?</li></ul><p>We can disassemble it with <code>pwntools.disasm</code> to get the following ASM.</p><div class="alert alert-warning d-flex align-items-start"><i class="fas fa-triangle-exclamation ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><p>Small caveat: you'll want to set <code>context.arch = 'amd64'</code> for <code>disasm</code> to interpret the shellcode correctly. In the disassembly, we see our two points of insertion (<code>0xdeadbeef</code>) treated as values, so <code>amd64</code> is probably the right choice.</p></div></div><div class="code-toolbar"><pre class="language-asm" tabindex="0"><code class="language-asm"><span class="token operator">-</span><span class="token operator">-</span> snip <span class="token operator">-</span><span class="token operator">-</span>
  b2:   0f <span class="token number">05</span>                   syscall             <span class="token comment">; read from /dev/zero</span>
  b4:   <span class="token number">58</span>                      pop    rax          <span class="token comment">; rax = 0</span>
  b5:   <span class="token number">48</span> f7 d0                not    rax          <span class="token comment">; exercise for the reader</span>
  b8:   <span class="token number">48</span> c1 e8 1d             shr    rax<span class="token punctuation">,</span> <span class="token number">0x1d</span>    <span class="token comment">;</span>
  bc:   <span class="token number">48</span> <span class="token number">99</span>                   cqo                 <span class="token comment">;</span>
  be:   6a <span class="token number">29</span>                   push   <span class="token number">0x29</span>         <span class="token comment">;</span>
  c0:   <span class="token number">59</span>                      pop    rcx          <span class="token comment">;</span>
  c1:   <span class="token number">48</span> f7 f1                div    rcx          <span class="token comment">;</span>
  c4:   <span class="token number">49</span> <span class="token number">96</span>                   xchg   r14<span class="token punctuation">,</span> rax     <span class="token comment">; swap r14 and rax</span>
  c6:   6a <span class="token number">03</span>                   push   <span class="token number">0x3</span>
  c8:   <span class="token number">58</span>                      pop    rax          <span class="token comment">; rax = 3</span>
  c9:   0f <span class="token number">05</span>                   syscall             <span class="token comment">; close()</span>
  cb:   b8 ef be ad de          mov    eax<span class="token punctuation">,</span> <span class="token number">0xdeadbeef</span>  <span class="token comment">; flag input</span>
  d0:   <span class="token number">44</span> <span class="token number">01</span> e0                add    eax<span class="token punctuation">,</span> r12d
  d3:   <span class="token number">44</span> <span class="token number">31</span> e8                xor    eax<span class="token punctuation">,</span> r13d
  d6:   c1 c8 0b                ror    eax<span class="token punctuation">,</span> <span class="token number">0xb</span>
  d9:   f7 d0                   not    eax
  db:   <span class="token number">44</span> <span class="token number">31</span> f0                xor    eax<span class="token punctuation">,</span> r14d        <span class="token comment">; eax = ~(ror(0xb, (0xDEADBEEF + r12) ^ r13)) ^ r14</span>
  de:   3d ef be ad de          cmp    eax<span class="token punctuation">,</span> <span class="token number">0xdeadbeef</span>  <span class="token comment">; static values (expected output)</span>
  e3:   <span class="token number">75</span> <span class="token number">05</span>                   jne    <span class="token number">0xea</span>
  e5:   6a <span class="token number">01</span>                   push   <span class="token number">0x1</span>
  e7:   <span class="token number">58</span>                      pop    rax  <span class="token comment">; rax = 1</span>
  e8:   eb <span class="token number">03</span>                   jmp    <span class="token number">0xed</span>
  ea:   <span class="token number">48</span> <span class="token number">31</span> c0                xor    rax<span class="token punctuation">,</span> rax <span class="token comment">; rax = 0</span>

<span class="token operator">-</span><span class="token operator">-</span> snip <span class="token operator">-</span><span class="token operator">-</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Assembly</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>I've included the juiciest part above (with some annotations). Essentially, we perform several reversible operations (add, xor, ror, not) on 4 bytes of input; and the result is checked against 4 bytes of static data. Finally, it sets <code>rax = 1</code> if correct, and <code>rax = 0</code> if false.</p><p>But are we <em>actually</em> comparing <code>0xdeadbeef</code>. Nope‚Äîwe're comparing something else instead.</p><ul><li>What are the two <code>0xdeadbeef</code> being replaced with?</li></ul><details><summary>The Guts: What does the shellcode load?</summary><div class="details-content"><p>Here is some (simplified) code which overwrites <code>0xdeadbeef</code> values at instruction <code>113168</code>. Remember, <code>vec</code> is the shellcode and <code>__ptr</code> is our permuted + mapped input.</p><div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c">vec<span class="token punctuation">[</span><span class="token number">0xcc</span><span class="token punctuation">]</span> <span class="token operator">=</span> __ptr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
vec<span class="token punctuation">[</span><span class="token number">0xdf</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0xA7</span><span class="token punctuation">;</span>
vec<span class="token punctuation">[</span><span class="token number">0xcd</span><span class="token punctuation">]</span> <span class="token operator">=</span> __ptr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
vec<span class="token punctuation">[</span><span class="token number">0xe0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x51</span><span class="token punctuation">;</span>
vec<span class="token punctuation">[</span><span class="token number">0xce</span><span class="token punctuation">]</span> <span class="token operator">=</span> __ptr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
vec<span class="token punctuation">[</span><span class="token number">0xe1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x68</span><span class="token punctuation">;</span>
vec<span class="token punctuation">[</span><span class="token number">0xcf</span><span class="token punctuation">]</span> <span class="token operator">=</span> __ptr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
vec<span class="token punctuation">[</span><span class="token number">0xe2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x52</span><span class="token punctuation">;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>Does <code>0xA7</code>, <code>0x51</code>, <code>0x68</code>, and <code>0x52</code> look familiar? üôÉ Check the wall of bytes in <code>11310e</code>.</p><p>Effectively, the Rust performs a little surgery on shellcode before using it.</p><p>But how is it used? Leafing around the decompiled code, you may notice Rust IO write and read functions... those seem sus...</p><div class="details-collapse-bottom"><sub><a class="details-collapse-button">(collapse)</a></sub></div></div></details><p>By now, you probably know what the shellcode does: <span class="spoiler" tabindex="0">flag-checking</span>. But there are a few more things we need to reverse...</p><p>In the calculations, three mystery values (<code>r12</code>, <code>r13</code>, <code>r14</code>) are used. These were computed in the preceding shellcode. To efficiently obtain our flag input from the expected output, we need to find out what these mystery values are.</p><p>In case you'd like to have a stab at dissecting the assembly, the full (unblemished) shellcode is in the box below. Try to figure out what <code>r12</code>, <code>r13</code>, and <code>r14</code> are!</p><div class="alert alert-info d-flex align-items-start"><i class="fas fa-bolt ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><ul><li>If you're stuck, try using GDB on our shellcode program (main.c from <a href="#running-the-server">Running the Server</a>) with <a href="/posts/gdb-cheatsheet/#watchpoints">watchpoints</a>.<ul><li><strong>Important</strong>: the shellcode we saw when <a href="#running-the-server">starting the server</a> is different from the shellcode we're reversing here! The former acts as a client, receiving commands and executing them. The latter is a flag-checker payload that is sent to the client over the network.</li></ul></li><li>Here's a useful list of Linux x86-64 syscalls: <a href="https://filippo.io/linux-syscall-table/" rel="noreferrer" target="_blank">filippo.io: Linux Syscall Table</a>.</li></ul></div></div><details><summary>Full Shellcode</summary><div class="details-content"><p>Have fun! :)</p><div class="code-toolbar"><pre class="language-asm" tabindex="0"><code class="language-asm">   <span class="token number">0</span>:   <span class="token number">54</span>                      push   rsp
   <span class="token number">1</span>:   5d                      pop    rbp
   <span class="token number">2</span>:   <span class="token number">31</span> f6                   xor    esi<span class="token punctuation">,</span> esi
   <span class="token number">4</span>:   <span class="token number">48</span> b9 a1 <span class="token number">57</span> <span class="token number">06</span> b8 <span class="token number">62</span> 3a 9f <span class="token number">37</span>   movabs rcx<span class="token punctuation">,</span> <span class="token number">0x379f3a62b80657a1</span>
   e:   <span class="token number">48</span> ba 8e <span class="token number">35</span> 6f d6 4d <span class="token number">49</span> f7 <span class="token number">37</span>   movabs rdx<span class="token punctuation">,</span> <span class="token number">0x37f7494dd66f358e</span>
  <span class="token number">18</span>:   <span class="token number">48</span> <span class="token number">31</span> d1                xor    rcx<span class="token punctuation">,</span> rdx
  1b:   <span class="token number">51</span>                      push   rcx
  1c:   <span class="token number">54</span>                      push   rsp
  1d:   5f                      pop    rdi
  1e:   6a <span class="token number">02</span>                   push   <span class="token number">0x2</span>
  <span class="token number">20</span>:   <span class="token number">58</span>                      pop    rax
  <span class="token number">21</span>:   <span class="token number">99</span>                      cdq
  <span class="token number">22</span>:   0f <span class="token number">05</span>                   syscall
  <span class="token number">24</span>:   <span class="token number">48</span> <span class="token number">97</span>                   xchg   rdi<span class="token punctuation">,</span> rax
  <span class="token number">26</span>:   <span class="token number">31</span> c0                   xor    eax<span class="token punctuation">,</span> eax
  <span class="token number">28</span>:   <span class="token number">50</span>                      push   rax
  <span class="token number">29</span>:   <span class="token number">54</span>                      push   rsp
  2a:   5e                      pop    rsi
  2b:   6a <span class="token number">04</span>                   push   <span class="token number">0x4</span>
  2d:   5a                      pop    rdx
  2e:   0f <span class="token number">05</span>                   syscall
  <span class="token number">30</span>:   <span class="token number">41</span> 5c                   pop    r12
  <span class="token number">32</span>:   6a <span class="token number">03</span>                   push   <span class="token number">0x3</span>
  <span class="token number">34</span>:   <span class="token number">58</span>                      pop    rax
  <span class="token number">35</span>:   0f <span class="token number">05</span>                   syscall
  <span class="token number">37</span>:   <span class="token number">31</span> f6                   xor    esi<span class="token punctuation">,</span> esi
  <span class="token number">39</span>:   <span class="token number">48</span> b9 3b 3b 6f c3 <span class="token number">63</span> <span class="token number">64</span> c0 aa   movabs rcx<span class="token punctuation">,</span> <span class="token number">0xaac06463c36f3b3b</span>
  <span class="token number">43</span>:   <span class="token number">48</span> ba <span class="token number">48</span> 4c 0b c3 <span class="token number">63</span> <span class="token number">64</span> c0 aa   movabs rdx<span class="token punctuation">,</span> <span class="token number">0xaac06463c30b4c48</span>
  4d:   <span class="token number">48</span> <span class="token number">31</span> d1                xor    rcx<span class="token punctuation">,</span> rdx
  <span class="token number">50</span>:   <span class="token number">51</span>                      push   rcx
  <span class="token number">51</span>:   <span class="token number">48</span> b9 8c <span class="token number">57</span> <span class="token number">82</span> <span class="token number">75</span> d6 f8 a9 7d   movabs rcx<span class="token punctuation">,</span> <span class="token number">0x7da9f8d67582578c</span>
  5b:   <span class="token number">48</span> ba a3 <span class="token number">32</span> f6 <span class="token number">16</span> f9 <span class="token number">88</span> c8 0e   movabs rdx<span class="token punctuation">,</span> <span class="token number">0xec888f916f632a3</span>
  <span class="token number">65</span>:   <span class="token number">48</span> <span class="token number">31</span> d1                xor    rcx<span class="token punctuation">,</span> rdx
  <span class="token number">68</span>:   <span class="token number">51</span>                      push   rcx
  <span class="token number">69</span>:   <span class="token number">54</span>                      push   rsp
  6a:   5f                      pop    rdi
  6b:   6a <span class="token number">02</span>                   push   <span class="token number">0x2</span>      
  6d:   <span class="token number">58</span>                      pop    rax
  6e:   <span class="token number">99</span>                      cdq
  6f:   0f <span class="token number">05</span>                   syscall
  <span class="token number">71</span>:   <span class="token number">48</span> <span class="token number">97</span>                   xchg   rdi<span class="token punctuation">,</span> rax
  <span class="token number">73</span>:   <span class="token number">31</span> c0                   xor    eax<span class="token punctuation">,</span> eax
  <span class="token number">75</span>:   <span class="token number">50</span>                      push   rax
  <span class="token number">76</span>:   <span class="token number">54</span>                      push   rsp      
  <span class="token number">77</span>:   5e                      pop    rsi
  <span class="token number">78</span>:   6a <span class="token number">04</span>                   push   <span class="token number">0x4</span> 
  7a:   5a                      pop    rdx
  7b:   0f <span class="token number">05</span>                   syscall
  7d:   <span class="token number">41</span> 5d                   pop    r13
  7f:   6a <span class="token number">03</span>                   push   <span class="token number">0x3</span>      
  <span class="token number">81</span>:   <span class="token number">58</span>                      pop    rax
  <span class="token number">82</span>:   0f <span class="token number">05</span>                   syscall
  <span class="token number">84</span>:   <span class="token number">31</span> f6                   xor    esi<span class="token punctuation">,</span> esi
  <span class="token number">86</span>:   6a 6f                   push   <span class="token number">0x6f</span>
  <span class="token number">88</span>:   <span class="token number">48</span> b9 <span class="token number">59</span> e5 <span class="token number">06</span> 0c 2d f6 d9 <span class="token number">77</span>   movabs rcx<span class="token punctuation">,</span> <span class="token number">0x77d9f62d0c06e559</span>
  <span class="token number">92</span>:   <span class="token number">48</span> ba <span class="token number">76</span> <span class="token number">81</span> <span class="token number">63</span> 7a <span class="token number">02</span> 8c bc <span class="token number">05</span>   movabs rdx<span class="token punctuation">,</span> <span class="token number">0x5bc8c027a638176</span>
  9c:   <span class="token number">48</span> <span class="token number">31</span> d1                xor    rcx<span class="token punctuation">,</span> rdx
  9f:   <span class="token number">51</span>                      push   rcx
  a0:   <span class="token number">54</span>                      push   rsp
  a1:   5f                      pop    rdi
  a2:   6a <span class="token number">02</span>                   push   <span class="token number">0x2</span>  
  a4:   <span class="token number">58</span>                      pop    rax
  a5:   <span class="token number">99</span>                      cdq
  a6:   0f <span class="token number">05</span>                   syscall
  a8:   <span class="token number">48</span> <span class="token number">97</span>                   xchg   rdi<span class="token punctuation">,</span> rax
  aa:   <span class="token number">31</span> c0                   xor    eax<span class="token punctuation">,</span> eax
  ac:   <span class="token number">50</span>                      push   rax
  ad:   <span class="token number">54</span>                      push   rsp
  ae:   5e                      pop    rsi
  af:   6a <span class="token number">04</span>                   push   <span class="token number">0x4</span>
  b1:   5a                      pop    rdx
  b2:   0f <span class="token number">05</span>                   syscall
  b4:   <span class="token number">58</span>                      pop    rax
  b5:   <span class="token number">48</span> f7 d0                not    rax
  b8:   <span class="token number">48</span> c1 e8 1d             shr    rax<span class="token punctuation">,</span> <span class="token number">0x1d</span>
  bc:   <span class="token number">48</span> <span class="token number">99</span>                   cqo
  be:   6a <span class="token number">29</span>                   push   <span class="token number">0x29</span>
  c0:   <span class="token number">59</span>                      pop    rcx
  c1:   <span class="token number">48</span> f7 f1                div    rcx
  c4:   <span class="token number">49</span> <span class="token number">96</span>                   xchg   r14<span class="token punctuation">,</span> rax
  c6:   6a <span class="token number">03</span>                   push   <span class="token number">0x3</span>
  c8:   <span class="token number">58</span>                      pop    rax
  c9:   0f <span class="token number">05</span>                   syscall
  cb:   b8 ef be ad de          mov    eax<span class="token punctuation">,</span> <span class="token number">0xdeadbeef</span>
  d0:   <span class="token number">44</span> <span class="token number">01</span> e0                add    eax<span class="token punctuation">,</span> r12d
  d3:   <span class="token number">44</span> <span class="token number">31</span> e8                xor    eax<span class="token punctuation">,</span> r13d
  d6:   c1 c8 0b                ror    eax<span class="token punctuation">,</span> <span class="token number">0xb</span>
  d9:   f7 d0                   not    eax
  db:   <span class="token number">44</span> <span class="token number">31</span> f0                xor    eax<span class="token punctuation">,</span> r14d
  de:   3d ef be ad de          cmp    eax<span class="token punctuation">,</span> <span class="token number">0xdeadbeef</span>
  e3:   <span class="token number">75</span> <span class="token number">05</span>                   jne    <span class="token number">0xea</span>
  e5:   6a <span class="token number">01</span>                   push   <span class="token number">0x1</span>
  e7:   <span class="token number">58</span>                      pop    rax
  e8:   eb <span class="token number">03</span>                   jmp    <span class="token number">0xed</span>
  ea:   <span class="token number">48</span> <span class="token number">31</span> c0                xor    rax<span class="token punctuation">,</span> rax
  ed:   <span class="token number">50</span>                      push   rax
  ee:   <span class="token number">53</span>                      push   rbx
  ef:   5f                      pop    rdi
  f0:   <span class="token number">54</span>                      push   rsp
  f1:   5e                      pop    rsi
  f2:   6a <span class="token number">08</span>                   push   <span class="token number">0x8</span>
  f4:   5a                      pop    rdx
  f5:   6a <span class="token number">01</span>                   push   <span class="token number">0x1</span>
  f7:   <span class="token number">58</span>                      pop    rax
  f8:   0f <span class="token number">05</span>                   syscall
  fa:   <span class="token number">55</span>                      push   rbp
  fb:   5c                      pop    rsp
  fc:   <span class="token number">41</span> ff e7                jmp    r15</code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Assembly</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><div class="details-collapse-bottom"><sub><a class="details-collapse-button">(collapse)</a></sub></div></div></details><p>It turns out <code>r12</code> and <code>r13</code> are just the first 4 bytes of <span class="spoiler" tabindex="0"><code>/bin/sh</code></span> and <span class="spoiler" tabindex="0"><code>/etc/passwd</code></span>, which is respectively <span class="spoiler" tabindex="0"><code>\x7fELF</code></span> and <span class="spoiler" tabindex="0"><code>root</code></span>. These correspond to <span class="spoiler" tabindex="0"><code>0x464c457f</code></span> and <span class="spoiler" tabindex="0"><code>0x746f6f72</code></span> in little endian. And <code>r14</code> is just <span class="spoiler" tabindex="0"><code>0x31f3831f</code></span>, computed with a bit of arithmetic. Armed with these 3 values, we can now reverse the encryption.</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">def</span> <span class="token function">ror</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    left <span class="token operator">=</span> x <span class="token operator">&gt;&gt;</span> n
    right <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">0xFFFFFFFF</span> <span class="token operator">&gt;&gt;</span> <span class="token punctuation">(</span><span class="token number">32</span> <span class="token operator">-</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">32</span> <span class="token operator">-</span> n<span class="token punctuation">)</span>
    <span class="token keyword">return</span> right <span class="token operator">|</span> left

<span class="token keyword">def</span> <span class="token function">neg</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> x <span class="token operator">&gt;=</span> <span class="token number">0</span>
    <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'01'</span><span class="token punctuation">[</span>c <span class="token operator">==</span> <span class="token string">'0'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>x<span class="token punctuation">:</span><span class="token format-spec">032b</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>

r12 <span class="token operator">=</span> <span class="token number">0x464c457f</span>
r13 <span class="token operator">=</span> <span class="token number">0x746f6f72</span>
r14 <span class="token operator">=</span> <span class="token number">0x31f3831f</span>

<span class="token keyword">def</span> <span class="token function">shelldec</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Reverse shellcode encryption (decryption)."""</span>
    <span class="token keyword">assert</span> b <span class="token operator">&gt;=</span> <span class="token number">0</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ror<span class="token punctuation">(</span>neg<span class="token punctuation">(</span>b <span class="token operator">^</span> r14<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">32</span> <span class="token operator">-</span> <span class="token number">0xb</span><span class="token punctuation">)</span> <span class="token operator">^</span> r13<span class="token punctuation">)</span> <span class="token operator">-</span> r12<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span><span class="token operator">**</span><span class="token number">32</span>

byteorder <span class="token operator">=</span> <span class="token string">'little'</span>

<span class="token comment"># `encrypted` words obtained from 160010 to 16004f.</span>
encrypted <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0x526851a7</span><span class="token punctuation">,</span> <span class="token number">0x31ff2785</span><span class="token punctuation">,</span> <span class="token number">0xc7d28788</span><span class="token punctuation">,</span> <span class="token number">0x523f23d3</span><span class="token punctuation">,</span> <span class="token number">0xaf1f1055</span><span class="token punctuation">,</span> <span class="token number">0x5c94f027</span><span class="token punctuation">,</span> <span class="token number">0x797a3fcd</span><span class="token punctuation">,</span> <span class="token number">0xe7f02f9f</span><span class="token punctuation">,</span> <span class="token number">0x3c86f045</span><span class="token punctuation">,</span> <span class="token number">0x6deab0f9</span><span class="token punctuation">,</span> <span class="token number">0x91f74290</span><span class="token punctuation">,</span> <span class="token number">0x7c9a3aed</span><span class="token punctuation">,</span> <span class="token number">0xdc846b01</span><span class="token punctuation">,</span> <span class="token number">0x743c86c</span><span class="token punctuation">,</span> <span class="token number">0xdff7085c</span><span class="token punctuation">,</span> <span class="token number">0xa4aee3eb</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
decrypted <span class="token operator">=</span> <span class="token punctuation">[</span>shelldec<span class="token punctuation">(</span>u<span class="token punctuation">)</span> <span class="token keyword">for</span> u <span class="token keyword">in</span> encrypted<span class="token punctuation">]</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><h3 id="tying-it-all-together" tabindex="-1"><a class="md-anchor" href="#tying-it-all-together" aria-hidden="true"></a> Tying it All Together</h3><p>All that's left is to tie the three parts together.</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python">bs <span class="token operator">=</span> <span class="token string">b''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>u<span class="token punctuation">.</span>to_bytes<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> byteorder<span class="token punctuation">)</span> <span class="token keyword">for</span> u <span class="token keyword">in</span> decrypted<span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    bs <span class="token operator">=</span> apply_rmp<span class="token punctuation">(</span>bs<span class="token punctuation">)</span>
    bs <span class="token operator">=</span> apply_rperm<span class="token punctuation">(</span>bs<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>bs<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><h2 id="debugging-our-mess" tabindex="-1"><a class="md-anchor" href="#debugging-our-mess" aria-hidden="true"></a> Debugging Our Mess</h2><p>Some small tips on debugging.</p><p>Sometimes the solution is simple and straightforward. But occasionally, we make programming mistakes or misunderstand the problem. Debugging code can be painful.</p><ul><li><p>Prove inverse function holds. Sounds mathy, but the basic principle is to check if our <em>reversed output</em> equals our <em>input</em>. In math terms: <code>f(g(x)) = g(f(x)) = x</code>, where <code>g</code> is the inverse of <code>f</code>. If it's not equal, clearly we messed up somewhere.</p><ul><li>This is useful for the second part (mapping), because our domain is small, just 0 - 255.</li><li>For example, with shellcode encryption, we can do a forward pass, to make sure we're getting the same data.<div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">def</span> <span class="token function">shellenc</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Forward shell encryption."""</span>
    <span class="token keyword">assert</span> a <span class="token operator">&gt;=</span> <span class="token number">0</span>
    u32 <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">&amp;</span> <span class="token number">0xFFFFFFFF</span> 
    <span class="token keyword">return</span> neg<span class="token punctuation">(</span>ror<span class="token punctuation">(</span>u32<span class="token punctuation">(</span>a <span class="token operator">+</span> r12<span class="token punctuation">)</span> <span class="token operator">^</span> r13<span class="token punctuation">,</span> <span class="token number">0xb</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> r14

<span class="token keyword">assert</span> encrypted <span class="token operator">==</span> <span class="token punctuation">[</span>shellenc<span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token keyword">for</span> v <span class="token keyword">in</span> decrypted<span class="token punctuation">]</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div></li></ul></li><li><p>Use <code>assert</code>s. Great for intermediate checks.</p></li><li><p>Verify assumptions with dynamic analysis. For example, I had falsely assumed in the shellcode that <code>r12 == 0</code>, since seemed to be pushed by the assembly. But as we found out, <code>r12 == L"FLE\x7f"</code>. However, be wary of the <a href="https://en.wikipedia.org/wiki/Observer_effect_(information_technology)" rel="noreferrer" target="_blank">observer effect</a>, where the program changes behaviour when observed. I haven't seen this much in CTFs, but it's certain to be out there...</p></li></ul><h2 id="final-remarks" tabindex="-1"><a class="md-anchor" href="#final-remarks" aria-hidden="true"></a> Final Remarks</h2><p>It's easy to miss things out. I know I did. Lots of hair was lost until I realised I left out the shellcode. I also tried to search the shellcode on ExploitDB, but no luck, because it was hand-spun.</p><p>But overall, a sweet challenge. And one that left me with nice rave music to power me through Saturday.</p><h2 id="solve-script" tabindex="-1"><a class="md-anchor" href="#solve-script" aria-hidden="true"></a> Solve Script</h2><script src="https://gist.github.com/TrebledJ/bea5665f3cd340997ff60e069558e80d.js"></script><h2 id="flag" tabindex="-1"><a class="md-anchor" href="#flag" aria-hidden="true"></a> Flag</h2><div class="code-toolbar"><pre data-lang-off="" class="language-txt" tabindex="0"><code class="language-txt">hitcon{&lt;https://soundcloud.com/monstercat/noisestorm-crab-rave&gt;}</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>(I don't know what this music was. It was my first time listening to it. And it's <em><strong>epic</strong></em>! So thank you, wxrdnx, for introducing this nice rave and meme.)</p><hr class="footnotes-sep"><b>Footnotes</b><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>A better specifier would be <code>x/64bd</code>. This displays 64 <code>d</code>ecimal <code>b</code>ytes, and is more convenient to parse in Python. But I chose <code>x/16wx</code> since I didn't know better at the time and caused myself extra pain. ü•≤ <a href="#fnref1" class="footnote-backref">‚Ü©Ô∏é</a></p></li></ol></section></div><a id="end-of-article"></a><br><script defer src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><div class="post-share dim-gentle mb-3 d-flex flex-row align-items-center"><div class="d-flex flex-row flex-wrap align-items-center gap-3"><span>Share&nbsp;on</span> <a class="no-decoration" data-sharer="reddit" data-title="HITCON 2023 ‚Äì The Blade" data-url="https://trebledj.me/posts/hitcon-2023-the-blade/"><span class="fs-4"><i class="fab fa-reddit"></i> </span></a><a class="no-decoration" data-sharer="telegram" data-title="HITCON 2023 ‚Äì The Blade" data-url="https://trebledj.me/posts/hitcon-2023-the-blade/"><span class="fs-4"><i class="fab fa-telegram"></i> </span></a><a class="no-decoration" data-sharer="whatsapp" data-title="HITCON 2023 ‚Äì The Blade" data-url="https://trebledj.me/posts/hitcon-2023-the-blade/"><span class="fs-4"><i class="fab fa-whatsapp"></i> </span></a><a class="no-decoration" data-sharer="linkedin" data-title="HITCON 2023 ‚Äì The Blade" data-url="https://trebledj.me/posts/hitcon-2023-the-blade/"><span class="fs-4"><i class="fab fa-linkedin"></i> </span></a><a class="no-decoration" data-sharer="vk" data-title="HITCON 2023 ‚Äì The Blade" data-url="https://trebledj.me/posts/hitcon-2023-the-blade/"><span class="fs-4"><i class="fab fa-vk"></i> </span></a><a class="no-decoration" data-sharer="twitter" data-title="HITCON 2023 ‚Äì The Blade" data-url="https://trebledj.me/posts/hitcon-2023-the-blade/"><span class="fs-4"><i class="fab fa-twitter"></i> </span></a><a id="copy-link-button" class="no-decoration" data-bs-toggle="tooltip" data-bs-trigger="click" title="Link copied!"><span class="fs-4"><i class="fas fa-link"></i></span></a></div></div><hr><div id="post-author-container" class="d-flex justify-content-between align-items-center gap-3" itemprop="author" itemscope itemtype="https://schema.org/Person"><img src="/img/profile-icon.jpg" class="profile-img" alt="" loading="lazy" decoding="async" itemprop="image"><div class="author-info d-flex flex-column gap-1"><p class="profile-name" itemprop="name">TrebledJ</p><p class="profile-bio" itemprop="description">Passionate problem-solver, pentester, and autodidact. I thrive on learning new things and enjoy passing it on. When not immersed in bughunting or programming, I can be found taking walks, composing a short tune, and occasionally indulging in CTF challenges.</p></div></div><hr class="section-sep"><div id="related" class="jw-100"><h3><i class="fas fa-circle-nodes me-2"></i>Related Posts</h3><div class="row gx-3 mt-4"><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/arbitrary-code-execution-for-breakfast/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/arbitrary-code-execution-for-breakfast/"><img class="post-img-blurred-bg" src="/img/posts/infosec/cpp-deserialization/assets/popashell-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 512" alt="Thumbnail for Sharing is Caring: Arbitrary Code Execution for Breakfast" srcset="/img/posts/infosec/cpp-deserialization/assets/popashell-256w.webp 256w, /img/posts/infosec/cpp-deserialization/assets/popashell-512w.webp 512w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/infosec/cpp-deserialization/assets/popashell-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 512" alt="Thumbnail for Sharing is Caring: Arbitrary Code Execution for Breakfast" srcset="/img/posts/infosec/cpp-deserialization/assets/popashell-256w.webp 256w, /img/posts/infosec/cpp-deserialization/assets/popashell-512w.webp 512w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">Sharing is Caring: Arbitrary Code Execution for Breakfast</h2><div class="post-summary"><p>A CTF challenge exploring binary exploitation in C++, gadget mania, and a new form of deserialization attack.</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/pwn/" itemprop="keywords">pwn</a> </span><span><a class="jtag" href="/tags/cpp/" itemprop="keywords">cpp</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/abusing-server-side-rendering-in-drogon/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/abusing-server-side-rendering-in-drogon/"><img class="post-img-blurred-bg" src="/img/posts/infosec/drogon-csp/assets/drogon-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 288" alt="Thumbnail for Dynamic Views Loading ‚Äì Abusing Server Side Rendering in Drogon" srcset="/img/posts/infosec/drogon-csp/assets/drogon-thumbnail-256w.webp 256w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-512w.webp 512w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-1024w.webp 1024w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-1600w.webp 1600w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/infosec/drogon-csp/assets/drogon-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 288" alt="Thumbnail for Dynamic Views Loading ‚Äì Abusing Server Side Rendering in Drogon" srcset="/img/posts/infosec/drogon-csp/assets/drogon-thumbnail-256w.webp 256w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-512w.webp 512w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-1024w.webp 1024w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-1600w.webp 1600w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">Dynamic Views Loading ‚Äì Abusing Server Side Rendering in Drogon</h2><div class="post-summary"><p>What could go wrong releasing a C++ web server with "live reload" into the wild?</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/infosec/" itemprop="keywords">infosec</a> </span><span><a class="jtag" href="/tags/cpp/" itemprop="keywords">cpp</a> </span><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/attack-of-the-zip/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/attack-of-the-zip/"><img class="post-img-blurred-bg" src="/img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-500w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 500 / 337" alt="Thumbnail for From Compression to Compromise: Unmasking Zip File Threats" srcset="/img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-256w.webp 256w, /img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-500w.webp 500w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 500px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-500w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 500 / 337" alt="Thumbnail for From Compression to Compromise: Unmasking Zip File Threats" srcset="/img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-256w.webp 256w, /img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-500w.webp 500w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 500px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">From Compression to Compromise: Unmasking Zip File Threats</h2><div class="post-summary"><p>Deep dive into zip file attacks and mitigations (with examples!).</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/infosec/" itemprop="keywords">infosec</a> </span><span><a class="jtag" href="/tags/notes/" itemprop="keywords">notes</a> </span><span><a class="jtag" href="/tags/web/" itemprop="keywords">web</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/hkcert-2023-decompetition-vitamin-cpp/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/hkcert-2023-decompetition-vitamin-cpp/"><img class="post-img-blurred-bg" src="/img/posts/ctf/hkcert23/assets/vitamin-cpp-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 288" alt="Thumbnail for HKCERT CTF 2023 ‚Äì Decompetition: Vitamin&nbsp;C++" srcset="/img/posts/ctf/hkcert23/assets/vitamin-cpp-256w.webp 256w, /img/posts/ctf/hkcert23/assets/vitamin-cpp-512w.webp 512w, /img/posts/ctf/hkcert23/assets/vitamin-cpp-640w.webp 640w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/ctf/hkcert23/assets/vitamin-cpp-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 288" alt="Thumbnail for HKCERT CTF 2023 ‚Äì Decompetition: Vitamin&nbsp;C++" srcset="/img/posts/ctf/hkcert23/assets/vitamin-cpp-256w.webp 256w, /img/posts/ctf/hkcert23/assets/vitamin-cpp-512w.webp 512w, /img/posts/ctf/hkcert23/assets/vitamin-cpp-640w.webp 640w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">HKCERT CTF 2023 ‚Äì Decompetition: Vitamin&nbsp;C++</h2><div class="post-summary"><p>A beginner-friendly writeup to reverse-engineering C++ a l√° decompetition. Years of complex shenanigans condensed!</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/reverse/" itemprop="keywords">reverse</a> </span><span><a class="jtag" href="/tags/cpp/" itemprop="keywords">cpp</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/subtype-metaprogramming-is-mostly-harmless/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/subtype-metaprogramming-is-mostly-harmless/"><img class="post-img-blurred-bg" src="/img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 249" alt="Thumbnail for N[Subtype Metaprogramming] is N[Mostly Harmless]" srcset="/img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-256w.webp 256w, /img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-512w.webp 512w, /img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-804w.webp 804w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 249" alt="Thumbnail for N[Subtype Metaprogramming] is N[Mostly Harmless]" srcset="/img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-256w.webp 256w, /img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-512w.webp 512w, /img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-804w.webp 804w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title"><sub><sup>N[</sup></sub>Subtype Metaprogramming<sub><sup>]</sup></sub> is <sub><sup>N[</sup></sub>Mostly Harmless<sub><sup>]</sup></sub></h2><div class="post-summary"><p>Inheritance go brrrrrrrr... abusing turing-complete typesystems to write fun programs in Python.</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/types/" itemprop="keywords">types</a> </span><span><a class="jtag" href="/tags/python/" itemprop="keywords">python</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/gdb-cheatsheet/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/gdb-cheatsheet/"><img class="post-img-blurred-bg" src="/img/posts/programming/cheatsheets/assets/gef-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 250" alt="Thumbnail for GDB/GEF Cheatsheet" srcset="/img/posts/programming/cheatsheets/assets/gef-256w.webp 256w, /img/posts/programming/cheatsheets/assets/gef-512w.webp 512w, /img/posts/programming/cheatsheets/assets/gef-906w.webp 906w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/programming/cheatsheets/assets/gef-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 250" alt="Thumbnail for GDB/GEF Cheatsheet" srcset="/img/posts/programming/cheatsheets/assets/gef-256w.webp 256w, /img/posts/programming/cheatsheets/assets/gef-512w.webp 512w, /img/posts/programming/cheatsheets/assets/gef-906w.webp 906w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">GDB/GEF Cheatsheet</h2><div class="post-summary"><p>Quick command reference on one of the most powerful tools for dynamic analysis.</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a> </span><span><a class="jtag" href="/tags/cheatsheet/" itemprop="keywords">cheatsheet</a> </span><span><a class="jtag" href="/tags/infosec/" itemprop="keywords">infosec</a></span></div></div></div></div></article></div></div><hr><h3><i class="fas fa-tags me-2"></i>Related Tags</h3><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to ctf, reverse">software.security</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/ctf/">ctf</a> <a class="jtag" href="/tags/infosec/">infosec</a> <a class="jtag" href="/tags/reverse/">reverse</a> <a class="jtag" href="/tags/pentesting/">pentesting</a> <a class="jtag" href="/tags/pwn/">pwn</a> <a class="jtag" href="/tags/cryptography/">cryptography</a> <a class="jtag" href="/tags/cve/">cve</a> <a class="jtag" href="/tags/redteam/">redteam</a> <a class="jtag" href="/tags/stego/">stego</a></span></div><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to programming">software.general</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/programming/">programming</a> <a class="jtag" href="/tags/software-engineering/">software-engineering</a> <a class="jtag" href="/tags/web/">web</a> <a class="jtag" href="/tags/aoc/">aoc</a> <a class="jtag" href="/tags/apps/">apps</a> <a class="jtag" href="/tags/dsp/">dsp</a> <a class="jtag" href="/tags/programming-languages/">programming-languages</a> <a class="jtag" href="/tags/linux/">linux</a> <a class="jtag" href="/tags/performance/">performance</a> <a class="jtag" href="/tags/functional/">functional</a> <a class="jtag" href="/tags/types/">types</a> <a class="jtag" href="/tags/windows/">windows</a> <a class="jtag" href="/tags/ai/">ai</a> <a class="jtag" href="/tags/metaprogramming/">metaprogramming</a> <a class="jtag" href="/tags/oop/">oop</a></span></div><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to python, rust">software.programming-language</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/cpp/">cpp</a> <a class="jtag" href="/tags/python/">python</a> <a class="jtag" href="/tags/c/">c</a> <a class="jtag" href="/tags/haskell/">haskell</a> <a class="jtag" href="/tags/js/">js</a> <a class="jtag" href="/tags/qt/">qt</a> <a class="jtag" href="/tags/rust/">rust</a> <a class="jtag" href="/tags/qml/">qml</a> <a class="jtag" href="/tags/sql/">sql</a> <a class="jtag" href="/tags/java/">java</a> <a class="jtag" href="/tags/scala/">scala</a></span></div><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to writeup">misc</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/writeup/">writeup</a> <a class="jtag" href="/tags/notes/">notes</a> <a class="jtag" href="/tags/tutorial/">tutorial</a> <a class="jtag" href="/tags/project/">project</a> <a class="jtag" href="/tags/reflection/">reflection</a> <a class="jtag" href="/tags/hkust/">hkust</a> <a class="jtag" href="/tags/experience/">experience</a> <a class="jtag" href="/tags/research/">research</a> <a class="jtag" href="/tags/faith/">faith</a> <a class="jtag" href="/tags/learning/">learning</a> <a class="jtag" href="/tags/meta/">meta</a> <a class="jtag" href="/tags/mathematics/">mathematics</a> <a class="jtag" href="/tags/cheatsheet/">cheatsheet</a> <a class="jtag" href="/tags/satire/">satire</a> <a class="jtag" href="/tags/essay/">essay</a> <a class="jtag" href="/tags/reading/">reading</a></span></div></div><hr class="section-sep"><div class="container-md mt-4 p-4"><a id="comments"></a><p>Comments are back! Privacy-focused; without ads, bloatware ü§Æ, and trackers. Be one of the first to contribute to the discussion‚Äî before AI invades social media, world leaders declare war on guppies, and what little humanity left is lost to time.</p><script defer src="/js/comentario.min.js"></script><script>if(window.location.hash.startsWith("#comentario")){const a=document.getElementById("comments");a&&a.scrollIntoView({behavior:"smooth"})}</script><comentario-comments id="comentario" auto-init="false" no-fonts="true" css-override="false" theme="dark"></comentario-comments></div><br></div></div></article></div></div></div><footer class="d-flex flex-column gap-2"><div class="d-flex flex-row gap-3 mx-auto" style="width:fit-content;"><a rel="me noreferrer" href="https://github.com/TrebledJ" target="_blank"><i class="social-icon fab fa-github" style="color:rgb(150, 60, 180) !important;"></i> </a><a rel="me noreferrer" href="https://infosec.exchange/@trebledj" target="_blank"><i class="social-icon fab fa-mastodon" style="color:rgb(99, 101, 255) !important;"></i> </a><a rel="me noreferrer" href="https://x.com/trebledjjj" target="_blank"><i class="social-icon fab fa-twitter" style="color:rgb(99, 101, 255) !important;"></i> </a><a rel="me noreferrer" href="https://stackoverflow.com/users/10239789/trebledj" target="_blank"><i class="social-icon fab fa-stack-overflow" style="color:rgb(236, 124, 34) !important;"></i> </a><a rel="me noreferrer" href="https://soundcloud.com/trebledj" target="_blank"><i class="social-icon fab fa-soundcloud" style="color:rgb(237, 110, 30) !important;"></i> </a><a rel="me noreferrer" href="https://discordapp.com/users/220427982798454794" target="_blank"><i class="social-icon fab fa-discord" style="color:rgb(84, 100, 235) !important;"></i> </a><a rel="me" href="mailto:trebledjjj@gmail.com"><i class="social-icon fas fa-envelope"></i> </a><a rel="me" href="/feeds"><i class="social-icon fas fa-square-rss"></i></a></div><p>Copyright&nbsp;¬©&nbsp;2026&nbsp;TrebledJ ‚Ä¢ <a href="/privacy-policy">Privacy&nbsp;Policy</a> ‚Ä¢ <a href="https://github.com/TrebledJ/trebledj.github.io?tab=readme-ov-file#credits--appreciation" rel="noreferrer" target="_blank">Credits</a></p></footer><script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js"></script><script>var tocOptions={}</script><script defer src="/cb/YmP0cUsv-I.js"></script><script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;52d99b3d385b4c9a98ac8ad109a95a2a&quot;}"></script></body></html>