<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Subtype Metaprogramming is Mostly Harmless - TrebledJ's Pages</title><meta name="description" content="Inheritance go brrrrrrrr... abusing turing-complete typesystems to write fun programs in Python."><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="trebledj,subtype metaprogramming is mostly harmless,inheritance go brrrrrrrr... abusing turing-complete typesystems to write fun programs in python.,programming,ctf,types,python,tutorial,reverse,programming-languages,metaprogramming,oop,writeup"><meta name="robots" content="index,follow"><meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'sha256-Wv9Tjjg7Y7X5sBbP5AXqAQJA6+eewSRUjoPhNczfpnM=' 'sha256-FBtdNYnNdsvTKcrNIznI+jwGwhW3pNA5x/yQUw8jOPA=' 'sha256-5e8R4YC3Atf/5McNMkFk4TZYUtMEItdy9ikt1KUoPSc=' 'sha256-qlkNkQyGC5u9Brt4wwVi0MsPO/hVdrz3rzXuWYIkAbM=' 'sha256-J+ryCgKrW+QOH4xdCyPd6R5W3u9wJkXayR7KvtlnCnQ=' 'sha256-kQnTuA4pPVYgo0bCEGXSCEkD+CzMbRrhb5Cn58IydSA=' 'sha256-Deekn20h+++EarpL0nFQLX7JSJv7s/2W9f988ZFAh14=' comments.trebledj.me code.jquery.com cdn.jsdelivr.net gist.github.com static.cloudflareinsights.com; style-src 'self' 'unsafe-inline' comments.trebledj.me cdn.jsdelivr.net cdnjs.cloudflare.com github.githubassets.com; font-src 'self' data: comments.trebledj.me cdn.jsdelivr.net cdnjs.cloudflare.com; img-src 'self' data: comments.trebledj.me; frame-src 'self' *.soundcloud.com; connect-src 'self' comments.trebledj.me wss://comments.trebledj.me cloudflareinsights.com formcarry.com;"><link href="/feeds/posts.xml" rel="alternate" title="RSS Feed for TrebledJ's Pages" type="application/rss+xml"><meta property="og:site_name" content="TrebledJ's Pages"><meta property="og:type" content="article"><meta property="og:title" content="Subtype Metaprogramming is Mostly Harmless - TrebledJ's Pages"><meta property="twitter:title" content="Subtype Metaprogramming is Mostly Harmless - TrebledJ's Pages"><meta property="og:description" content="Inheritance go brrrrrrrr... abusing turing-complete typesystems to write fun programs in Python.

Types are cool! But y'know what's even cooler? A CTF challenge on types! This year's MapleCTF graced us with a challenge involving much class, much inheritance, much confuzzlement, and much..."><meta property="twitter:description" content="Inheritance go brrrrrrrr... abusing turing-complete typesystems to write fun programs in Python.

Types are cool! But y'know what's even cooler? A CTF challenge on types! This year's MapleCTF graced us with a challenge involving much class, much inheritance, much confuzzlement, and much..."><meta property="og:url" content="https://trebledj.me/posts/subtype-metaprogramming-is-mostly-harmless/"><meta name="twitter:card" content="summary_large_image"><meta property="og:image" content="https://trebledj.me/img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-804w.webp"><meta property="twitter:image" content="https://trebledj.me/img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-804w.webp"><meta property="article:published_time" content="2023-10-02T00:00:00.000Z"><meta property="article:author" content="TrebledJ"><meta property="article:section" content="programming"><meta property="article:tag" content="programming"><meta property="article:tag" content="ctf"><meta property="article:tag" content="types"><meta property="article:tag" content="python"><meta property="article:tag" content="tutorial"><meta property="article:tag" content="reverse"><meta property="article:tag" content="programming-languages"><meta property="article:tag" content="metaprogramming"><meta property="article:tag" content="oop"><meta property="article:tag" content="writeup"><script type="application/ld+json">{"@context": "https://schema.org","@type": "WebSite","name": "TrebledJ's Pages","url": "https://trebledj.me"}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/cb/css/icons-6e60ae6c5e022aba.css"><link rel="stylesheet" href="/cb/x2ljFSZBUH.css" media="print"><style></style><script>document.querySelectorAll('link[media|="print"]').forEach(e=>{e.addEventListener("load",()=>e.media="all"),e.sheet&&(e.media="all")})</script><script>const defaultTheme="dark";let icon=void 0;var reloadDisqus=void 0;function modeInit(){var e=localStorage.getItem("theme");setMode("dark"===e?"dark":"light"===e?"light":defaultTheme)}function modeInitIcon(){icon=document.getElementById("mode-switch-icon"),isLightTheme()&&(icon.classList.remove("fa-moon"),icon.classList.add("fa-sun"),icon.classList.add("mode-switch-transform"))}function isLightTheme(){return"light"===localStorage.getItem("theme")}function modeSwitcher(){var e=localStorage.getItem("theme");"dark"===e?(setMode("light"),reloadDisqus&&reloadDisqus()):"light"===e?(setMode("dark"),reloadDisqus&&reloadDisqus()):setMode(defaultTheme)}function setMode(e){"dark"===e?(document.documentElement.setAttribute("data-theme","dark"),localStorage.setItem("theme","dark")):"light"===e&&(document.documentElement.setAttribute("data-theme","light"),localStorage.setItem("theme","light")),icon&&(icon.classList.toggle("fa-moon"),icon.classList.toggle("fa-sun"),icon.classList.toggle("mode-switch-transform"))}modeInit(),document.addEventListener("DOMContentLoaded",()=>{document.getElementById("mode-switch").addEventListener("click",()=>{modeSwitcher()})})</script><script defer src="https://cdn.jsdelivr.net/npm/jquery@3.7.0/dist/jquery.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"><link rel="stylesheet" href="/css/comments.css"><link rel="icon" href="/favicon.ico" type="image/x-icon"></head><body><header><nav class="navbar navbar-expand-md py-2"><div class="container-fluid justify-content-between align-items-center"><button aria-controls="navbar-container" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler shadow-none" data-bs-target="#navbar-container" data-bs-toggle="collapse" type="button"><span id="navbar-toggler-icon"><i class="fas fa-bars"></i></span></button> <a class="navbar-brand no-decoration" href="/">TrebledJ's Pages</a><div class="navbar-collapse collapse" id="navbar-container"><ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="/">Home</a></li><li class="nav-item"><a class="nav-link" href="/about">About</a></li><li class="nav-item"><a class="nav-link" href="/posts">Posts</a></li><li class="nav-item"><a class="nav-link" href="/music">Music</a></li></ul><ul class="navbar-nav"><li><a class="nav-link me-2" data-bs-toggle="modal" data-bs-target="#search-modal" aria-label="Search..." role="button"><i class="fas fa-search nav-icon"></i></a></li><li><a class="nav-link" id="mode-switch" aria-label="Theme Switch" role="button"><i id="mode-switch-icon" class="fas fa-moon nav-icon"></i></a><script>modeInitIcon()</script></li></ul></div></div></nav><div id="scroll-progress-bar"></div></header><div id="top-of-the-morning-to-you"></div><div id="search-modal" class="modal fade wide-modal" aria-hidden="true" aria-label="Search" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header pb-2 d-flex flex-row justify-content-between"><div class="container-fluid ps-0" id="search-box-container"><input type="text" autofocus class="container-fluid" id="search-box" placeholder="Search"> <i class="fas fa-search"></i></div><button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button></div><div class="modal-body" id="search-results-list"></div></div></div></div><button id="btn-back-to-top" class="btn btn-lg" type="button" aria-label="Back to Top"><i class="fas fa-arrow-up"></i></button><div id="btn-mobile-toc" class="dropup"><button type="button" class="btn btn-lg" data-bs-toggle="dropdown" aria-label="Content"><i class="fas fa-list-ul"></i></button><ul class="dropdown-menu toc-container"><li><nav class="toc"><ol><li><a href="#description">Description</a></li><li><a href="#solve">Solve</a><ol><li><a href="#script">Script</a></li><li><a href="#flag">Flag</a></li></ol></li><li><a href="#back-to-the-basics">Back to the Basics</a><ol><li><a href="#classes">Classes</a></li><li><a href="#inheritance">Inheritance</a></li><li><a href="#typing">Typing</a></li><li><a href="#invariance-covariance-and-contravariance">Invariance, Covariance, and Contravariance</a></li></ol></li><li><a href="#metaprogramming-with-type-hints">Metaprogramming with Type Hints</a><ol><li><a href="#be-a-subtype-checker">Be a Subtype Checker</a></li><li><a href="#subtype-checking-example">Subtype-Checking Example</a></li><li><a href="#python-type-hints-are-turing-complete">Python Type Hints are Turing Complete</a></li><li><a href="#decoding-the-challenge-s-subtype-query">Decoding the Challenge's Subtype Query</a></li></ol></li><li><a href="#closing-remarks">Closing Remarks</a></li><li><a href="#references">References</a></li></ol></nav></li></ul></div><div class="main-container"><div class="page-container col-lg-12"><div class="container-lg px-0"><article class="jw-100 post-article" itemscope itemtype="http://schema.org/BlogPosting"><div class="row flex-row-reverse gx-lg-5"><div class="col-lg-4 d-none d-lg-block"><div class="dim-deep"><div class="metadata-container d-flex"><div class="d-flex flex-row align-items-center"><span><i class="fas fa-calendar post-meta-icon me-1"></i> </span><span class="fs-7 post-posted-date">Posted on <span itemprop="datePublished" content="2023-10-02T08:00:00.000+08:00">2023‑10‑02</span></span></div><div class="d-flex flex-row align-items-center"><span class="post-updated-date-icon"><i class="fas fa-calendar post-meta-icon me-1"></i> </span><span class="fs-7 post-updated-date">Updated on <span itemprop="dateModified" content="2024-04-07T17:19:19.000+08:00">2024‑04‑07</span></span></div><div class="d-flex flex-row align-items-center"><span><i class="far fa-clock post-meta-icon me-1"></i> </span><span class="fs-7">12 minute read</span></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><span><i class="fas fa-tag post-meta-icon me-1 mt-2"></i></span><div class="tag-list d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a> </span><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/types/" itemprop="keywords">types</a> </span><span><a class="jtag" href="/tags/python/" itemprop="keywords">python</a> </span><span><a class="jtag" href="/tags/tutorial/" itemprop="keywords">tutorial</a> </span><span><a class="jtag" href="/tags/reverse/" itemprop="keywords">reverse</a> </span><span><a class="jtag" href="/tags/programming-languages/" itemprop="keywords">programming-languages</a> </span><span><a class="jtag" href="/tags/metaprogramming/" itemprop="keywords">metaprogramming</a> </span><span><a class="jtag" href="/tags/oop/" itemprop="keywords">oop</a> </span><span><a class="jtag" href="/tags/writeup/" itemprop="keywords">writeup</a></span></div></div></div><br><div id="toc-sidebar" class="sticky-right dim-deep dim-if-dark"><div class="toc-container"><span><a id="toc-content" href="javascript:void(0);">Content</a></span><nav class="toc"><ol><li><a href="#description">Description</a></li><li><a href="#solve">Solve</a><ol><li><a href="#script">Script</a></li><li><a href="#flag">Flag</a></li></ol></li><li><a href="#back-to-the-basics">Back to the Basics</a><ol><li><a href="#classes">Classes</a></li><li><a href="#inheritance">Inheritance</a></li><li><a href="#typing">Typing</a></li><li><a href="#invariance-covariance-and-contravariance">Invariance, Covariance, and Contravariance</a></li></ol></li><li><a href="#metaprogramming-with-type-hints">Metaprogramming with Type Hints</a><ol><li><a href="#be-a-subtype-checker">Be a Subtype Checker</a></li><li><a href="#subtype-checking-example">Subtype-Checking Example</a></li><li><a href="#python-type-hints-are-turing-complete">Python Type Hints are Turing Complete</a></li><li><a href="#decoding-the-challenge-s-subtype-query">Decoding the Challenge's Subtype Query</a></li></ol></li><li><a href="#closing-remarks">Closing Remarks</a></li><li><a href="#references">References</a></li></ol></nav><hr></div><div class="toc-link-container"><span><a href="#related">Related Posts</a></span></div><div class="toc-link-container"><span><a href="#comments">Comments</a></span></div></div></div><div class="col-lg-8 post-body-container"><div class="article-header"><h1 class="post-title" itemprop="name headline"><sub><sup>N[</sup></sub>Subtype Metaprogramming<sub><sup>]</sup></sub> is <sub><sup>N[</sup></sub>Mostly Harmless<sub><sup>]</sup></sub></h1><p class="post-desc" itemprop="alternativeHeadline">Inheritance go brrrrrrrr... abusing turing-complete typesystems to write fun programs in Python.</p><div class="d-lg-none dim-deep"><div class="metadata-container d-flex"><div class="d-flex flex-row align-items-center"><span><i class="fas fa-calendar post-meta-icon me-1"></i> </span><span class="fs-7 post-posted-date">Posted on <span itemprop="datePublished" content="2023-10-02T08:00:00.000+08:00">2023‑10‑02</span></span></div><div class="d-flex flex-row align-items-center"><span class="post-updated-date-icon"><i class="fas fa-calendar post-meta-icon me-1"></i> </span><span class="fs-7 post-updated-date">Updated on <span itemprop="dateModified" content="2024-04-07T17:19:19.000+08:00">2024‑04‑07</span></span></div><div class="d-flex flex-row align-items-center"><span><i class="far fa-clock post-meta-icon me-1"></i> </span><span class="fs-7">12 minute read</span></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><span><i class="fas fa-tag post-meta-icon me-1 mt-2"></i></span><div class="tag-list d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a> </span><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/types/" itemprop="keywords">types</a> </span><span><a class="jtag" href="/tags/python/" itemprop="keywords">python</a> </span><span><a class="jtag" href="/tags/tutorial/" itemprop="keywords">tutorial</a> </span><span><a class="jtag" href="/tags/reverse/" itemprop="keywords">reverse</a> </span><span><a class="jtag" href="/tags/programming-languages/" itemprop="keywords">programming-languages</a> </span><span><a class="jtag" href="/tags/metaprogramming/" itemprop="keywords">metaprogramming</a> </span><span><a class="jtag" href="/tags/oop/" itemprop="keywords">oop</a> </span><span><a class="jtag" href="/tags/writeup/" itemprop="keywords">writeup</a></span></div></div></div></div><hr><div class="post-body text-content" itemprop="articleBody text"><img class="mb-2 rw center jw-100" src="/img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-804w.webp" loading="eager" decoding="async" style="aspect-ratio: auto 804 / 392" alt="Subtype Metaprogramming is Mostly Harmless" title="Subtype Metaprogramming is Mostly Harmless" srcset="/img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-256w.webp 256w, /img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-512w.webp 512w, /img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-804w.webp 804w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 804px"><p>Types are cool! But y'know what's even cooler? A CTF challenge on types!</p><p>This year's MapleCTF graced us with a challenge involving much class, much inheritance, much confuzzlement, and much eyesore.</p><div class="center rw mb-2 h-auto lightbox-gallery"><a class="" title="Screenshot of output.py." href="/img/posts/programming/concepts/subtype-metaprogramming/assets/output-797w.webp"><img class="multi rw" src="/img/posts/programming/concepts/subtype-metaprogramming/assets/output-797w.webp" loading="lazy" decoding="async" style="width:69.46%;aspect-ratio: auto 797 / 293" alt="Screenshot of output.py." title="Screenshot of output.py." srcset="/img/posts/programming/concepts/subtype-metaprogramming/assets/output-256w.webp 256w, /img/posts/programming/concepts/subtype-metaprogramming/assets/output-512w.webp 512w, /img/posts/programming/concepts/subtype-metaprogramming/assets/output-797w.webp 797w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 797px"></a><a class="" title="Much harm." href="/img/posts/programming/concepts/subtype-metaprogramming/assets/doge-much-class-500w.webp"><img class="multi rw" src="/img/posts/programming/concepts/subtype-metaprogramming/assets/doge-much-class-500w.webp" loading="lazy" decoding="async" style="width:25.54%;aspect-ratio: auto 500 / 500" alt="Doge meme. Much class. Much inheritance. Much contravariant. Much turing. Much eyesore." title="Much harm." srcset="/img/posts/programming/concepts/subtype-metaprogramming/assets/doge-much-class-256w.webp 256w, /img/posts/programming/concepts/subtype-metaprogramming/assets/doge-much-class-500w.webp 500w" sizes="(max-width: 256px) 256px, 500px"></a></div><h2 id="description" tabindex="-1"><a class="md-anchor" href="#description" aria-hidden="true"></a> Description</h2><p><strong>Mostly Harmless</strong></p><blockquote><p>Some people consider type annotations to be useless. I consider everything <em>but</em> type annotations redundant.</p></blockquote><p>Author: <a href="https://toki.la/" rel="noreferrer" target="_blank">JJ</a><br>17/291 solves.</p><p>The <abbr data-bs-placement="top" data-bs-toggle="tooltip" title="challenge">chal</abbr> is also humorously tagged "cursed" and "misc". Well, that's reassuring...</p><p>Anyway, we're presented with two files:</p><ul><li><p><code>app.py</code>: Driver code to convert the flag (input) to a mysterious line of output, then opens a subprocess and runs</p><div class="code-toolbar"><pre class="language-shell" tabindex="0"><code class="language-shell">mypy output.py</code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Shell</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div></li><li><p><code>output.py</code>: A template file full of class declarations and inheritance. Utter gibberish on first sight.</p></li></ul><p>You can follow along by getting these files <a href="https://github.com/TrebledJ/ctf-binaries/tree/main/maplectf-2023/mostly-harmless" rel="noreferrer" target="_blank"><em>here</em></a>.</p><h2 id="solve" tabindex="-1"><a class="md-anchor" href="#solve" aria-hidden="true"></a> Solve</h2><p>What? A section titled "solve"? Already? What about the usual analysis and observations?</p><p>Usually I begin my writeups with an extensive analysis section. Contrary to this, <em>Mostly Harmless</em> is one of those blursed challenges which favours those with strong guess-fu; but the challenge is so intellectually challenging and <em><strong>deep</strong></em>, that to properly reverse (let alone understand) it would take <s>a PhD,</s> <s>years,</s> extra study post-CTF.</p><div class="alert alert-info d-flex align-items-start"><i class="fas fa-bolt ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><p>The key idea is to recognise:</p><ol><li>How does the flag checking work? Where is the final condition which decides whether the input is correct or not?<ul><li><em>By using the mypy type checker.</em></li></ul></li><li>How do the classes containing numbers (e.g. <code>QLW_s1</code>, <code>QRW_s1</code>) relate to the classes containing a letter (e.g. <code>L_x</code>, <code>L_a</code>)?<ul><li><em>By inheriting classes <em>in a specific manner</em>, therefore creating a subtyping relationship.</em></li></ul></li></ol></div></div><p>Still, let's look at some key insights:</p><ul><li><p>The final line of <code>output.py</code> is built by stacking input in a recursive fashion:</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python">L_<span class="token operator">&lt;</span>INPUT<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">[</span>N<span class="token punctuation">[</span> L_<span class="token operator">&lt;</span>INPUT<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">[</span>N<span class="token punctuation">[</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">]</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><ul><li>Thus, <strong>characters are encoded by the <code>L_*</code> classes</strong>.</li><li>The chain also begins (or ends?) with <code>QRW_s29</code>.</li></ul></li><li><p>There are a bunch of <code>Q*_s*</code> classes, numbered from 1 to 71. Indices, perhaps? Or just references?</p></li><li><p>Any clue to the relationship between these symbols? Yes! We see interesting stuff from lines 320 to 459.</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Line 378.</span>
<span class="token keyword">class</span> <span class="token class-name">QL_s29</span><span class="token punctuation">(</span>Generic<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">,</span> L_n<span class="token punctuation">[</span><span class="token string">"N[QLW_s31[L_x[N[MR[N[T]]]]]]"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">#          │               │          │</span>
<span class="token comment">#          │               │          └── Next number</span>
<span class="token comment">#          │               └── Next letter in flag</span>
<span class="token comment">#          └── Current number</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div></li></ul><p>And guess what? That's all we need! Just follow the numbers like how Alice follows the White Rabbit!</p><p><a class="lightbox-single" title="Naur way!!!" href="/img/posts/programming/concepts/subtype-metaprogramming/assets/shocker-500w.webp"><img class="mb-2 rw center jw-45" src="/img/posts/programming/concepts/subtype-metaprogramming/assets/shocker-500w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 500 / 553" alt="Shocked meme. That feeling when Mostly Harmless is an eyesore, but is actually pretty harmless." title="Naur way!!!" srcset="/img/posts/programming/concepts/subtype-metaprogramming/assets/shocker-256w.webp 256w, /img/posts/programming/concepts/subtype-metaprogramming/assets/shocker-500w.webp 500w" sizes="(max-width: 256px) 256px, 500px"></a></p><h3 id="script" tabindex="-1"><a class="md-anchor" href="#script" aria-hidden="true"></a> Script</h3><p>The solve is rather simple and fits within 25 lines (including comments!).</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> re

<span class="token comment"># Extract the lines containing pointers(?)/relationships between letters.</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'output.py'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    lines <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">319</span><span class="token punctuation">:</span><span class="token number">458</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token comment"># Skip every 2 lines, bc redundant info.</span>

lookup <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment"># Parse and store the relationships in a lookup map.</span>
<span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>
    curr_idx<span class="token punctuation">,</span> char<span class="token punctuation">,</span> next_idx <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'Q._s(\d+)[^ ]+, L_(\w).*.W_s(\d+)'</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    lookup<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>curr_idx<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>next_idx<span class="token punctuation">)</span><span class="token punctuation">,</span> char<span class="token punctuation">)</span>

<span class="token comment"># Follow the pointers until we hit 71.</span>
idx <span class="token operator">=</span> <span class="token number">29</span>
flag <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">while</span> idx <span class="token operator">!=</span> <span class="token number">71</span><span class="token punctuation">:</span>
    idx<span class="token punctuation">,</span> c <span class="token operator">=</span> lookup<span class="token punctuation">[</span>idx<span class="token punctuation">]</span>
    flag <span class="token operator">+=</span> c

<span class="token comment"># Profit!</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'maple{{</span><span class="token interpolation"><span class="token punctuation">{</span>flag<span class="token punctuation">}</span></span><span class="token string">}}'</span></span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><h3 id="flag" tabindex="-1"><a class="md-anchor" href="#flag" aria-hidden="true"></a> Flag</h3><details><summary>Lé Flaggo</summary><div class="details-content"><div class="code-toolbar"><pre data-lang-off="" class="language-txt" tabindex="0"><code class="language-txt">maple{no_type_system_is_safe_from_pl_grads_with_too_much_time_on_their_hands}</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>C++ template metaprogramming reverse when?</p><div class="details-collapse-bottom"><sub><a class="details-collapse-button">(collapse)</a></sub></div></div></details><p>We're done. We got the flag. But my curious side wants to dig deeper.</p><p>So let's go deeper! The rest of this post attempts to dissect the type theory behind the challenge, starting from basic principles.</p><h2 id="back-to-the-basics" tabindex="-1"><a class="md-anchor" href="#back-to-the-basics" aria-hidden="true"></a> Back to the Basics</h2><div class="alert alert-warning d-flex align-items-start"><i class="fas fa-triangle-exclamation ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><p>This section attempts to bolster the reader's understanding of programming and type theory in order to understand the nitty-gritty of the challenge. If you're comfortable with types and variance, feel free to <a href="#metaprogramming-with-type-hints">skip to the next section</a>. If you have any questions, do <a href="#comments">let me</a> <a href="/#contact">know</a>.</p></div></div><h3 id="classes" tabindex="-1"><a class="md-anchor" href="#classes" aria-hidden="true"></a> Classes</h3><p>Classes are a fundamental concept in object-oriented programming (OOP) that allow us to define objects with attributes (variables) and behaviours (methods/functions). They serve as blueprints or templates for creating instances of objects. In the functional realm, classes are used to create new types.</p><div class="alert alert-info d-flex align-items-start"><i class="fas fa-circle-info ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><p>From here on, <em>class</em> and <em>type</em> are interchangeable.</p></div></div><p>Here's an example:</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Declare a new class called Challenge.</span>
<span class="token keyword">class</span> <span class="token class-name">Challenge</span><span class="token punctuation">:</span>
    <span class="token comment"># __init__ is a magic method called automatically when an instance is created.</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> title<span class="token punctuation">,</span> description<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Creating challenge </span><span class="token interpolation"><span class="token punctuation">{</span>title<span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>title <span class="token operator">=</span> title
        self<span class="token punctuation">.</span>description <span class="token operator">=</span> description

<span class="token comment"># Create instance of our class.</span>
chal <span class="token operator">=</span> Challenge<span class="token punctuation">(</span><span class="token string">"Mostly Harmless"</span><span class="token punctuation">,</span> <span class="token string">"A totally harmless reverse challenge abusing Python types."</span><span class="token punctuation">)</span>
<span class="token comment"># Prints "Creating challenge Mostly Harmless..."</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>But we'll stay relevant to the challenge and keep things simple by declaring classes without a meaningful body. Let's not worry about fancy Python methods and class mechanics.</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># This also declares a class called Challenge.</span>
<span class="token keyword">class</span> <span class="token class-name">Challenge</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>The <code>...</code> (ellipsis) usually denotes an empty implementation.</p><p>Classes can do a lot more, but for now this explanation suffices.</p><h3 id="inheritance" tabindex="-1"><a class="md-anchor" href="#inheritance" aria-hidden="true"></a> Inheritance</h3><p>Inheritance is a mechanism in <abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Object-Oriented Programming">OOP</abbr> that allows a class to inherit attributes and behaviour from another class. The new class is called a <strong>subclass</strong> or <strong>derived class</strong>, and the class being inherited from is called the <strong>superclass</strong> or <strong>base class</strong>.</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Reverse</span><span class="token punctuation">(</span>Challenge<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>Here, <code>Reverse</code> is a subclass of <code>Challenge</code>, and <code>Challenge</code> is a superclass of <code>Reverse</code>.</p><ul><li><p>Semantically, a <code>Reverse</code> is also a <code>Challenge</code>, but the inverse does not always apply.</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">assert</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>Reverse<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Reverse<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">True</span>    <span class="token comment"># A Reverse is a Reverse. (Duh.)</span>
<span class="token keyword">assert</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>Reverse<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Challenge<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">True</span>  <span class="token comment"># A Reverse is also a Challenge.</span>
<span class="token keyword">assert</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>Challenge<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Reverse<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">False</span> <span class="token comment"># Supertype is not a subtype.</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div></li><li><p>Type-wise, it creates a relationship: <code>Reverse</code> is a <strong>subtype</strong> of <code>Challenge</code>. More on this later.</p></li></ul><p>We can inherit multiple classes too:</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Create a class for Python Reverse challenges.</span>
<span class="token keyword">class</span> <span class="token class-name">PythonReverse</span><span class="token punctuation">(</span>Python<span class="token punctuation">,</span> Reverse<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>Both <code>Python</code> and <code>Reverse</code> are superclasses/supertypes of <code>PythonReverse</code>.</p><p>Mathematically, we denote inheritance with $A : B$, where $A$ is the subtype and $B$ the supertype.</p><h3 id="typing" tabindex="-1"><a class="md-anchor" href="#typing" aria-hidden="true"></a> Typing</h3><p>Python is a dynamically-typed language and does not offer type-checking out-of-the-box. This challenge uses the third-party tool <code>mypy</code> to type-check <code>output.py</code> (get it with <code>pip install mypy</code>). Let's look at a typed example.</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Challenge</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">Reverse</span><span class="token punctuation">(</span>Challenge<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">Web</span><span class="token punctuation">(</span>Challenge<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

x<span class="token punctuation">:</span> Challenge <span class="token operator">=</span> Challenge<span class="token punctuation">(</span><span class="token punctuation">)</span>
y<span class="token punctuation">:</span> Challenge <span class="token operator">=</span> Reverse<span class="token punctuation">(</span><span class="token punctuation">)</span>
z<span class="token punctuation">:</span> Challenge <span class="token operator">=</span> Web<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><ul><li><p>We declare three classes: <code>Challenge</code>, <code>Reverse</code>, and <code>Web</code>. The latter two are nominal subtypes of <code>Challenge</code>.</p><details><summary>Nominal vs. Structural Subtyping</summary><div class="details-content"><p>Generally, there are two ways to look at subtypes:</p><ul><li><p>Nominal Subtyping: Two types are considered subtypes if they were <strong>declared</strong> such. Usually an explicit link is specified, e.g. inheritance.</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Reverse</span><span class="token punctuation">(</span>Challenge<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>Here, <code>Reverse</code> is a (nominal) subtype of <code>Challenge</code>.</p></li><li><p>Structural Subtyping: Two types are considered subtypes if their <strong>structures match</strong>. No explicit linking required.</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Challenge</span><span class="token punctuation">:</span>
    title <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    description <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">def</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">class</span> <span class="token class-name">Web</span><span class="token punctuation">:</span>      <span class="token comment"># No inheritance.</span>
    title <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    description <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    url <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">def</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">def</span> <span class="token function">instantiate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p><code>Web</code> is a (structural) subtype of <code>Challenge</code>, because <code>Web</code> <em>contains</em> attributes and behaviour of <code>Challenge.</code></p><p>This is more akin to duck typing.</p></li></ul><p>All the subtyping discussed in this post is <em>nominal subtyping</em>.</p><div class="details-collapse-bottom"><sub><a class="details-collapse-button">(collapse)</a></sub></div></div></details></li><li><p>We then...</p><ul><li>declare three variables <code>x</code>, <code>y</code>, <code>z</code>,</li><li>annotate them with <code>Challenge</code>, and</li><li>initiate them to instances of the classes we created.</li></ul></li></ul><div class="alert alert-warning d-flex align-items-start"><i class="fas fa-triangle-exclamation ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><p>Beware, <code>Challenge</code> takes on two roles here:</p><ul><li>Type. When inheriting (in the declaration of <code>class Reverse</code>) or when annotating <code>x</code>, <code>Challenge</code> is treated as a type.</li><li>Constructor. When calling <code>Challenge()</code>, we are instantiating an object.</li></ul></div></div><p>The <strong>type annotation</strong> is a constraint we place on the variable.</p><p>When we run <code>mypy</code> on this file, the type-checker will:</p><ul><li>process class declarations,</li><li>register subtyping relationships ($\texttt{Reverse} &lt;: \texttt{Challenge}$, $\texttt{Web} &lt;: \texttt{Challenge}$), and</li><li>type-check annotations and values.</li></ul><div class="alert alert-success d-flex align-items-start"><i class="fas fa-lightbulb ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><ul><li>$U &lt;: T$ denotes "$U$ is a <strong>subtype</strong> of $T$".</li><li>$U :&gt; T$ denotes "$U$ is a <strong>supertype</strong> of $T$".</li></ul><p><strong>Examples</strong></p><ul><li>$\texttt{int} &lt;: \texttt{object}$</li><li>$\texttt{RuntimeError} &lt;: \texttt{Exception} &lt;: \texttt{BaseException}$</li><li>$\texttt{object} :&gt; \texttt{int}$</li></ul></div></div><p>The type-check passes if the values are subtypes of the annotations. This is also called a <strong>subtype query</strong> (distinguished by $&lt;:^?$).<sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup> Other examples of subtype queries:</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python">x<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">5</span>                  <span class="token comment"># Is type(5) a subtype of int? ✓</span>
y<span class="token punctuation">:</span> <span class="token builtin">float</span> <span class="token operator">=</span> <span class="token string">"abc"</span>            <span class="token comment"># Is type("abc") a subtype of float? ✗</span>
z<span class="token punctuation">:</span> Challenge <span class="token operator">=</span> Reverse<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># Is type(Reverse()) a subtype of Challenge? ✓</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>We'll find out later how to resolve subtype queries. That is, we'll look at how to figure out if a class is a subtype of another class. (<a href="#be-a-subtype-checker">Jump</a>.)</p><p>Subtypes are great for <a href="https://www.programiz.com/python-programming/polymorphism" rel="noreferrer" target="_blank">polymorphism</a> as they allow us to construct containers (lists, arrays, maps) in a concise and type-safe manner. Here's a simple example:</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">class</span> <span class="token class-name">Challenge</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">Reverse</span><span class="token punctuation">(</span>Challenge<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">Web</span><span class="token punctuation">(</span>Challenge<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">Pwn</span><span class="token punctuation">(</span>Challenge<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token comment"># Create a list of different challenges.</span>
chals<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Challenge<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>Reverse<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Web<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Pwn<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><h3 id="invariance-covariance-and-contravariance" tabindex="-1"><a class="md-anchor" href="#invariance-covariance-and-contravariance" aria-hidden="true"></a> Invariance, Covariance, and Contravariance</h3><p>Wow, big mathy terms.</p><p>Suppose we want to display our list of challenges. We create a function <code>display()</code> which takes a list of challenges. But what if we specifically pass in a list of <code>Reverse</code> challenges?</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Create a generic list type using an invariant type variable T.</span>
T <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'T'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">MyList</span><span class="token punctuation">(</span>Generic<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">def</span> <span class="token function">display</span><span class="token punctuation">(</span>chals<span class="token punctuation">:</span> MyList<span class="token punctuation">[</span>Challenge<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

display<span class="token punctuation">(</span>MyList<span class="token punctuation">[</span>Reverse<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># ERROR! Argument 1 to "display" has incompatible type "MyList[Reverse]"; expected "MyList[Challenge]"</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>(N.B. For the sake of this section, I've used a custom <code>MyList</code> type instead of <code>typing.List</code>.)</p><p>But why did this error? Although <code>mypy</code> deduced that $\texttt{Reverse} &lt;: \texttt{Challenge}$, it couldn't deduce that our subtype query $\texttt{MyList[Reverse]} {} &lt;:^? \texttt{MyList[Challenge]}$ holds.</p><p>This is where covariance and contravariance come into play. With these two bad bois, we can derive further relationships on generic types. The two are similar, with a minor difference.</p><div class="alert alert-info d-flex align-items-start"><i class="fas fa-bolt ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><ul><li>Let $F[T]$ be a generic container with type parameter $T$.</li><li>If $T$ is <strong>covariant</strong>, then $A &lt;: B\ \iff\ F[A] &lt;: F[B]$ for any type $A$, $B$.</li><li>If $T$ is <strong>contravariant</strong>, then $A &lt;: B\ \iff\ F[A] :&gt; F[B]$ for any type $A$, $B$.<sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup> (It flips!)</li><li>If $T$ is <strong>invariant</strong>, then $A = B\ \iff\ F[A] = F[B]$. No other subtyping relationships are derived. (This is the default!)</li></ul></div></div><p>Hence, in the previous code example, we can fix the code by adding <code>covariant=True</code>:</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python">T <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'T'</span><span class="token punctuation">,</span> covariant<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>Now $\texttt{MyList[Reverse]} {} &lt;: \texttt{MyList[Challenge]}$, and the program compiles.</p><p>At this point, you should be able to appreciate the double entendre in the title: <em>N[Subtype Metaprogramming] is N[Mostly Harmless]</em>.</p><h2 id="metaprogramming-with-type-hints" tabindex="-1"><a class="md-anchor" href="#metaprogramming-with-type-hints" aria-hidden="true"></a> Metaprogramming with Type Hints</h2><p><a class="lightbox-single" title="SpongeBob agrees: it's all magic." href="/img/posts/programming/concepts/subtype-metaprogramming/assets/magic-584w.webp"><img class="mb-2 rw center jw-50" src="/img/posts/programming/concepts/subtype-metaprogramming/assets/magic-584w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 584 / 427" alt="Spongebob gesturing a rainbow, suggesting metaprogramming with type hints is magic." title="SpongeBob agrees: it's all magic." srcset="/img/posts/programming/concepts/subtype-metaprogramming/assets/magic-256w.webp 256w, /img/posts/programming/concepts/subtype-metaprogramming/assets/magic-512w.webp 512w, /img/posts/programming/concepts/subtype-metaprogramming/assets/magic-584w.webp 584w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 584px"></a></p><div class="alert alert-warning d-flex align-items-start"><i class="fas fa-triangle-exclamation ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><p><strong>Disclaimer: Here be dragons.</strong></p><p>I don't have a PhD in computer science or mathematics. Most things below are rephrased from Roth's paper, but if you spot something erroneous (or have questions), do <a href="#comments">let me</a> <a href="/#contact">know</a>. :D</p></div></div><p>We haven't even started digging through <code>output.py</code>! Thankfully, the challenge author linked a paper for our perusal.</p><h3 id="be-a-subtype-checker" tabindex="-1"><a class="md-anchor" href="#be-a-subtype-checker" aria-hidden="true"></a> Be a Subtype Checker</h3><p>Back to the challenge. The program leverages the <code>mypy</code> type-checker to perform flag-checking. The last line of <code>output.py</code> asks an important question (aka subtype query): <strong>is <code>QRW_s29[L___TAPE_END__[N[...]]]</code> a subtype of <code>E[E[Z]]</code></strong>???</p><p>To answer this subtype query, we need to search for a trail of supertypes leading us from the supposed subtype (<code>QRW_s29[L___TAPE_END__[N[...]]]</code>) to the upper type (<code>E[E[Z]]</code>).</p><div class="alert alert-info d-flex align-items-start"><i class="fas fa-circle-info ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><p>A quick aside.</p><ul><li>We use "$\rightsquigarrow$" to denote a resolution step in the checker.</li><li>For convenience, we simplify expressions by ignoring brackets: $C[D[E[A]]]$ becomes $CDEA$.</li></ul></div></div><p>How does the search go? Meet the two <strong>subtyping rules</strong> used by the type-checker:</p><ol><li><strong>Super</strong>. Substitute a type with its supertype. $$ (C : D) \land (CA &lt;: EB) {} \rightsquigarrow DA &lt;: EB $$ In English, if $C$ has a supertype $D$, we can "go up a level" to <em>search</em> for a match.</li><li><strong>Cancel</strong>.<sup class="footnote-ref"><a href="#fn3" id="fnref3">3</a></sup> Remove the outermost type from both sides of the query. (And flip, since all type parameters are assumed to be contravariant!) $$ EA &lt;: EB \rightsquigarrow A &lt;: B $$ This just comes from our definition of contravariance.</li></ol><p>The search terminates once we find a match $A &lt;: A$.</p><div class="alert alert-success d-flex align-items-start"><i class="fas fa-lightbulb ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><p>What if there are multiple supertypes (due to multiple inheritance)? Wouldn't our paths diverge? Which one do we choose?</p><p>Keep in mind we're performing a <em>search</em>.</p><p>A good heuristic is to choose a supertype that cancels out the outer type on the other side.</p><p>For example:</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">(</span>Generic<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">,</span> A<span class="token punctuation">[</span><span class="token string">"C[T]"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> B<span class="token punctuation">[</span><span class="token string">"A[T]"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> B<span class="token punctuation">[</span>C<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> C<span class="token punctuation">[</span>C<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>Here, choosing $BAT$ allows us to cancel $B$ in the next step.</p><ol><li>$CCZ &lt;:^? BCZ$</li><li>$\rightsquigarrow BACZ &lt;:^? BCZ$ (<strong>Super</strong>)</li><li>$\rightsquigarrow ACZ :&gt;^? CZ$ (<strong>Cancel</strong>)</li></ol></div></div><h3 id="subtype-checking-example" tabindex="-1"><a class="md-anchor" href="#subtype-checking-example" aria-hidden="true"></a> Subtype-Checking Example</h3><p>Let’s walk through an example of an infinite subtyping query.<sup class="footnote-ref"><a href="#fn4" id="fnref4">4</a></sup> Here's the code:</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> TypeVar<span class="token punctuation">,</span> Generic<span class="token punctuation">,</span> Any
z <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">"z"</span><span class="token punctuation">,</span> contravariant<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">N</span><span class="token punctuation">(</span>Generic<span class="token punctuation">[</span>z<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
x <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">"x"</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">(</span>Generic<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">,</span> N<span class="token punctuation">[</span>N<span class="token punctuation">[</span><span class="token string">"C[C[x]]"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">U</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> N<span class="token punctuation">[</span>C<span class="token punctuation">[</span>U<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> C<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># Subtype query: CT &lt;: NCU.</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><div class="alert alert-info d-flex align-items-start"><i class="fas fa-circle-info ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><p><code>"C[C[x]]"</code> is quoted in order to forward-reference <code>C</code>. (We declare and use it in the same statement.)</p></div></div><p>And here's the applied rules:</p><ol><li>$CT &lt;:^? NCU$</li><li>$\rightsquigarrow NNCCT &lt;:^? NCU$ (<strong>Super</strong>)</li><li>$\rightsquigarrow NCCT :&gt;^? CU$ (<strong>Cancel</strong>)</li><li>$\rightsquigarrow NCCT :&gt;^? NNCCU$ (<strong>Super</strong>)</li><li>$\rightsquigarrow CCT &lt;:^? NCCU$ (<strong>Cancel</strong>)</li><li>(and so on...)</li></ol><p>As you may notice, we started with $CT &lt;:^? NCU$, but after 4 steps, another $C$ joined the party. Inductively, this will continue to grow forever (or until <code>mypy</code> runs out of space).</p><h3 id="python-type-hints-are-turing-complete" tabindex="-1"><a class="md-anchor" href="#python-type-hints-are-turing-complete" aria-hidden="true"></a> Python Type Hints are Turing Complete</h3><p>It turns out that Python type hints are Turing Complete thanks to two characteristics: <em>contravariance</em> and <em>expansive-recursive inheritance</em>.</p><ul><li><p><a href="#invariance-covariance-and-contravariance"><strong>Contravariance</strong></a>, as we saw previously, means $A &lt;: B\ \iff\ F[A] :&gt; F[B]$.</p><div class="alert alert-info d-flex align-items-start"><i class="fas fa-circle-info ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><p>In this section, we assume all type parameters are contravariant.</p></div></div></li><li><p><strong>Expansive-Recursive Inheritance</strong> is more complicated to define, but the implications are that we can inherit recursively, and generate infinite, undecidable subtype queries. We saw an example of this in a <a href="#be-a-subtype-checker">previous section</a>. (Read more in §2 of Roth's paper.<sup class="footnote-ref"><a href="#fn5" id="fnref5">5</a></sup>)</p></li></ul><p>With these, Python type hints can (slowly) simulate any Turing machine or computation!</p><details><summary>What is a Turing Machine?</summary><div class="details-content"><div class="alert alert-info d-flex align-items-start"><i class="fas fa-bolt ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><p>A <strong>Turing Machine</strong> is a theoretical computing device that operates on an infinite tape divided into cells. It has a read/write head that follows rules to read, write, and move on the tape based on its current state and the symbol it reads. It repeats this process until it reaches a halting state.</p><p>Turing Machines are powerful because they can solve a wide range of computational problems. They can perform calculations, simulate other machines, and theoretically solve any problem that can be solved by an algorithm. They serve as a fundamental model for understanding the capabilities and limitations of computation.</p><p>Get some intuition by playing the <a href="https://www.google.com/doodles/alan-turings-100th-birthday" rel="noreferrer" target="_blank">Turing Machine Google Doodle</a>.</p></div></div><div class="details-collapse-bottom"><sub><a class="details-collapse-button">(collapse)</a></sub></div></div></details><p>The whole ordeal is rather complicated. Essentially, there are two things to be aware of:</p><ul><li><p>Type Encoding. Different aspects of the tape machine are encoded as types. For example, the <code>L_*</code> encode the set of possible values (excluding $\bot$, i.e. no value), and <code>ML</code> encodes the machine head.</p><p><a class="lightbox-single" title="Table showing various symbols in Grigore's encoding; copied from Roth's paper." href="/img/posts/programming/concepts/subtype-metaprogramming/assets/table1-1120w.webp"><img class="mb-2 rw center jw-70" src="/img/posts/programming/concepts/subtype-metaprogramming/assets/table1-1120w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 1120 / 320" alt="Table showing various symbols in Grigore's encoding; copied from Roth's paper." title="Table showing various symbols in Grigore's encoding; copied from Roth's paper." srcset="/img/posts/programming/concepts/subtype-metaprogramming/assets/table1-256w.webp 256w, /img/posts/programming/concepts/subtype-metaprogramming/assets/table1-512w.webp 512w, /img/posts/programming/concepts/subtype-metaprogramming/assets/table1-1024w.webp 1024w, /img/posts/programming/concepts/subtype-metaprogramming/assets/table1-1120w.webp 1120w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, (max-width: 1024px) 1024px, 1120px"></a></p><p class="caption"><sup>The components of Grigore’s subtyping machine. All classes are parameterised by a contravariant type parameter $x$, except $Z$, which is monomorphic.<sup class="footnote-ref"><a href="#fn5" id="fnref5:1">5</a></sup></sup></p><p class="no-center"></p></li><li><p>Inheritance Rules. These are used to encode state transitions and the general mechanics of the Turing machine.</p><p><a class="lightbox-single" title="Table showing various inheritance rules; copied from Roth's paper." href="/img/posts/programming/concepts/subtype-metaprogramming/assets/table4-1030w.webp"><img class="mb-2 rw center jw-80" src="/img/posts/programming/concepts/subtype-metaprogramming/assets/table4-1030w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 1030 / 674" alt="Table showing various inheritance rules; copied from Roth's paper." title="Table showing various inheritance rules; copied from Roth's paper." srcset="/img/posts/programming/concepts/subtype-metaprogramming/assets/table4-256w.webp 256w, /img/posts/programming/concepts/subtype-metaprogramming/assets/table4-512w.webp 512w, /img/posts/programming/concepts/subtype-metaprogramming/assets/table4-1024w.webp 1024w, /img/posts/programming/concepts/subtype-metaprogramming/assets/table4-1030w.webp 1030w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, (max-width: 1024px) 1024px, 1030px"></a></p><p class="caption"><sup>Roth's subtyping inheritance rules. This image is included to illustrate inheritance rules. They differ from the rules in the challenge (which are based on Grigore's work). The first 4 rows encode Turing Machine state transitions. Again, the type parameter $x$ is contravariant.<sup class="footnote-ref"><a href="#fn5" id="fnref5:2">5</a></sup></sup></p><p class="no-center"></p></li></ul><p>If you want to read more, I suggest reading §1.2 of Roth's paper.<sup class="footnote-ref"><a href="#fn5" id="fnref5:3">5</a></sup></p><h3 id="decoding-the-challenge-s-subtype-query" tabindex="-1"><a class="md-anchor" href="#decoding-the-challenge-s-subtype-query" aria-hidden="true"></a> Decoding the Challenge's Subtype Query</h3><p>Just for fun, let's solve some subtype queries from the challenge. Who needs a job when you're employed as a full-time subtype checker?</p><p>Although the given subtype query in <code>output.py</code> doesn't work, we can still try simpler versions. It turns out the query recurses on the numbers. For example, the following queries compile:</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python">E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QRW_s71<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QRW_s46<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QRW_s06<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_d<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QRW_s30<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_d<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_n<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>We just started with the base case (empty suffix of flag), and worked backwards.</p><p>Let's look closer at the base case:</p><p>$$\texttt{QRW\_s71[...]} &lt;:^? \texttt{E[E[Z]]}.$$</p><p>It turns out this is a special case, since the declaration of <code>QRW_s71</code> inherits from <code>E["E[Z]"]</code>. So with just one <strong>Super</strong> expansion step, we conclude that the base case checks out. Wow, life seems easy as a subtype-checker.</p><p>Let's try the next query.</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">_</span><span class="token punctuation">:</span> E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QRW_s46<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>Although <code>QRW_s46</code> inherits multiple classes, we'll substitute the <code>E["QRL_s46[N[T]]"]</code> supertype, because this allows us to cancel <code>E[...]</code> afterwards.</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Super.</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> E<span class="token punctuation">[</span>QRL_s46<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Cancel.</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> QRL_s46<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>We can carry on...</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">_</span><span class="token punctuation">:</span> QRL_s46<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QRL_s46<span class="token punctuation">[</span>N<span class="token punctuation">[</span>QLW_s46<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QLW_s46<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QLW_s46<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QLW_s46<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QLW_s46<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QLW_s46<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>Boy, work as a subtype checker seems like slave labour.</p><p>Notice that we seem to have... doubled-back? Let's do a quick comparison.</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Initial query.</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QRW_s46<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Midway.</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QLW_s46<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><div class="alert alert-info d-flex align-items-start"><i class="fas fa-bolt ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><p>Indeed, the query has made one pass over the tape. Also notice how:</p><ul><li><code>QRW_s46</code> changes to <code>QLW_s46</code>. (Direction swapped!)</li><li>The chain of tokens is reversed: <code>L___TAPE_END__</code>, <code>L_s</code>, <code>MR</code> becomes <code>MR</code>, <code>L_s</code>, <code>L___TAPE_END__</code>.</li></ul><p>This is one shortcoming of Grigore's encoding of a subtyping machine: it makes a pass over the <em>entire tape</em> before processing a single state on the Turing Machine. This drastically increases the runtime of the machine.</p></div></div><p>Let's continue...</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">_</span><span class="token punctuation">:</span> QLR_s46<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QRW_s46<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QR_s46<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QRW_s71<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_x<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QRW_s71<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_x<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>Oh look! We've arrived back at <code>QRW_s71</code>! Time for another quick comparison:</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># QRW_s71 query (original).</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QRW_s71<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># QRW_s71 query (deduced from QRW_s46).</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QRW_s71<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_x<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>Looks like <code>L___TAPE_END__</code> is replaced with a <code>L_x</code>. Eh, still resolves to <code>E[E[Z]]</code> though, so we're fine. ¯\_(ツ)_/¯</p><p>This was a rather informal attempt at induction, but hopefully it provides some insight on how the subtype query is resolved recursively.</p><h2 id="closing-remarks" tabindex="-1"><a class="md-anchor" href="#closing-remarks" aria-hidden="true"></a> Closing Remarks</h2><p>Overall, this is a remarkable CTF challenge. When opening the files, I was pleasantly surprised, because it's so rare to see type-theoretic challenges.<sup class="footnote-ref"><a href="#fn6" id="fnref6">6</a></sup> (In fact, this was the first type-theoretic chal I've ever seen!)</p><p>I still feel like we cheated the challenge by not going the painstaking, masochistic route of pathfinding the subtype tree. I guess that method would prove more effective if there were more red-herrings (e.g. misleading class inheritances).</p><p>But overall, an intellectually challenging reverse challenge!</p><h2 id="references" tabindex="-1"><a class="md-anchor" href="#references" aria-hidden="true"></a> References</h2><ul><li><a href="https://drops.dagstuhl.de/opus/volltexte/2023/18237/pdf/LIPIcs-ECOOP-2023-44.pdf" rel="noreferrer" target="_blank">Roth, Ori. 2023. <em>Python Type Hints Are Turing Complete</em>.</a><ul><li>Good for intuition + explanation of concepts.</li><li>Builds upon Grigore's paper and presents an optimised subtyping machine.</li></ul></li><li><a href="https://arxiv.org/pdf/1605.05274.pdf" rel="noreferrer" target="_blank">Grigore, Radu. 2016. <em>Java Generics are Turing Complete</em>.</a><ul><li>The implementation of the CTF challenge was based on this paper.</li></ul></li></ul><hr class="footnotes-sep"><b>Footnotes</b><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>N.B. Grigore's and Roth's paper use a different notation ($\blacktriangleleft$ / $\blacktriangleright$) for subtype queries, but I opted to use $&lt;:^?$ / $:&gt;^?$ instead. <a href="#fnref1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p>You may be wondering how the heck is contravariance useful. Well, it's immensely useful for functions and <a href="https://docs.scala-lang.org/tour/variances.html#contravariance" rel="noreferrer" target="_blank">serialisers</a>. <a href="#fnref2" class="footnote-backref">↩︎</a></p></li><li id="fn3" class="footnote-item"><p>In the paper, they use <strong>Var</strong> instead of <strong>Cancel</strong>, but I think the latter conveys the operation better. <a href="#fnref3" class="footnote-backref">↩︎</a></p></li><li id="fn4" class="footnote-item"><p>Blatantly taken from Roth's paper. <a href="#fnref4" class="footnote-backref">↩︎</a></p></li><li id="fn5" class="footnote-item"><p><a href="https://drops.dagstuhl.de/opus/volltexte/2023/18237/pdf/LIPIcs-ECOOP-2023-44.pdf" rel="noreferrer" target="_blank">Roth, Ori. 2023. <em>Python Type Hints Are Turing Complete</em>.</a> <a href="#fnref5" class="footnote-backref">↩︎</a> <a href="#fnref5:1" class="footnote-backref">↩︎</a> <a href="#fnref5:2" class="footnote-backref">↩︎</a> <a href="#fnref5:3" class="footnote-backref">↩︎</a></p></li><li id="fn6" class="footnote-item"><p>I was also slightly disappointed when it turns out the solution was rather straightforward. But eh, it was fun reading the paper. :D <a href="#fnref6" class="footnote-backref">↩︎</a></p></li></ol></section></div><a id="end-of-article"></a><br><script defer src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><div class="post-share dim-gentle mb-3 d-flex flex-row align-items-center"><div class="d-flex flex-row flex-wrap align-items-center gap-3"><span>Share&nbsp;on</span> <a class="no-decoration" data-sharer="reddit" data-title="Subtype Metaprogramming is Mostly Harmless" data-url="/posts/subtype-metaprogramming-is-mostly-harmless/"><span class="fs-4"><i class="fab fa-reddit"></i> </span></a><a class="no-decoration" data-sharer="telegram" data-title="Subtype Metaprogramming is Mostly Harmless" data-url="/posts/subtype-metaprogramming-is-mostly-harmless/"><span class="fs-4"><i class="fab fa-telegram"></i> </span></a><a class="no-decoration" data-sharer="whatsapp" data-title="Subtype Metaprogramming is Mostly Harmless" data-url="/posts/subtype-metaprogramming-is-mostly-harmless/"><span class="fs-4"><i class="fab fa-whatsapp"></i> </span></a><a class="no-decoration" data-sharer="linkedin" data-title="Subtype Metaprogramming is Mostly Harmless" data-url="/posts/subtype-metaprogramming-is-mostly-harmless/"><span class="fs-4"><i class="fab fa-linkedin"></i> </span></a><a class="no-decoration" data-sharer="vk" data-title="Subtype Metaprogramming is Mostly Harmless" data-url="/posts/subtype-metaprogramming-is-mostly-harmless/"><span class="fs-4"><i class="fab fa-vk"></i> </span></a><a class="no-decoration" data-sharer="twitter" data-title="Subtype Metaprogramming is Mostly Harmless" data-url="/posts/subtype-metaprogramming-is-mostly-harmless/"><span class="fs-4"><i class="fab fa-twitter"></i> </span></a><a id="copy-link-button" class="no-decoration" data-bs-toggle="tooltip" data-bs-trigger="click" title="Link copied!"><span class="fs-4"><i class="fas fa-link"></i></span></a></div></div><hr><div id="post-author-container" class="d-flex justify-content-between align-items-center gap-3" itemprop="author" itemscope itemtype="https://schema.org/Person"><img src="/img/profile-icon.jpg" class="profile-img" alt="" loading="lazy" decoding="async" itemprop="image"><div class="author-info d-flex flex-column gap-1"><p class="profile-name" itemprop="name">TrebledJ</p><p class="profile-bio" itemprop="description">Passionate problem-solver, pentester, and autodidact. I thrive on learning new things and enjoy passing it on. When not immersed in bughunting or programming, I can be found taking walks, composing a short tune, and occasionally indulging in CTF challenges.</p></div></div><hr class="section-sep"><div id="related" class="jw-100"><h3><i class="fas fa-circle-nodes me-2"></i>Related Posts</h3><div class="row gx-3 mt-4"><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/hkcert-2023-decompetition-vitamin-cpp/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/hkcert-2023-decompetition-vitamin-cpp/"><img class="post-img-blurred-bg" src="/img/posts/ctf/hkcert23/assets/vitamin-cpp-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 288" alt="Thumbnail for HKCERT CTF 2023 – Decompetition: Vitamin&nbsp;C++" srcset="/img/posts/ctf/hkcert23/assets/vitamin-cpp-256w.webp 256w, /img/posts/ctf/hkcert23/assets/vitamin-cpp-512w.webp 512w, /img/posts/ctf/hkcert23/assets/vitamin-cpp-640w.webp 640w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/ctf/hkcert23/assets/vitamin-cpp-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 288" alt="Thumbnail for HKCERT CTF 2023 – Decompetition: Vitamin&nbsp;C++" srcset="/img/posts/ctf/hkcert23/assets/vitamin-cpp-256w.webp 256w, /img/posts/ctf/hkcert23/assets/vitamin-cpp-512w.webp 512w, /img/posts/ctf/hkcert23/assets/vitamin-cpp-640w.webp 640w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">HKCERT CTF 2023 – Decompetition: Vitamin&nbsp;C++</h2><div class="post-summary"><p>A beginner-friendly writeup to reverse-engineering C++ a lá decompetition. Years of complex shenanigans condensed!</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/writeup/" itemprop="keywords">writeup</a> </span><span><a class="jtag" href="/tags/reverse/" itemprop="keywords">reverse</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/hitcon-2023-the-blade/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/hitcon-2023-the-blade/"><img class="post-img-blurred-bg" src="/img/posts/ctf/hitcon23/assets/hitcon-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 206" alt="Thumbnail for HITCON 2023 – The Blade" srcset="/img/posts/ctf/hitcon23/assets/hitcon-thumbnail-256w.webp 256w, /img/posts/ctf/hitcon23/assets/hitcon-thumbnail-512w.webp 512w, /img/posts/ctf/hitcon23/assets/hitcon-thumbnail-1024w.webp 1024w, /img/posts/ctf/hitcon23/assets/hitcon-thumbnail-1570w.webp 1570w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/ctf/hitcon23/assets/hitcon-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 206" alt="Thumbnail for HITCON 2023 – The Blade" srcset="/img/posts/ctf/hitcon23/assets/hitcon-thumbnail-256w.webp 256w, /img/posts/ctf/hitcon23/assets/hitcon-thumbnail-512w.webp 512w, /img/posts/ctf/hitcon23/assets/hitcon-thumbnail-1024w.webp 1024w, /img/posts/ctf/hitcon23/assets/hitcon-thumbnail-1570w.webp 1570w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">HITCON 2023 – The Blade</h2><div class="post-summary"><p>Beginner-friendly writeup for a nifty Rust reversing challenge.</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/writeup/" itemprop="keywords">writeup</a> </span><span><a class="jtag" href="/tags/reverse/" itemprop="keywords">reverse</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/ductf-2023-wrong-signal/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/ductf-2023-wrong-signal/"><img class="post-img-blurred-bg" src="/img/posts/ctf/ductf23/assets/straight-to-oops-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 287" alt="Thumbnail for DUCTF 2023 – Wrong Signal" srcset="/img/posts/ctf/ductf23/assets/straight-to-oops-256w.webp 256w, /img/posts/ctf/ductf23/assets/straight-to-oops-512w.webp 512w, /img/posts/ctf/ductf23/assets/straight-to-oops-888w.webp 888w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/ctf/ductf23/assets/straight-to-oops-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 287" alt="Thumbnail for DUCTF 2023 – Wrong Signal" srcset="/img/posts/ctf/ductf23/assets/straight-to-oops-256w.webp 256w, /img/posts/ctf/ductf23/assets/straight-to-oops-512w.webp 512w, /img/posts/ctf/ductf23/assets/straight-to-oops-888w.webp 888w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">DUCTF 2023 – Wrong Signal</h2><div class="post-summary"><p>You straight to <code>oops()</code>. Right away.</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/writeup/" itemprop="keywords">writeup</a> </span><span><a class="jtag" href="/tags/reverse/" itemprop="keywords">reverse</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/ductf-2022-ezpz-rev/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/ductf-2022-ezpz-rev/"><img class="post-img-blurred-bg" src="/img/posts/ctf/ductf22/assets/reverse-ultrascan-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 384" alt="Thumbnail for DownUnderCTF 2022 – ezpz-rev" srcset="/img/posts/ctf/ductf22/assets/reverse-ultrascan-256w.webp 256w, /img/posts/ctf/ductf22/assets/reverse-ultrascan-512w.webp 512w, /img/posts/ctf/ductf22/assets/reverse-ultrascan-577w.webp 577w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/ctf/ductf22/assets/reverse-ultrascan-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 384" alt="Thumbnail for DownUnderCTF 2022 – ezpz-rev" srcset="/img/posts/ctf/ductf22/assets/reverse-ultrascan-256w.webp 256w, /img/posts/ctf/ductf22/assets/reverse-ultrascan-512w.webp 512w, /img/posts/ctf/ductf22/assets/reverse-ultrascan-577w.webp 577w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">DownUnderCTF 2022 – ezpz-rev</h2><div class="post-summary"><p>Grid puzzles aren't that easy.</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/writeup/" itemprop="keywords">writeup</a> </span><span><a class="jtag" href="/tags/reverse/" itemprop="keywords">reverse</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/tamuctf-2022-labyrinth/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/tamuctf-2022-labyrinth/"><img class="post-img-blurred-bg" src="/img/posts/ctf/tamuctf22/assets/labyrinth-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 221" alt="Thumbnail for TAMUctf 2022 – Labyrinth" srcset="/img/posts/ctf/tamuctf22/assets/labyrinth-thumbnail-256w.webp 256w, /img/posts/ctf/tamuctf22/assets/labyrinth-thumbnail-512w.webp 512w, /img/posts/ctf/tamuctf22/assets/labyrinth-thumbnail-1024w.webp 1024w, /img/posts/ctf/tamuctf22/assets/labyrinth-thumbnail-1800w.webp 1800w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/ctf/tamuctf22/assets/labyrinth-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 221" alt="Thumbnail for TAMUctf 2022 – Labyrinth" srcset="/img/posts/ctf/tamuctf22/assets/labyrinth-thumbnail-256w.webp 256w, /img/posts/ctf/tamuctf22/assets/labyrinth-thumbnail-512w.webp 512w, /img/posts/ctf/tamuctf22/assets/labyrinth-thumbnail-1024w.webp 1024w, /img/posts/ctf/tamuctf22/assets/labyrinth-thumbnail-1800w.webp 1800w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">TAMUctf 2022 – Labyrinth</h2><div class="post-summary"><p>Using CFGs to solve a control-flow maze.</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/writeup/" itemprop="keywords">writeup</a> </span><span><a class="jtag" href="/tags/reverse/" itemprop="keywords">reverse</a></span></div></div></div></div></article></div></div><hr><h3><i class="fas fa-tags me-2"></i>Related Tags</h3><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to ctf, reverse">software.security</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/ctf/">ctf</a> <a class="jtag" href="/tags/infosec/">infosec</a> <a class="jtag" href="/tags/reverse/">reverse</a> <a class="jtag" href="/tags/pentesting/">pentesting</a> <a class="jtag" href="/tags/pwn/">pwn</a> <a class="jtag" href="/tags/cryptography/">cryptography</a> <a class="jtag" href="/tags/redteam/">redteam</a> <a class="jtag" href="/tags/stego/">stego</a></span></div><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to metaprogramming, oop, programming, programming-languages, types">software.general</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/programming/">programming</a> <a class="jtag" href="/tags/software-engineering/">software-engineering</a> <a class="jtag" href="/tags/web/">web</a> <a class="jtag" href="/tags/aoc/">aoc</a> <a class="jtag" href="/tags/apps/">apps</a> <a class="jtag" href="/tags/dsp/">dsp</a> <a class="jtag" href="/tags/programming-languages/">programming-languages</a> <a class="jtag" href="/tags/linux/">linux</a> <a class="jtag" href="/tags/performance/">performance</a> <a class="jtag" href="/tags/functional/">functional</a> <a class="jtag" href="/tags/types/">types</a> <a class="jtag" href="/tags/windows/">windows</a> <a class="jtag" href="/tags/ai/">ai</a> <a class="jtag" href="/tags/metaprogramming/">metaprogramming</a> <a class="jtag" href="/tags/oop/">oop</a></span></div><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to python">software.programming-language</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/cpp/">cpp</a> <a class="jtag" href="/tags/python/">python</a> <a class="jtag" href="/tags/c/">c</a> <a class="jtag" href="/tags/haskell/">haskell</a> <a class="jtag" href="/tags/js/">js</a> <a class="jtag" href="/tags/qt/">qt</a> <a class="jtag" href="/tags/rust/">rust</a> <a class="jtag" href="/tags/qml/">qml</a> <a class="jtag" href="/tags/sql/">sql</a> <a class="jtag" href="/tags/scala/">scala</a></span></div><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to tutorial, writeup">misc</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/writeup/">writeup</a> <a class="jtag" href="/tags/notes/">notes</a> <a class="jtag" href="/tags/tutorial/">tutorial</a> <a class="jtag" href="/tags/reflection/">reflection</a> <a class="jtag" href="/tags/hkust/">hkust</a> <a class="jtag" href="/tags/project/">project</a> <a class="jtag" href="/tags/experience/">experience</a> <a class="jtag" href="/tags/faith/">faith</a> <a class="jtag" href="/tags/meta/">meta</a> <a class="jtag" href="/tags/learning/">learning</a> <a class="jtag" href="/tags/mathematics/">mathematics</a> <a class="jtag" href="/tags/cheatsheet/">cheatsheet</a> <a class="jtag" href="/tags/research/">research</a> <a class="jtag" href="/tags/satire/">satire</a> <a class="jtag" href="/tags/essay/">essay</a> <a class="jtag" href="/tags/reading/">reading</a></span></div></div><hr class="section-sep"><div class="container-md mt-4 p-4"><a id="comments"></a><p><em>Comments are back! Privacy-focused, without ads, bloatware 🤮, and trackers. Be one of the first to contribute to the discussion — I'd love to hear your thoughts.</em></p><script defer src="https://trebledj.me/js/comentario.min.js"></script><comentario-comments id="comentario" auto-init="false" no-fonts="true" css-override="false" theme="dark"></comentario-comments></div><br></div></div></article></div></div></div><footer class="d-flex flex-column gap-2"><div class="d-flex flex-row gap-3 mx-auto" style="width:fit-content;"><a rel="me noreferrer" href="https://github.com/TrebledJ" target="_blank"><i class="social-icon fab fa-github" style="color:rgb(150, 60, 180) !important;"></i> </a><a rel="me noreferrer" href="https://stackoverflow.com/users/10239789/trebledj" target="_blank"><i class="social-icon fab fa-stack-overflow" style="color:rgb(236, 124, 34) !important;"></i> </a><a rel="me noreferrer" href="https://www.codingame.com/profile/8444100ecb9723c1ec542346b0630aaa2821532" target="_blank"><i class="social-icon d-flex flex-column"><img src="/img/logos/codingame.webp" alt="" loading="lazy" decoding="async"></i></a><a rel="me noreferrer" href="https://soundcloud.com/trebledj" target="_blank"><i class="social-icon fab fa-soundcloud" style="color:rgb(237, 110, 30) !important;"></i> </a><a rel="me noreferrer" href="https://musescore.com/user/20636901" target="_blank"><i class="social-icon d-flex flex-column"><img src="/img/logos/musescore.webp" alt="" loading="lazy" decoding="async"></i></a><a rel="me noreferrer" href="https://discordapp.com/users/220427982798454794" target="_blank"><i class="social-icon fab fa-discord" style="color:rgb(84, 100, 235) !important;"></i> </a><a rel="me" href="mailto:trebledjjj@gmail.com"><i class="social-icon fas fa-envelope"></i> </a><a rel="me" href="/feeds"><i class="social-icon fas fa-square-rss"></i></a></div><p>Copyright&nbsp;©&nbsp;2025&nbsp;TrebledJ • <a href="/privacy-policy">Privacy&nbsp;Policy</a> • <a href="https://github.com/TrebledJ/trebledj.github.io?tab=readme-ov-file#credits--appreciation" rel="noreferrer" target="_blank">Credits</a></p></footer><script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js"></script><script>var tocOptions={}</script><script defer src="/cb/MPnrKnjI5w.js"></script><link href="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css" rel="stylesheet" media="print"><script>document.querySelectorAll('link[media|="print"]').forEach(e=>{e.addEventListener("load",()=>e.media="all"),e.sheet&&(e.media="all")})</script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js" integrity="sha384-cMkvdD8LoxVzGF/RPUKAcvmm49FQ0oxwDF3BGKtDXcEc+T1b2N+teh/OJfpU0jr6" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js" integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh" crossorigin="anonymous"></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!0})})</script><script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;52d99b3d385b4c9a98ac8ad109a95a2a&quot;}"></script></body></html>